# Android Native Project

This directory contains the Android native project for Habitat, managed by Capacitor. It is committed to version control because the project includes custom native code and configuration that cannot be regenerated automatically.

## Custom modifications

These files have been manually modified from the default Capacitor scaffold and **must not be overwritten** by `npx cap add android`:

| File | Purpose |
|------|---------|
| `app/src/main/java/com/habitat/app/BatteryOptimPlugin.java` | Custom Capacitor plugin that checks and requests exemption from Android battery optimization, ensuring reminders fire when the app is closed. |
| `app/src/main/java/com/habitat/app/MainActivity.java` | Registers `BatteryOptimPlugin` with the Capacitor bridge. |
| `app/src/main/AndroidManifest.xml` | Declares `POST_NOTIFICATIONS`, `SCHEDULE_EXACT_ALARM`, `RECEIVE_BOOT_COMPLETED`, and `REQUEST_IGNORE_BATTERY_OPTIMIZATIONS` permissions required for reliable notification delivery. |
| `app/src/main/res/drawable-*/ic_notification.png` | Notification small icon (white silhouette on transparent background). Android requires this format for the status bar icon; the system applies `iconColor` tint. |
| `app/src/main/res/mipmap-*/ic_launcher*.png` | Habitat-branded launcher icons replacing the default Capacitor icons. |
| `app/src/main/res/mipmap-anydpi-v26/ic_launcher*.xml` | Adaptive icon definitions pointing to foreground/background layers. |
| `app/src/main/res/values/ic_launcher_background.xml` | Adaptive icon background color (`#18181b`) matching the app's dark theme. |

## What is auto-generated (gitignored)

These files are regenerated by `npx cap sync` and should never be committed:

- `app/src/main/assets/public/` -- synced web build output
- `app/src/main/assets/capacitor.config.json` -- generated from `capacitor.config.ts`
- `app/src/main/assets/capacitor.plugins.json` -- generated plugin registry
- `app/src/main/res/xml/config.xml` -- generated Cordova-compat config
- `app/capacitor.build.gradle` -- generated plugin Gradle dependencies
- `capacitor.settings.gradle` -- generated plugin Gradle includes
- `capacitor-cordova-android-plugins/` -- generated Cordova plugin bridge

Build artifacts (`build/`, `.gradle/`, `*.apk`, etc.) are also gitignored.

## Building

```bash
# Sync web assets to the native project
pnpm cap:sync

# Build and run on a connected device/emulator
pnpm cap:run:android

# Build a debug APK directly
cd android && ./gradlew assembleDebug
```
