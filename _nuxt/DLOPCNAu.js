import{e as de,f as ue,C as pe,h as fe,o as l,c as r,j as o,i as xe,b as x,w as L,d as A,k as me,F as v,a as n,t as a,r as U,n as y,l as Q,m as ge,q as m,p as V,s as ye,x as _e,v as Z,_ as ve,z as _,A as B,y as N,D as he}from"./B4ebfuTa.js";import{u as ke}from"./-led405M.js";import{u as we}from"./D3ohnzwY.js";const Ce={class:"space-y-5"},be={key:0,class:"flex flex-col items-center justify-center gap-7 pt-10 pb-4 text-center"},De={class:"text-sm text-slate-500"},Se={class:"text-2xl font-bold"},Ie={class:"flex flex-col items-center gap-1.5 py-2"},Le={class:"relative"},Ne={width:"160",height:"160",viewBox:"0 0 100 100"},Me=["stroke-dashoffset"],Oe={class:"absolute inset-0 flex flex-col items-center justify-center gap-0.5"},Ee={class:"text-3xl font-bold tabular-nums leading-none"},je={class:"text-xs text-slate-500"},Fe={class:"text-xs font-medium"},Re={key:0,class:"text-primary-400"},Ae={key:1,class:"text-slate-500"},Ue={class:"space-y-2"},Ve={class:"flex-1 min-w-0"},Be={class:"flex items-center gap-1.5 min-w-0"},He={key:0,class:"text-xs text-slate-500"},Te={key:0,class:"ml-2 text-slate-600"},$e={key:0,class:"ml-2 text-slate-600"},Pe={key:2,class:"text-xs text-slate-500"},ze={key:3,class:"flex flex-wrap gap-1 mt-1"},qe={key:4,class:"flex flex-wrap gap-x-3 gap-y-0.5 mt-0.5"},We=["disabled","onClick"],Ke=["onUpdate:modelValue","onKeyup"],Ye=["disabled","onClick"],Xe=["onClick"],Ge={key:0,class:"w-5 flex-shrink-0 flex items-center justify-center"},Je={key:0,class:"space-y-2"},Qe={class:"space-y-1.5"},Ze={class:"w-8 h-8 rounded-full bg-primary-500/10 flex-shrink-0 flex items-center justify-center"},et={class:"flex-1 min-w-0"},tt={class:"text-sm font-medium text-slate-100 truncate"},st={class:"text-xs text-slate-500"},ot={class:"w-8 h-8 rounded-full bg-amber-500/10 flex-shrink-0 flex items-center justify-center"},nt={class:"flex-1 min-w-0"},lt={class:"text-xs text-slate-500"},rt={class:"w-8 h-8 rounded-full bg-rose-500/10 flex-shrink-0 flex items-center justify-center"},at={class:"flex-1 min-w-0"},it={class:"text-xs text-slate-500"},W=42,ft=de({__name:"index",setup(ct){const u=ue(),{impact:K}=ke(),{settings:b}=we();pe(()=>{b.value.enableToday||he("/habits")});const p=new Date().toISOString().slice(0,10),ee=new Date().getDay(),te=new Date().toLocaleDateString("en-US",{weekday:"long"}),se=new Date().toLocaleDateString("en-US",{month:"long",day:"numeric"}),M=(()=>{const t=new Date;return t.setDate(t.getDate()-t.getDay()),t.toISOString().slice(0,10)})(),H=_([]),T=_([]),O=_([]),$=_([]),P=_([]),E=_(!0),j=B(new Set),D=B(new Set),S=B(new Set),F=B({}),z=_([]),I=_([]),k=_(0);function oe(){return new Promise((t,s)=>{const c=indexedDB.open("habitat",1);c.onupgradeneeded=()=>c.result.createObjectStore("voice_notes",{keyPath:"id"}),c.onsuccess=()=>t(c.result),c.onerror=()=>s(c.error)})}async function ne(){try{const t=await oe(),s=await new Promise((c,i)=>{const f=t.transaction("voice_notes","readonly").objectStore("voice_notes").getAll();f.onsuccess=()=>c(f.result),f.onerror=()=>i(f.error)});k.value=s.filter(c=>c.created_at.slice(0,10)===p).length}catch{k.value=0}}async function le(){if(!u.isAvailable){E.value=!1;return}const[t,s,c,i,f,e,d]=await Promise.all([u.getHabits(),u.getCompletionsForDate(p),u.getHabitLogsForDate(p),u.getCompletionsForDateRange(M,p),u.getHabitLogsForDateRange(M,p),u.getCheckinSummaryForDate(p),u.getScribblesForDate(p)]);H.value=t,T.value=s,O.value=c,$.value=i,P.value=f,z.value=e,I.value=d,E.value=!1,ne()}const q=N(()=>H.value.filter(t=>{if(t.paused_until&&t.paused_until>=p)return!1;const s=t.schedule;return s&&s.schedule_type==="SPECIFIC_DAYS"?s.days_of_week?.includes(ee)??!1:!0}));function w(t){return O.value.filter(s=>s.habit_id===t).reduce((s,c)=>s+c.value,0)}function h(t){return t.type==="BOOLEAN"?T.value.some(s=>s.habit_id===t.id):t.type==="NUMERIC"?w(t.id)>=t.target_value:w(t.id)<t.target_value}function Y(t){return w(t.id)>=t.target_value}function g(t){if(t.schedule?.schedule_type!=="WEEKLY_FLEX")return null;const s=t.schedule.frequency_count??7;return t.type==="BOOLEAN"?{done:$.value.filter(i=>i.habit_id===t.id).length,target:s}:{done:new Set(P.value.filter(i=>i.habit_id===t.id).map(i=>i.date)).size,target:s}}const R=N(()=>q.value.filter(t=>h(t)).length),C=N(()=>q.value.length),re=N(()=>C.value>0?R.value/C.value:0),X=2*Math.PI*W,ae=N(()=>X*(1-re.value));async function ie(t){if(j.has(t.id))return;j.add(t.id);const s=h(t);try{await u.toggleCompletion(t.id,p),T.value=await u.getCompletionsForDate(p),$.value=await u.getCompletionsForDateRange(M,p),await K(s?"light":"medium")}finally{j.delete(t.id)}}function ce(t){F[t.id]=b.value.logInputMode==="absolute"?w(t.id):1,S.add(t.id)}async function G(t){if(D.has(t.id))return;const s=F[t.id]??0,c=b.value.logInputMode==="absolute";if(!(!c&&s<=0)){D.add(t.id);try{if(c){const i=O.value.filter(f=>f.habit_id===t.id);await Promise.all(i.map(f=>u.deleteHabitLog(f.id))),s>0&&await u.logHabitValue(t.id,p,s)}else await u.logHabitValue(t.id,p,s);O.value=await u.getHabitLogsForDate(p),P.value=await u.getHabitLogsForDateRange(M,p),S.delete(t.id),await K("medium")}finally{D.delete(t.id)}}}return fe(le),(t,s)=>{const c=me,i=ge,f=ve;return l(),r("div",Ce,[!o(E)&&o(H).length===0?(l(),r("div",be,[s[1]||(s[1]=xe('<div class="relative flex items-center justify-center"><div class="absolute w-44 h-44 rounded-full bg-primary-500/10 blur-3xl"></div><svg class="plant-logo relative w-24 h-28" viewBox="0 0 40 44" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M 8,40 C 12,37 28,37 32,40" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round"></path><line x1="20" y1="40" x2="20" y2="24" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"></line><path d="M 20,24 C 11,23 4,29 8,34 C 11,37 19,30 20,24" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 20,24 C 26,20 32,14 30,8 C 28,5 20,13 20,24" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><div class="space-y-2 max-w-xs"><h2 class="text-2xl font-bold leading-snug">Welcome to Your<br>New Routine</h2><p class="text-sm text-slate-500 leading-relaxed"> Private, offline, and flexible habit tracking. Let&#39;s get started. </p></div>',2)),x(c,{to:"/habits",size:"lg",icon:"i-heroicons-plus",class:"px-8"},{default:L(()=>[...s[0]||(s[0]=[A(" Create My First Habit ",-1)])]),_:1})])):o(E)?m("",!0):(l(),r(v,{key:1},[n("header",null,[n("p",De,a(o(se)),1),n("h2",Se,a(o(te)),1)]),n("div",Ie,[n("div",Le,[(l(),r("svg",Ne,[n("circle",{cx:"50",cy:"50",r:W,fill:"none","stroke-width":"8",stroke:"#1e293b"}),n("circle",{cx:"50",cy:"50",r:W,fill:"none","stroke-width":"8",stroke:"#22d3ee","stroke-linecap":"round","stroke-dasharray":X,"stroke-dashoffset":o(ae),transform:"rotate(-90 50 50)",style:{transition:"stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1)"}},null,8,Me)])),n("div",Oe,[n("span",Ee,a(o(R)),1),n("span",je,"of "+a(o(C)),1)])]),n("p",Fe,[o(R)===o(C)&&o(C)>0?(l(),r("span",Re,"All done today!")):(l(),r("span",Ae,a(o(C)-o(R))+" remaining",1))])]),n("ul",Ue,[(l(!0),r(v,null,U(o(q),e=>(l(),r("li",{key:e.id,class:y(["flex items-center gap-3 p-3 rounded-xl border transition-all duration-200",h(e)?"bg-slate-900/50 border-slate-800/50 opacity-70":"bg-slate-900 border-slate-800"])},[n("div",{class:"w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center",style:Q({backgroundColor:e.color+"22"})},[x(i,{name:e.icon,class:"w-5 h-5",style:Q({color:e.color})},null,8,["name","style"])],4),n("div",Ve,[n("div",Be,[n("p",{class:y(["text-sm font-medium truncate transition-colors",h(e)&&e.type==="BOOLEAN"?"line-through text-slate-500":"text-slate-100"])},a(e.name),3),e.type!=="BOOLEAN"?(l(),r("span",{key:0,class:y(["shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded",e.type==="NUMERIC"?"bg-primary-500/15 text-primary-400":"bg-amber-500/15 text-amber-400"])},a(e.type==="NUMERIC"?"# Metric":"↓ Limit"),3)):m("",!0)]),e.type==="NUMERIC"?(l(),r("p",He,[A(a(w(e.id))+" / "+a(e.target_value)+" ",1),g(e)?(l(),r("span",Te," · "+a(g(e).done)+"/"+a(g(e).target)+" this week ",1)):m("",!0)])):e.type==="LIMIT"?(l(),r("p",{key:1,class:y(["text-xs",Y(e)?"text-red-400":"text-slate-500"])},[A(a(w(e.id))+" / "+a(e.target_value)+" limit ",1),g(e)?(l(),r("span",$e," · "+a(g(e).done)+"/"+a(g(e).target)+" this week ",1)):m("",!0)],2)):g(e)?(l(),r("p",Pe,a(g(e).done)+"/"+a(g(e).target)+" this week ",1)):m("",!0),o(b).showTagsOnToday&&e.tags.length?(l(),r("div",ze,[(l(!0),r(v,null,U(e.tags,d=>(l(),r("span",{key:d,class:y(["px-1.5 py-0.5 rounded text-[9px]",d.startsWith("habitat-")?"bg-cyan-900/40 text-cyan-600":"bg-slate-800 text-slate-500"])},"#"+a(d.startsWith("habitat-")?d.slice(8):d),3))),128))])):m("",!0),o(b).showAnnotationsOnToday&&Object.keys(e.annotations).length?(l(),r("div",qe,[(l(!0),r(v,null,U(e.annotations,(d,J)=>(l(),r("span",{key:J,class:"text-[9px] text-slate-600"},a(J)+": "+a(d),1))),128))])):m("",!0)]),e.type==="BOOLEAN"?(l(),r("button",{key:0,class:y(["w-7 h-7 rounded-full border-2 flex-shrink-0 flex items-center justify-center transition-all duration-200",h(e)?"bg-primary-500 border-primary-500":"border-slate-700 hover:border-slate-500 bg-transparent"]),disabled:o(j).has(e.id),onClick:d=>ie(e)},[h(e)?(l(),V(i,{key:0,name:"i-heroicons-check",class:"w-3.5 h-3.5 text-white"})):m("",!0)],10,We)):(l(),r(v,{key:1},[o(S).has(e.id)?(l(),r(v,{key:0},[ye(n("input",{"onUpdate:modelValue":d=>o(F)[e.id]=d,type:"number",min:"0",step:"any",class:y(["w-16 px-2 py-1 text-sm bg-slate-800 border border-slate-600 rounded-lg text-slate-100 text-center focus:outline-none",e.type==="NUMERIC"?"focus:border-primary-500":"focus:border-amber-500"]),onKeyup:[Z(d=>G(e),["enter"]),Z(d=>o(S).delete(e.id),["escape"])]},null,42,Ke),[[_e,o(F)[e.id],void 0,{number:!0}]]),n("button",{class:y(["w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0",e.type==="NUMERIC"?"bg-primary-500":"bg-amber-500"]),disabled:o(D).has(e.id),onClick:d=>G(e)},[x(i,{name:"i-heroicons-check",class:"w-3.5 h-3.5 text-white"})],10,Ye),n("button",{class:"w-7 h-7 rounded-full border border-slate-700 flex items-center justify-center flex-shrink-0 text-slate-500",onClick:d=>o(S).delete(e.id)},[x(i,{name:"i-heroicons-x-mark",class:"w-3.5 h-3.5"})],8,Xe)],64)):(l(),r(v,{key:1},[x(c,{size:"xs",variant:"soft",color:e.type==="LIMIT"&&Y(e)?"error":e.type==="NUMERIC"?"primary":"warning",disabled:o(D).has(e.id),onClick:d=>ce(e)},{default:L(()=>[...s[2]||(s[2]=[A(" Log ",-1)])]),_:1},8,["color","disabled","onClick"]),h(e)?(l(),r("div",Ge,[x(i,{name:"i-heroicons-check-circle",class:y(["w-5 h-5",e.type==="NUMERIC"?"text-primary-400":"text-amber-400"])},null,8,["class"])])):m("",!0)],64))],64))],2))),128))]),o(z).length>0||o(I).length>0||o(k)>0?(l(),r("section",Je,[s[5]||(s[5]=n("p",{class:"text-xs font-semibold uppercase tracking-wider text-slate-500 px-1"},"Today's Activity",-1)),n("div",Qe,[(l(!0),r(v,null,U(o(z),e=>(l(),V(f,{key:e.template_id,to:`/checkin/${e.template_id}`,class:"flex items-center gap-3 p-3 rounded-xl bg-slate-900 border border-slate-800 hover:border-slate-700 transition-colors"},{default:L(()=>[n("div",Ze,[x(i,{name:"i-heroicons-pencil-square",class:"w-4 h-4 text-primary-400"})]),n("div",et,[n("p",tt,a(e.title),1),n("p",st,a(e.response_count)+" "+a(e.response_count===1?"response":"responses"),1)]),x(i,{name:"i-heroicons-chevron-right",class:"w-4 h-4 text-slate-600 flex-shrink-0"})]),_:2},1032,["to"]))),128)),o(I).length>0?(l(),V(f,{key:0,to:"/scribbles",class:"flex items-center gap-3 p-3 rounded-xl bg-slate-900 border border-slate-800 hover:border-slate-700 transition-colors"},{default:L(()=>[n("div",ot,[x(i,{name:"i-heroicons-pencil",class:"w-4 h-4 text-amber-400"})]),n("div",nt,[s[3]||(s[3]=n("p",{class:"text-sm font-medium text-slate-100"},"Scribbles",-1)),n("p",lt,a(o(I).length)+" "+a(o(I).length===1?"note":"notes")+" updated today ",1)]),x(i,{name:"i-heroicons-chevron-right",class:"w-4 h-4 text-slate-600 flex-shrink-0"})]),_:1})):m("",!0),o(k)>0?(l(),V(f,{key:1,to:"/voice",class:"flex items-center gap-3 p-3 rounded-xl bg-slate-900 border border-slate-800 hover:border-slate-700 transition-colors"},{default:L(()=>[n("div",rt,[x(i,{name:"i-heroicons-microphone",class:"w-4 h-4 text-rose-400"})]),n("div",at,[s[4]||(s[4]=n("p",{class:"text-sm font-medium text-slate-100"},"Voice Notes",-1)),n("p",it,a(o(k))+" "+a(o(k)===1?"recording":"recordings")+" today ",1)]),x(i,{name:"i-heroicons-chevron-right",class:"w-4 h-4 text-slate-600 flex-shrink-0"})]),_:1})):m("",!0)])])):m("",!0)],64))])}}});export{ft as default};
