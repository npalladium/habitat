import{e as se,g as ae,o as i,c as r,a as t,i as s,b as d,l as le,w as y,d as A,j as oe,F as D,m as q,r as z,k as C,t as p,n as H,p as L,G as ne,y as v,x as m,A as ie}from"./DeXYWsHe.js";import{_ as re}from"./2ixuHvWC.js";import{_ as de}from"./DIpXulfF.js";const ue={class:"space-y-5"},ce={key:0,class:"flex flex-col items-center justify-center gap-4 py-12 text-center"},fe={class:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center"},pe={class:"flex items-center justify-between"},ve={class:"flex items-center gap-2"},me={class:"flex flex-col items-center gap-3"},ge={class:"flex items-center gap-1"},xe={class:"text-xs text-slate-500 tracking-wide"},he={class:"space-y-1.5"},be={class:"h-2.5 bg-slate-800 rounded-full overflow-hidden"},_e={class:"flex justify-between text-[11px] text-slate-600"},ye={key:0,class:"text-emerald-400 font-medium"},we={key:1},ke={key:0,class:"space-y-1.5"},Se={class:"flex items-end gap-1 h-14"},Le={class:"w-full flex-1 flex items-end"},Me={class:"relative h-px"},De={key:1,class:"flex items-center gap-2 pt-2 border-t border-slate-800"},Ce={class:"flex items-center justify-between"},He={class:"flex items-center gap-2"},$e={class:"text-xs text-slate-500"},Ve={class:"font-semibold text-slate-300"},Te={class:"space-y-2"},je={class:"flex items-center justify-between px-3 py-3"},Ae={class:"flex items-center gap-2"},ze={class:"text-sm font-medium"},Ie={class:"flex items-center gap-3"},Oe={class:"text-right leading-tight"},Be={class:"text-xs text-slate-600"},Fe=["onClick"],Ne={class:"h-1 bg-slate-800/80"},Ue={key:0,class:"flex items-center gap-2 px-3 py-2.5 border-t border-slate-800 bg-slate-900/50"},We=se({__name:"health",setup(Ee){const u=ie(),b=new Date().toISOString().slice(0,10),I=(()=>{const a=new Date;return a.setDate(a.getDate()-6),a.toISOString().slice(0,10)})(),g=v([]),w=v([]),O=v([]),$=v(!0);async function Y(){if(!u.isAvailable){$.value=!1;return}const[a,e,o]=await Promise.all([u.getHabits(),u.getHabitLogsForDate(b),u.getHabitLogsForDateRange(I,b)]);g.value=a.filter(n=>n.tags.includes("habitat-health")),w.value=e.filter(n=>g.value.some(c=>c.id===n.habit_id)),O.value=o.filter(n=>g.value.some(c=>c.id===n.habit_id)),$.value=!1}async function E(){if(!u.isAvailable)return;const[a,e]=await Promise.all([u.getHabitLogsForDate(b),u.getHabitLogsForDateRange(I,b)]);w.value=a.filter(o=>g.value.some(n=>n.id===o.habit_id)),O.value=e.filter(o=>g.value.some(n=>n.id===o.habit_id))}const f=m(()=>g.value.find(a=>a.tags.includes("habitat-steps"))??null),R=["Breakfast","Lunch","Dinner"],B=m(()=>g.value.filter(a=>a.tags.includes("habitat-meals")).sort((a,e)=>R.indexOf(a.name)-R.indexOf(e.name)));function P(a,e){return e.filter(o=>o.habit_id===a).reduce((o,n)=>o+n.value,0)}const _=m(()=>f.value?P(f.value.id,w.value):0),J=m(()=>String(Math.min(99999,Math.round(_.value))).padStart(5,"0").split("").map(Number)),F=m(()=>{if(!f.value)return[];const a=f.value.id;return Array.from({length:7},(e,o)=>{const n=new Date(I);n.setDate(n.getDate()+o);const c=n.toISOString().slice(0,10);return{date:c,label:n.toLocaleDateString("en-US",{weekday:"narrow"}),steps:P(a,O.value.filter(j=>j.date===c)),isToday:c===b}})}),x=m(()=>f.value?.target_value??1e4),V=m(()=>Math.max(x.value,...F.value.map(a=>a.steps))),T=v(!1),k=v(0),N=v(!1);function K(){k.value=Math.round(_.value),T.value=!0}async function Q(){if(!(!f.value||!u.isAvailable)){N.value=!0;try{const a=w.value.filter(e=>e.habit_id===f.value.id);await Promise.all(a.map(e=>u.deleteHabitLog(e.id))),k.value>0&&await u.logHabitValue(f.value.id,b,k.value),await E(),T.value=!1}finally{N.value=!1}}}const S=m(()=>{const a=new Map;for(const e of w.value)a.set(e.habit_id,(a.get(e.habit_id)??0)+e.value);return a}),X=m(()=>B.value.reduce((a,e)=>a+(S.value.get(e.id)??0),0)),h=v(null),U=v(!1);function Z(a){h.value={habitId:a,value:S.value.get(a)??0}}function G(){h.value=null}async function ee(a){if(!(!u.isAvailable||!h.value)){U.value=!0;try{const e=w.value.filter(o=>o.habit_id===a.id);await Promise.all(e.map(o=>u.deleteHabitLog(o.id))),h.value.value>0&&await u.logHabitValue(a.id,b,h.value.value),await E(),G()}finally{U.value=!1}}}const te={Breakfast:"i-heroicons-sun",Lunch:"i-heroicons-sparkles",Dinner:"i-heroicons-moon"};return ae(Y),(a,e)=>{const o=le,n=oe,c=re,j=de;return i(),r("div",ue,[e[13]||(e[13]=t("header",null,[t("p",{class:"text-sm text-slate-500"},"Wellness"),t("h2",{class:"text-2xl font-bold"},"Health")],-1)),!s($)&&s(g).length===0?(i(),r("div",ce,[t("div",fe,[d(o,{name:"i-heroicons-heart",class:"w-8 h-8 text-rose-400"})]),e[4]||(e[4]=t("div",{class:"space-y-1"},[t("p",{class:"font-semibold text-slate-200"},"No health habits yet"),t("p",{class:"text-sm text-slate-500"},"Enable Health in Settings to set up step and meal tracking.")],-1)),d(n,{to:"/settings",variant:"soft",color:"neutral",size:"sm"},{default:y(()=>[...e[3]||(e[3]=[A("Open Settings",-1)])]),_:1})])):s($)?L("",!0):(i(),r(D,{key:1},[s(f)?(i(),q(j,{key:0,ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-4"}},{default:y(()=>[t("div",pe,[t("div",ve,[d(o,{name:"i-heroicons-fire",class:"w-4 h-4 text-rose-400"}),e[5]||(e[5]=t("p",{class:"text-xs font-semibold text-slate-400 uppercase tracking-wide"},"Steps Today",-1))]),d(n,{icon:"i-heroicons-pencil-square",variant:"ghost",color:"neutral",size:"xs",onClick:K})]),t("div",me,[t("div",ge,[(i(!0),r(D,null,z(s(J),(l,M)=>(i(),r("div",{key:M,class:"w-11 h-16 overflow-hidden bg-slate-900 rounded-xl border border-slate-700/60 relative shadow-inner"},[t("div",{class:"flex flex-col transition-transform duration-700 ease-out",style:C({transform:`translateY(-${l*10}%)`})},[(i(),r(D,null,z(10,W=>t("div",{key:W,class:"w-11 h-16 flex items-center justify-center text-3xl font-mono font-bold text-slate-100 select-none"},p(W-1),1)),64))],4),e[6]||(e[6]=t("div",{class:"absolute inset-0 bg-gradient-to-b from-slate-900/80 via-transparent to-slate-900/80 pointer-events-none rounded-xl"},null,-1)),e[7]||(e[7]=t("div",{class:"absolute inset-x-0 top-1/2 -translate-y-px h-px bg-slate-600/60 pointer-events-none"},null,-1))]))),128))]),t("p",xe," / "+p(s(x).toLocaleString())+" steps goal ",1)]),t("div",he,[t("div",be,[t("div",{class:H(["h-full rounded-full transition-all duration-700",s(_)>=s(x)?"bg-emerald-500":"bg-rose-500"]),style:C({width:`${Math.min(100,s(_)/s(x)*100)}%`})},null,6)]),t("div",_e,[t("span",null,p(Math.round(s(_)).toLocaleString())+" logged",1),s(_)>=s(x)?(i(),r("span",ye,"Goal reached!")):(i(),r("span",we,p((s(x)-Math.round(s(_))).toLocaleString())+" to go",1))])]),s(F).some(l=>l.steps>0)?(i(),r("div",ke,[e[8]||(e[8]=t("p",{class:"text-[11px] text-slate-600 uppercase tracking-wide"},"This week",-1)),t("div",Se,[(i(!0),r(D,null,z(s(F),l=>(i(),r("div",{key:l.date,class:"flex-1 flex flex-col items-center gap-0.5"},[t("div",Le,[t("div",{class:H(["w-full rounded-t-sm transition-all duration-500",[l.steps>=s(x)?"bg-emerald-500":l.isToday?"bg-rose-500":"bg-slate-700",l.steps===0?"opacity-0":""]]),style:C({height:`${s(V)>0?Math.round(l.steps/s(V)*100):0}%`})},null,6)]),t("span",{class:H(["text-[9px] text-slate-600",l.isToday?"text-rose-400 font-medium":""])},p(l.label),3)]))),128))]),t("div",Me,[t("div",{class:"absolute right-0 left-0 border-t border-dashed border-slate-700",style:C({bottom:`${s(V)>0?Math.round(s(x)/s(V)*56):0}px`})},null,4)])])):L("",!0),s(T)?(i(),r("div",De,[d(c,{modelValue:s(k),"onUpdate:modelValue":e[0]||(e[0]=l=>ne(k)?k.value=l:null),modelModifiers:{number:!0},type:"number",min:"0",step:"100",placeholder:"Total steps today",class:"flex-1",autofocus:""},null,8,["modelValue"]),d(n,{size:"sm",loading:s(N),onClick:Q},{default:y(()=>[...e[9]||(e[9]=[A("Save",-1)])]),_:1},8,["loading"]),d(n,{size:"sm",variant:"ghost",color:"neutral",onClick:e[1]||(e[1]=l=>T.value=!1)},{default:y(()=>[d(o,{name:"i-heroicons-x-mark",class:"w-4 h-4"})]),_:1})])):L("",!0)]),_:1})):L("",!0),s(B).length?(i(),q(j,{key:1,ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-3"}},{default:y(()=>[t("div",Ce,[t("div",He,[d(o,{name:"i-heroicons-scale",class:"w-4 h-4 text-amber-400"}),e[10]||(e[10]=t("p",{class:"text-xs font-semibold text-slate-400 uppercase tracking-wide"},"Meals",-1))]),t("p",$e,[t("span",Ve,p(s(X).toLocaleString()),1),e[11]||(e[11]=A(" kcal today ",-1))])]),t("div",Te,[(i(!0),r(D,null,z(s(B),l=>(i(),r("div",{key:l.id,class:"rounded-xl border border-slate-800 overflow-hidden"},[t("div",je,[t("div",Ae,[d(o,{name:te[l.name]??"i-heroicons-beaker",class:"w-4 h-4 text-slate-400"},null,8,["name"]),t("span",ze,p(l.name),1)]),t("div",Ie,[t("div",Oe,[t("span",{class:H(["text-base font-semibold tabular-nums",(s(S).get(l.id)??0)>=l.target_value?"text-amber-400":"text-slate-200"])},p(s(S).get(l.id)??0),3),t("span",Be," / "+p(l.target_value)+" kcal",1)]),t("button",{class:"w-7 h-7 rounded-lg bg-slate-800 flex items-center justify-center text-slate-400 hover:text-slate-200 transition-colors",onClick:M=>Z(l.id)},[d(o,{name:"i-heroicons-pencil",class:"w-3.5 h-3.5"})],8,Fe)])]),t("div",Ne,[t("div",{class:H(["h-full transition-all duration-500",(s(S).get(l.id)??0)>=l.target_value?"bg-amber-400":"bg-emerald-500"]),style:C({width:`${Math.min(100,(s(S).get(l.id)??0)/l.target_value*100)}%`})},null,6)]),s(h)?.habitId===l.id?(i(),r("div",Ue,[d(c,{modelValue:s(h).value,"onUpdate:modelValue":e[2]||(e[2]=M=>s(h).value=M),modelModifiers:{number:!0},type:"number",min:"0",step:"10",placeholder:`${l.name} calories`,class:"flex-1",autofocus:""},null,8,["modelValue","placeholder"]),d(n,{size:"sm",loading:s(U),onClick:M=>ee(l)},{default:y(()=>[...e[12]||(e[12]=[A("Save",-1)])]),_:1},8,["loading","onClick"]),d(n,{size:"sm",variant:"ghost",color:"neutral",onClick:G},{default:y(()=>[d(o,{name:"i-heroicons-x-mark",class:"w-4 h-4"})]),_:1})])):L("",!0)]))),128))])]),_:1})):L("",!0)],64))])}}});export{We as default};
