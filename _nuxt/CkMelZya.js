import{e as Ee,L as $e,f as ze,H as Le,g as Re,o as i,c as d,a as s,b as o,j as Se,i as a,l as je,w as m,d as p,F as k,t as f,p as w,r as A,m as ie,n as E,s as re,I as J,y as u,x as X,z as Z,E as Ve,A as Ne}from"./xAnKZML8.js";import{_ as Ye}from"./C8z6p9s2.js";import{_ as Ue}from"./ClmIK66i.js";import{_ as Ie}from"./COSDyWQn.js";const Me={class:"space-y-5"},Oe={class:"flex items-center gap-2 -mb-1"},Qe={key:0,class:"flex items-center justify-center py-12"},We={key:1,class:"flex flex-col items-center gap-3 py-12 text-center"},Be={class:"flex items-start justify-between"},Ke={class:"text-xs text-slate-500"},Fe={class:"text-2xl font-bold leading-tight"},Xe={class:"flex items-center gap-0.5 mt-1"},He={class:"text-sm text-slate-400 -mt-2"},Pe={class:"space-y-4"},Ge={key:0,class:"flex flex-col items-center gap-3 py-8 text-center"},Je={class:"flex items-start justify-between gap-2"},Ze={class:"text-sm font-medium text-slate-100 leading-snug"},qe=["disabled","onClick"],et={key:0,class:"flex gap-1 flex-wrap"},tt=["onClick"],st={key:2,class:"flex gap-2"},lt=["onClick"],at=["onClick"],nt={class:"px-4 pt-3.5 pb-3 flex items-center justify-between"},ot={key:0,class:"px-4 py-3 space-y-3"},it={class:"space-y-1"},rt={class:"flex gap-1.5"},dt=["onClick"],ut={class:"flex justify-end gap-2"},ct={class:"px-4 pt-3.5 pb-3 flex items-center justify-between"},vt={class:"text-sm font-medium text-slate-200"},mt={class:"text-[11px] text-slate-500"},pt=["disabled","onClick"],ft={key:0,class:"px-4 py-3 text-xs text-slate-600"},xt={key:1,class:"px-4 py-3 space-y-3"},yt={class:"flex items-center gap-3"},bt={class:"space-y-1"},gt={class:"flex gap-1.5"},ht=["onClick"],_t={class:"flex justify-end gap-2"},kt={class:"space-y-2 pb-4"},wt={key:3,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center"},Ct={class:"relative w-full sm:max-w-md bg-slate-900 border border-slate-800 rounded-t-3xl sm:rounded-2xl p-5 space-y-4"},Tt={class:"flex items-center justify-between"},Dt={class:"space-y-1.5"},At={class:"flex gap-1.5"},Et=["onClick"],$t={key:0,class:"space-y-1.5"},zt={class:"flex gap-1.5"},Lt=["onClick"],Rt={class:"flex justify-end gap-2 pt-1"},St={key:4,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center"},jt={class:"relative w-full sm:max-w-sm bg-slate-900 border border-slate-800 rounded-t-3xl sm:rounded-2xl p-5 space-y-4"},Vt={class:"text-sm text-slate-400"},Nt={class:"text-slate-200 font-medium"},Yt={class:"flex justify-end gap-2"},Wt=Ee({__name:"[id]",setup(Ut){const r=Ne(),de=$e(),$=X(()=>de.params.id),v=u(null),b=u([]),H=u(!0);async function ue(){if(!r.isAvailable){H.value=!1;return}const[t,e]=await Promise.all([r.getCheckinTemplate($.value),r.getCheckinQuestions($.value)]);v.value=t,b.value=e,H.value=!1}const ce=new Date().toISOString().slice(0,10),z=u(new Date),Q=X(()=>z.value.toISOString().slice(0,10)),q=X(()=>Q.value===ce),ve=X(()=>z.value.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}));function me(){const t=new Date(z.value);t.setDate(t.getDate()-1),z.value=t}function pe(){if(q.value)return;const t=new Date(z.value);t.setDate(t.getDate()+1),z.value=t}const y=u(new Map),V=Z({});let g=null;async function ee(){if(!r.isAvailable)return;const t=await r.getCheckinResponses($.value,Q.value);y.value=new Map(t.map(e=>[e.question_id,e]));for(const e of b.value){const n=y.value.get(e.id);n?.value_text!=null?V[e.id]=n.value_text:delete V[e.id]}}ze(Q,async()=>{g&&(clearTimeout(g),g=null),await ee()});async function N(t,e,n){if(!r.isAvailable)return;const x=await r.upsertCheckinResponse(t,Q.value,e,n);y.value.set(t,x)}function fe(t,e){V[t]=e,g&&clearTimeout(g),g=setTimeout(()=>{N(t,null,e.trim()||null)},600)}async function xe(t,e){y.value.get(t)?.value_numeric===e?await N(t,null,null):await N(t,e,null)}async function te(t,e){y.value.get(t)?.value_numeric===e?await N(t,null,null):await N(t,e,null)}Le(()=>{g&&clearTimeout(g)});const L=u(!1),C=u(""),W=u("TEXT"),Y=u(!1),B=Z(new Set);async function se(){if(!(!r.isAvailable||!C.value.trim()||Y.value)){Y.value=!0;try{const t=await r.createCheckinQuestion({template_id:$.value,prompt:C.value.trim(),response_type:W.value,display_order:b.value.length});b.value.push(t),C.value="",W.value="TEXT",L.value=!1}finally{Y.value=!1}}}async function ye(t){if(!(!r.isAvailable||B.has(t))){B.add(t);try{await r.deleteCheckinQuestion(t),b.value=b.value.filter(e=>e.id!==t),y.value.delete(t),delete V[t]}finally{B.delete(t)}}}const le=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ae=["Su","Mo","Tu","We","Th","Fr","Sa"],R=u([]),T=u(!1),D=u(""),h=u([]),U=u(!1),K=Z(new Set);async function be(){r.isAvailable&&(R.value=await r.getCheckinRemindersForTemplate($.value))}function ge(t){return!t.days_active||t.days_active.length===0?"Every day":t.days_active.map(e=>le[e]).join(", ")}function he(t){const e=h.value.indexOf(t);e>=0?h.value.splice(e,1):(h.value.push(t),h.value.sort((n,x)=>n-x))}async function _e(){if(!(!r.isAvailable||!D.value||U.value)){U.value=!0;try{const t=await r.createCheckinReminder($.value,D.value,h.value.length?[...h.value]:null);R.value.push(t),D.value="",h.value=[],T.value=!1}finally{U.value=!1}}}async function ke(t){if(!(!r.isAvailable||K.has(t))){K.add(t);try{await r.deleteCheckinReminder(t),R.value=R.value.filter(e=>e.id!==t)}finally{K.delete(t)}}}const S=u(!1),I=u(""),j=u("DAILY"),_=u([]),M=u(!1);function we(){v.value&&(I.value=v.value.title,j.value=v.value.schedule_type,_.value=v.value.days_active?[...v.value.days_active]:[],S.value=!0)}function Ce(t){const e=_.value.indexOf(t);e>=0?_.value.splice(e,1):(_.value.push(t),_.value.sort((n,x)=>n-x))}async function ne(){if(!(!r.isAvailable||!v.value||M.value)){M.value=!0;try{const t=await r.updateCheckinTemplate({id:v.value.id,title:I.value.trim()||v.value.title,schedule_type:j.value,days_active:j.value==="WEEKLY"&&_.value.length?[..._.value]:null});v.value=t,S.value=!1}finally{M.value=!1}}}const F=u(!1),O=u(!1);async function Te(){if(!(!r.isAvailable||!v.value||O.value)){O.value=!0;try{await r.deleteCheckinTemplate(v.value.id),await Ve("/checkin")}finally{O.value=!1}}}function De(t){return t.schedule_type==="DAILY"?"Daily":t.schedule_type==="MONTHLY"?"Monthly":!t.days_active||t.days_active.length===0?"Weekly":`Weekly · ${t.days_active.map(e=>le[e]).join(", ")}`}return Re(async()=>{await ue(),await Promise.all([ee(),be()])}),(t,e)=>{const n=Se,x=je,Ae=Ye,P=Ue,G=Ie;return i(),d("div",Me,[s("div",Oe,[o(n,{icon:"i-heroicons-arrow-left",variant:"ghost",color:"neutral",size:"sm",to:"/checkin"}),e[13]||(e[13]=s("span",{class:"text-sm text-slate-500"},"Check-in",-1))]),a(H)?(i(),d("div",Qe,[o(x,{name:"i-heroicons-arrow-path",class:"w-5 h-5 animate-spin text-slate-600"})])):a(v)?(i(),d(k,{key:2},[s("header",Be,[s("div",null,[s("p",Ke,f(De(a(v))),1),s("h2",Fe,f(a(v).title),1)]),s("div",Xe,[o(n,{icon:"i-heroicons-pencil-square",variant:"ghost",color:"neutral",size:"sm",onClick:we}),o(n,{icon:"i-heroicons-chevron-left",variant:"ghost",color:"neutral",size:"sm",onClick:me}),o(n,{icon:"i-heroicons-chevron-right",variant:"ghost",color:"neutral",size:"sm",disabled:a(q),onClick:pe},null,8,["disabled"])])]),s("p",He,f(a(ve)),1),s("div",Pe,[a(b).length===0?(i(),d("div",Ge,[o(x,{name:"i-heroicons-plus-circle",class:"w-7 h-7 text-slate-700"}),e[16]||(e[16]=s("p",{class:"text-sm text-slate-500"},"No questions yet. Add one below.",-1))])):w("",!0),(i(!0),d(k,null,A(a(b),l=>(i(),ie(P,{key:l.id,ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-3"}},{default:m(()=>[s("div",Je,[s("p",Ze,f(l.prompt),1),s("button",{class:"flex-shrink-0 text-slate-700 hover:text-red-400 transition-colors mt-0.5",disabled:a(B).has(l.id),onClick:c=>ye(l.id)},[o(x,{name:"i-heroicons-trash",class:"w-3.5 h-3.5"})],8,qe)]),l.response_type==="SCALE"?(i(),d("div",et,[(i(),d(k,null,A(10,c=>s("button",{key:c,class:E(["w-8 h-8 rounded-full text-xs font-semibold border transition-colors",a(y).get(l.id)?.value_numeric===c?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600 hover:text-slate-400"]),onClick:oe=>xe(l.id,c)},f(c),11,tt)),64))])):l.response_type==="TEXT"?(i(),ie(Ae,{key:1,"model-value":a(V)[l.id]??"",placeholder:"Write something…",rows:3,autoresize:"",variant:"outline",class:"w-full text-sm","onUpdate:modelValue":c=>fe(l.id,c)},null,8,["model-value","onUpdate:modelValue"])):l.response_type==="BOOLEAN"?(i(),d("div",st,[s("button",{class:E(["flex-1 py-1.5 text-sm font-medium rounded-xl border transition-colors",a(y).get(l.id)?.value_numeric===1?"bg-emerald-500/20 border-emerald-500 text-emerald-300":"border-slate-700 text-slate-500 hover:border-slate-600 hover:text-slate-400"]),onClick:c=>te(l.id,1)}," Yes ",10,lt),s("button",{class:E(["flex-1 py-1.5 text-sm font-medium rounded-xl border transition-colors",a(y).get(l.id)?.value_numeric===0?"bg-red-500/20 border-red-500 text-red-300":"border-slate-700 text-slate-500 hover:border-slate-600 hover:text-slate-400"]),onClick:c=>te(l.id,0)}," No ",10,at)])):w("",!0)]),_:2},1024))),128))]),o(P,{ui:{root:"rounded-2xl",body:"p-0 sm:p-0 divide-y divide-slate-800"}},{default:m(()=>[s("div",nt,[e[17]||(e[17]=s("p",{class:"text-xs font-semibold text-slate-400"},"Questions",-1)),o(n,{size:"xs",variant:"ghost",color:"neutral",icon:a(L)?"i-heroicons-chevron-up":"i-heroicons-plus",onClick:e[0]||(e[0]=l=>L.value=!a(L))},null,8,["icon"])]),a(L)?(i(),d("div",ot,[o(G,{modelValue:a(C),"onUpdate:modelValue":e[1]||(e[1]=l=>J(C)?C.value=l:null),placeholder:"Question prompt…",autofocus:"",onKeydown:re(se,["enter"])},null,8,["modelValue"]),s("div",it,[e[18]||(e[18]=s("p",{class:"text-[11px] text-slate-500"},"Response type",-1)),s("div",rt,[(i(),d(k,null,A(["TEXT","SCALE","BOOLEAN"],l=>s("button",{key:l,class:E(["flex-1 py-1 text-xs font-medium rounded-lg border transition-colors",a(W)===l?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600"]),onClick:c=>W.value=l},f(l==="TEXT"?"Text":l==="SCALE"?"1–10":"Yes/No"),11,dt)),64))])]),s("div",ut,[o(n,{size:"xs",variant:"ghost",color:"neutral",onClick:e[2]||(e[2]=l=>L.value=!1)},{default:m(()=>[...e[19]||(e[19]=[p("Cancel",-1)])]),_:1}),o(n,{size:"xs",disabled:!a(C).trim()||a(Y),loading:a(Y),onClick:se},{default:m(()=>[...e[20]||(e[20]=[p(" Add ",-1)])]),_:1},8,["disabled","loading"])])])):w("",!0)]),_:1}),o(P,{ui:{root:"rounded-2xl",body:"p-0 sm:p-0 divide-y divide-slate-800"}},{default:m(()=>[s("div",ct,[e[21]||(e[21]=s("p",{class:"text-xs font-semibold text-slate-400"},"Reminders",-1)),o(n,{size:"xs",variant:"ghost",color:"neutral",icon:a(T)?"i-heroicons-chevron-up":"i-heroicons-plus",onClick:e[3]||(e[3]=l=>T.value=!a(T))},null,8,["icon"])]),(i(!0),d(k,null,A(a(R),l=>(i(),d("div",{key:l.id,class:"flex items-center justify-between px-4 py-2.5"},[s("div",null,[s("p",vt,f(l.trigger_time),1),s("p",mt,f(ge(l)),1)]),s("button",{class:"text-slate-700 hover:text-red-400 transition-colors",disabled:a(K).has(l.id),onClick:c=>ke(l.id)},[o(x,{name:"i-heroicons-trash",class:"w-4 h-4"})],8,pt)]))),128)),a(R).length===0&&!a(T)?(i(),d("div",ft," No reminders set. ")):w("",!0),a(T)?(i(),d("div",xt,[s("div",yt,[o(G,{modelValue:a(D),"onUpdate:modelValue":e[4]||(e[4]=l=>J(D)?D.value=l:null),type:"time",class:"w-32"},null,8,["modelValue"]),e[22]||(e[22]=s("span",{class:"text-xs text-slate-500"},"Remind me at this time",-1))]),s("div",bt,[e[23]||(e[23]=s("p",{class:"text-[11px] text-slate-500"},"Days (leave blank for every day)",-1)),s("div",gt,[(i(),d(k,null,A(ae,(l,c)=>s("button",{key:c,class:E(["w-8 h-8 rounded-full text-xs font-medium border transition-colors",a(h).includes(c)?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600"]),onClick:oe=>he(c)},f(l),11,ht)),64))])]),s("div",_t,[o(n,{size:"xs",variant:"ghost",color:"neutral",onClick:e[5]||(e[5]=l=>T.value=!1)},{default:m(()=>[...e[24]||(e[24]=[p("Cancel",-1)])]),_:1}),o(n,{size:"xs",disabled:!a(D)||a(U),loading:a(U),onClick:_e},{default:m(()=>[...e[25]||(e[25]=[p(" Add ",-1)])]),_:1},8,["disabled","loading"])])])):w("",!0)]),_:1}),s("div",kt,[e[27]||(e[27]=s("p",{class:"text-xs font-semibold text-slate-600"},"Danger zone",-1)),o(n,{variant:"soft",color:"error",size:"sm",icon:"i-heroicons-trash",onClick:e[6]||(e[6]=l=>F.value=!0)},{default:m(()=>[...e[26]||(e[26]=[p(" Delete check-in ",-1)])]),_:1})])],64)):(i(),d("div",We,[o(x,{name:"i-heroicons-exclamation-circle",class:"w-8 h-8 text-slate-700"}),e[15]||(e[15]=s("p",{class:"text-sm text-slate-500"},"Check-in not found.",-1)),o(n,{variant:"ghost",color:"neutral",size:"sm",to:"/checkin"},{default:m(()=>[...e[14]||(e[14]=[p("Go back",-1)])]),_:1})])),a(S)?(i(),d("div",wt,[s("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:e[7]||(e[7]=l=>S.value=!1)}),s("div",Ct,[s("div",Tt,[e[28]||(e[28]=s("h3",{class:"font-semibold text-slate-100"},"Edit Check-in",-1)),o(n,{icon:"i-heroicons-x-mark",variant:"ghost",color:"neutral",size:"xs",onClick:e[8]||(e[8]=l=>S.value=!1)})]),o(G,{modelValue:a(I),"onUpdate:modelValue":e[9]||(e[9]=l=>J(I)?I.value=l:null),placeholder:"Name",onKeydown:re(ne,["enter"])},null,8,["modelValue"]),s("div",Dt,[e[29]||(e[29]=s("p",{class:"text-xs text-slate-500"},"Schedule",-1)),s("div",At,[(i(),d(k,null,A(["DAILY","WEEKLY","MONTHLY"],l=>s("button",{key:l,class:E(["flex-1 py-1.5 text-xs font-medium rounded-lg border transition-colors",a(j)===l?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600 hover:text-slate-400"]),onClick:c=>j.value=l},f(l==="DAILY"?"Daily":l==="WEEKLY"?"Weekly":"Monthly"),11,Et)),64))])]),a(j)==="WEEKLY"?(i(),d("div",$t,[e[30]||(e[30]=s("p",{class:"text-xs text-slate-500"},"Days (leave blank for every day)",-1)),s("div",zt,[(i(),d(k,null,A(ae,(l,c)=>s("button",{key:c,class:E(["w-8 h-8 rounded-full text-xs font-medium border transition-colors",a(_).includes(c)?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600"]),onClick:oe=>Ce(c)},f(l),11,Lt)),64))])])):w("",!0),s("div",Rt,[o(n,{variant:"ghost",color:"neutral",size:"sm",onClick:e[10]||(e[10]=l=>S.value=!1)},{default:m(()=>[...e[31]||(e[31]=[p("Cancel",-1)])]),_:1}),o(n,{size:"sm",disabled:a(M),loading:a(M),onClick:ne},{default:m(()=>[...e[32]||(e[32]=[p("Save",-1)])]),_:1},8,["disabled","loading"])])])])):w("",!0),a(F)?(i(),d("div",St,[s("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:e[11]||(e[11]=l=>F.value=!1)}),s("div",jt,[e[37]||(e[37]=s("h3",{class:"font-semibold text-slate-100"},"Delete check-in?",-1)),s("p",Vt,[e[33]||(e[33]=p(" This will delete ",-1)),s("span",Nt,f(a(v)?.title),1),e[34]||(e[34]=p(" along with all its questions and responses. This cannot be undone. ",-1))]),s("div",Yt,[o(n,{variant:"ghost",color:"neutral",size:"sm",onClick:e[12]||(e[12]=l=>F.value=!1)},{default:m(()=>[...e[35]||(e[35]=[p("Cancel",-1)])]),_:1}),o(n,{color:"error",size:"sm",disabled:a(O),loading:a(O),onClick:Te},{default:m(()=>[...e[36]||(e[36]=[p(" Delete ",-1)])]),_:1},8,["disabled","loading"])])])])):w("",!0)])}}});export{Wt as default};
