import{e as ae,f as oe,g as ie,o,c as r,a as n,b as i,j as re,i as l,m as M,p as m,w as c,d as _,l as ue,F as b,r as k,k as B,t as p,n as U,_ as de,G as $,y,x as ce,z as pe,A as me}from"./BefkYMre.js";import{_ as fe}from"./KceDsMZD.js";import{_ as _e}from"./4iiA_LSR.js";import{_ as ye}from"./h0g9nwaE.js";import{u as xe}from"./CQsX2DKg.js";const ve={class:"space-y-5"},he={class:"flex items-center justify-between"},ge={class:"flex items-center gap-2"},be={key:0,class:"flex flex-col items-center justify-center gap-4 py-12 text-center"},ke={class:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center"},we={key:1,class:"space-y-2"},Ce={class:"flex-1 min-w-0"},Ee={class:"flex items-center gap-1.5 min-w-0"},Ae={class:"font-medium text-sm truncate text-slate-100"},Le={class:"text-xs text-slate-600"},Ie={key:0,class:"ml-1"},Ve={key:1,class:"ml-1 text-amber-500"},De={key:0,class:"flex flex-wrap gap-1 mt-1"},Se={key:1,class:"flex flex-wrap gap-x-3 gap-y-0.5 mt-0.5"},Ue={class:"p-4 space-y-4"},Ne={class:"flex justify-end gap-2 pt-1"},Oe={class:"p-4 space-y-4"},Me={class:"space-y-2"},$e={key:0,class:"flex flex-wrap gap-1"},Ye=["onClick"],Fe={class:"flex gap-2"},qe=["onClick"],Te={class:"flex items-center gap-2"},Pe={class:"flex gap-2 mb-2"},Be=["onClick"],He={key:0,class:"flex items-center gap-2"},je={class:"flex items-center gap-1"},We={class:"w-5 text-center text-sm font-medium"},Re={key:1,class:"flex gap-1.5"},Ke=["onClick"],ze={key:0,class:"mt-2"},Xe={key:0,class:"mt-2 space-y-1.5"},Ge=["onClick"],Je={key:1,class:"text-sm text-red-400 flex items-center gap-1.5"},Qe={class:"flex justify-end gap-2 pt-2"},at=ae({__name:"index",setup(Ze){const x=me(),{settings:Y}=xe(),D=y([]),S=y(!1),N=y(!1),A=y(null),L=y(!1),v=y(""),w=y(!1),H=new Date().toISOString().slice(0,10),F=(()=>{const a=new Date;return a.setDate(a.getDate()+1),a.toISOString().slice(0,10)})(),j=ce(()=>D.value.some(a=>a.paused_until&&a.paused_until>=H));async function W(){if(!(!x.isAvailable||!v.value)){w.value=!0;try{await x.pauseAllHabits(v.value),await O(),L.value=!1,v.value=""}finally{w.value=!1}}}async function R(){if(x.isAvailable){w.value=!0;try{await x.pauseAllHabits(null),await O()}finally{w.value=!1}}}function K(){v.value=F,L.value=!0}const q=["Su","Mo","Tu","We","Th","Fr","Sa"],e=pe({name:"",description:"",type:"BOOLEAN",target_value:1,schedule_type:"DAILY",frequency_count:3,days_of_week:[],tags:[],show_due_time:!1,due_time:""}),I=y(""),C=y([]),V=y(!1);function z(){const a=I.value.replace(/,$/,"").trim();a&&!a.startsWith("habitat-")&&!e.tags.includes(a)&&e.tags.push(a),I.value=""}function X(a){const t=e.tags.indexOf(a);t>=0&&e.tags.splice(t,1)}function G(a){(a.key==="Enter"||a.key===",")&&(a.preventDefault(),z())}function J(){C.value.push({key:"",value:""})}function Q(a){C.value.splice(a,1)}function Z(a){const t={};for(const{key:d,value:f}of a)d.trim()&&(t[d.trim()]=f);return t}function ee(){if(e.type==="NUMERIC"){if(e.schedule_type==="SPECIFIC_DAYS")return"Metric habits can only be daily or 1× per week.";if(e.schedule_type==="WEEKLY_FLEX"&&e.frequency_count>1)return"Metric habits must use WEEKLY_FLEX with frequency 1, or be daily."}return e.type==="LIMIT"&&e.schedule_type!=="DAILY"?"Limit habits must be daily.":null}oe([()=>e.type,()=>e.schedule_type,()=>e.frequency_count],()=>{A.value=null});async function O(){x.isAvailable&&(D.value=await x.getHabits())}function te(a){const t=e.days_of_week.indexOf(a);t>=0?e.days_of_week.splice(t,1):(e.days_of_week.push(a),e.days_of_week.sort((d,f)=>d-f))}async function se(){if(!x.isAvailable||!e.name.trim())return;const a=ee();if(a){A.value=a;return}A.value=null,N.value=!0;try{const t=await x.createHabit({name:e.name.trim(),description:e.description.trim(),color:"#06b6d4",icon:"i-heroicons-star",frequency:"daily",tags:[...e.tags],annotations:Z(C.value),type:e.type,target_value:e.target_value,paused_until:null});t.schedule&&(e.schedule_type!=="DAILY"||e.show_due_time&&e.due_time)&&await x.updateHabitSchedule({id:t.schedule.id,schedule_type:e.schedule_type,frequency_count:e.schedule_type==="WEEKLY_FLEX"?e.frequency_count:null,days_of_week:e.schedule_type==="SPECIFIC_DAYS"?[...e.days_of_week]:null,due_time:e.show_due_time&&e.due_time?e.due_time:null}),await O(),T()}finally{N.value=!1}}function T(){S.value=!1,A.value=null,e.name="",e.description="",e.type="BOOLEAN",e.target_value=1,e.schedule_type="DAILY",e.frequency_count=3,e.days_of_week=[],e.tags=[],I.value="",C.value=[],V.value=!1,e.show_due_time=!1,e.due_time=""}function le(a){const t=a.schedule;return!t||t.schedule_type==="DAILY"?"Daily":t.schedule_type==="WEEKLY_FLEX"?`${t.frequency_count??1}×/week`:t.schedule_type==="SPECIFIC_DAYS"?(t.days_of_week??[]).map(d=>q[d]).join(" "):"Daily"}return ie(O),(a,t)=>{const d=re,f=ue,ne=de,h=fe,E=_e,P=ye;return o(),r("div",ve,[n("header",he,[t[15]||(t[15]=n("h2",{class:"text-2xl font-bold"},"Habits",-1)),n("div",ge,[i(d,{to:"/archive",icon:"i-heroicons-archive-box",variant:"ghost",color:"neutral",size:"sm"}),l(j)?(o(),M(d,{key:0,icon:"i-heroicons-play",variant:"ghost",color:"neutral",size:"sm",loading:l(w),title:"Resume all habits",onClick:R},null,8,["loading"])):m("",!0),l(D).length>0?(o(),M(d,{key:1,icon:"i-heroicons-pause",variant:"ghost",color:"neutral",size:"sm",title:"Pause all habits",onClick:K})):m("",!0),i(d,{icon:"i-heroicons-plus",size:"sm",onClick:t[0]||(t[0]=s=>S.value=!0)},{default:c(()=>[...t[14]||(t[14]=[_("New",-1)])]),_:1})])]),l(D).length===0?(o(),r("section",be,[n("div",ke,[i(f,{name:"i-heroicons-clipboard-document-list",class:"w-8 h-8 text-slate-400"})]),t[16]||(t[16]=n("div",{class:"space-y-1"},[n("p",{class:"font-semibold text-slate-200"},"No habits yet"),n("p",{class:"text-sm text-slate-500"},"Tap New to create your first habit.")],-1))])):(o(),r("ul",we,[(o(!0),r(b,null,k(l(D),s=>(o(),M(ne,{key:s.id,to:`/habits/${s.id}`,class:"flex items-center gap-3 p-3 rounded-xl bg-slate-900 border border-slate-800 active:opacity-70 transition-opacity"},{default:c(()=>[n("div",{class:"w-9 h-9 rounded-full flex items-center justify-center flex-shrink-0",style:B({backgroundColor:s.color+"33"})},[i(f,{name:s.icon,class:"w-5 h-5",style:B({color:s.color})},null,8,["name","style"])],4),n("div",Ce,[n("div",Ee,[n("p",Ae,p(s.name),1),s.type!=="BOOLEAN"?(o(),r("span",{key:0,class:U(["shrink-0 text-[9px] font-bold px-1.5 py-0.5 rounded",s.type==="NUMERIC"?"bg-primary-500/15 text-primary-400":"bg-amber-500/15 text-amber-400"])},p(s.type==="NUMERIC"?"# Metric":"↓ Limit"),3)):m("",!0)]),n("p",Le,[_(p(le(s))+" ",1),s.type!=="BOOLEAN"?(o(),r("span",Ie," · "+p(s.type==="NUMERIC"?`target ${s.target_value}`:`limit ${s.target_value}`),1)):m("",!0),s.paused_until&&s.paused_until>=new Date().toISOString().slice(0,10)?(o(),r("span",Ve," · Paused ")):m("",!0)]),l(Y).showTagsOnHabits&&s.tags.length?(o(),r("div",De,[(o(!0),r(b,null,k(s.tags,u=>(o(),r("span",{key:u,class:U(["px-1.5 py-0.5 rounded text-[9px]",u.startsWith("habitat-")?"bg-cyan-900/40 text-cyan-600":"bg-slate-800 text-slate-500"])},"#"+p(u.startsWith("habitat-")?u.slice(8):u),3))),128))])):m("",!0),l(Y).showAnnotationsOnHabits&&Object.keys(s.annotations).length?(o(),r("div",Se,[(o(!0),r(b,null,k(s.annotations,(u,g)=>(o(),r("span",{key:g,class:"text-[9px] text-slate-600"},p(g)+": "+p(u),1))),128))])):m("",!0)]),i(f,{name:"i-heroicons-chevron-right",class:"w-4 h-4 text-slate-700 flex-shrink-0"})]),_:2},1032,["to"]))),128))])),i(P,{open:l(L),"onUpdate:open":t[3]||(t[3]=s=>$(L)?L.value=s:null)},{content:c(()=>[n("div",Ue,[t[19]||(t[19]=n("div",null,[n("h3",{class:"text-lg font-semibold"},"Pause all habits"),n("p",{class:"text-sm text-slate-400 mt-0.5"},"All active habits will be hidden from Today until this date.")],-1)),i(E,{label:"Pause until"},{default:c(()=>[i(h,{modelValue:l(v),"onUpdate:modelValue":t[1]||(t[1]=s=>$(v)?v.value=s:null),type:"date",min:l(F),class:"w-full"},null,8,["modelValue","min"])]),_:1}),n("div",Ne,[i(d,{variant:"ghost",color:"neutral",onClick:t[2]||(t[2]=s=>L.value=!1)},{default:c(()=>[...t[17]||(t[17]=[_("Cancel",-1)])]),_:1}),i(d,{color:"warning",disabled:!l(v)||l(w),loading:l(w),onClick:W},{default:c(()=>[...t[18]||(t[18]=[_(" Pause all ",-1)])]),_:1},8,["disabled","loading"])])])]),_:1},8,["open"]),i(P,{open:l(S),"onUpdate:open":t[13]||(t[13]=s=>$(S)?S.value=s:null)},{content:c(()=>[n("div",Oe,[t[26]||(t[26]=n("h3",{class:"text-lg font-semibold"},"New Habit",-1)),i(E,{label:"Name",required:""},{default:c(()=>[i(h,{modelValue:l(e).name,"onUpdate:modelValue":t[4]||(t[4]=s=>l(e).name=s),placeholder:"e.g. Morning run",autofocus:""},null,8,["modelValue"])]),_:1}),i(E,{label:"Description"},{default:c(()=>[i(h,{modelValue:l(e).description,"onUpdate:modelValue":t[5]||(t[5]=s=>l(e).description=s),placeholder:"Optional description"},null,8,["modelValue"])]),_:1}),i(E,{label:"Tags"},{default:c(()=>[n("div",Me,[l(e).tags.length?(o(),r("div",$e,[(o(!0),r(b,null,k(l(e).tags,s=>(o(),r("span",{key:s,class:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-slate-800 border border-slate-700 text-xs text-slate-300"},[_(p(s)+" ",1),n("button",{class:"text-slate-500 hover:text-white leading-none",onClick:u=>X(s)},"×",8,Ye)]))),128))])):m("",!0),i(h,{modelValue:l(I),"onUpdate:modelValue":t[6]||(t[6]=s=>$(I)?I.value=s:null),placeholder:"Add tag, press Enter",onKeydown:G},null,8,["modelValue"])])]),_:1}),i(E,{label:"Type"},{default:c(()=>[n("div",Fe,[(o(),r(b,null,k(["BOOLEAN","NUMERIC","LIMIT"],s=>n("button",{key:s,class:U(["flex-1 py-1.5 px-2 rounded-lg text-xs font-medium border transition-colors",l(e).type===s?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-400 hover:border-slate-600"]),onClick:u=>l(e).type=s},p(s==="BOOLEAN"?"✓ Done":s==="NUMERIC"?"# Metric":"↓ Limit"),11,qe)),64))])]),_:1}),l(e).type!=="BOOLEAN"?(o(),M(E,{key:0,label:l(e).type==="NUMERIC"?"Target":"Limit"},{default:c(()=>[n("div",Te,[i(h,{modelValue:l(e).target_value,"onUpdate:modelValue":t[7]||(t[7]=s=>l(e).target_value=s),modelModifiers:{number:!0},type:"number",min:"0.1",step:"any",class:"w-28"},null,8,["modelValue"]),t[20]||(t[20]=n("span",{class:"text-sm text-slate-500"},"per day",-1))])]),_:1},8,["label"])):m("",!0),i(E,{label:"Schedule"},{default:c(()=>[n("div",Pe,[(o(),r(b,null,k(["DAILY","WEEKLY_FLEX","SPECIFIC_DAYS"],s=>n("button",{key:s,class:U(["flex-1 py-1.5 px-1 rounded-lg text-xs font-medium border transition-colors",l(e).schedule_type===s?"bg-slate-700 border-slate-500 text-slate-100":"border-slate-700 text-slate-400 hover:border-slate-600"]),onClick:u=>l(e).schedule_type=s},p(s==="DAILY"?"Daily":s==="WEEKLY_FLEX"?"N× week":"Specific days"),11,Be)),64))]),l(e).schedule_type==="WEEKLY_FLEX"?(o(),r("div",He,[t[21]||(t[21]=n("span",{class:"text-sm text-slate-400"},"Times per week:",-1)),n("div",je,[n("button",{class:"w-7 h-7 rounded-lg bg-slate-800 border border-slate-700 text-slate-300 flex items-center justify-center text-sm",onClick:t[8]||(t[8]=s=>l(e).frequency_count=Math.max(1,l(e).frequency_count-1))},"−"),n("span",We,p(l(e).frequency_count),1),n("button",{class:"w-7 h-7 rounded-lg bg-slate-800 border border-slate-700 text-slate-300 flex items-center justify-center text-sm",onClick:t[9]||(t[9]=s=>l(e).frequency_count=Math.min(7,l(e).frequency_count+1))},"+")])])):m("",!0),l(e).schedule_type==="SPECIFIC_DAYS"?(o(),r("div",Re,[(o(),r(b,null,k(q,(s,u)=>n("button",{key:u,class:U(["w-8 h-8 rounded-full text-xs font-medium border transition-colors",l(e).days_of_week.includes(u)?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600"]),onClick:g=>te(u)},p(s),11,Ke)),64))])):m("",!0)]),_:1}),n("div",null,[n("button",{class:"text-xs text-slate-500 hover:text-slate-400 flex items-center gap-1",onClick:t[10]||(t[10]=s=>l(e).show_due_time=!l(e).show_due_time)},[i(f,{name:l(e).show_due_time?"i-heroicons-chevron-down":"i-heroicons-chevron-right",class:"w-3.5 h-3.5"},null,8,["name"]),_(" "+p(l(e).show_due_time?"Remove due time":"Add due time"),1)]),l(e).show_due_time?(o(),r("div",ze,[i(h,{modelValue:l(e).due_time,"onUpdate:modelValue":t[11]||(t[11]=s=>l(e).due_time=s),type:"time",class:"w-32"},null,8,["modelValue"])])):m("",!0)]),n("div",null,[n("button",{class:"text-xs text-slate-500 hover:text-slate-400 flex items-center gap-1",onClick:t[12]||(t[12]=s=>V.value=!l(V))},[i(f,{name:l(V)?"i-heroicons-chevron-down":"i-heroicons-chevron-right",class:"w-3.5 h-3.5"},null,8,["name"]),_(" "+p(l(V)?"Hide annotations":l(C).length>0?`Annotations (${l(C).length})`:"Add annotations"),1)]),l(V)?(o(),r("div",Xe,[(o(!0),r(b,null,k(l(C),(s,u)=>(o(),r("div",{key:u,class:"flex items-center gap-1.5"},[i(h,{modelValue:s.key,"onUpdate:modelValue":g=>s.key=g,placeholder:"key",class:"w-24 shrink-0"},null,8,["modelValue","onUpdate:modelValue"]),t[22]||(t[22]=n("span",{class:"text-slate-600 text-xs"},":",-1)),i(h,{modelValue:s.value,"onUpdate:modelValue":g=>s.value=g,placeholder:"value",class:"flex-1"},null,8,["modelValue","onUpdate:modelValue"]),n("button",{class:"text-slate-700 hover:text-red-400 transition-colors",onClick:g=>Q(u)},[i(f,{name:"i-heroicons-x-mark",class:"w-3.5 h-3.5"})],8,Ge)]))),128)),n("button",{class:"text-xs text-slate-500 hover:text-slate-400 flex items-center gap-1",onClick:J},[i(f,{name:"i-heroicons-plus",class:"w-3 h-3"}),t[23]||(t[23]=_(" Add annotation ",-1))])])):m("",!0)]),l(A)?(o(),r("p",Je,[i(f,{name:"i-heroicons-exclamation-circle",class:"w-4 h-4 flex-shrink-0"}),_(" "+p(l(A)),1)])):m("",!0),n("div",Qe,[i(d,{variant:"ghost",color:"neutral",onClick:T},{default:c(()=>[...t[24]||(t[24]=[_("Cancel",-1)])]),_:1}),i(d,{disabled:!l(e).name.trim()||l(N),loading:l(N),onClick:se},{default:c(()=>[...t[25]||(t[25]=[_(" Create ",-1)])]),_:1},8,["disabled","loading"])])])]),_:1},8,["open"])])}}});export{at as default};
