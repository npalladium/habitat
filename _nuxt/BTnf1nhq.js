import{e as Z,g as tt,o,c as i,a,b as u,w as C,d as V,j as et,i as l,l as nt,F as U,r as $,t as r,p as x,m as st,q as I,v as O,Y as at,G as j,s as F,y as v,z as lt,x as L,A as ot}from"./DeXYWsHe.js";import{_ as it}from"./BCMIW9k0.js";import{_ as rt}from"./2ixuHvWC.js";import{_ as ct}from"./BocCuOFG.js";const dt={class:"space-y-5"},ut={class:"flex items-center justify-between"},pt={key:0,class:"flex flex-col items-center justify-center gap-4 py-12 text-center"},ft={class:"w-16 h-16 rounded-full bg-slate-800 flex items-center justify-center"},mt={key:1,class:"space-y-2"},xt=["onClick"],vt={class:"flex items-start justify-between gap-2"},bt={class:"font-medium text-sm text-slate-100 leading-snug"},_t={class:"text-[11px] text-slate-600 shrink-0 mt-0.5"},gt={key:0,class:"text-xs text-slate-500 mt-0.5 line-clamp-2"},ht={key:1,class:"flex flex-wrap gap-1 mt-2"},yt={key:0,class:"text-slate-600"},wt={key:0,class:"text-[10px] text-slate-600 self-center pl-0.5"},kt={class:"flex flex-col max-h-[90dvh]"},Ct={class:"flex items-center justify-between px-4 pt-4 pb-3 border-b border-slate-800 shrink-0"},Vt={class:"text-base font-semibold"},St={class:"flex items-center gap-2"},Ut={key:0,class:"text-[11px] text-slate-600"},$t={class:"flex-1 overflow-y-auto px-4 pt-3 pb-2 space-y-3 min-h-0"},jt={class:"border-t border-slate-800 pt-3 space-y-2"},Tt={class:"flex flex-wrap items-center gap-1.5 min-h-[20px]"},At={key:0,class:"text-slate-500"},zt=["onClick"],Nt={class:"border-t border-slate-800 pt-3 pb-1"},Dt={key:0},Bt={key:1},Mt={key:0,class:"mt-2 space-y-2"},Kt={class:"text-[11px] text-slate-500 font-mono shrink-0"},Et={class:"text-[11px] text-slate-400 flex-1 min-w-0 truncate"},It={class:"flex items-center gap-1.5"},Ot={class:"flex justify-end gap-2 px-4 py-3 border-t border-slate-800 shrink-0"},Wt=Z({__name:"scribbles",setup(Ft){const b=ot(),T=v([]),h=v(!1),k=v(!1),c=v(null),n=lt({title:"",content:"",tags:[],annotations:{}}),_=v("");function B(){const e=_.value.replace(/,+$/,"").trim();e&&!e.startsWith("habitat-")&&!n.tags.includes(e)&&n.tags.push(e),_.value=""}function q(e){(e.key==="Enter"||e.key===",")&&(e.preventDefault(),B())}function G(e){n.tags=n.tags.filter(t=>t!==e)}const g=v(!1),f=v(""),m=v("");function A(){!f.value.trim()||!m.value.trim()||(n.annotations[f.value.trim()]=m.value.trim(),f.value="",m.value="")}function H(e){delete n.annotations[e]}async function z(){b.isAvailable&&(T.value=await b.getScribbles())}function R(){c.value=null,n.title="",n.content="",n.tags=[],n.annotations={},_.value="",g.value=!1,f.value="",m.value="",h.value=!0}function W(e){c.value=e,n.title=e.title,n.content=e.content,n.tags=[...e.tags],n.annotations={...e.annotations},_.value="",g.value=!1,f.value="",m.value="",h.value=!0}function N(){h.value=!1}async function Y(){if(!(!b.isAvailable||k.value)){k.value=!0;try{c.value?await b.updateScribble({id:c.value.id,title:n.title,content:n.content,tags:[...n.tags],annotations:{...n.annotations}}):await b.createScribble({title:n.title,content:n.content,tags:[...n.tags],annotations:{...n.annotations}}),await z(),N()}finally{k.value=!1}}}async function J(){!b.isAvailable||!c.value||(await b.deleteScribble(c.value.id),await z(),N())}function M(e){const t=Date.now()-new Date(e).getTime(),d=Math.floor(t/6e4);if(d<1)return"just now";if(d<60)return`${d}m ago`;const w=Math.floor(d/60);if(w<24)return`${w}h ago`;const S=Math.floor(w/24);return S<7?`${S}d ago`:new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function P(e){return e.title?e.title:(e.content.split(`
`)[0]?.trim()??"").slice(0,72)||"Untitled"}function K(e){return e.title?e.content.split(`
`).slice(0,2).join(" ").trim().slice(0,120):""}function y(e){const t=e.lastIndexOf("/");return t===-1?{parent:null,leaf:e}:{parent:e.slice(0,t),leaf:e.slice(t+1)}}const D=L(()=>Object.keys(n.annotations).length),Q=L(()=>n.title.trim().length>0||n.content.trim().length>0);return tt(z),(e,t)=>{const d=et,w=nt,S=it,E=rt,X=ct;return o(),i("div",dt,[a("header",ut,[t[8]||(t[8]=a("h2",{class:"text-2xl font-bold"},"Scribbles",-1)),u(d,{icon:"i-heroicons-plus",size:"sm",onClick:R},{default:C(()=>[...t[7]||(t[7]=[V("New",-1)])]),_:1})]),l(T).length===0?(o(),i("section",pt,[a("div",ft,[u(w,{name:"i-heroicons-pencil",class:"w-8 h-8 text-slate-400"})]),t[9]||(t[9]=a("div",{class:"space-y-1"},[a("p",{class:"font-semibold text-slate-200"},"No scribbles yet"),a("p",{class:"text-sm text-slate-500"},"Tap New to jot something down.")],-1))])):(o(),i("ul",mt,[(o(!0),i(U,null,$(l(T),s=>(o(),i("li",{key:s.id,class:"p-3 rounded-xl bg-slate-900 border border-slate-800 active:opacity-70 transition-opacity cursor-pointer",onClick:p=>W(s)},[a("div",vt,[a("p",bt,r(P(s)),1),a("span",_t,r(M(s.updated_at)),1)]),K(s)?(o(),i("p",gt,r(K(s)),1)):x("",!0),s.tags.length>0?(o(),i("div",ht,[(o(!0),i(U,null,$(s.tags.slice(0,5),p=>(o(),i("span",{key:p,class:"inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded-full text-[10px] text-slate-400 bg-slate-800 border border-slate-700"},[y(p).parent?(o(),i("span",yt,r(y(p).parent)+"/",1)):x("",!0),a("span",null,r(y(p).leaf),1)]))),128)),s.tags.length>5?(o(),i("span",wt,"+"+r(s.tags.length-5),1)):x("",!0)])):x("",!0)],8,xt))),128))])),u(X,{open:l(h),"onUpdate:open":t[6]||(t[6]=s=>j(h)?h.value=s:null)},{content:C(()=>[a("div",kt,[a("div",Ct,[a("h3",Vt,r(l(c)?"Edit Scribble":"New Scribble"),1),a("div",St,[l(c)?(o(),i("span",Ut," Created "+r(M(l(c).created_at)),1)):x("",!0),l(c)?(o(),st(d,{key:1,icon:"i-heroicons-trash",color:"error",variant:"ghost",size:"xs",onClick:J})):x("",!0)])]),a("div",$t,[I(a("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l(n).title=s),placeholder:"Title (optional)",class:"w-full bg-transparent text-base font-medium text-slate-100 placeholder-slate-600 outline-none border-0"},null,512),[[O,l(n).title]]),t[12]||(t[12]=a("div",{class:"border-t border-slate-800/60"},null,-1)),u(S,{modelValue:l(n).content,"onUpdate:modelValue":t[1]||(t[1]=s=>l(n).content=s),placeholder:"Start writing…",autoresize:"",rows:6,variant:"none",class:"w-full",ui:{base:"resize-none bg-transparent text-slate-200 placeholder-slate-600 text-sm leading-relaxed"}},null,8,["modelValue"]),a("div",jt,[t[10]||(t[10]=a("p",{class:"text-[10px] font-semibold text-slate-600 uppercase tracking-wider"},"Tags",-1)),a("div",Tt,[(o(!0),i(U,null,$(l(n).tags,s=>(o(),i("span",{key:s,class:"inline-flex items-center gap-1 pl-2 pr-1 py-0.5 rounded-full text-[11px] bg-slate-800 text-slate-300 border border-slate-700"},[y(s).parent?(o(),i("span",At,r(y(s).parent)+"/",1)):x("",!0),V(" "+r(y(s).leaf)+" ",1),a("button",{class:"ml-0.5 w-3.5 h-3.5 flex items-center justify-center rounded-full text-slate-500 hover:text-slate-200 hover:bg-slate-700 transition-colors",onClick:at(p=>G(s),["stop"])},"×",8,zt)]))),128)),I(a("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>j(_)?_.value=s:null),placeholder:"+ add tag",class:"text-[11px] bg-transparent text-slate-400 placeholder-slate-600 outline-none border-0 min-w-0 w-20",onKeydown:q,onBlur:B},null,544),[[O,l(_)]])])]),a("div",Nt,[a("button",{class:"text-xs text-slate-500 hover:text-slate-400 flex items-center gap-1.5 transition-colors",onClick:t[3]||(t[3]=s=>g.value=!l(g))},[u(w,{name:l(g)?"i-heroicons-chevron-down":"i-heroicons-tag",class:"w-3.5 h-3.5"},null,8,["name"]),l(D)>0?(o(),i("span",Dt,r(l(D))+" annotation"+r(l(D)!==1?"s":""),1)):(o(),i("span",Bt,r(l(g)?"Hide annotations":"Add annotations"),1))]),l(g)?(o(),i("div",Mt,[(o(!0),i(U,null,$(l(n).annotations,(s,p)=>(o(),i("div",{key:p,class:"flex items-center gap-2"},[a("span",Kt,r(p),1),a("span",Et,r(s),1),u(d,{icon:"i-heroicons-x-mark",color:"neutral",variant:"ghost",size:"xs",class:"text-slate-600 hover:text-red-400 shrink-0",onClick:Lt=>H(String(p))},null,8,["onClick"])]))),128)),a("div",It,[u(E,{modelValue:l(f),"onUpdate:modelValue":t[4]||(t[4]=s=>j(f)?f.value=s:null),placeholder:"key",size:"xs",variant:"outline",class:"flex-1",onKeydown:F(A,["enter"])},null,8,["modelValue"]),u(E,{modelValue:l(m),"onUpdate:modelValue":t[5]||(t[5]=s=>j(m)?m.value=s:null),placeholder:"value",size:"xs",variant:"outline",class:"flex-1",onKeydown:F(A,["enter"])},null,8,["modelValue"]),u(d,{size:"xs",variant:"soft",color:"neutral",onClick:A},{default:C(()=>[...t[11]||(t[11]=[V("Add",-1)])]),_:1})])])):x("",!0)])]),a("div",Ot,[u(d,{variant:"ghost",color:"neutral",onClick:N},{default:C(()=>[...t[13]||(t[13]=[V("Cancel",-1)])]),_:1}),u(d,{loading:l(k),disabled:l(k)||!l(Q),onClick:Y},{default:C(()=>[V(r(l(c)?"Save":"Create"),1)]),_:1},8,["loading","disabled"])])])]),_:1},8,["open"])])}}});export{Wt as default};
