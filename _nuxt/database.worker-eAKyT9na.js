async function cr(Je={}){var Ae,f=Je,Me=!!globalThis.window,Qe=!!globalThis.WorkerGlobalScope;globalThis.process?.versions?.node&&globalThis.process?.type;var Be="./this.program",Ye=import.meta.url,It="";function Pt(e){return f.locateFile?f.locateFile(e,It):It+e}var nt,ft;if(Me||Qe){try{It=new URL(".",Ye).href}catch{}Qe&&(ft=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),nt=async e=>{var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)}}var he=console.log.bind(console),ie=console.error.bind(console),ae,pt=!1,ut,Tt,Ve,Ze,Ot,Fe,Pe,Ge,Xt=!1;function Jt(){var e=ot.buffer;Ve=new Int8Array(e),Ot=new Int16Array(e),Ze=new Uint8Array(e),Fe=new Int32Array(e),Pe=new Uint32Array(e),Ge=new BigInt64Array(e),new BigUint64Array(e)}function dn(){if(f.wasmMemory)ot=f.wasmMemory;else{var e=f.INITIAL_MEMORY||8388608;ot=new WebAssembly.Memory({initial:e/65536,maximum:32768})}Jt()}function fn(){if(f.preRun)for(typeof f.preRun=="function"&&(f.preRun=[f.preRun]);f.preRun.length;)vn(f.preRun.shift());$t(Kt)}function pn(){Xt=!0,!f.noFSInit&&!l.initialized&&l.init(),Mt.__wasm_call_ctors(),l.ignorePermissions=!1}function hn(){if(f.postRun)for(typeof f.postRun=="function"&&(f.postRun=[f.postRun]);f.postRun.length;)qn(f.postRun.shift());$t(xt)}function et(e){f.onAbort?.(e),e="Aborted("+e+")",ie(e),pt=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw Tt?.(t),t}var Bt;function gn(){return f.locateFile?Pt("sqlite3.wasm"):new URL(""+new URL("sqlite3-DGXXSD5r.wasm",import.meta.url).href,import.meta.url).href}function mn(e){if(e==Bt&&ae)return new Uint8Array(ae);if(ft)return ft(e);throw"both async and sync fetching of the wasm failed"}async function En(e){if(!ae)try{var t=await nt(e);return new Uint8Array(t)}catch{}return mn(e)}async function bn(e,t){try{var o=await En(e);return await WebAssembly.instantiate(o,t)}catch(s){ie(`failed to asynchronously prepare wasm: ${s}`),et(s)}}async function yn(e,t,o){if(!e)try{var s=fetch(t,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(s,o)}catch(n){ie(`wasm streaming compile failed: ${n}`),ie("falling back to ArrayBuffer instantiation")}return bn(t,o)}function Tn(){return{env:_r,wasi_snapshot_preview1:_r}}async function Sn(){function e(s,n){return Mt=s.exports,fr(Mt),Mt}function t(s){return e(s.instance)}var o=Tn();return f.instantiateWasm?new Promise((s,n)=>{f.instantiateWasm(o,(i,r)=>{s(e(i))})}):(Bt??=gn(),t(await yn(ae,Bt,o)))}var $t=e=>{for(;e.length>0;)e.shift()(f)},xt=[],qn=e=>xt.push(e),Kt=[],vn=e=>Kt.push(e),ot,Ce={isAbs:e=>e.charAt(0)==="/",splitPath:e=>/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1),normalizeArray:(e,t)=>{for(var o=0,s=e.length-1;s>=0;s--){var n=e[s];n==="."?e.splice(s,1):n===".."?(e.splice(s,1),o++):o&&(e.splice(s,1),o--)}if(t)for(;o;o--)e.unshift("..");return e},normalize:e=>{var t=Ce.isAbs(e),o=e.slice(-1)==="/";return e=Ce.normalizeArray(e.split("/").filter(s=>!!s),!t).join("/"),!e&&!t&&(e="."),e&&o&&(e+="/"),(t?"/":"")+e},dirname:e=>{var t=Ce.splitPath(e),o=t[0],s=t[1];return!o&&!s?".":(s&&(s=s.slice(0,-1)),o+s)},basename:e=>e&&e.match(/([^\/]+|\/)\/*$/)[1],join:(...e)=>Ce.normalize(e.join("/")),join2:(e,t)=>Ce.normalize(e+"/"+t)},An=()=>e=>crypto.getRandomValues(e),Yt=e=>{(Yt=An())(e)},St={resolve:(...e)=>{for(var t="",o=!1,s=e.length-1;s>=-1&&!o;s--){var n=s>=0?e[s]:l.cwd();if(typeof n!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";t=n+"/"+t,o=Ce.isAbs(n)}return t=Ce.normalizeArray(t.split("/").filter(i=>!!i),!o).join("/"),(o?"/":"")+t||"."},relative:(e,t)=>{e=St.resolve(e).slice(1),t=St.resolve(t).slice(1);function o(N){for(var ee=0;ee<N.length&&N[ee]==="";ee++);for(var x=N.length-1;x>=0&&N[x]==="";x--);return ee>x?[]:N.slice(ee,x-ee+1)}for(var s=o(e.split("/")),n=o(t.split("/")),i=Math.min(s.length,n.length),r=i,u=0;u<i;u++)if(s[u]!==n[u]){r=u;break}for(var D=[],u=r;u<s.length;u++)D.push("..");return D=D.concat(n.slice(r)),D.join("/")}},Zt=new TextDecoder,en=(e,t,o,s)=>{for(var n=t+o;e[t]&&!(t>=n);)++t;return t},at=(e,t=0,o,s)=>{var n=en(e,t,o);return Zt.decode(e.buffer?e.subarray(t,n):new Uint8Array(e.slice(t,n)))},qt=[],ht=e=>{for(var t=0,o=0;o<e.length;++o){var s=e.charCodeAt(o);s<=127?t++:s<=2047?t+=2:s>=55296&&s<=57343?(t+=4,++o):t+=3}return t},wt=(e,t,o,s)=>{if(!(s>0))return 0;for(var n=o,i=o+s-1,r=0;r<e.length;++r){var u=e.codePointAt(r);if(u<=127){if(o>=i)break;t[o++]=u}else if(u<=2047){if(o+1>=i)break;t[o++]=192|u>>6,t[o++]=128|u&63}else if(u<=65535){if(o+2>=i)break;t[o++]=224|u>>12,t[o++]=128|u>>6&63,t[o++]=128|u&63}else{if(o+3>=i)break;t[o++]=240|u>>18,t[o++]=128|u>>12&63,t[o++]=128|u>>6&63,t[o++]=128|u&63,r++}}return t[o]=0,o-n},jt=(e,t,o)=>{var s=ht(e)+1,n=new Array(s),i=wt(e,n,0,n.length);return n.length=i,n},In=()=>{if(!qt.length){var e=null;if(globalThis.window?.prompt&&(e=window.prompt("Input: "),e!==null&&(e+=`
`)),!e)return null;qt=jt(e)}return qt.shift()},gt={ttys:[],init(){},shutdown(){},register(e,t){gt.ttys[e]={input:[],output:[],ops:t},l.registerDevice(e,gt.stream_ops)},stream_ops:{open(e){var t=gt.ttys[e.node.rdev];if(!t)throw new l.ErrnoError(43);e.tty=t,e.seekable=!1},close(e){e.tty.ops.fsync(e.tty)},fsync(e){e.tty.ops.fsync(e.tty)},read(e,t,o,s,n){if(!e.tty||!e.tty.ops.get_char)throw new l.ErrnoError(60);for(var i=0,r=0;r<s;r++){var u;try{u=e.tty.ops.get_char(e.tty)}catch{throw new l.ErrnoError(29)}if(u===void 0&&i===0)throw new l.ErrnoError(6);if(u==null)break;i++,t[o+r]=u}return i&&(e.node.atime=Date.now()),i},write(e,t,o,s,n){if(!e.tty||!e.tty.ops.put_char)throw new l.ErrnoError(60);try{for(var i=0;i<s;i++)e.tty.ops.put_char(e.tty,t[o+i])}catch{throw new l.ErrnoError(29)}return s&&(e.node.mtime=e.node.ctime=Date.now()),i}},default_tty_ops:{get_char(e){return In()},put_char(e,t){t===null||t===10?(he(at(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output?.length>0&&(he(at(e.output)),e.output=[])},ioctl_tcgets(e){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(e,t,o){return 0},ioctl_tiocgwinsz(e){return[24,80]}},default_tty1_ops:{put_char(e,t){t===null||t===10?(ie(at(e.output)),e.output=[]):t!=0&&e.output.push(t)},fsync(e){e.output?.length>0&&(ie(at(e.output)),e.output=[])}}},On=(e,t)=>Ze.fill(0,e,e+t),Wt=(e,t)=>Math.ceil(e/t)*t,Lt=e=>{e=Wt(e,65536);var t=cn(65536,e);return t&&On(t,e),t},Oe={ops_table:null,mount(e){return Oe.createNode(null,"/",16895,0)},createNode(e,t,o,s){if(l.isBlkdev(o)||l.isFIFO(o))throw new l.ErrnoError(63);Oe.ops_table||={dir:{node:{getattr:Oe.node_ops.getattr,setattr:Oe.node_ops.setattr,lookup:Oe.node_ops.lookup,mknod:Oe.node_ops.mknod,rename:Oe.node_ops.rename,unlink:Oe.node_ops.unlink,rmdir:Oe.node_ops.rmdir,readdir:Oe.node_ops.readdir,symlink:Oe.node_ops.symlink},stream:{llseek:Oe.stream_ops.llseek}},file:{node:{getattr:Oe.node_ops.getattr,setattr:Oe.node_ops.setattr},stream:{llseek:Oe.stream_ops.llseek,read:Oe.stream_ops.read,write:Oe.stream_ops.write,mmap:Oe.stream_ops.mmap,msync:Oe.stream_ops.msync}},link:{node:{getattr:Oe.node_ops.getattr,setattr:Oe.node_ops.setattr,readlink:Oe.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Oe.node_ops.getattr,setattr:Oe.node_ops.setattr},stream:l.chrdev_stream_ops}};var n=l.createNode(e,t,o,s);return l.isDir(n.mode)?(n.node_ops=Oe.ops_table.dir.node,n.stream_ops=Oe.ops_table.dir.stream,n.contents={}):l.isFile(n.mode)?(n.node_ops=Oe.ops_table.file.node,n.stream_ops=Oe.ops_table.file.stream,n.usedBytes=0,n.contents=null):l.isLink(n.mode)?(n.node_ops=Oe.ops_table.link.node,n.stream_ops=Oe.ops_table.link.stream):l.isChrdev(n.mode)&&(n.node_ops=Oe.ops_table.chrdev.node,n.stream_ops=Oe.ops_table.chrdev.stream),n.atime=n.mtime=n.ctime=Date.now(),e&&(e.contents[t]=n,e.atime=e.mtime=e.ctime=n.atime),n},getFileDataAsTypedArray(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage(e,t){var o=e.contents?e.contents.length:0;if(!(o>=t)){t=Math.max(t,o*(o<1024*1024?2:1.125)>>>0),o!=0&&(t=Math.max(t,256));var s=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(s.subarray(0,e.usedBytes),0)}},resizeFileStorage(e,t){if(e.usedBytes!=t)if(t==0)e.contents=null,e.usedBytes=0;else{var o=e.contents;e.contents=new Uint8Array(t),o&&e.contents.set(o.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr(e){var t={};return t.dev=l.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,l.isDir(e.mode)?t.size=4096:l.isFile(e.mode)?t.size=e.usedBytes:l.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.atime),t.mtime=new Date(e.mtime),t.ctime=new Date(e.ctime),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr(e,t){for(const o of["mode","atime","mtime","ctime"])t[o]!=null&&(e[o]=t[o]);t.size!==void 0&&Oe.resizeFileStorage(e,t.size)},lookup(e,t){throw Oe.doesNotExistError||(Oe.doesNotExistError=new l.ErrnoError(44),Oe.doesNotExistError.stack="<generic error, no stack>"),Oe.doesNotExistError},mknod(e,t,o,s){return Oe.createNode(e,t,o,s)},rename(e,t,o){var s;try{s=l.lookupNode(t,o)}catch{}if(s){if(l.isDir(e.mode))for(var n in s.contents)throw new l.ErrnoError(55);l.hashRemoveNode(s)}delete e.parent.contents[e.name],t.contents[o]=e,e.name=o,t.ctime=t.mtime=e.parent.ctime=e.parent.mtime=Date.now()},unlink(e,t){delete e.contents[t],e.ctime=e.mtime=Date.now()},rmdir(e,t){for(var o in l.lookupNode(e,t).contents)throw new l.ErrnoError(55);delete e.contents[t],e.ctime=e.mtime=Date.now()},readdir(e){return[".","..",...Object.keys(e.contents)]},symlink(e,t,o){var s=Oe.createNode(e,t,41471,0);return s.link=o,s},readlink(e){if(!l.isLink(e.mode))throw new l.ErrnoError(28);return e.link}},stream_ops:{read(e,t,o,s,n){var i=e.node.contents;if(n>=e.node.usedBytes)return 0;var r=Math.min(e.node.usedBytes-n,s);if(r>8&&i.subarray)t.set(i.subarray(n,n+r),o);else for(var u=0;u<r;u++)t[o+u]=i[n+u];return r},write(e,t,o,s,n,i){if(t.buffer===Ve.buffer&&(i=!1),!s)return 0;var r=e.node;if(r.mtime=r.ctime=Date.now(),t.subarray&&(!r.contents||r.contents.subarray)){if(i)return r.contents=t.subarray(o,o+s),r.usedBytes=s,s;if(r.usedBytes===0&&n===0)return r.contents=t.slice(o,o+s),r.usedBytes=s,s;if(n+s<=r.usedBytes)return r.contents.set(t.subarray(o,o+s),n),s}if(Oe.expandFileStorage(r,n+s),r.contents.subarray&&t.subarray)r.contents.set(t.subarray(o,o+s),n);else for(var u=0;u<s;u++)r.contents[n+u]=t[o+u];return r.usedBytes=Math.max(r.usedBytes,n+s),s},llseek(e,t,o){var s=t;if(o===1?s+=e.position:o===2&&l.isFile(e.node.mode)&&(s+=e.node.usedBytes),s<0)throw new l.ErrnoError(28);return s},mmap(e,t,o,s,n){if(!l.isFile(e.node.mode))throw new l.ErrnoError(43);var i,r,u=e.node.contents;if(!(n&2)&&u&&u.buffer===Ve.buffer)r=!1,i=u.byteOffset;else{if(r=!0,i=Lt(t),!i)throw new l.ErrnoError(48);u&&((o>0||o+t<u.length)&&(u.subarray?u=u.subarray(o,o+t):u=Array.prototype.slice.call(u,o,o+t)),Ve.set(u,i))}return{ptr:i,allocated:r}},msync(e,t,o,s,n){return Oe.stream_ops.write(e,t,0,s,o,!1),0}}},wn=e=>{var t={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[e];if(typeof t>"u")throw new Error(`Unknown file open mode: ${e}`);return t},Ht=(e,t)=>{var o=0;return e&&(o|=365),t&&(o|=146),o},Ut=async e=>{var t=await nt(e);return new Uint8Array(t)},Ln=(...e)=>l.createDataFile(...e),mt=0,kt=null,kn=e=>{if(mt--,f.monitorRunDependencies?.(mt),mt==0&&kt){var t=kt;kt=null,t()}},Nn=e=>{mt++,f.monitorRunDependencies?.(mt)},Nt=[],tn=async(e,t)=>{typeof Browser<"u"&&Browser.init();for(var o of Nt)if(o.canHandle(t))return o.handle(e,t);return e},nn=async(e,t,o,s,n,i,r,u)=>{var D=t?St.resolve(Ce.join2(e,t)):e;Nn();try{var N=o;typeof o=="string"&&(N=await Ut(o)),N=await tn(N,D),u?.(),i||Ln(e,t,N,s,n,r)}finally{kn()}},Rn=(e,t,o,s,n,i,r,u,D,N)=>{nn(e,t,o,s,n,u,D,N).then(i).catch(r)},l={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,filesystems:null,syncFSRequests:0,readFiles:{},ErrnoError:class{name="ErrnoError";constructor(e){this.errno=e}},FSStream:class{shared={};get object(){return this.node}set object(e){this.node=e}get isRead(){return(this.flags&2097155)!==1}get isWrite(){return(this.flags&2097155)!==0}get isAppend(){return this.flags&1024}get flags(){return this.shared.flags}set flags(e){this.shared.flags=e}get position(){return this.shared.position}set position(e){this.shared.position=e}},FSNode:class{node_ops={};stream_ops={};readMode=365;writeMode=146;mounted=null;constructor(e,t,o,s){e||(e=this),this.parent=e,this.mount=e.mount,this.id=l.nextInode++,this.name=t,this.mode=o,this.rdev=s,this.atime=this.mtime=this.ctime=Date.now()}get read(){return(this.mode&this.readMode)===this.readMode}set read(e){e?this.mode|=this.readMode:this.mode&=~this.readMode}get write(){return(this.mode&this.writeMode)===this.writeMode}set write(e){e?this.mode|=this.writeMode:this.mode&=~this.writeMode}get isFolder(){return l.isDir(this.mode)}get isDevice(){return l.isChrdev(this.mode)}},lookupPath(e,t={}){if(!e)throw new l.ErrnoError(44);t.follow_mount??=!0,Ce.isAbs(e)||(e=l.cwd()+"/"+e);e:for(var o=0;o<40;o++){for(var s=e.split("/").filter(N=>!!N),n=l.root,i="/",r=0;r<s.length;r++){var u=r===s.length-1;if(u&&t.parent)break;if(s[r]!=="."){if(s[r]===".."){if(i=Ce.dirname(i),l.isRoot(n)){e=i+"/"+s.slice(r+1).join("/"),o--;continue e}else n=n.parent;continue}i=Ce.join2(i,s[r]);try{n=l.lookupNode(n,s[r])}catch(N){if(N?.errno===44&&u&&t.noent_okay)return{path:i};throw N}if(l.isMountpoint(n)&&(!u||t.follow_mount)&&(n=n.mounted.root),l.isLink(n.mode)&&(!u||t.follow)){if(!n.node_ops.readlink)throw new l.ErrnoError(52);var D=n.node_ops.readlink(n);Ce.isAbs(D)||(D=Ce.dirname(i)+"/"+D),e=D+"/"+s.slice(r+1).join("/");continue e}}}return{path:i,node:n}}throw new l.ErrnoError(32)},getPath(e){for(var t;;){if(l.isRoot(e)){var o=e.mount.mountpoint;return t?o[o.length-1]!=="/"?`${o}/${t}`:o+t:o}t=t?`${e.name}/${t}`:e.name,e=e.parent}},hashName(e,t){for(var o=0,s=0;s<t.length;s++)o=(o<<5)-o+t.charCodeAt(s)|0;return(e+o>>>0)%l.nameTable.length},hashAddNode(e){var t=l.hashName(e.parent.id,e.name);e.name_next=l.nameTable[t],l.nameTable[t]=e},hashRemoveNode(e){var t=l.hashName(e.parent.id,e.name);if(l.nameTable[t]===e)l.nameTable[t]=e.name_next;else for(var o=l.nameTable[t];o;){if(o.name_next===e){o.name_next=e.name_next;break}o=o.name_next}},lookupNode(e,t){var o=l.mayLookup(e);if(o)throw new l.ErrnoError(o);for(var s=l.hashName(e.id,t),n=l.nameTable[s];n;n=n.name_next){var i=n.name;if(n.parent.id===e.id&&i===t)return n}return l.lookup(e,t)},createNode(e,t,o,s){var n=new l.FSNode(e,t,o,s);return l.hashAddNode(n),n},destroyNode(e){l.hashRemoveNode(e)},isRoot(e){return e===e.parent},isMountpoint(e){return!!e.mounted},isFile(e){return(e&61440)===32768},isDir(e){return(e&61440)===16384},isLink(e){return(e&61440)===40960},isChrdev(e){return(e&61440)===8192},isBlkdev(e){return(e&61440)===24576},isFIFO(e){return(e&61440)===4096},isSocket(e){return(e&49152)===49152},flagsToPermissionString(e){var t=["r","w","rw"][e&3];return e&512&&(t+="w"),t},nodePermissions(e,t){return l.ignorePermissions?0:t.includes("r")&&!(e.mode&292)||t.includes("w")&&!(e.mode&146)||t.includes("x")&&!(e.mode&73)?2:0},mayLookup(e){if(!l.isDir(e.mode))return 54;var t=l.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate(e,t){if(!l.isDir(e.mode))return 54;try{return l.lookupNode(e,t),20}catch{}return l.nodePermissions(e,"wx")},mayDelete(e,t,o){var s;try{s=l.lookupNode(e,t)}catch(i){return i.errno}var n=l.nodePermissions(e,"wx");if(n)return n;if(o){if(!l.isDir(s.mode))return 54;if(l.isRoot(s)||l.getPath(s)===l.cwd())return 10}else if(l.isDir(s.mode))return 31;return 0},mayOpen(e,t){return e?l.isLink(e.mode)?32:l.isDir(e.mode)&&(l.flagsToPermissionString(t)!=="r"||t&576)?31:l.nodePermissions(e,l.flagsToPermissionString(t)):44},checkOpExists(e,t){if(!e)throw new l.ErrnoError(t);return e},MAX_OPEN_FDS:4096,nextfd(){for(var e=0;e<=l.MAX_OPEN_FDS;e++)if(!l.streams[e])return e;throw new l.ErrnoError(33)},getStreamChecked(e){var t=l.getStream(e);if(!t)throw new l.ErrnoError(8);return t},getStream:e=>l.streams[e],createStream(e,t=-1){return e=Object.assign(new l.FSStream,e),t==-1&&(t=l.nextfd()),e.fd=t,l.streams[t]=e,e},closeStream(e){l.streams[e]=null},dupStream(e,t=-1){var o=l.createStream(e,t);return o.stream_ops?.dup?.(o),o},doSetAttr(e,t,o){var s=e?.stream_ops.setattr,n=s?e:t;s??=t.node_ops.setattr,l.checkOpExists(s,63),s(n,o)},chrdev_stream_ops:{open(e){e.stream_ops=l.getDevice(e.node.rdev).stream_ops,e.stream_ops.open?.(e)},llseek(){throw new l.ErrnoError(70)}},major:e=>e>>8,minor:e=>e&255,makedev:(e,t)=>e<<8|t,registerDevice(e,t){l.devices[e]={stream_ops:t}},getDevice:e=>l.devices[e],getMounts(e){for(var t=[],o=[e];o.length;){var s=o.pop();t.push(s),o.push(...s.mounts)}return t},syncfs(e,t){typeof e=="function"&&(t=e,e=!1),l.syncFSRequests++,l.syncFSRequests>1&&ie(`warning: ${l.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var o=l.getMounts(l.root.mount),s=0;function n(u){return l.syncFSRequests--,t(u)}function i(u){if(u)return i.errored?void 0:(i.errored=!0,n(u));++s>=o.length&&n(null)}for(var r of o)r.type.syncfs?r.type.syncfs(r,e,i):i(null)},mount(e,t,o){var s=o==="/",n=!o,i;if(s&&l.root)throw new l.ErrnoError(10);if(!s&&!n){var r=l.lookupPath(o,{follow_mount:!1});if(o=r.path,i=r.node,l.isMountpoint(i))throw new l.ErrnoError(10);if(!l.isDir(i.mode))throw new l.ErrnoError(54)}var u={type:e,opts:t,mountpoint:o,mounts:[]},D=e.mount(u);return D.mount=u,u.root=D,s?l.root=D:i&&(i.mounted=u,i.mount&&i.mount.mounts.push(u)),D},unmount(e){var t=l.lookupPath(e,{follow_mount:!1});if(!l.isMountpoint(t.node))throw new l.ErrnoError(28);var o=t.node,s=o.mounted,n=l.getMounts(s);for(var[i,r]of Object.entries(l.nameTable))for(;r;){var u=r.name_next;n.includes(r.mount)&&l.destroyNode(r),r=u}o.mounted=null;var D=o.mount.mounts.indexOf(s);o.mount.mounts.splice(D,1)},lookup(e,t){return e.node_ops.lookup(e,t)},mknod(e,t,o){var s=l.lookupPath(e,{parent:!0}).node,n=Ce.basename(e);if(!n)throw new l.ErrnoError(28);if(n==="."||n==="..")throw new l.ErrnoError(20);var i=l.mayCreate(s,n);if(i)throw new l.ErrnoError(i);if(!s.node_ops.mknod)throw new l.ErrnoError(63);return s.node_ops.mknod(s,n,t,o)},statfs(e){return l.statfsNode(l.lookupPath(e,{follow:!0}).node)},statfsStream(e){return l.statfsNode(e.node)},statfsNode(e){var t={bsize:4096,frsize:4096,blocks:1e6,bfree:5e5,bavail:5e5,files:l.nextInode,ffree:l.nextInode-1,fsid:42,flags:2,namelen:255};return e.node_ops.statfs&&Object.assign(t,e.node_ops.statfs(e.mount.opts.root)),t},create(e,t=438){return t&=4095,t|=32768,l.mknod(e,t,0)},mkdir(e,t=511){return t&=1023,t|=16384,l.mknod(e,t,0)},mkdirTree(e,t){var o=e.split("/"),s="";for(var n of o)if(n){(s||Ce.isAbs(e))&&(s+="/"),s+=n;try{l.mkdir(s,t)}catch(i){if(i.errno!=20)throw i}}},mkdev(e,t,o){return typeof o>"u"&&(o=t,t=438),t|=8192,l.mknod(e,t,o)},symlink(e,t){if(!St.resolve(e))throw new l.ErrnoError(44);var o=l.lookupPath(t,{parent:!0}).node;if(!o)throw new l.ErrnoError(44);var s=Ce.basename(t),n=l.mayCreate(o,s);if(n)throw new l.ErrnoError(n);if(!o.node_ops.symlink)throw new l.ErrnoError(63);return o.node_ops.symlink(o,s,e)},rename(e,t){var o=Ce.dirname(e),s=Ce.dirname(t),n=Ce.basename(e),i=Ce.basename(t),r=l.lookupPath(e,{parent:!0}),u=r.node,D;if(r=l.lookupPath(t,{parent:!0}),D=r.node,!u||!D)throw new l.ErrnoError(44);if(u.mount!==D.mount)throw new l.ErrnoError(75);var N=l.lookupNode(u,n),ee=St.relative(e,s);if(ee.charAt(0)!==".")throw new l.ErrnoError(28);if(ee=St.relative(t,o),ee.charAt(0)!==".")throw new l.ErrnoError(55);var x;try{x=l.lookupNode(D,i)}catch{}if(N!==x){var K=l.isDir(N.mode),g=l.mayDelete(u,n,K);if(g)throw new l.ErrnoError(g);if(g=x?l.mayDelete(D,i,K):l.mayCreate(D,i),g)throw new l.ErrnoError(g);if(!u.node_ops.rename)throw new l.ErrnoError(63);if(l.isMountpoint(N)||x&&l.isMountpoint(x))throw new l.ErrnoError(10);if(D!==u&&(g=l.nodePermissions(u,"w"),g))throw new l.ErrnoError(g);l.hashRemoveNode(N);try{u.node_ops.rename(N,D,i),N.parent=D}catch(H){throw H}finally{l.hashAddNode(N)}}},rmdir(e){var t=l.lookupPath(e,{parent:!0}).node,o=Ce.basename(e),s=l.lookupNode(t,o),n=l.mayDelete(t,o,!0);if(n)throw new l.ErrnoError(n);if(!t.node_ops.rmdir)throw new l.ErrnoError(63);if(l.isMountpoint(s))throw new l.ErrnoError(10);t.node_ops.rmdir(t,o),l.destroyNode(s)},readdir(e){var t=l.lookupPath(e,{follow:!0}).node;return l.checkOpExists(t.node_ops.readdir,54)(t)},unlink(e){var t=l.lookupPath(e,{parent:!0}).node;if(!t)throw new l.ErrnoError(44);var o=Ce.basename(e),s=l.lookupNode(t,o),n=l.mayDelete(t,o,!1);if(n)throw new l.ErrnoError(n);if(!t.node_ops.unlink)throw new l.ErrnoError(63);if(l.isMountpoint(s))throw new l.ErrnoError(10);t.node_ops.unlink(t,o),l.destroyNode(s)},readlink(e){var t=l.lookupPath(e).node;if(!t)throw new l.ErrnoError(44);if(!t.node_ops.readlink)throw new l.ErrnoError(28);return t.node_ops.readlink(t)},stat(e,t){var o=l.lookupPath(e,{follow:!t}).node;return l.checkOpExists(o.node_ops.getattr,63)(o)},fstat(e){var t=l.getStreamChecked(e),o=t.node,s=t.stream_ops.getattr,n=s?t:o;return s??=o.node_ops.getattr,l.checkOpExists(s,63),s(n)},lstat(e){return l.stat(e,!0)},doChmod(e,t,o,s){l.doSetAttr(e,t,{mode:o&4095|t.mode&-4096,ctime:Date.now(),dontFollow:s})},chmod(e,t,o){var s;typeof e=="string"?s=l.lookupPath(e,{follow:!o}).node:s=e,l.doChmod(null,s,t,o)},lchmod(e,t){l.chmod(e,t,!0)},fchmod(e,t){var o=l.getStreamChecked(e);l.doChmod(o,o.node,t,!1)},doChown(e,t,o){l.doSetAttr(e,t,{timestamp:Date.now(),dontFollow:o})},chown(e,t,o,s){var n;typeof e=="string"?n=l.lookupPath(e,{follow:!s}).node:n=e,l.doChown(null,n,s)},lchown(e,t,o){l.chown(e,t,o,!0)},fchown(e,t,o){var s=l.getStreamChecked(e);l.doChown(s,s.node,!1)},doTruncate(e,t,o){if(l.isDir(t.mode))throw new l.ErrnoError(31);if(!l.isFile(t.mode))throw new l.ErrnoError(28);var s=l.nodePermissions(t,"w");if(s)throw new l.ErrnoError(s);l.doSetAttr(e,t,{size:o,timestamp:Date.now()})},truncate(e,t){if(t<0)throw new l.ErrnoError(28);var o;typeof e=="string"?o=l.lookupPath(e,{follow:!0}).node:o=e,l.doTruncate(null,o,t)},ftruncate(e,t){var o=l.getStreamChecked(e);if(t<0||(o.flags&2097155)===0)throw new l.ErrnoError(28);l.doTruncate(o,o.node,t)},utime(e,t,o){var s=l.lookupPath(e,{follow:!0}).node;l.checkOpExists(s.node_ops.setattr,63)(s,{atime:t,mtime:o})},open(e,t,o=438){if(e==="")throw new l.ErrnoError(44);t=typeof t=="string"?wn(t):t,t&64?o=o&4095|32768:o=0;var s,n;if(typeof e=="object")s=e;else{n=e.endsWith("/");var i=l.lookupPath(e,{follow:!(t&131072),noent_okay:!0});s=i.node,e=i.path}var r=!1;if(t&64)if(s){if(t&128)throw new l.ErrnoError(20)}else{if(n)throw new l.ErrnoError(31);s=l.mknod(e,o|511,0),r=!0}if(!s)throw new l.ErrnoError(44);if(l.isChrdev(s.mode)&&(t&=-513),t&65536&&!l.isDir(s.mode))throw new l.ErrnoError(54);if(!r){var u=l.mayOpen(s,t);if(u)throw new l.ErrnoError(u)}t&512&&!r&&l.truncate(s,0),t&=-131713;var D=l.createStream({node:s,path:l.getPath(s),flags:t,seekable:!0,position:0,stream_ops:s.stream_ops,ungotten:[],error:!1});return D.stream_ops.open&&D.stream_ops.open(D),r&&l.chmod(s,o&511),f.logReadFiles&&!(t&1)&&(e in l.readFiles||(l.readFiles[e]=1)),D},close(e){if(l.isClosed(e))throw new l.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(t){throw t}finally{l.closeStream(e.fd)}e.fd=null},isClosed(e){return e.fd===null},llseek(e,t,o){if(l.isClosed(e))throw new l.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new l.ErrnoError(70);if(o!=0&&o!=1&&o!=2)throw new l.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,o),e.ungotten=[],e.position},read(e,t,o,s,n){if(s<0||n<0)throw new l.ErrnoError(28);if(l.isClosed(e))throw new l.ErrnoError(8);if((e.flags&2097155)===1)throw new l.ErrnoError(8);if(l.isDir(e.node.mode))throw new l.ErrnoError(31);if(!e.stream_ops.read)throw new l.ErrnoError(28);var i=typeof n<"u";if(!i)n=e.position;else if(!e.seekable)throw new l.ErrnoError(70);var r=e.stream_ops.read(e,t,o,s,n);return i||(e.position+=r),r},write(e,t,o,s,n,i){if(s<0||n<0)throw new l.ErrnoError(28);if(l.isClosed(e))throw new l.ErrnoError(8);if((e.flags&2097155)===0)throw new l.ErrnoError(8);if(l.isDir(e.node.mode))throw new l.ErrnoError(31);if(!e.stream_ops.write)throw new l.ErrnoError(28);e.seekable&&e.flags&1024&&l.llseek(e,0,2);var r=typeof n<"u";if(!r)n=e.position;else if(!e.seekable)throw new l.ErrnoError(70);var u=e.stream_ops.write(e,t,o,s,n,i);return r||(e.position+=u),u},mmap(e,t,o,s,n){if((s&2)!==0&&(n&2)===0&&(e.flags&2097155)!==2)throw new l.ErrnoError(2);if((e.flags&2097155)===1)throw new l.ErrnoError(2);if(!e.stream_ops.mmap)throw new l.ErrnoError(43);if(!t)throw new l.ErrnoError(28);return e.stream_ops.mmap(e,t,o,s,n)},msync(e,t,o,s,n){return e.stream_ops.msync?e.stream_ops.msync(e,t,o,s,n):0},ioctl(e,t,o){if(!e.stream_ops.ioctl)throw new l.ErrnoError(59);return e.stream_ops.ioctl(e,t,o)},readFile(e,t={}){t.flags=t.flags||0,t.encoding=t.encoding||"binary",t.encoding!=="utf8"&&t.encoding!=="binary"&&et(`Invalid encoding type "${t.encoding}"`);var o=l.open(e,t.flags),s=l.stat(e).size,n=new Uint8Array(s);return l.read(o,n,0,s,0),t.encoding==="utf8"&&(n=at(n)),l.close(o),n},writeFile(e,t,o={}){o.flags=o.flags||577;var s=l.open(e,o.flags,o.mode);typeof t=="string"&&(t=new Uint8Array(jt(t))),ArrayBuffer.isView(t)?l.write(s,t,0,t.byteLength,void 0,o.canOwn):et("Unsupported data type"),l.close(s)},cwd:()=>l.currentPath,chdir(e){var t=l.lookupPath(e,{follow:!0});if(t.node===null)throw new l.ErrnoError(44);if(!l.isDir(t.node.mode))throw new l.ErrnoError(54);var o=l.nodePermissions(t.node,"x");if(o)throw new l.ErrnoError(o);l.currentPath=t.path},createDefaultDirectories(){l.mkdir("/tmp"),l.mkdir("/home"),l.mkdir("/home/web_user")},createDefaultDevices(){l.mkdir("/dev"),l.registerDevice(l.makedev(1,3),{read:()=>0,write:(s,n,i,r,u)=>r,llseek:()=>0}),l.mkdev("/dev/null",l.makedev(1,3)),gt.register(l.makedev(5,0),gt.default_tty_ops),gt.register(l.makedev(6,0),gt.default_tty1_ops),l.mkdev("/dev/tty",l.makedev(5,0)),l.mkdev("/dev/tty1",l.makedev(6,0));var e=new Uint8Array(1024),t=0,o=()=>(t===0&&(Yt(e),t=e.byteLength),e[--t]);l.createDevice("/dev","random",o),l.createDevice("/dev","urandom",o),l.mkdir("/dev/shm"),l.mkdir("/dev/shm/tmp")},createSpecialDirectories(){l.mkdir("/proc");var e=l.mkdir("/proc/self");l.mkdir("/proc/self/fd"),l.mount({mount(){var t=l.createNode(e,"fd",16895,73);return t.stream_ops={llseek:Oe.stream_ops.llseek},t.node_ops={lookup(o,s){var n=+s,i=l.getStreamChecked(n),r={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>i.path},id:n+1};return r.parent=r,r},readdir(){return Array.from(l.streams.entries()).filter(([o,s])=>s).map(([o,s])=>o.toString())}},t}},{},"/proc/self/fd")},createStandardStreams(e,t,o){e?l.createDevice("/dev","stdin",e):l.symlink("/dev/tty","/dev/stdin"),t?l.createDevice("/dev","stdout",null,t):l.symlink("/dev/tty","/dev/stdout"),o?l.createDevice("/dev","stderr",null,o):l.symlink("/dev/tty1","/dev/stderr"),l.open("/dev/stdin",0),l.open("/dev/stdout",1),l.open("/dev/stderr",1)},staticInit(){l.nameTable=new Array(4096),l.mount(Oe,{},"/"),l.createDefaultDirectories(),l.createDefaultDevices(),l.createSpecialDirectories(),l.filesystems={MEMFS:Oe}},init(e,t,o){l.initialized=!0,e??=f.stdin,t??=f.stdout,o??=f.stderr,l.createStandardStreams(e,t,o)},quit(){l.initialized=!1;for(var e of l.streams)e&&l.close(e)},findObject(e,t){var o=l.analyzePath(e,t);return o.exists?o.object:null},analyzePath(e,t){try{var o=l.lookupPath(e,{follow:!t});e=o.path}catch{}var s={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var o=l.lookupPath(e,{parent:!0});s.parentExists=!0,s.parentPath=o.path,s.parentObject=o.node,s.name=Ce.basename(e),o=l.lookupPath(e,{follow:!t}),s.exists=!0,s.path=o.path,s.object=o.node,s.name=o.node.name,s.isRoot=o.path==="/"}catch(n){s.error=n.errno}return s},createPath(e,t,o,s){e=typeof e=="string"?e:l.getPath(e);for(var n=t.split("/").reverse();n.length;){var i=n.pop();if(i){var r=Ce.join2(e,i);try{l.mkdir(r)}catch(u){if(u.errno!=20)throw u}e=r}}return r},createFile(e,t,o,s,n){var i=Ce.join2(typeof e=="string"?e:l.getPath(e),t),r=Ht(s,n);return l.create(i,r)},createDataFile(e,t,o,s,n,i){var r=t;e&&(e=typeof e=="string"?e:l.getPath(e),r=t?Ce.join2(e,t):e);var u=Ht(s,n),D=l.create(r,u);if(o){if(typeof o=="string"){for(var N=new Array(o.length),ee=0,x=o.length;ee<x;++ee)N[ee]=o.charCodeAt(ee);o=N}l.chmod(D,u|146);var K=l.open(D,577);l.write(K,o,0,o.length,0,i),l.close(K),l.chmod(D,u)}},createDevice(e,t,o,s){var n=Ce.join2(typeof e=="string"?e:l.getPath(e),t),i=Ht(!!o,!!s);l.createDevice.major??=64;var r=l.makedev(l.createDevice.major++,0);return l.registerDevice(r,{open(u){u.seekable=!1},close(u){s?.buffer?.length&&s(10)},read(u,D,N,ee,x){for(var K=0,g=0;g<ee;g++){var H;try{H=o()}catch{throw new l.ErrnoError(29)}if(H===void 0&&K===0)throw new l.ErrnoError(6);if(H==null)break;K++,D[N+g]=H}return K&&(u.node.atime=Date.now()),K},write(u,D,N,ee,x){for(var K=0;K<ee;K++)try{s(D[N+K])}catch{throw new l.ErrnoError(29)}return ee&&(u.node.mtime=u.node.ctime=Date.now()),K}}),l.mkdev(n,i,r)},forceLoadFile(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if(globalThis.XMLHttpRequest)et("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");else try{e.contents=ft(e.url)}catch{throw new l.ErrnoError(29)}},createLazyFile(e,t,o,s,n){class i{lengthKnown=!1;chunks=[];get(x){if(!(x>this.length-1||x<0)){var K=x%this.chunkSize,g=x/this.chunkSize|0;return this.getter(g)[K]}}setDataGetter(x){this.getter=x}cacheLength(){var x=new XMLHttpRequest;x.open("HEAD",o,!1),x.send(null),x.status>=200&&x.status<300||x.status===304||et("Couldn't load "+o+". Status: "+x.status);var K=Number(x.getResponseHeader("Content-length")),g,H=(g=x.getResponseHeader("Accept-Ranges"))&&g==="bytes",U=(g=x.getResponseHeader("Content-Encoding"))&&g==="gzip",oe=1024*1024;H||(oe=K);var S=(M,Q)=>{M>Q&&et("invalid range ("+M+", "+Q+") or no bytes requested!"),Q>K-1&&et("only "+K+" bytes available! programmer error!");var O=new XMLHttpRequest;return O.open("GET",o,!1),K!==oe&&O.setRequestHeader("Range","bytes="+M+"-"+Q),O.responseType="arraybuffer",O.overrideMimeType&&O.overrideMimeType("text/plain; charset=x-user-defined"),O.send(null),O.status>=200&&O.status<300||O.status===304||et("Couldn't load "+o+". Status: "+O.status),O.response!==void 0?new Uint8Array(O.response||[]):jt(O.responseText||"")},T=this;T.setDataGetter(M=>{var Q=M*oe,O=(M+1)*oe-1;return O=Math.min(O,K-1),typeof T.chunks[M]>"u"&&(T.chunks[M]=S(Q,O)),typeof T.chunks[M]>"u"&&et("doXHR failed!"),T.chunks[M]}),(U||!K)&&(oe=K=1,K=this.getter(0).length,oe=K,he("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=K,this._chunkSize=oe,this.lengthKnown=!0}get length(){return this.lengthKnown||this.cacheLength(),this._length}get chunkSize(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}if(globalThis.XMLHttpRequest){Qe||et("Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc");var r={isDevice:!1,contents:new i}}else var r={isDevice:!1,url:o};var u=l.createFile(e,t,r,s,n);r.contents?u.contents=r.contents:r.url&&(u.contents=null,u.url=r.url),Object.defineProperties(u,{usedBytes:{get:function(){return this.contents.length}}});var D={};for(const[ee,x]of Object.entries(u.stream_ops))D[ee]=(...K)=>(l.forceLoadFile(u),x(...K));function N(ee,x,K,g,H){var U=ee.node.contents;if(H>=U.length)return 0;var oe=Math.min(U.length-H,g);if(U.slice)for(var S=0;S<oe;S++)x[K+S]=U[H+S];else for(var S=0;S<oe;S++)x[K+S]=U.get(H+S);return oe}return D.read=(ee,x,K,g,H)=>(l.forceLoadFile(u),N(ee,x,K,g,H)),D.mmap=(ee,x,K,g,H)=>{l.forceLoadFile(u);var U=Lt(x);if(!U)throw new l.ErrnoError(48);return N(ee,Ve,U,x,K),{ptr:U,allocated:!0}},u.stream_ops=D,u}},zt=(e,t,o)=>{if(!e)return"";var s=en(Ze,e,t);return Zt.decode(Ze.subarray(e,s))},Ne={calculateAt(e,t,o){if(Ce.isAbs(t))return t;var s;if(e===-100?s=l.cwd():s=Ne.getStreamFromFD(e).path,t.length==0){if(!o)throw new l.ErrnoError(44);return s}return s+"/"+t},writeStat(e,t){Pe[e>>2]=t.dev,Pe[e+4>>2]=t.mode,Pe[e+8>>2]=t.nlink,Pe[e+12>>2]=t.uid,Pe[e+16>>2]=t.gid,Pe[e+20>>2]=t.rdev,Ge[e+24>>3]=BigInt(t.size),Fe[e+32>>2]=4096,Fe[e+36>>2]=t.blocks;var o=t.atime.getTime(),s=t.mtime.getTime(),n=t.ctime.getTime();return Ge[e+40>>3]=BigInt(Math.floor(o/1e3)),Pe[e+48>>2]=o%1e3*1e3*1e3,Ge[e+56>>3]=BigInt(Math.floor(s/1e3)),Pe[e+64>>2]=s%1e3*1e3*1e3,Ge[e+72>>3]=BigInt(Math.floor(n/1e3)),Pe[e+80>>2]=n%1e3*1e3*1e3,Ge[e+88>>3]=BigInt(t.ino),0},writeStatFs(e,t){Pe[e+4>>2]=t.bsize,Pe[e+60>>2]=t.bsize,Ge[e+8>>3]=BigInt(t.blocks),Ge[e+16>>3]=BigInt(t.bfree),Ge[e+24>>3]=BigInt(t.bavail),Ge[e+32>>3]=BigInt(t.files),Ge[e+40>>3]=BigInt(t.ffree),Pe[e+48>>2]=t.fsid,Pe[e+64>>2]=t.flags,Pe[e+56>>2]=t.namelen},doMsync(e,t,o,s,n){if(!l.isFile(t.node.mode))throw new l.ErrnoError(43);if(s&2)return 0;var i=Ze.slice(e,e+o);l.msync(t,i,n,o,s)},getStreamFromFD(e){return l.getStreamChecked(e)},varargs:void 0,getStr(e){return zt(e)}};function Fn(e,t){try{return e=Ne.getStr(e),l.chmod(e,t),0}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function Cn(e,t,o,s){try{if(t=Ne.getStr(t),t=Ne.calculateAt(e,t),o&-8)return-28;var n=l.lookupPath(t,{follow:!0}).node;if(!n)return-44;var i="";return o&4&&(i+="r"),o&2&&(i+="w"),o&1&&(i+="x"),i&&l.nodePermissions(n,i)?-2:0}catch(r){if(typeof l>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function Dn(e,t){try{return l.fchmod(e,t),0}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function Qt(e,t,o){try{return l.fchown(e,t,o),0}catch(s){if(typeof l>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}var Rt=()=>{var e=Fe[+Ne.varargs>>2];return Ne.varargs+=4,e},vt=Rt;function Pn(e,t,o){Ne.varargs=o;try{var s=Ne.getStreamFromFD(e);switch(t){case 0:var n=Rt();if(n<0)return-28;for(;l.streams[n];)n++;return l.dupStream(s,n).fd;case 1:case 2:return 0;case 3:return s.flags;case 4:var n=Rt();return s.flags|=n,0;case 12:var n=vt(),i=0;return Ot[n+i>>1]=2,0;case 13:case 14:return 0}return-28}catch(r){if(typeof l>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function xn(e,t){try{return Ne.writeStat(t,l.fstat(e))}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}var Un=9007199254740992,Mn=-9007199254740992,Ft=e=>e<Mn||e>Un?NaN:Number(e);function Bn(e,t){t=Ft(t);try{return isNaN(t)?-61:(l.ftruncate(e,t),0)}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}var rt=(e,t,o)=>wt(e,Ze,t,o);function dt(e,t){try{if(t===0)return-28;var o=l.cwd(),s=ht(o)+1;return t<s?-68:(rt(o,e,t),s)}catch(n){if(typeof l>"u"||n.name!=="ErrnoError")throw n;return-n.errno}}function Et(e,t,o){Ne.varargs=o;try{var s=Ne.getStreamFromFD(e);switch(t){case 21509:return s.tty?0:-59;case 21505:if(!s.tty)return-59;if(s.tty.ops.ioctl_tcgets){var n=s.tty.ops.ioctl_tcgets(s),x=vt();Fe[x>>2]=n.c_iflag||0,Fe[x+4>>2]=n.c_oflag||0,Fe[x+8>>2]=n.c_cflag||0,Fe[x+12>>2]=n.c_lflag||0;for(var i=0;i<32;i++)Ve[x+i+17]=n.c_cc[i]||0;return 0}return 0;case 21510:case 21511:case 21512:return s.tty?0:-59;case 21506:case 21507:case 21508:if(!s.tty)return-59;if(s.tty.ops.ioctl_tcsets){for(var x=vt(),r=Fe[x>>2],u=Fe[x+4>>2],D=Fe[x+8>>2],N=Fe[x+12>>2],ee=[],i=0;i<32;i++)ee.push(Ve[x+i+17]);return s.tty.ops.ioctl_tcsets(s.tty,t,{c_iflag:r,c_oflag:u,c_cflag:D,c_lflag:N,c_cc:ee})}return 0;case 21519:if(!s.tty)return-59;var x=vt();return Fe[x>>2]=0,0;case 21520:return s.tty?-28:-59;case 21537:case 21531:var x=vt();return l.ioctl(s,t,x);case 21523:if(!s.tty)return-59;if(s.tty.ops.ioctl_tiocgwinsz){var K=s.tty.ops.ioctl_tiocgwinsz(s.tty),x=vt();Ot[x>>1]=K[0],Ot[x+2>>1]=K[1]}return 0;case 21524:return s.tty?0:-59;case 21515:return s.tty?0:-59;default:return-28}}catch(g){if(typeof l>"u"||g.name!=="ErrnoError")throw g;return-g.errno}}function rn(e,t){try{return e=Ne.getStr(e),Ne.writeStat(t,l.lstat(e))}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function jn(e,t,o){try{return t=Ne.getStr(t),t=Ne.calculateAt(e,t),l.mkdir(t,o,0),0}catch(s){if(typeof l>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}function Wn(e,t,o,s){try{t=Ne.getStr(t);var n=s&256,i=s&4096;return s=s&-6401,t=Ne.calculateAt(e,t,i),Ne.writeStat(o,n?l.lstat(t):l.stat(t))}catch(r){if(typeof l>"u"||r.name!=="ErrnoError")throw r;return-r.errno}}function Hn(e,t,o,s){Ne.varargs=s;try{t=Ne.getStr(t),t=Ne.calculateAt(e,t);var n=s?Rt():0;return l.open(t,o,n).fd}catch(i){if(typeof l>"u"||i.name!=="ErrnoError")throw i;return-i.errno}}function zn(e,t,o,s){try{if(t=Ne.getStr(t),t=Ne.calculateAt(e,t),s<=0)return-28;var n=l.readlink(t),i=Math.min(s,ht(n)),r=Ve[o+i];return rt(n,o,s+1),Ve[o+i]=r,i}catch(u){if(typeof l>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}function Qn(e){try{return e=Ne.getStr(e),l.rmdir(e),0}catch(t){if(typeof l>"u"||t.name!=="ErrnoError")throw t;return-t.errno}}function Vn(e,t){try{return e=Ne.getStr(e),Ne.writeStat(t,l.stat(e))}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return-o.errno}}function Gn(e,t,o){try{if(t=Ne.getStr(t),t=Ne.calculateAt(e,t),!o)l.unlink(t);else if(o===512)l.rmdir(t);else return-28;return 0}catch(s){if(typeof l>"u"||s.name!=="ErrnoError")throw s;return-s.errno}}var sn=e=>Pe[e>>2]+Fe[e+4>>2]*4294967296;function Xn(e,t,o,s){try{t=Ne.getStr(t),t=Ne.calculateAt(e,t,!0);var n=Date.now(),i,r;if(!o)i=n,r=n;else{var u=sn(o),D=Fe[o+8>>2];D==1073741823?i=n:D==1073741822?i=null:i=u*1e3+D/(1e3*1e3),o+=16,u=sn(o),D=Fe[o+8>>2],D==1073741823?r=n:D==1073741822?r=null:r=u*1e3+D/(1e3*1e3)}return(r??i)!==null&&l.utime(t,i,r),0}catch(N){if(typeof l>"u"||N.name!=="ErrnoError")throw N;return-N.errno}}var Jn=e=>e%4===0&&(e%100!==0||e%400===0),$n=[0,31,60,91,121,152,182,213,244,274,305,335],Kn=[0,31,59,90,120,151,181,212,243,273,304,334],Yn=e=>(Jn(e.getFullYear())?$n:Kn)[e.getMonth()]+e.getDate()-1;function Zn(e,t){e=Ft(e);var o=new Date(e*1e3);Fe[t>>2]=o.getSeconds(),Fe[t+4>>2]=o.getMinutes(),Fe[t+8>>2]=o.getHours(),Fe[t+12>>2]=o.getDate(),Fe[t+16>>2]=o.getMonth(),Fe[t+20>>2]=o.getFullYear()-1900,Fe[t+24>>2]=o.getDay();var s=Yn(o)|0;Fe[t+28>>2]=s,Fe[t+36>>2]=-(o.getTimezoneOffset()*60);var n=new Date(o.getFullYear(),0,1),i=new Date(o.getFullYear(),6,1).getTimezoneOffset(),r=n.getTimezoneOffset(),u=(i!=r&&o.getTimezoneOffset()==Math.min(r,i))|0;Fe[t+32>>2]=u}function er(e,t,o,s,n,i,r){n=Ft(n);try{var u=Ne.getStreamFromFD(s),D=l.mmap(u,e,n,t,o),N=D.ptr;return Fe[i>>2]=D.allocated,Pe[r>>2]=N,0}catch(ee){if(typeof l>"u"||ee.name!=="ErrnoError")throw ee;return-ee.errno}}function tr(e,t,o,s,n,i){i=Ft(i);try{var r=Ne.getStreamFromFD(n);o&2&&Ne.doMsync(e,r,t,s,i)}catch(u){if(typeof l>"u"||u.name!=="ErrnoError")throw u;return-u.errno}}var nr=(e,t,o,s)=>{var n=new Date().getFullYear(),i=new Date(n,0,1),r=new Date(n,6,1),u=i.getTimezoneOffset(),D=r.getTimezoneOffset(),N=Math.max(u,D);Pe[e>>2]=N*60,Fe[t>>2]=+(u!=D);var ee=g=>{var H=g>=0?"-":"+",U=Math.abs(g);return`UTC${H}${String(Math.floor(U/60)).padStart(2,"0")}${String(U%60).padStart(2,"0")}`},x=ee(u),K=ee(D);D<u?(rt(x,o,17),rt(K,s,17)):(rt(x,s,17),rt(K,o,17))},on=()=>performance.now(),an=()=>Date.now(),rr=e=>e>=0&&e<=3;function Vt(e,t,o){if(!rr(e))return 28;var s;e===0?s=an():s=on();var n=Math.round(s*1e3*1e3);return Ge[o>>3]=BigInt(n),0}var ln=()=>2147483648,lt=()=>ln(),Ct=e=>{var t=(e-ot.buffer.byteLength+65535)/65536|0;try{return ot.grow(t),Jt(),1}catch{}},c=e=>{var t=Ze.length;e>>>=0;var o=ln();if(e>o)return!1;for(var s=1;s<=4;s*=2){var n=t*(1+.2/s);if(n=Math.min(n,e+100663296),Ct(Math.min(o,Wt(Math.max(e,n),65536))))return!0}return!1},_={},m=()=>Be||"./this.program",X=()=>{if(!X.strings){var e=(globalThis.navigator?.language??"C").replace("-","_")+".UTF-8",t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:m()};for(var o in _)_[o]===void 0?delete t[o]:t[o]=_[o];var s=[];for(var o in t)s.push(`${o}=${t[o]}`);X.strings=s}return X.strings},ue=(e,t)=>{var o=0,s=0;for(var n of X()){var i=t+o;Pe[e+s>>2]=i,o+=rt(n,i,1/0)+1,s+=4}return 0},de=(e,t)=>{var o=X();Pe[e>>2]=o.length;var s=0;for(var n of o)s+=ht(n)+1;return Pe[t>>2]=s,0};function be(e){try{var t=Ne.getStreamFromFD(e);return l.close(t),0}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return o.errno}}function je(e,t){try{var o=0,s=0,n=0,i=Ne.getStreamFromFD(e),r=i.tty?2:l.isDir(i.mode)?3:l.isLink(i.mode)?7:4;return Ve[t]=r,Ot[t+2>>1]=n,Ge[t+8>>3]=BigInt(o),Ge[t+16>>3]=BigInt(s),0}catch(u){if(typeof l>"u"||u.name!=="ErrnoError")throw u;return u.errno}}var bt=(e,t,o,s)=>{for(var n=0,i=0;i<o;i++){var r=Pe[t>>2],u=Pe[t+4>>2];t+=8;var D=l.read(e,Ve,r,u,s);if(D<0)return-1;if(n+=D,D<u)break}return n};function ct(e,t,o,s){try{var n=bt(Ne.getStreamFromFD(e),t,o);return Pe[s>>2]=n,0}catch(i){if(typeof l>"u"||i.name!=="ErrnoError")throw i;return i.errno}}function ir(e,t,o,s){t=Ft(t);try{if(isNaN(t))return 61;var n=Ne.getStreamFromFD(e);return l.llseek(n,t,o),Ge[s>>3]=BigInt(n.position),n.getdents&&t===0&&o===0&&(n.getdents=null),0}catch(i){if(typeof l>"u"||i.name!=="ErrnoError")throw i;return i.errno}}function sr(e){try{var t=Ne.getStreamFromFD(e);return t.stream_ops?.fsync?.(t)}catch(o){if(typeof l>"u"||o.name!=="ErrnoError")throw o;return o.errno}}var or=(e,t,o,s)=>{for(var n=0,i=0;i<o;i++){var r=Pe[t>>2],u=Pe[t+4>>2];t+=8;var D=l.write(e,Ve,r,u,s);if(D<0)return-1;if(n+=D,D<u)break}return n};function ar(e,t,o,s){try{var n=or(Ne.getStreamFromFD(e),t,o);return Pe[s>>2]=n,0}catch(i){if(typeof l>"u"||i.name!=="ErrnoError")throw i;return i.errno}}if(l.createPreloadedFile=Rn,l.preloadFile=nn,l.staticInit(),dn(),f.noExitRuntime&&f.noExitRuntime,f.preloadPlugins&&(Nt=f.preloadPlugins),f.print&&(he=f.print),f.printErr&&(ie=f.printErr),f.wasmBinary&&(ae=f.wasmBinary),f.arguments&&f.arguments,f.thisProgram&&(Be=f.thisProgram),f.preInit)for(typeof f.preInit=="function"&&(f.preInit=[f.preInit]);f.preInit.length>0;)f.preInit.shift()();f.wasmMemory=ot;var cn;function fr(e){f._sqlite3_status64=e.sqlite3_status64,f._sqlite3_status=e.sqlite3_status,f._sqlite3_db_status64=e.sqlite3_db_status64,f._sqlite3_msize=e.sqlite3_msize,f._sqlite3_db_status=e.sqlite3_db_status,f._sqlite3_vfs_find=e.sqlite3_vfs_find,f._sqlite3_initialize=e.sqlite3_initialize,f._sqlite3_malloc=e.sqlite3_malloc,f._sqlite3_free=e.sqlite3_free,f._sqlite3_vfs_register=e.sqlite3_vfs_register,f._sqlite3_vfs_unregister=e.sqlite3_vfs_unregister,f._sqlite3_malloc64=e.sqlite3_malloc64,f._sqlite3_realloc=e.sqlite3_realloc,f._sqlite3_realloc64=e.sqlite3_realloc64,f._sqlite3_value_text=e.sqlite3_value_text,f._sqlite3_randomness=e.sqlite3_randomness,f._sqlite3_stricmp=e.sqlite3_stricmp,f._sqlite3_strnicmp=e.sqlite3_strnicmp,f._sqlite3_uri_parameter=e.sqlite3_uri_parameter,f._sqlite3_uri_boolean=e.sqlite3_uri_boolean,f._sqlite3_serialize=e.sqlite3_serialize,f._sqlite3_prepare_v2=e.sqlite3_prepare_v2,f._sqlite3_step=e.sqlite3_step,f._sqlite3_column_int64=e.sqlite3_column_int64,f._sqlite3_reset=e.sqlite3_reset,f._sqlite3_exec=e.sqlite3_exec,f._sqlite3_column_int=e.sqlite3_column_int,f._sqlite3_finalize=e.sqlite3_finalize,f._sqlite3_file_control=e.sqlite3_file_control,f._sqlite3_column_name=e.sqlite3_column_name,f._sqlite3_column_text=e.sqlite3_column_text,f._sqlite3_column_type=e.sqlite3_column_type,f._sqlite3_errmsg=e.sqlite3_errmsg,f._sqlite3_deserialize=e.sqlite3_deserialize,f._sqlite3_clear_bindings=e.sqlite3_clear_bindings,f._sqlite3_value_blob=e.sqlite3_value_blob,f._sqlite3_value_bytes=e.sqlite3_value_bytes,f._sqlite3_value_double=e.sqlite3_value_double,f._sqlite3_value_int=e.sqlite3_value_int,f._sqlite3_value_int64=e.sqlite3_value_int64,f._sqlite3_value_subtype=e.sqlite3_value_subtype,f._sqlite3_value_pointer=e.sqlite3_value_pointer,f._sqlite3_value_type=e.sqlite3_value_type,f._sqlite3_value_nochange=e.sqlite3_value_nochange,f._sqlite3_value_frombind=e.sqlite3_value_frombind,f._sqlite3_value_dup=e.sqlite3_value_dup,f._sqlite3_value_free=e.sqlite3_value_free,f._sqlite3_result_blob=e.sqlite3_result_blob,f._sqlite3_result_error_toobig=e.sqlite3_result_error_toobig,f._sqlite3_result_error_nomem=e.sqlite3_result_error_nomem,f._sqlite3_result_double=e.sqlite3_result_double,f._sqlite3_result_error=e.sqlite3_result_error,f._sqlite3_result_int=e.sqlite3_result_int,f._sqlite3_result_int64=e.sqlite3_result_int64,f._sqlite3_result_null=e.sqlite3_result_null,f._sqlite3_result_pointer=e.sqlite3_result_pointer,f._sqlite3_result_subtype=e.sqlite3_result_subtype,f._sqlite3_result_text=e.sqlite3_result_text,f._sqlite3_result_zeroblob=e.sqlite3_result_zeroblob,f._sqlite3_result_zeroblob64=e.sqlite3_result_zeroblob64,f._sqlite3_result_error_code=e.sqlite3_result_error_code,f._sqlite3_user_data=e.sqlite3_user_data,f._sqlite3_context_db_handle=e.sqlite3_context_db_handle,f._sqlite3_vtab_nochange=e.sqlite3_vtab_nochange,f._sqlite3_vtab_in_first=e.sqlite3_vtab_in_first,f._sqlite3_vtab_in_next=e.sqlite3_vtab_in_next,f._sqlite3_aggregate_context=e.sqlite3_aggregate_context,f._sqlite3_get_auxdata=e.sqlite3_get_auxdata,f._sqlite3_set_auxdata=e.sqlite3_set_auxdata,f._sqlite3_column_count=e.sqlite3_column_count,f._sqlite3_data_count=e.sqlite3_data_count,f._sqlite3_column_blob=e.sqlite3_column_blob,f._sqlite3_column_bytes=e.sqlite3_column_bytes,f._sqlite3_column_double=e.sqlite3_column_double,f._sqlite3_column_value=e.sqlite3_column_value,f._sqlite3_column_decltype=e.sqlite3_column_decltype,f._sqlite3_column_database_name=e.sqlite3_column_database_name,f._sqlite3_column_table_name=e.sqlite3_column_table_name,f._sqlite3_column_origin_name=e.sqlite3_column_origin_name,f._sqlite3_bind_blob=e.sqlite3_bind_blob,f._sqlite3_bind_double=e.sqlite3_bind_double,f._sqlite3_bind_int=e.sqlite3_bind_int,f._sqlite3_bind_int64=e.sqlite3_bind_int64,f._sqlite3_bind_null=e.sqlite3_bind_null,f._sqlite3_bind_pointer=e.sqlite3_bind_pointer,f._sqlite3_bind_text=e.sqlite3_bind_text,f._sqlite3_bind_parameter_count=e.sqlite3_bind_parameter_count,f._sqlite3_bind_parameter_name=e.sqlite3_bind_parameter_name,f._sqlite3_bind_parameter_index=e.sqlite3_bind_parameter_index,f._sqlite3_db_handle=e.sqlite3_db_handle,f._sqlite3_stmt_readonly=e.sqlite3_stmt_readonly,f._sqlite3_stmt_isexplain=e.sqlite3_stmt_isexplain,f._sqlite3_stmt_explain=e.sqlite3_stmt_explain,f._sqlite3_stmt_busy=e.sqlite3_stmt_busy,f._sqlite3_next_stmt=e.sqlite3_next_stmt,f._sqlite3_stmt_status=e.sqlite3_stmt_status,f._sqlite3_sql=e.sqlite3_sql,f._sqlite3_expanded_sql=e.sqlite3_expanded_sql,f._sqlite3_preupdate_old=e.sqlite3_preupdate_old,f._sqlite3_preupdate_count=e.sqlite3_preupdate_count,f._sqlite3_preupdate_depth=e.sqlite3_preupdate_depth,f._sqlite3_preupdate_blobwrite=e.sqlite3_preupdate_blobwrite,f._sqlite3_preupdate_new=e.sqlite3_preupdate_new,f._sqlite3_value_numeric_type=e.sqlite3_value_numeric_type,f._sqlite3_set_authorizer=e.sqlite3_set_authorizer,f._sqlite3_strglob=e.sqlite3_strglob,f._sqlite3_strlike=e.sqlite3_strlike,f._sqlite3_auto_extension=e.sqlite3_auto_extension,f._sqlite3_cancel_auto_extension=e.sqlite3_cancel_auto_extension,f._sqlite3_reset_auto_extension=e.sqlite3_reset_auto_extension,f._sqlite3_prepare_v3=e.sqlite3_prepare_v3,f._sqlite3_create_module=e.sqlite3_create_module,f._sqlite3_create_module_v2=e.sqlite3_create_module_v2,f._sqlite3_drop_modules=e.sqlite3_drop_modules,f._sqlite3_declare_vtab=e.sqlite3_declare_vtab,f._sqlite3_vtab_on_conflict=e.sqlite3_vtab_on_conflict,f._sqlite3_vtab_collation=e.sqlite3_vtab_collation,f._sqlite3_vtab_in=e.sqlite3_vtab_in,f._sqlite3_vtab_rhs_value=e.sqlite3_vtab_rhs_value,f._sqlite3_vtab_distinct=e.sqlite3_vtab_distinct,f._sqlite3_keyword_name=e.sqlite3_keyword_name,f._sqlite3_keyword_count=e.sqlite3_keyword_count,f._sqlite3_keyword_check=e.sqlite3_keyword_check,f._sqlite3_complete=e.sqlite3_complete,f._sqlite3_libversion=e.sqlite3_libversion,f._sqlite3_libversion_number=e.sqlite3_libversion_number,f._sqlite3_shutdown=e.sqlite3_shutdown,f._sqlite3_last_insert_rowid=e.sqlite3_last_insert_rowid,f._sqlite3_set_last_insert_rowid=e.sqlite3_set_last_insert_rowid,f._sqlite3_changes64=e.sqlite3_changes64,f._sqlite3_changes=e.sqlite3_changes,f._sqlite3_total_changes64=e.sqlite3_total_changes64,f._sqlite3_total_changes=e.sqlite3_total_changes,f._sqlite3_txn_state=e.sqlite3_txn_state,f._sqlite3_close_v2=e.sqlite3_close_v2,f._sqlite3_busy_handler=e.sqlite3_busy_handler,f._sqlite3_progress_handler=e.sqlite3_progress_handler,f._sqlite3_busy_timeout=e.sqlite3_busy_timeout,f._sqlite3_interrupt=e.sqlite3_interrupt,f._sqlite3_is_interrupted=e.sqlite3_is_interrupted,f._sqlite3_create_function=e.sqlite3_create_function,f._sqlite3_create_function_v2=e.sqlite3_create_function_v2,f._sqlite3_create_window_function=e.sqlite3_create_window_function,f._sqlite3_overload_function=e.sqlite3_overload_function,f._sqlite3_trace_v2=e.sqlite3_trace_v2,f._sqlite3_commit_hook=e.sqlite3_commit_hook,f._sqlite3_update_hook=e.sqlite3_update_hook,f._sqlite3_rollback_hook=e.sqlite3_rollback_hook,f._sqlite3_preupdate_hook=e.sqlite3_preupdate_hook,f._sqlite3_set_errmsg=e.sqlite3_set_errmsg,f._sqlite3_error_offset=e.sqlite3_error_offset,f._sqlite3_errcode=e.sqlite3_errcode,f._sqlite3_extended_errcode=e.sqlite3_extended_errcode,f._sqlite3_errstr=e.sqlite3_errstr,f._sqlite3_limit=e.sqlite3_limit,f._sqlite3_open=e.sqlite3_open,f._sqlite3_open_v2=e.sqlite3_open_v2,f._sqlite3_create_collation=e.sqlite3_create_collation,f._sqlite3_create_collation_v2=e.sqlite3_create_collation_v2,f._sqlite3_collation_needed=e.sqlite3_collation_needed,f._sqlite3_get_autocommit=e.sqlite3_get_autocommit,f._sqlite3_table_column_metadata=e.sqlite3_table_column_metadata,f._sqlite3_extended_result_codes=e.sqlite3_extended_result_codes,f._sqlite3_uri_key=e.sqlite3_uri_key,f._sqlite3_uri_int64=e.sqlite3_uri_int64,f._sqlite3_db_name=e.sqlite3_db_name,f._sqlite3_db_filename=e.sqlite3_db_filename,f._sqlite3_db_readonly=e.sqlite3_db_readonly,f._sqlite3_compileoption_used=e.sqlite3_compileoption_used,f._sqlite3_compileoption_get=e.sqlite3_compileoption_get,f._sqlite3session_diff=e.sqlite3session_diff,f._sqlite3session_attach=e.sqlite3session_attach,f._sqlite3session_create=e.sqlite3session_create,f._sqlite3session_delete=e.sqlite3session_delete,f._sqlite3session_table_filter=e.sqlite3session_table_filter,f._sqlite3session_changeset=e.sqlite3session_changeset,f._sqlite3session_changeset_strm=e.sqlite3session_changeset_strm,f._sqlite3session_patchset_strm=e.sqlite3session_patchset_strm,f._sqlite3session_patchset=e.sqlite3session_patchset,f._sqlite3session_enable=e.sqlite3session_enable,f._sqlite3session_indirect=e.sqlite3session_indirect,f._sqlite3session_isempty=e.sqlite3session_isempty,f._sqlite3session_memory_used=e.sqlite3session_memory_used,f._sqlite3session_object_config=e.sqlite3session_object_config,f._sqlite3session_changeset_size=e.sqlite3session_changeset_size,f._sqlite3changeset_start=e.sqlite3changeset_start,f._sqlite3changeset_start_v2=e.sqlite3changeset_start_v2,f._sqlite3changeset_start_strm=e.sqlite3changeset_start_strm,f._sqlite3changeset_start_v2_strm=e.sqlite3changeset_start_v2_strm,f._sqlite3changeset_next=e.sqlite3changeset_next,f._sqlite3changeset_op=e.sqlite3changeset_op,f._sqlite3changeset_pk=e.sqlite3changeset_pk,f._sqlite3changeset_old=e.sqlite3changeset_old,f._sqlite3changeset_new=e.sqlite3changeset_new,f._sqlite3changeset_conflict=e.sqlite3changeset_conflict,f._sqlite3changeset_fk_conflicts=e.sqlite3changeset_fk_conflicts,f._sqlite3changeset_finalize=e.sqlite3changeset_finalize,f._sqlite3changeset_invert=e.sqlite3changeset_invert,f._sqlite3changeset_invert_strm=e.sqlite3changeset_invert_strm,f._sqlite3changeset_apply_v2=e.sqlite3changeset_apply_v2,f._sqlite3changeset_apply_v3=e.sqlite3changeset_apply_v3,f._sqlite3changeset_apply=e.sqlite3changeset_apply,f._sqlite3changeset_apply_v3_strm=e.sqlite3changeset_apply_v3_strm,f._sqlite3changeset_apply_v2_strm=e.sqlite3changeset_apply_v2_strm,f._sqlite3changeset_apply_strm=e.sqlite3changeset_apply_strm,f._sqlite3changegroup_new=e.sqlite3changegroup_new,f._sqlite3changegroup_add=e.sqlite3changegroup_add,f._sqlite3changegroup_output=e.sqlite3changegroup_output,f._sqlite3changegroup_add_strm=e.sqlite3changegroup_add_strm,f._sqlite3changegroup_output_strm=e.sqlite3changegroup_output_strm,f._sqlite3changegroup_delete=e.sqlite3changegroup_delete,f._sqlite3changeset_concat=e.sqlite3changeset_concat,f._sqlite3changeset_concat_strm=e.sqlite3changeset_concat_strm,f._sqlite3session_config=e.sqlite3session_config,f._sqlite3_sourceid=e.sqlite3_sourceid,f._sqlite3__wasm_pstack_ptr=e.sqlite3__wasm_pstack_ptr,f._sqlite3__wasm_pstack_restore=e.sqlite3__wasm_pstack_restore,f._sqlite3__wasm_pstack_alloc=e.sqlite3__wasm_pstack_alloc,f._sqlite3__wasm_pstack_remaining=e.sqlite3__wasm_pstack_remaining,f._sqlite3__wasm_pstack_quota=e.sqlite3__wasm_pstack_quota,f._sqlite3__wasm_test_struct=e.sqlite3__wasm_test_struct,f._sqlite3__wasm_enum_json=e.sqlite3__wasm_enum_json,f._sqlite3__wasm_vfs_unlink=e.sqlite3__wasm_vfs_unlink,f._sqlite3__wasm_db_vfs=e.sqlite3__wasm_db_vfs,f._sqlite3__wasm_db_reset=e.sqlite3__wasm_db_reset,f._sqlite3__wasm_db_export_chunked=e.sqlite3__wasm_db_export_chunked,f._sqlite3__wasm_db_serialize=e.sqlite3__wasm_db_serialize,f._sqlite3__wasm_vfs_create_file=e.sqlite3__wasm_vfs_create_file,f._sqlite3__wasm_posix_create_file=e.sqlite3__wasm_posix_create_file,f._sqlite3__wasm_kvvfsMakeKey=e.sqlite3__wasm_kvvfsMakeKey,f._sqlite3__wasm_kvvfs_methods=e.sqlite3__wasm_kvvfs_methods,f._sqlite3__wasm_vtab_config=e.sqlite3__wasm_vtab_config,f._sqlite3__wasm_db_config_ip=e.sqlite3__wasm_db_config_ip,f._sqlite3__wasm_db_config_pii=e.sqlite3__wasm_db_config_pii,f._sqlite3__wasm_db_config_s=e.sqlite3__wasm_db_config_s,f._sqlite3__wasm_config_i=e.sqlite3__wasm_config_i,f._sqlite3__wasm_config_ii=e.sqlite3__wasm_config_ii,f._sqlite3__wasm_config_j=e.sqlite3__wasm_config_j,f._sqlite3__wasm_qfmt_token=e.sqlite3__wasm_qfmt_token,f._sqlite3__wasm_kvvfs_decode=e.sqlite3__wasm_kvvfs_decode,f._sqlite3__wasm_kvvfs_encode=e.sqlite3__wasm_kvvfs_encode,f._sqlite3__wasm_init_wasmfs=e.sqlite3__wasm_init_wasmfs,f._sqlite3__wasm_test_intptr=e.sqlite3__wasm_test_intptr,f._sqlite3__wasm_test_voidptr=e.sqlite3__wasm_test_voidptr,f._sqlite3__wasm_test_int64_max=e.sqlite3__wasm_test_int64_max,f._sqlite3__wasm_test_int64_min=e.sqlite3__wasm_test_int64_min,f._sqlite3__wasm_test_int64_times2=e.sqlite3__wasm_test_int64_times2,f._sqlite3__wasm_test_int64_minmax=e.sqlite3__wasm_test_int64_minmax,f._sqlite3__wasm_test_int64ptr=e.sqlite3__wasm_test_int64ptr,f._sqlite3__wasm_test_stack_overflow=e.sqlite3__wasm_test_stack_overflow,f._sqlite3__wasm_test_str_hello=e.sqlite3__wasm_test_str_hello,f._sqlite3__wasm_SQLTester_strglob=e.sqlite3__wasm_SQLTester_strglob,f._malloc=e.malloc,f._free=e.free,f._realloc=e.realloc,cn=e.emscripten_builtin_memalign,e._emscripten_stack_restore,e._emscripten_stack_alloc,e.emscripten_stack_get_current,e.__indirect_function_table}var _r={__syscall_chmod:Fn,__syscall_faccessat:Cn,__syscall_fchmod:Dn,__syscall_fchown32:Qt,__syscall_fcntl64:Pn,__syscall_fstat64:xn,__syscall_ftruncate64:Bn,__syscall_getcwd:dt,__syscall_ioctl:Et,__syscall_lstat64:rn,__syscall_mkdirat:jn,__syscall_newfstatat:Wn,__syscall_openat:Hn,__syscall_readlinkat:zn,__syscall_rmdir:Qn,__syscall_stat64:Vn,__syscall_unlinkat:Gn,__syscall_utimensat:Xn,_localtime_js:Zn,_mmap_js:er,_munmap_js:tr,_tzset_js:nr,clock_time_get:Vt,emscripten_date_now:an,emscripten_get_heap_max:lt,emscripten_get_now:on,emscripten_resize_heap:c,environ_get:ue,environ_sizes_get:de,fd_close:be,fd_fdstat_get:je,fd_read:ct,fd_seek:ir,fd_sync:sr,fd_write:ar,memory:ot};function lr(){if(mt>0){kt=lr;return}if(fn(),mt>0){kt=lr;return}function e(){f.calledRun=!0,!pt&&(pn(),ut?.(f),f.onRuntimeInitialized?.(),hn())}f.setStatus?(f.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>f.setStatus(""),1),e()},1)):e()}var Mt=await Sn();return lr(),f.runSQLite3PostLoadInit=async function(e,t,o){delete t.runSQLite3PostLoadInit,globalThis.sqlite3ApiBootstrap=async function s(n=globalThis.sqlite3ApiConfig||s.defaultConfig){if(s.sqlite3)return(s.sqlite3.config||console).warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),s.sqlite3;const i=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},n||{});Object.assign(i,{allocExportName:i.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:i.useStdAlloc?"free":"sqlite3_free",reallocExportName:i.useStdAlloc?"realloc":"sqlite3_realloc"}),["exports","memory","functionTable","wasmfsOpfsDir"].forEach(p=>{typeof i[p]=="function"&&(i[p]=i[p]())});const r=Object.create(null),u=Object.create(null),D=p=>r.sqlite3_js_rc_str&&r.sqlite3_js_rc_str(p)||"Unknown result code #"+p,N=p=>typeof p=="number"&&p===(p|0)&&p<=2147483647&&p>=-2147483648;class ee extends Error{constructor(...b){let q;if(b.length)if(N(b[0]))if(q=b[0],b.length===1)super(D(b[0]));else{const j=D(q);typeof b[1]=="object"?super(j,b[1]):(b[0]=j+":",super(b.join(" ")))}else b.length===2&&typeof b[1]=="object"?super(...b):super(b.join(" "));this.resultCode=q||r.SQLITE_ERROR,this.name="SQLite3Error"}}ee.toss=(...p)=>{throw new ee(...p)};const x=ee.toss;i.wasmfsOpfsDir&&!/^\/[^/]+$/.test(i.wasmfsOpfsDir)&&x("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const K=function p(b){return p._max||(p._max=BigInt("0x7fffffffffffffff"),p._min=~p._max),b>=p._min&&b<=p._max},g=p=>p>=-2147483647n-1n&&p<=2147483647n,H=function p(b){return p._min||(p._min=Number.MIN_SAFE_INTEGER,p._max=Number.MAX_SAFE_INTEGER),b>=p._min&&b<=p._max},U=p=>p&&p.constructor&&N(p.constructor.BYTES_PER_ELEMENT)?p:!1,oe=p=>p&&(p instanceof Uint8Array||p instanceof Int8Array||p instanceof ArrayBuffer),S=p=>p&&(p instanceof Uint8Array||p instanceof Int8Array||p instanceof ArrayBuffer),T=p=>oe(p)||x("Value is not of a supported TypedArray type."),M=function(p){return S(p)?u.typedArrayToString(p instanceof ArrayBuffer?new Uint8Array(p):p,0,p.length):Array.isArray(p)?p.join(""):(u.isPtr(p)&&(p=u.cstrToJs(p)),p)};class Q extends Error{constructor(...b){b.length===2&&typeof b[1]=="object"?super(...b):b.length?super(b.join(" ")):super("Allocation failed."),this.resultCode=r.SQLITE_NOMEM,this.name="WasmAllocError"}}Q.toss=(...p)=>{throw new Q(...p)},Object.assign(r,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(p,b,q,j,ne,fe,Ie,we,Te)=>{},sqlite3_create_function:(p,b,q,j,ne,fe,Ie,we)=>{},sqlite3_create_window_function:(p,b,q,j,ne,fe,Ie,we,Te,J)=>{},sqlite3_prepare_v3:(p,b,q,j,ne,fe)=>{},sqlite3_prepare_v2:(p,b,q,j,ne)=>{},sqlite3_exec:(p,b,q,j,ne)=>{},sqlite3_randomness:(p,b)=>{}});const O={affirmBindableTypedArray:T,flexibleString:M,bigIntFits32:g,bigIntFits64:K,bigIntFitsDouble:H,isBindableTypedArray:oe,isInt32:N,isSQLableTypedArray:S,isTypedArray:U,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,toss:function(...p){throw new Error(p.join(" "))},toss3:x,typedArrayPart:u.typedArrayPart,assert:function(p,b){p||O.toss("Assertion failed:",b)},affirmDbHeader:function(p){p instanceof ArrayBuffer&&(p=new Uint8Array(p));const b="SQLite format 3";15>p.byteLength&&x("Input does not contain an SQLite3 database header.");for(let q=0;q<15;++q)b.charCodeAt(q)!==p[q]&&x("Input does not contain an SQLite3 database header.")},affirmIsDb:function(p){p instanceof ArrayBuffer&&(p=new Uint8Array(p));const b=p.byteLength;(b<512||b%512!==0)&&x("Byte array size",b,"is invalid for an SQLite3 db."),O.affirmDbHeader(p)}};Object.assign(u,{exports:i.exports||x("Missing API config.exports (WASM module exports)."),memory:i.memory||i.exports.memory||x("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),pointerSize:typeof i.exports.sqlite3_libversion()=="number"?4:8,bigIntEnabled:!!i.bigIntEnabled,functionTable:i.functionTable,alloc:void 0,realloc:void 0,dealloc:void 0}),u.allocFromTypedArray=function(p){p instanceof ArrayBuffer&&(p=new Uint8Array(p)),T(p);const b=u.alloc(p.byteLength||1);return u.heapForSize(p.constructor).set(p.byteLength?p:[0],Number(b)),b};{const p=i.allocExportName,b=i.deallocExportName,q=i.reallocExportName;for(const j of[p,b,q])u.exports[j]instanceof Function||x("Missing required exports[",j,"] function.");u.alloc=function j(ne){return j.impl(ne)||Q.toss("Failed to allocate",ne," bytes.")},u.alloc.impl=u.exports[p],u.realloc=function j(ne,fe){const Ie=j.impl(u.ptr.coerce(ne),fe);return fe?Ie||Q.toss("Failed to reallocate",fe," bytes."):u.ptr.null},u.realloc.impl=u.exports[q],u.dealloc=function j(ne){j.impl(u.ptr.coerce(ne))},u.dealloc.impl=u.exports[b]}u.compileOptionUsed=function p(b){if(arguments.length){if(Array.isArray(b)){const q=Object.create(null);return b.forEach(j=>{q[j]=r.sqlite3_compileoption_used(j)}),q}else if(typeof b=="object")return Object.keys(b).forEach(q=>{b[q]=r.sqlite3_compileoption_used(q)}),b}else{if(p._result)return p._result;p._opt||(p._rx=/^([^=]+)=(.+)/,p._rxInt=/^-?\d+$/,p._opt=function(Ie,we){const Te=p._rx.exec(Ie);we[0]=Te?Te[1]:Ie,we[1]=Te?p._rxInt.test(Te[2])?+Te[2]:Te[2]:!0});const q=Object.create(null),j=[0,0];let ne=0,fe;for(;fe=r.sqlite3_compileoption_get(ne++);)p._opt(fe,j),q[j[0]]=j[1];return p._result=q}return typeof b=="string"?!!r.sqlite3_compileoption_used(b):!1},u.pstack=Object.assign(Object.create(null),{restore:u.exports.sqlite3__wasm_pstack_restore,alloc:function(p){return typeof p=="string"&&!(p=u.sizeofIR(p))&&Q.toss("Invalid value for pstack.alloc(",arguments[0],")"),u.exports.sqlite3__wasm_pstack_alloc(p)||Q.toss("Could not allocate",p,"bytes from the pstack.")},allocChunks:function(p,b){typeof b=="string"&&!(b=u.sizeofIR(b))&&Q.toss("Invalid size value for allocChunks(",arguments[1],")");const q=u.pstack.alloc(p*b),j=[q];let ne=1,fe=b;for(;ne<p;++ne,fe+=b)j.push(u.ptr.add(q,fe));return j},allocPtr:(p=1,b=!0)=>p===1?u.pstack.alloc(b?8:u.ptr.size):u.pstack.allocChunks(p,b?8:u.ptr.size),call:function(p){const b=u.pstack.pointer;try{return p(R)}finally{u.pstack.restore(b)}}}),Object.defineProperties(u.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:u.exports.sqlite3__wasm_pstack_remaining}}),r.sqlite3_randomness=(...p)=>{if(p.length===1&&O.isTypedArray(p[0])&&p[0].BYTES_PER_ELEMENT===1){const b=p[0];if(b.byteLength===0)return u.exports.sqlite3_randomness(0,u.ptr.null),b;const q=u.pstack.pointer;try{let j=b.byteLength,ne=0;const fe=u.exports.sqlite3_randomness,Ie=u.heap8u(),we=j<512?j:512,Te=u.pstack.alloc(we);do{const J=j>we?we:j;fe(J,Te),b.set(u.typedArrayPart(Ie,Te,u.ptr.add(Te,J)),ne),j-=J,ne+=J}while(j>0)}catch(j){i.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",j)}finally{u.pstack.restore(q)}return b}u.exports.sqlite3_randomness(...p)},r.sqlite3_wasmfs_opfs_dir=(function(){if(this.dir!==void 0)return this.dir;const p=i.wasmfsOpfsDir;if(!p||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!u.exports.sqlite3__wasm_init_wasmfs)return this.dir="";try{return p&&u.xCallWrapped("sqlite3__wasm_init_wasmfs","i32",["string"],p)===0?this.dir=p:this.dir=""}catch{return this.dir=""}}).bind(Object.create(null)),r.sqlite3_wasmfs_filename_is_persistent=function(p){const b=r.sqlite3_wasmfs_opfs_dir();return b&&p?p.startsWith(b+"/"):!1},r.sqlite3_js_db_uses_vfs=function(p,b,q=0){try{const j=r.sqlite3_vfs_find(b);return j?p?j===r.sqlite3_js_db_vfs(p,q)?j:!1:j===r.sqlite3_vfs_find(0)?j:!1:!1}catch{return!1}},r.sqlite3_js_vfs_list=function(){const p=[];let b=r.sqlite3_vfs_find(u.ptr.null);for(;b;){const q=new r.sqlite3_vfs(b);p.push(u.cstrToJs(q.$zName)),b=q.$pNext,q.dispose()}return p},r.sqlite3_js_db_export=function(p,b=0){p=u.xWrap.testConvertArg("sqlite3*",p),p||x("Invalid sqlite3* argument."),u.bigIntEnabled||x("BigInt support is not enabled.");const q=u.scopedAllocPush();let j;try{const ne=u.scopedAlloc(8+u.ptr.size),fe=u.ptr.add(ne,8),Ie=b?u.isPtr(b)?b:u.scopedAllocCString(""+b):u.ptr.null;let we=u.exports.sqlite3__wasm_db_serialize(p,Ie,fe,ne,0);we&&x("Database serialization failed with code",R.capi.sqlite3_js_rc_str(we)),j=u.peekPtr(fe);const Te=u.peek(ne,"i64");return we=Te?u.heap8u().slice(Number(j),Number(j)+Number(Te)):new Uint8Array,we}finally{j&&u.exports.sqlite3_free(j),u.scopedAllocPop(q)}},r.sqlite3_js_db_vfs=(p,b=u.ptr.null)=>O.sqlite3__wasm_db_vfs(p,b),r.sqlite3_js_aggregate_context=(p,b)=>r.sqlite3_aggregate_context(p,b)||(b?Q.toss("Cannot allocate",b,"bytes for sqlite3_aggregate_context()"):0),r.sqlite3_js_posix_create_file=function(p,b,q){let j;b&&u.isPtr(b)?j=b:b instanceof ArrayBuffer||b instanceof Uint8Array?(j=u.allocFromTypedArray(b),(arguments.length<3||!O.isInt32(q)||q<0)&&(q=b.byteLength)):ee.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!O.isInt32(q)||q<0)&&ee.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const ne=O.sqlite3__wasm_posix_create_file(p,j,q);ne&&ee.toss("Creation of file failed with sqlite3 result code",r.sqlite3_js_rc_str(ne))}finally{j&&j!==b&&u.dealloc(j)}},r.sqlite3_js_vfs_create_file=function(p,b,q,j){i.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternatives.");let ne;q?u.isPtr(q)?ne=q:(q instanceof ArrayBuffer&&(q=new Uint8Array(q)),q instanceof Uint8Array?(ne=u.allocFromTypedArray(q),(arguments.length<4||!O.isInt32(j)||j<0)&&(j=q.byteLength)):ee.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):ne=0,(!O.isInt32(j)||j<0)&&(ne&&ne!==q&&u.dealloc(ne),ee.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const fe=O.sqlite3__wasm_vfs_create_file(p,b,ne,j);fe&&ee.toss("Creation of file failed with sqlite3 result code",r.sqlite3_js_rc_str(fe))}finally{ne&&ne!==q&&u.dealloc(ne)}},r.sqlite3_js_sql_to_string=p=>{if(typeof p=="string")return p;const b=M(v);return b===v?void 0:b},r.sqlite3_db_config=(function(p,b,...q){switch(b){case r.SQLITE_DBCONFIG_ENABLE_FKEY:case r.SQLITE_DBCONFIG_ENABLE_TRIGGER:case r.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case r.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case r.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case r.SQLITE_DBCONFIG_ENABLE_QPSG:case r.SQLITE_DBCONFIG_TRIGGER_EQP:case r.SQLITE_DBCONFIG_RESET_DATABASE:case r.SQLITE_DBCONFIG_DEFENSIVE:case r.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case r.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case r.SQLITE_DBCONFIG_DQS_DML:case r.SQLITE_DBCONFIG_DQS_DDL:case r.SQLITE_DBCONFIG_ENABLE_VIEW:case r.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case r.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case r.SQLITE_DBCONFIG_STMT_SCANSTATUS:case r.SQLITE_DBCONFIG_REVERSE_SCANORDER:case r.SQLITE_DBCONFIG_ENABLE_ATTACH_CREATE:case r.SQLITE_DBCONFIG_ENABLE_ATTACH_WRITE:case r.SQLITE_DBCONFIG_ENABLE_COMMENTS:return this.ip||(this.ip=u.xWrap("sqlite3__wasm_db_config_ip","int",["sqlite3*","int","int","*"])),this.ip(p,b,q[0],q[1]||0);case r.SQLITE_DBCONFIG_LOOKASIDE:return this.pii||(this.pii=u.xWrap("sqlite3__wasm_db_config_pii","int",["sqlite3*","int","*","int","int"])),this.pii(p,b,q[0],q[1],q[2]);case r.SQLITE_DBCONFIG_MAINDBNAME:return this.s||(this.s=u.xWrap("sqlite3__wasm_db_config_s","int",["sqlite3*","int","string:static"])),this.s(p,b,q[0]);default:return r.SQLITE_MISUSE}}).bind(Object.create(null)),r.sqlite3_value_to_js=function(p,b=!0){let q;const j=r.sqlite3_value_type(p);switch(j){case r.SQLITE_INTEGER:u.bigIntEnabled?(q=r.sqlite3_value_int64(p),O.bigIntFitsDouble(q)&&(q=Number(q))):q=r.sqlite3_value_double(p);break;case r.SQLITE_FLOAT:q=r.sqlite3_value_double(p);break;case r.SQLITE_TEXT:q=r.sqlite3_value_text(p);break;case r.SQLITE_BLOB:{const ne=r.sqlite3_value_bytes(p),fe=r.sqlite3_value_blob(p);ne&&!fe&&R.WasmAllocError.toss("Cannot allocate memory for blob argument of",ne,"byte(s)"),q=ne?u.heap8u().slice(Number(fe),Number(fe)+Number(ne)):null;break}case r.SQLITE_NULL:q=null;break;default:b&&x(r.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",j),q=void 0}return q},r.sqlite3_values_to_js=function(p,b,q=!0){let j;const ne=[];for(j=0;j<p;++j)ne.push(r.sqlite3_value_to_js(u.peekPtr(u.ptr.add(b,u.ptr.size*j)),q));return ne},r.sqlite3_result_error_js=function(p,b){b instanceof Q?r.sqlite3_result_error_nomem(p):r.sqlite3_result_error(p,""+b,-1)},r.sqlite3_result_js=function(p,b){if(b instanceof Error){r.sqlite3_result_error_js(p,b);return}try{switch(typeof b){case"undefined":break;case"boolean":r.sqlite3_result_int(p,b?1:0);break;case"bigint":O.bigIntFits32(b)?r.sqlite3_result_int(p,Number(b)):O.bigIntFitsDouble(b)?r.sqlite3_result_double(p,Number(b)):u.bigIntEnabled?O.bigIntFits64(b)?r.sqlite3_result_int64(p,b):x("BigInt value",b.toString(),"is too BigInt for int64."):x("BigInt value",b.toString(),"is too BigInt.");break;case"number":{let q;O.isInt32(b)?q=r.sqlite3_result_int:u.bigIntEnabled&&Number.isInteger(b)&&O.bigIntFits64(BigInt(b))?q=r.sqlite3_result_int64:q=r.sqlite3_result_double,q(p,b);break}case"string":{const[q,j]=u.allocCString(b,!0);r.sqlite3_result_text(p,q,j,r.SQLITE_WASM_DEALLOC);break}case"object":if(b===null){r.sqlite3_result_null(p);break}else if(O.isBindableTypedArray(b)){const q=u.allocFromTypedArray(b);r.sqlite3_result_blob(p,q,b.byteLength,r.SQLITE_WASM_DEALLOC);break}default:x("Don't not how to handle this UDF result value:",typeof b,b)}}catch(q){r.sqlite3_result_error_js(p,q)}},r.sqlite3_column_js=function(p,b,q=!0){const j=r.sqlite3_column_value(p,b);return j===0?void 0:r.sqlite3_value_to_js(j,q)};{const p=(function(b,q,j){j=r[j],this.ptr?u.pokePtr(this.ptr,0):this.ptr=u.allocPtr();const ne=j(b,q,this.ptr);if(ne)return ee.toss(ne,arguments[2]+"() failed with code "+ne);const fe=u.peekPtr(this.ptr);return fe?r.sqlite3_value_to_js(fe,!0):void 0}).bind(Object.create(null));r.sqlite3_preupdate_new_js=(b,q)=>p(b,q,"sqlite3_preupdate_new"),r.sqlite3_preupdate_old_js=(b,q)=>p(b,q,"sqlite3_preupdate_old"),r.sqlite3changeset_new_js=(b,q)=>p(b,q,"sqlite3changeset_new"),r.sqlite3changeset_old_js=(b,q)=>p(b,q,"sqlite3changeset_old")}const R={WasmAllocError:Q,SQLite3Error:ee,capi:r,util:O,wasm:u,config:i,version:Object.create(null),client:void 0,asyncPostInit:(async function p(){if(p.isReady instanceof Promise)return p.isReady;let b=this.initializersAsync;delete this.initializersAsync;const q=async()=>(R.__isUnderTest||(delete R.util,delete R.StructBinder),R),j=fe=>{throw i.error("an async sqlite3 initializer failed:",fe),fe};if(!b||!b.length)return p.isReady=q().catch(j);b=b.map(fe=>fe instanceof Function?async Ie=>fe(R):fe),b.push(q);let ne=Promise.resolve(R);for(;b.length;)ne=ne.then(b.shift());return p.isReady=ne.catch(j)}).bind(s),scriptInfo:void 0};typeof o<"u"&&(R.__isUnderTest=!!o);try{s.initializers.forEach(p=>{p(R)})}catch(p){throw console.error("sqlite3 bootstrap initializer threw:",p),p}if(delete s.initializers,s.sqlite3=R,typeof e<"u"&&(e.debugModule("sqlite3ApiBootstrap() complete",R),R.scriptInfo=e),R.__isUnderTest){typeof t<"u"&&(R.config.emscripten=t);const p=R.scriptInfo?.instantiateWasm;p&&(R.wasm.module=p.module,R.wasm.instance=p.instance,R.wasm.imports=p.imports)}return delete globalThis.sqlite3ApiConfig,delete globalThis.sqlite3ApiBootstrap,delete s.defaultConfig,R.asyncPostInit().then(p=>(typeof e<"u"&&e.debugModule("sqlite3.asyncPostInit() complete",p),delete p.asyncPostInit,delete p.scriptInfo,delete p.emscripten,p))},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.sqlite3ApiBootstrap.initializers.push(function(s){s.version={libVersion:"3.52.0",libVersionNumber:3052e3,sourceId:"2026-01-30 06:37:34 407724c4e80efdf93d885e95b5209a100a3f470fe0298138be57201f65f9817e",downloadVersion:352e4,scm:{"sha3-256":"407724c4e80efdf93d885e95b5209a100a3f470fe0298138be57201f65f9817e",branch:"trunk",tags:"",datetime:"2026-01-30T06:37:34.096Z"}}}),globalThis.WhWasmUtilInstaller=function(n){n.bigIntEnabled===void 0&&(n.bigIntEnabled=!!globalThis.BigInt64Array);const i=(...a)=>{throw new Error(a.join(" "))};if(!n.pointerSize&&!n.pointerIR&&n.alloc&&n.dealloc){const a=n.alloc(1);n.pointerSize=typeof a=="bigint"?8:4,n.dealloc(a)}n.pointerSize&&!n.pointerIR&&(n.pointerIR=n.pointerSize===4?"i32":"i64");const r=n.pointerIR??="i32",u=n.pointerSize??=r==="i32"?4:r==="i64"?8:0;delete n.pointerSize,delete n.pointerIR,r!=="i32"&&r!=="i64"?i("Invalid pointerIR:",r):u!==8&&u!==4&&i("Invalid pointerSize:",u);const D=n.bigIntEnabled?a=>BigInt(a||0):a=>i("BigInt support is disabled in this build."),ee=u===4?a=>Number(a||0):D,x=ee(0),K=function(...a){let d=ee(0);for(const h of a)d+=ee(h);return d};{const a=Object.create(null);Object.defineProperty(n,"ptr",{enumerable:!0,get:()=>a,set:()=>i("The ptr property is read-only.")}),(function d(h,A){return Object.defineProperty(a,h,{enumerable:!0,get:()=>A,set:()=>i("ptr["+h+"] is read-only.")}),d})("null",x)("size",u)("ir",r)("coerce",ee)("add",K)("addn",r===4?K:(...d)=>Number(K(...d)))}n.exports||Object.defineProperty(n,"exports",{enumerable:!0,configurable:!0,get:()=>n.instance?.exports});const g=Object.create(null);g.heapSize=0,g.memory=null,g.freeFuncIndexes=[],g.scopedAlloc=[],g.scopedAlloc.pushPtr=a=>(g.scopedAlloc[g.scopedAlloc.length-1].push(a),a),g.utf8Decoder=new TextDecoder,g.utf8Encoder=new TextEncoder("utf-8"),n.sizeofIR=a=>{switch(a){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return u;default:return(""+a).endsWith("*")?u:void 0}};const H=function(){if(!g.memory)g.memory=n.memory instanceof WebAssembly.Memory?n.memory:n.exports.memory;else if(g.heapSize===g.memory.buffer.byteLength)return g;const a=g.memory.buffer;return g.HEAP8=new Int8Array(a),g.HEAP8U=new Uint8Array(a),g.HEAP16=new Int16Array(a),g.HEAP16U=new Uint16Array(a),g.HEAP32=new Int32Array(a),g.HEAP32U=new Uint32Array(a),g.HEAP32F=new Float32Array(a),g.HEAP64F=new Float64Array(a),n.bigIntEnabled&&(typeof BigInt64Array<"u"?(g.HEAP64=new BigInt64Array(a),g.HEAP64U=new BigUint64Array(a)):i("BigInt support is enabled, but the BigInt64Array type is missing.")),g.heapSize=a.byteLength,g};n.heap8=()=>H().HEAP8,n.heap8u=()=>H().HEAP8U,n.heap16=()=>H().HEAP16,n.heap16u=()=>H().HEAP16U,n.heap32=()=>H().HEAP32,n.heap32u=()=>H().HEAP32U,n.heapForSize=function(a,d=!0){const h=g.memory&&g.heapSize===g.memory.buffer.byteLength?g:H();switch(a){case Int8Array:return h.HEAP8;case Uint8Array:return h.HEAP8U;case Int16Array:return h.HEAP16;case Uint16Array:return h.HEAP16U;case Int32Array:return h.HEAP32;case Uint32Array:return h.HEAP32U;case 8:return d?h.HEAP8U:h.HEAP8;case 16:return d?h.HEAP16U:h.HEAP16;case 32:return d?h.HEAP32U:h.HEAP32;case 64:if(h.HEAP64)return d?h.HEAP64U:h.HEAP64;break;default:if(n.bigIntEnabled){if(a===globalThis.BigUint64Array)return h.HEAP64U;if(a===globalThis.BigInt64Array)return h.HEAP64;break}}i("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")};const U=n.functionTable;delete n.functionTable,n.functionTable=U?()=>U:()=>n.exports.__indirect_function_table,n.functionEntry=function(a){const d=n.functionTable();return a<d.length?d.get(ee(a)):void 0},n.jsFuncToWasm=function a(d,h){if(a._||(a._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:r,P:r,s:r,j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:(B,E,F)=>{F<128?B[E](F):B[E](F%128|128,F>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:B=>{const E=a._.rxJSig.exec(B);return E?E[2]:B.substr(1)},letterType:B=>a._.sigTypes[B]||i("Invalid signature letter:",B),pushSigType:(B,E)=>B.push(a._.typeCodes[a._.letterType(E)])}),typeof d=="string"){const B=h;h=d,d=B}const A=a._,V=A.sigParams(h),Z=[1,96];A.uleb128Encode(Z,"push",V.length);for(const B of V)A.pushSigType(Z,B);return h[0]==="v"?Z.push(0):(Z.push(1),A.pushSigType(Z,h[0])),A.uleb128Encode(Z,"unshift",Z.length),Z.unshift(0,97,115,109,1,0,0,0,1),Z.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(Z)),{e:{f:d}}).exports.f};const oe=function(d,h,A){if(A&&!g.scopedAlloc.length&&i("No scopedAllocPush() scope is active."),typeof d=="string"){const E=h;h=d,d=E}(typeof h!="string"||!(d instanceof Function))&&i("Invalid arguments: expecting (function,signature) or (signature,function).");const V=n.functionTable(),Z=ee(V.length);let B;for(;(B=g.freeFuncIndexes.pop())&&V.get(B);){B=null;continue}B||(B=ee(Z),V.grow(ee(1)));try{return V.set(B,d),A&&g.scopedAlloc.pushPtr(B),B}catch(E){if(!(E instanceof TypeError))throw B===Z&&g.freeFuncIndexes.push(Z),E}try{const E=n.jsFuncToWasm(d,h);V.set(B,E),A&&g.scopedAlloc.pushPtr(B)}catch(E){throw B===Z&&g.freeFuncIndexes.push(Z),E}return B};n.installFunction=(a,d)=>oe(a,d,!1),n.scopedInstallFunction=(a,d)=>oe(a,d,!0),n.uninstallFunction=function(a){if(!a&&x!==a)return;const d=n.functionTable();g.freeFuncIndexes.push(a);const h=d.get(a);return d.set(a,null),h},n.peek=function(d,h="i8"){h.endsWith("*")&&(h=r);const A=g.memory&&g.heapSize===g.memory.buffer.byteLength?g:H(),V=Array.isArray(d)?[]:void 0;let Z;do{switch(V&&(d=arguments[0].shift()),h){case"i1":case"i8":Z=A.HEAP8[Number(d)>>0];break;case"i16":Z=A.HEAP16[Number(d)>>1];break;case"i32":Z=A.HEAP32[Number(d)>>2];break;case"float":case"f32":Z=A.HEAP32F[Number(d)>>2];break;case"double":case"f64":Z=Number(A.HEAP64F[Number(d)>>3]);break;case"i64":if(A.HEAP64){Z=D(A.HEAP64[Number(d)>>3]);break}default:i("Invalid type for peek():",h)}V&&V.push(Z)}while(V&&arguments[0].length);return V||Z},n.poke=function(a,d,h="i8"){h.endsWith("*")&&(h=r);const A=g.memory&&g.heapSize===g.memory.buffer.byteLength?g:H();for(const V of Array.isArray(a)?a:[a])switch(h){case"i1":case"i8":A.HEAP8[Number(V)>>0]=d;continue;case"i16":A.HEAP16[Number(V)>>1]=d;continue;case"i32":A.HEAP32[Number(V)>>2]=d;continue;case"float":case"f32":A.HEAP32F[Number(V)>>2]=d;continue;case"double":case"f64":A.HEAP64F[Number(V)>>3]=d;continue;case"i64":if(A.HEAP64){A.HEAP64[Number(V)>>3]=D(d);continue}default:i("Invalid type for poke(): "+h)}return this},n.peekPtr=(...a)=>n.peek(a.length===1?a[0]:a,r),n.pokePtr=(a,d=0)=>n.poke(a,d,r),n.peek8=(...a)=>n.peek(a.length===1?a[0]:a,"i8"),n.poke8=(a,d)=>n.poke(a,d,"i8"),n.peek16=(...a)=>n.peek(a.length===1?a[0]:a,"i16"),n.poke16=(a,d)=>n.poke(a,d,"i16"),n.peek32=(...a)=>n.peek(a.length===1?a[0]:a,"i32"),n.poke32=(a,d)=>n.poke(a,d,"i32"),n.peek64=(...a)=>n.peek(a.length===1?a[0]:a,"i64"),n.poke64=(a,d)=>n.poke(a,d,"i64"),n.peek32f=(...a)=>n.peek(a.length===1?a[0]:a,"f32"),n.poke32f=(a,d)=>n.poke(a,d,"f32"),n.peek64f=(...a)=>n.peek(a.length===1?a[0]:a,"f64"),n.poke64f=(a,d)=>n.poke(a,d,"f64"),n.getMemValue=n.peek,n.getPtrValue=n.peekPtr,n.setMemValue=n.poke,n.setPtrValue=n.pokePtr,n.isPtr32=a=>typeof a=="number"&&a>=0&&a===(a|0),n.isPtr64=a=>typeof a=="bigint"?a>=0:n.isPtr32(a),n.isPtr=u===4?n.isPtr32:n.isPtr64,n.cstrlen=function(a){if(!a||!n.isPtr(a))return null;a=Number(a);const d=H().HEAP8U;let h=a;for(;d[h]!==0;++h);return h-a};const S=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,T=a=>a.buffer instanceof S;n.isSharedTypedArray=T;const M=(a,d,h)=>(u===8&&(typeof d=="bigint"&&(d=Number(d)),typeof h=="bigint"&&(h=Number(h))),T(a)?a.slice(d,h):a.subarray(d,h));n.typedArrayPart=M;const Q=(a,d,h)=>g.utf8Decoder.decode(M(a,d,h));n.typedArrayToString=Q,n.cstrToJs=function(a){const d=n.cstrlen(a);return d?Q(H().HEAP8U,Number(a),Number(a)+d):d===null?d:""},n.jstrlen=function(a){if(typeof a!="string")return null;const d=a.length;let h=0;for(let A=0;A<d;++A){let V=a.charCodeAt(A);V>=55296&&V<=57343&&(V=65536+((V&1023)<<10)|a.charCodeAt(++A)&1023),V<=127?++h:V<=2047?h+=2:V<=65535?h+=3:h+=4}return h},n.jstrcpy=function(a,d,h=0,A=-1,V=!0){if((!d||!(d instanceof Int8Array)&&!(d instanceof Uint8Array))&&i("jstrcpy() target must be an Int8Array or Uint8Array."),A=Number(A),h=Number(h),A<0&&(A=d.length-h),!(A>0)||!(h>=0))return 0;let Z=0,B=a.length;const E=h,F=h+A-(V?1:0);for(;Z<B&&h<F;++Z){let G=a.charCodeAt(Z);if(G>=55296&&G<=57343&&(G=65536+((G&1023)<<10)|a.charCodeAt(++Z)&1023),G<=127){if(h>=F)break;d[h++]=G}else if(G<=2047){if(h+1>=F)break;d[h++]=192|G>>6,d[h++]=128|G&63}else if(G<=65535){if(h+2>=F)break;d[h++]=224|G>>12,d[h++]=128|G>>6&63,d[h++]=128|G&63}else{if(h+3>=F)break;d[h++]=240|G>>18,d[h++]=128|G>>12&63,d[h++]=128|G>>6&63,d[h++]=128|G&63}}return V&&(d[h++]=0),h-E},n.cstrncpy=function(a,d,h){if((!a||!d)&&i("cstrncpy() does not accept NULL strings."),h<0)h=n.cstrlen(strPtr)+1;else if(!(h>0))return 0;const A=n.heap8u();let V=0,Z;const B=Number(a),E=Number(d);for(;V<h&&(Z=A[E+V]);++V)A[B+V]=Z;return V<h&&(A[B+V++]=0),V},n.jstrToUintArray=(a,d=!1)=>g.utf8Encoder.encode(d?a+"\0":a);const O=(a,d)=>{(!(a.alloc instanceof Function)||!(a.dealloc instanceof Function))&&i("Object is missing alloc() and/or dealloc() function(s)","required by",d+"().")},R=function(a,d,h,A){if(O(n,A),typeof a!="string")return null;const V=g.utf8Encoder.encode(a),Z=h(V.length+1);let B=Z;try{const E=H().HEAP8U;return E.set(V,Number(Z)),E[K(Z,V.length)]=0,B=x,d?[Z,V.length]:Z}finally{B&&n.dealloc(B)}};n.allocCString=(a,d=!1)=>R(a,d,n.alloc,"allocCString()"),n.scopedAllocPush=function(){O(n,"scopedAllocPush");const a=[];return g.scopedAlloc.push(a),a},n.scopedAllocPop=function(a){O(n,"scopedAllocPop");const d=arguments.length?g.scopedAlloc.indexOf(a):g.scopedAlloc.length-1;d<0&&i("Invalid state object for scopedAllocPop()."),arguments.length===0&&(a=g.scopedAlloc[d]),g.scopedAlloc.splice(d,1);for(let h;h=a.pop();)n.functionEntry(h)?n.uninstallFunction(h):n.dealloc(h)},n.scopedAlloc=function(a){g.scopedAlloc.length||i("No scopedAllocPush() scope is active.");const d=ee(n.alloc(a));return g.scopedAlloc.pushPtr(d)},Object.defineProperty(n.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>g.scopedAlloc.length,set:()=>i("The 'active' property is read-only.")}),n.scopedAllocCString=(a,d=!1)=>R(a,d,n.scopedAlloc,"scopedAllocCString()");const p=function(a,d){const h=n[a?"scopedAlloc":"alloc"]((d.length+1)*n.ptr.size);let A=0;return d.forEach(V=>{n.pokePtr(K(h,n.ptr.size*A++),n[a?"scopedAllocCString":"allocCString"](""+V))}),n.pokePtr(K(h,n.ptr.size*A),0),h};n.scopedAllocMainArgv=a=>p(!0,a),n.allocMainArgv=a=>p(!1,a),n.cArgvToJs=(a,d)=>{const h=[];for(let A=0;A<a;++A){const V=n.peekPtr(K(d,n.ptr.size*A));h.push(V?n.cstrToJs(V):null)}return h},n.scopedAllocCall=function(a){n.scopedAllocPush();try{return a()}finally{n.scopedAllocPop()}};const b=function(a,d,h){O(n,h);const A=d?"i64":r;let V=n[h](a*(d?8:u));if(n.poke(V,0,A),a===1)return V;const Z=[V];for(let B=1;B<a;++B)V=K(V,d?8:u),Z[B]=V,n.poke(V,0,A);return Z};n.allocPtr=(a=1,d=!0)=>b(a,d,"alloc"),n.scopedAllocPtr=(a=1,d=!0)=>b(a,d,"scopedAlloc"),n.xGet=function(a){return n.exports[a]||i("Cannot find exported symbol:",a)};const q=(a,d)=>i(a+"() requires",d,"argument(s).");n.xCall=function(a,...d){const h=a instanceof Function?a:n.xGet(a);return h instanceof Function||i("Exported symbol",a,"is not a function."),h.length!==d.length&&q(h===a?h.name:a,h.length),arguments.length===2&&Array.isArray(arguments[1])?h.apply(null,arguments[1]):h.apply(null,d)},g.xWrap=Object.create(null),g.xWrap.convert=Object.create(null),g.xWrap.convert.arg=new Map,g.xWrap.convert.result=new Map;const j=g.xWrap.convert.arg,ne=g.xWrap.convert.result,fe=ee;j.set("i64",D).set("i32",a=>a|0).set("i16",a=>(a|0)&65535).set("i8",a=>(a|0)&255).set("f32",a=>Number(a).valueOf()).set("float",j.get("f32")).set("f64",j.get("f32")).set("double",j.get("f64")).set("int",j.get("i32")).set("null",a=>a).set(null,j.get("null")).set("**",fe).set("*",fe),ne.set("*",fe).set("pointer",fe).set("number",a=>Number(a)).set("void",a=>{}).set(void 0,ne.get("void")).set("null",a=>a).set(null,ne.get("null"));for(const a of["i8","i16","i32","i64","int","f32","float","f64","double"])j.set(a+"*",fe),ne.set(a+"*",fe),ne.set(a,j.get(a)||i("Maintenance required: missing arg converter for",a));const Ie=a=>typeof a=="string"?n.scopedAllocCString(a):ee(a);j.set("string",Ie).set("utf8",Ie),ne.set("string",a=>n.cstrToJs(a)).set("utf8",ne.get("string")).set("string:dealloc",a=>{try{return a?n.cstrToJs(a):null}finally{n.dealloc(a)}}).set("utf8:dealloc",ne.get("string:dealloc")).set("json",a=>JSON.parse(n.cstrToJs(a))).set("json:dealloc",a=>{try{return a?JSON.parse(n.cstrToJs(a)):null}finally{n.dealloc(a)}});const we=class{constructor(a){this.name=a.name||"unnamed adapter"}convertArg(a,d,h){i("AbstractArgAdapter must be subclassed.")}};j.FuncPtrAdapter=class yt extends we{constructor(d){super(d),j.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",d),this.name=d.name||"unnamed",this.signature=d.signature,d.contextKey instanceof Function&&(this.contextKey=d.contextKey,d.bindScope||(d.bindScope="context")),this.bindScope=d.bindScope||i("FuncPtrAdapter options requires a bindScope (explicit or implied)."),yt.bindScopes.indexOf(d.bindScope)<0&&i("Invalid options.bindScope ("+d.bindMod+") for FuncPtrAdapter. Expecting one of: ("+yt.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=d.callProxy instanceof Function?d.callProxy:void 0}contextKey(d,h){return this}contextMap(d){const h=this.__cmap||(this.__cmap=new Map);let A=h.get(d);return A===void 0&&h.set(d,A=[]),A}convertArg(d,h,A){let V=this.singleton;if(!V&&this.isContext&&(V=this.contextMap(this.contextKey(h,A))),V&&V.length===2&&V[0]===d)return V[1];if(d instanceof Function){this.callProxy&&(d=this.callProxy(d));const Z=oe(d,this.signature,this.isTransient);if(yt.debugFuncInstall&&yt.debugOut("FuncPtrAdapter installed",this,this.contextKey(h,A),"@"+Z,d),V){if(V[1]){yt.debugFuncInstall&&yt.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(h,A),"@"+V[1],d);try{g.scopedAlloc.pushPtr(V[1])}catch{}}V[0]=arguments[0]||x,V[1]=Z}return Z}else if(n.isPtr(d)||d===null||d===void 0){if(V&&V[1]&&V[1]!==d){yt.debugFuncInstall&&yt.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(h,A),"@"+V[1],d);try{g.scopedAlloc.pushPtr(V[1])}catch{}V[0]=V[1]=d||x}return d||x}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},j.FuncPtrAdapter.warnOnUse=!1,j.FuncPtrAdapter.debugFuncInstall=!1,j.FuncPtrAdapter.debugOut=console.debug.bind(console),j.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const Te=a=>j.get(a)||i("Argument adapter not found:",a),J=a=>ne.get(a)||i("Result adapter not found:",a);g.xWrap.convertArg=(a,...d)=>Te(a)(...d),g.xWrap.convertArgNoCheck=(a,...d)=>j.get(a)(...d),g.xWrap.convertResult=(a,d)=>a===null?d:a?J(a)(d):void 0,g.xWrap.convertResultNoCheck=(a,d)=>a===null?d:a?ne.get(a)(d):void 0,n.xWrap=function a(d,h,...A){arguments.length===3&&Array.isArray(arguments[2])&&(A=arguments[2]),n.isPtr(d)&&(d=n.functionEntry(d)||i("Function pointer not found in WASM function table."));const V=d instanceof Function,Z=V?d:n.xGet(d);if(V&&(d=Z.name||"unnamed function"),A.length!==Z.length&&q(d,Z.length),Z.length===0&&(h===null||h==="null"))return Z;J(h);for(const E of A)E instanceof we?j.set(E,(...F)=>E.convertArg(...F)):Te(E);const B=g.xWrap;return Z.length===0?(...E)=>E.length?q(d,Z.length):B.convertResult(h,Z.call(null)):function(...E){E.length!==Z.length&&q(d,Z.length);const F=n.scopedAllocPush();try{let G=0;for(a.debug&&console.debug("xWrap() preparing: resultType ",h,"xf",Z,"argTypes",A,"args",E);G<E.length;++G)E[G]=B.convertArgNoCheck(A[G],E[G],E,G);return a.debug&&console.debug("xWrap() calling: resultType ",h,"xf",Z,"argTypes",A,"args",E),B.convertResultNoCheck(h,Z.apply(null,E))}finally{n.scopedAllocPop(F)}}};const w=function(a,d,h,A,V,Z){if(typeof h=="string"){if(d===1)return Z.get(h);if(d===2){if(A)A instanceof Function||i(V,"requires a function argument.");else return Z.delete(h),a;return Z.set(h,A),a}}i("Invalid arguments to",V)};return n.xWrap.resultAdapter=function a(d,h){return w(a,arguments.length,d,h,"resultAdapter()",ne)},n.xWrap.argAdapter=function a(d,h){return w(a,arguments.length,d,h,"argAdapter()",j)},n.xWrap.FuncPtrAdapter=j.FuncPtrAdapter,n.xCallWrapped=function(a,d,h,...A){return Array.isArray(arguments[3])&&(A=arguments[3]),n.xWrap(a,d,h||[]).apply(null,A||[])},n.xWrap.testConvertArg=g.xWrap.convertArg,n.xWrap.testConvertResult=g.xWrap.convertResult,n},globalThis.WhWasmUtilInstaller.yawl=(function(n){const i=()=>fetch(n.uri,{credentials:"same-origin"}),r=this,u=function(D){if(n.wasmUtilTarget){const N=(...x)=>{throw new Error(x.join(" "))},ee=n.wasmUtilTarget;if(ee.module=D.module,ee.instance=D.instance,ee.instance.exports.memory||(ee.memory=n?.imports?.env?.memory||N("Missing 'memory' object!")),!ee.alloc&&D.instance.exports.malloc){const x=D.instance.exports;ee.alloc=function(K){return x.malloc(K)||N("Allocation of",K,"bytes failed.")},ee.dealloc=function(K){K&&x.free(K)}}r(ee)}return D.config=n,n.onload&&n.onload(D),D};return WebAssembly.instantiateStreaming?()=>WebAssembly.instantiateStreaming(i(),n.imports||{}).then(u):()=>i().then(D=>D.arrayBuffer()).then(D=>WebAssembly.instantiate(D,n.imports||{})).then(u)}).bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function s(n){const i=(...L)=>{throw new Error(L.join(" "))};{let L=n.heap;L instanceof WebAssembly.Memory?L=(function(){return new Uint8Array(this.buffer)}).bind(L):L instanceof Function||i("config.heap must be WebAssembly.Memory instance or","a function which returns one."),n.heap=L}["alloc","dealloc"].forEach(function(L){n[L]instanceof Function||i("Config option '"+L+"' must be a function.")});const r=s,u=n.heap,D=n.alloc,N=n.dealloc;n.realloc;const ee=n.log||console.debug.bind(console),x=n.memberPrefix||"",K=n.memberSuffix||"",g=globalThis.BigInt,H=globalThis.BigInt64Array,U=n.bigIntEnabled??!!H;let oe;const S=n.pointerSize||n.ptrSize||(typeof(oe=D(1))=="bigint"?8:4),T=n.pointerIR||n.ptrIR||(S===4?"i32":"i64");oe&&(N(oe),oe=void 0),S!==4&&S!==8&&i("Invalid pointer size:",S),T!=="i32"&&T!=="i64"&&i("Invalid pointer representation:",T);const M=U&&g?L=>g(L||0):L=>i("BigInt support is disabled in this build."),Q=T=="i32"?Number:M,O=Q(0),R=function(...L){let Y=O;for(let te=0;te<L.length;++te)Y+=Q(L[te]);return Y},p=function(...L){return R(this.pointer,...L)};r.debugFlags||(r.__makeDebugFlags=function(L=null){L&&L.__flags&&(L=L.__flags);const Y=function te(_e){return arguments.length===0?te.__flags:(_e<0?(delete te.__flags.getter,delete te.__flags.setter,delete te.__flags.alloc,delete te.__flags.dealloc):(te.__flags.getter=(1&_e)!==0,te.__flags.setter=(2&_e)!==0,te.__flags.alloc=(4&_e)!==0,te.__flags.dealloc=(8&_e)!==0),te._flags)};return Object.defineProperty(Y,"__flags",{iterable:!1,writable:!1,value:Object.create(L)}),L||Y(0),Y},r.debugFlags=r.__makeDebugFlags());const b=!0,q=L=>L[1]==="(",j=L=>L==="p"||L==="P"||L==="s",ne=L=>L==="P",fe=L=>L?q(L)?"p":L[0]:void 0,Ie=function(L){switch(fe(L)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return T;case"j":return"i64";case"f":return"float";case"d":return"double"}i("Unhandled signature IR:",L)},we=function(L){switch(fe(L)){case"c":case"C":return 1;case"i":return 4;case"p":case"P":case"s":return S;case"j":return 8;case"f":return 4;case"d":return 8}i("Unhandled signature sizeof:",L)},Te=H?()=>!0:()=>i("BigInt64Array is not available."),J=function(L){switch(fe(L)){case"p":case"P":case"s":switch(S){case 4:return"getInt32";case 8:return Te()&&"getBigInt64"}break;case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return Te()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}i("Unhandled DataView getter for signature:",L)},w=function(L){switch(fe(L)){case"p":case"P":case"s":switch(S){case 4:return"setInt32";case 8:return Te()&&"setBigInt64"}break;case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return Te()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}i("Unhandled DataView setter for signature:",L)},a=function(L){switch(fe(L)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return M;case"p":case"P":case"s":switch(S){case 4:return Number;case 8:return M}break}i("Unhandled DataView set wrapper for signature:",L)},d=(L,Y)=>L+"::"+Y,h=function(L,Y){return()=>i(d(L,Y),"is read-only.")},A=function L(Y,te=!0){let _e=L.map.get(Y);return!_e&&te&&L.map.set(Y,_e=L.create(Y)),_e};A.map=new WeakMap,A.create=L=>Object.assign(Object.create(null),{o:L,p:void 0,ownsPointer:!1,zod:!1,xb:0});const V=L=>A.map.delete(L),Z=L=>typeof L=="number"&&L===(L|0)&&L>=0,E=S===4?Z:L=>typeof L=="bigint"&&L>=0||Z(L),F=L=>E(L)&&L>0,G=function(L,Y,te){const _e=A(Y,!1);if(_e){if(V(Y),!te&&!(te=_e.p)){console.warn("Cannot(?) happen: __freeStruct() found no instanceInfo");return}if(Array.isArray(Y.ondispose)){let Se;for(;Se=Y.ondispose.pop();)try{Se instanceof Function?Se.call(Y):Se instanceof st?Se.dispose():E(Se)&&N(Se)}catch(xe){console.warn("ondispose() for",L.structName,"@",te,"threw. NOT propagating it.",xe)}}else if(Y.ondispose instanceof Function)try{Y.ondispose()}catch(Se){console.warn("ondispose() for",L.structName,"@",te,"threw. NOT propagating it.",Se)}delete Y.ondispose,L.debugFlags.__flags.dealloc&&ee("debug.dealloc:",_e.ownsPointer?"":"EXTERNAL",L.structName,"instance:",L.structInfo.sizeof,"bytes @"+te),_e.ownsPointer&&((_e.zod||L.structInfo.zeroOnDispose)&&u().fill(0,Number(te),Number(te)+L.structInfo.sizeof+_e.xb),N(te))}},le=()=>({configurable:!1,writable:!1,iterable:!1}),y=L=>({...le(),value:L}),P=function(Y,te,_e){let Se;const xe=De=>{F(De)||i("Invalid pointer value",arguments[0],"for",Y.structName,"constructor.")};arguments.length>=3?_e&&typeof _e=="object"?(Se=_e,_e=Se?.wrap):(xe(_e),Se={wrap:_e}):Se={};const He=!_e;let $e=0,Ke=!1;if(_e)xe(_e),Ke=!!Se?.takeOwnership;else{const De=Se?.extraBytes??0;(De<0||De!==(De|0))&&i("Invalid extraBytes value:",Se?.extraBytes),$e=Y.structInfo.sizeof+De,_e=D($e)||i("Allocation of",Y.structName,"structure failed."),Ke=!0}try{Se?.debugFlags&&te.debugFlags(Se.debugFlags),Y.debugFlags.__flags.alloc&&ee("debug.alloc:",He?"":"EXTERNAL",Y.structName,"instance:",Y.structInfo.sizeof,"bytes @"+_e),He&&u().fill(0,Number(_e),Number(_e)+$e);const De=A(te);De.p=_e,De.ownsPointer=Ke,De.xb=$e?$e-Y.structInfo.sizeof:0,De.zod=!!Se?.zeroOnDispose,Se?.ondispose&&Se.ondispose!==_e&&te.addOnDispose(Se.ondispose)}catch(De){throw G(Y,te,_e),De}},$=function L(Y){return L.rxSig1??=/^[ipPsjfdcC]$/,L.rxSig2??=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/,L.rxSig1.test(Y)||L.rxSig2.test(Y)},ce=(function(L){let Y=this.get(L);return Y||(Y=[Object.create(null),Object.create(null),Object.create(null)],this.set(L,Y)),Y}).bind(new WeakMap),re=function(L,Y,te,_e){const Se=ce(L)[Y];return arguments.length===3?Se[te]:_e?Se[te]=_e:delete Se[te]},me=function(L,...Y){return re(this,0,L,...Y)},Le=function(L,Y){$(Y)&&i(L,"(",Y,") collides with a data type signature.")},Ee=function(L,...Y){return Le("Setter adaptor",L),re(this,1,L,...Y)},I=function(L,...Y){return Le("Struct adaptor",L),re(this,2,L,...Y)},C=function(L,Y){const te=typeof Y=="string"?re(L,2,Y):Y;return typeof te!="object"&&i("Invalid struct mapping object. Arg =",Y,JSON.stringify(te)),te},z=y(L=>x+L+K),se=function(L,Y,te=!0){let _e=L.members[Y];if(!_e&&(x||K)){for(const Se of Object.values(L.members))if(Se.key===Y){_e=Se;break}!_e&&te&&i(d(L.name||L.structName,Y),"is not a mapped struct member.")}return _e},pe=function L(Y,te,_e=!1){L._||(L._=xe=>xe.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const Se=se(Y.structInfo,te,!0);return _e?L._(Se.signature):Se.signature},ye=y(function(){const L=[];for(const Y of Object.keys(this.structInfo.members))L.push(this.memberKey(Y));return L}),ge=new TextDecoder("utf-8"),ve=new TextEncoder,Re=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,Ue=function(L,Y,te){return S===8&&(Y=Number(Y),te=Number(te)),ge.decode(L.buffer instanceof Re?L.slice(Y,te):L.subarray(Y,te))},ke=function(L,Y,te=!1){const _e=se(L.structInfo,Y,te);return _e&&_e.signature.length===1&&_e.signature[0]==="s"?_e:!1},Xe=function(L){L.signature!=="s"&&i("Invalid member type signature for C-string value:",JSON.stringify(L))},_t=function(Y,te){const _e=se(Y.structInfo,te,!0);Xe(_e);const Se=Y[_e.key];if(!Se)return null;let xe=Se;const He=u();for(;He[xe]!==0;++xe);return Se===xe?"":Ue(He,Se,xe)},Dt=function(L,...Y){L.ondispose?Array.isArray(L.ondispose)||(L.ondispose=[L.ondispose]):L.ondispose=[],L.ondispose.push(...Y)},it=function(L){const Y=ve.encode(L),te=D(Y.length+1);te||i("Allocation error while duplicating string:",L);const _e=u();return _e.set(Y,Number(te)),_e[R(te,Y.length)]=0,te},Gt=function(L,Y,te){const _e=se(L.structInfo,Y,!0);Xe(_e);const Se=it(te);return L[_e.key]=Se,Dt(L,Se),L},st=function(Y,te){arguments[2]!==y&&i("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:y(Y),structInfo:y(te)})};st.prototype=Object.create(null,{dispose:y(function(){G(this.constructor,this)}),lookupMember:y(function(L,Y=!0){return se(this.structInfo,L,Y)}),memberToJsString:y(function(L){return _t(this,L)}),memberIsString:y(function(L,Y=!0){return ke(this,L,Y)}),memberKey:z,memberKeys:ye,memberSignature:y(function(L,Y=!1){return pe(this,L,Y)}),memoryDump:y(function(){const L=this.pointer;return L?new Uint8Array(u().slice(Number(L),Number(L)+this.structInfo.sizeof)):null}),extraBytes:{configurable:!1,enumerable:!1,get:function(){return A(this,!1)?.xb??0}},zeroOnDispose:{configurable:!1,enumerable:!1,get:function(){return A(this,!1)?.zod??!!this.structInfo.zeroOnDispose}},pointer:{configurable:!1,enumerable:!1,get:function(){return A(this,!1)?.p},set:()=>i("Cannot assign the 'pointer' property of a struct.")},setMemberCString:y(function(L,Y){return Gt(this,L,Y)})}),Object.assign(st.prototype,{addOnDispose:function(...L){return Dt(this,...L),this}}),Object.defineProperties(st,{allocCString:y(it),isA:y(L=>L instanceof st),hasExternalPointer:y(L=>{const Y=A(L,!1);return!!(Y?.p&&!Y?.ownsPointer)}),memberKey:z});const At=function(L){return L.get||(L.adaptGet?tt.adaptGet(L.adaptGet):void 0)},_n=function(L){return L.set||(L.adaptSet?tt.adaptSet(L.adaptSet):void 0)},pr=function L(Y,te,_e){const Se=L.innerStructs??=new Map,xe=Y.memberKey(te);_e.signature!==void 0&&i("'signature' cannot be used on an embedded struct (",Y.structName,".",xe,")."),_n(_e)&&i("'set' and 'adaptSet' are not permitted for nested struct members."),_e.structName??=Y.structName+"::"+te,_e.key=xe,_e.name=te,_e.constructor=this.call(this,_e.structName,_e);const He=At(_e),$e=Object.assign(Object.create(null),{configurable:!1,enumerable:!1,set:h(Y.structName,xe),get:function(){const Ke=this.debugFlags.__flags,De=this.pointer,ze=De+"."+xe;let qe=Se.get(ze);return Ke.getter&&ee("debug.getter: k =",ze),qe||(qe=new _e.constructor(R(De,_e.offset)),Se.set(ze,qe),this.addOnDispose(()=>qe.dispose()),qe.addOnDispose(()=>Se.delete(ze))),He&&(qe=He.apply(this,[qe,xe])),Ke.getter&&ee("debug.getter: result =",qe),qe}});Object.defineProperty(Y.prototype,xe,$e)},hr=function L(Y,te,_e){if(_e=C(this,_e),_e.members)return pr.call(this,Y,te,_e);if(!L.cache){L.cache={getters:{},setters:{},sw:{}};const ze=["i","c","C","p","P","s","f","d","v()"];U&&ze.push("j"),ze.forEach(function(qe){L.cache.getters[qe]=J(qe),L.cache.setters[qe]=w(qe),L.cache.sw[qe]=a(qe)}),L.sigCheck=function(qe,We,un,dr){Object.prototype.hasOwnProperty.call(qe,un)&&i(qe.structName,"already has a property named",un+"."),$(dr)||i("Malformed signature for",d(qe.structName,We)+":",dr)}}const Se=Y.memberKey(te);L.sigCheck(Y.prototype,te,Se,_e.signature),_e.key=Se,_e.name=te;const xe=fe(_e.signature),He=d(Y.structName,Se),$e=Y.debugFlags.__flags,Ke=At(_e),De=Object.create(null);if(De.configurable=!1,De.enumerable=!1,De.get=function(){$e.getter&&ee("debug.getter:",L.cache.getters[xe],"for",Ie(xe),He,"@",this.pointer,"+",_e.offset,"sz",_e.sizeof);let ze=new DataView(u().buffer,Number(this.pointer)+_e.offset,_e.sizeof)[L.cache.getters[xe]](0,b);return Ke&&(ze=Ke.apply(this,[Se,ze])),$e.getter&&ee("debug.getter:",He,"result =",ze),ze},_e.readOnly)De.set=h(Y.prototype.structName,Se);else{const ze=_n(_e);De.set=function(qe){$e.setter&&ee("debug.setter:",L.cache.setters[xe],"for",Ie(xe),He,"@",this.pointer,"+",_e.offset,"sz",_e.sizeof,qe),this.pointer||i("Cannot set native property on a disposed",this.structName,"instance."),ze&&(qe=ze.apply(this,[Se,qe])),qe==null?qe=O:j(_e.signature)&&!E(qe)&&(ne(_e.signature)&&qe instanceof st?(qe=qe.pointer||O,$e.setter&&ee("debug.setter:",He,"resolved to",qe)):i("Invalid value for pointer-type",He+".")),new DataView(u().buffer,Number(this.pointer)+_e.offset,_e.sizeof)[L.cache.setters[xe]](0,L.cache.sw[xe](qe),b)}}Object.defineProperty(Y.prototype,Se,De)},ur=function L(Y,te,_e=Object.create(null)){const Se=function qe(We){this instanceof qe||i("The",Y,"constructor may only be called via 'new'."),P(qe,this,...arguments)},xe=this,He=qe=>typeof qe=="string"&&$(qe)?{signature:qe}:C(xe,qe);arguments.length===1?(te=He(Y),Y=te.structName||te.name):arguments.length===2?(te=He(te),te.name??=Y):te=He(te),Y??=te.structName,Y??=_e.structName,Y||i("One of 'name' or 'structName' are required."),te.adapt&&(Object.keys(te.adapt.struct||{}).forEach(qe=>{I.call(L,qe,te.adapt.struct[qe])}),Object.keys(te.adapt.set||{}).forEach(qe=>{Ee.call(L,qe,te.adapt.set[qe])}),Object.keys(te.adapt.get||{}).forEach(qe=>{me.call(L,qe,te.adapt.get[qe])})),!te.members&&!te.sizeof&&(te.sizeof=we(te.signature));const $e=y(r.__makeDebugFlags(tt.debugFlags));Object.defineProperties(Se,{debugFlags:$e,isA:y(qe=>qe instanceof Se),memberKey:z,memberKeys:ye,structInfo:y(te),structName:y(Y),ptrAdd:y(R)}),Se.prototype=new st(Y,te,y),Object.defineProperties(Se.prototype,{debugFlags:$e,constructor:y(Se),ptrAdd:y(p)});let Ke=!1,De=0;const ze=!!te.autoCalcSizeOffset;return ze||te.sizeof||i(Y,"description is missing its sizeof property."),te.offset??=0,Object.keys(te.members||{}).forEach(qe=>{let We=He(te.members[qe]);!We.members&&!We.sizeof&&(We.sizeof=we(We.signature),We.sizeof||i(d(Y,qe),"is missing a sizeof property.",We)),We.offset===void 0&&(ze?We.offset=De:i(d(Y,qe),"is missing its offset.",JSON.stringify(We))),te.members[qe]=We,(!Ke||Ke.offset<We.offset)&&(Ke=We);const un=!!We.autoCalc;ze&&(We.autoCalcSizeOffset=!0),hr.call(xe,Se,qe,We),un?We.autoCalcSizeOffset=!0:delete We.autoCalcSizeOffset,De+=We.sizeof}),Ke||i("No member property descriptions found."),te.sizeof||(te.sizeof=De),te.sizeof===1?te.signature==="c"||te.signature==="C"||i("Unexpected sizeof==1 member",d(Y,k),"with signature",te.signature):(te.sizeof%4!==0&&(console.warn("Invalid struct member description",te),i(Y,"sizeof is not aligned. sizeof="+te.sizeof)),te.offset%4!==0&&(console.warn("Invalid struct member description",te),i(Y,"offset is not aligned. offset="+te.offset))),te.sizeof<De&&(console.warn("Suspect struct description:",te,"offset =",De),i("Mismatch in the calculated vs. the provided sizeof/offset info.","Expected sizeof",De,"but got",te.sizeof,"for",te)),delete te.autoCalcSizeOffset,Se},tt=function L(Y,te){return arguments.length==1?ur.call(L,Y):ur.call(L,Y,te)};return tt.StructType=st,tt.config=n,tt.allocCString=it,tt.adaptGet=me,tt.adaptSet=Ee,tt.adaptStruct=I,tt.ptrAdd=R,tt.debugFlags||(tt.debugFlags=r.__makeDebugFlags(r.debugFlags)),tt},globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const n=(...S)=>{throw new Error(S.join(" "))},i=s.capi,r=s.wasm,u=s.util;globalThis.WhWasmUtilInstaller(r),delete globalThis.WhWasmUtilInstaller;const D={core:[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_parameter_name","string","sqlite3_stmt*","int"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(S,T)=>S[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_decltype","string","sqlite3_stmt*","int"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:S=>S[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_readonly","int","sqlite3*","string"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new r.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:S=>{let T;return(M,Q,O,R)=>{try{const p=r.cArgvToJs(Q,O);return T||(T=r.cArgvToJs(Q,R)),S(p,T)|0}catch(p){return p.resultCode||i.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_autocommit","int","sqlite3*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_interrupt",void 0,"sqlite3*"],["sqlite3_is_interrupted","int","sqlite3*"],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_next_stmt","sqlite3_stmt*",["sqlite3*","sqlite3_stmt*"]],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:S=>S[0]}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*","*"]],["sqlite3_set_errmsg","int","sqlite3*","int","string"],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_busy","int","sqlite3_stmt*"],["sqlite3_stmt_readonly","int","sqlite3_stmt*"],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new r.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(S,T)=>S[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],int64:[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_db_status64","int","sqlite3*","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook::callback",signature:"v(pippj)",contextKey:S=>S[0],callProxy:S=>(T,M,Q,O,R)=>{S(T,M,r.cstrToJs(Q),r.cstrToJs(O),R)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"]],wasmInternal:[["sqlite3__wasm_db_reset","int","sqlite3*"],["sqlite3__wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3__wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3__wasm_posix_create_file","int","string","*","int"],["sqlite3__wasm_vfs_unlink","int","sqlite3_vfs*","string"],["sqlite3__wasm_qfmt_token","string:dealloc","string","int"]]};if(r.exports.sqlite3_progress_handler&&D.core.push(["sqlite3_progress_handler",void 0,["sqlite3*","int",new r.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(S,T)=>S[0]}),"*"]]),r.exports.sqlite3_stmt_explain&&D.core.push(["sqlite3_stmt_explain","int","sqlite3_stmt*","int"],["sqlite3_stmt_isexplain","int","sqlite3_stmt*"]),r.exports.sqlite3_set_authorizer&&D.core.push(["sqlite3_set_authorizer","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(S,T)=>S[0],callProxy:S=>(T,M,Q,O,R,p)=>{try{return Q=Q&&r.cstrToJs(Q),O=O&&r.cstrToJs(O),R=R&&r.cstrToJs(R),p=p&&r.cstrToJs(p),S(T,M,Q,O,R,p)|0}catch(b){return b.resultCode||i.SQLITE_ERROR}}}),"*"]]),r.exports.sqlite3_column_origin_name&&D.core.push(["sqlite3_column_database_name","string","sqlite3_stmt*","int"],["sqlite3_column_origin_name","string","sqlite3_stmt*","int"],["sqlite3_column_table_name","string","sqlite3_stmt*","int"]),r.bigIntEnabled&&r.exports.sqlite3_declare_vtab&&D.int64.push(["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]),r.bigIntEnabled&&r.exports.sqlite3_preupdate_hook&&D.int64.push(["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:S=>S[0],callProxy:S=>(T,M,Q,O,R,p,b)=>{S(T,M,Q,r.cstrToJs(O),r.cstrToJs(R),p,b)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]]),r.bigIntEnabled&&r.exports.sqlite3changegroup_add&&r.exports.sqlite3session_create&&r.exports.sqlite3_preupdate_hook){const S={signature:"i(ps)",callProxy:T=>(M,Q)=>{try{return T(M,r.cstrToJs(Q))|0}catch(O){return O.resultCode||i.SQLITE_ERROR}}};D.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...S}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...S}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...S}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...S}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v3","int",["sqlite3*","int","void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",signature:"i(pp)",bindScope:"transient"}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v3_strm","int",["sqlite3*",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xFilter",signature:"i(pp)",bindScope:"transient"}),new r.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new r.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new r.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new r.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new r.xWrap.FuncPtrAdapter({name:"xFilter",...S,contextKey:(T,M)=>T[0]}),"*"]])}s.StructBinder=globalThis.Jaccwabyt({heap:r.heap8u,alloc:r.alloc,dealloc:r.dealloc,bigIntEnabled:r.bigIntEnabled,pointerIR:r.ptr.ir,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const S=r.xWrap.argAdapter("string");r.xWrap.argAdapter("string:flexible",O=>S(u.flexibleString(O))),r.xWrap.argAdapter("string:static",(function(O){return r.isPtr(O)?O:(O=""+O,this[O]||(this[O]=r.allocCString(O)))}).bind(Object.create(null)));const T=r.xWrap.argAdapter("*"),M=function(){};r.xWrap.argAdapter("sqlite3_filename",T)("sqlite3_context*",T)("sqlite3_value*",T)("void*",T)("sqlite3_changegroup*",T)("sqlite3_changeset_iter*",T)("sqlite3_session*",T)("sqlite3_stmt*",O=>T(O instanceof(s?.oo1?.Stmt||M)?O.pointer:O))("sqlite3*",O=>T(O instanceof(s?.oo1?.DB||M)?O.pointer:O))("sqlite3_vfs*",O=>typeof O=="string"?i.sqlite3_vfs_find(O)||s.SQLite3Error.toss(i.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",O):T(O instanceof(i.sqlite3_vfs||M)?O.pointer:O)),r.exports.sqlite3_declare_vtab&&r.xWrap.argAdapter("sqlite3_index_info*",O=>T(O instanceof(i.sqlite3_index_info||M)?O.pointer:O))("sqlite3_module*",O=>T(O instanceof(i.sqlite3_module||M)?O.pointer:O));const Q=r.xWrap.resultAdapter("*");r.xWrap.resultAdapter("sqlite3*",Q)("sqlite3_context*",Q)("sqlite3_stmt*",Q)("sqlite3_value*",Q)("sqlite3_vfs*",Q)("void*",Q);for(const O of D.core)i[O[0]]=r.xWrap.apply(null,O);for(const O of D.wasmInternal)u[O[0]]=r.xWrap.apply(null,O);for(const O of D.int64)i[O[0]]=r.bigIntEnabled?r.xWrap.apply(null,O):()=>n(O[0]+"() is unavailable due to lack","of BigInt support in this build.");delete D.core,delete D.int64,delete D.wasmInternal,u.sqlite3__wasm_db_error=function(O,R,p){return O?(R instanceof s.WasmAllocError?(R=i.SQLITE_NOMEM,p=0):R instanceof Error&&(p=p||""+R,R=R.resultCode||i.SQLITE_ERROR),i.sqlite3_set_errmsg(O,R,p)||R):i.SQLITE_MISUSE}}{const S=r.xCall("sqlite3__wasm_enum_json");S||n("Maintenance required: increase sqlite3__wasm_enum_json()'s","static buffer size!"),r.ctype=JSON.parse(r.cstrToJs(S));const T=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];r.bigIntEnabled&&T.push("serialize","session","vtab");for(const O of T)for(const R of Object.entries(r.ctype[O]))i[R[0]]=R[1];r.functionEntry(i.SQLITE_WASM_DEALLOC)||n("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+i.SQLITE_WASM_DEALLOC+").");const M=Object.create(null);for(const O of Object.entries(r.ctype.resultCodes))M[O[1]]=O[0];i.sqlite3_js_rc_str=O=>M[O];const Q=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_index_info:!r.bigIntEnabled,sqlite3_index_constraint:!r.bigIntEnabled,sqlite3_index_orderby:!r.bigIntEnabled,sqlite3_index_constraint_usage:!r.bigIntEnabled});for(const O of r.ctype.structs)Q[O.name]||(i[O.name]=s.StructBinder(O));if(i.sqlite3_index_info){for(const O of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])i.sqlite3_index_info[O]=i[O],delete i[O];i.sqlite3_vtab_config=r.xWrap("sqlite3__wasm_vtab_config","int",["sqlite3*","int","int"])}}const N=(S,T,M)=>u.sqlite3__wasm_db_error(S,i.SQLITE_MISUSE,T+"() requires "+M+" argument"+(M===1?"":"s")+"."),ee=S=>u.sqlite3__wasm_db_error(S,i.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),x=S=>r.xWrap.argAdapter("sqlite3*")(S),K=S=>r.isPtr(S)?r.cstrToJs(S):S,g=(function(S,T){S=x(S);let M=this.dbMap.get(S);if(T)!M&&T>0&&this.dbMap.set(S,M=Object.create(null));else return this.dbMap.delete(S),M;return M}).bind(Object.assign(Object.create(null),{dbMap:new Map}));g.addCollation=function(S,T){const M=g(S,1);M.collation||(M.collation=new Set),M.collation.add(K(T).toLowerCase())},g._addUDF=function(S,T,M,Q){T=K(T).toLowerCase();let O=Q.get(T);O||Q.set(T,O=new Set),O.add(M<0?-1:M)},g.addFunction=function(S,T,M){const Q=g(S,1);Q.udf||(Q.udf=new Map),this._addUDF(S,T,M,Q.udf)},r.exports.sqlite3_create_window_function&&(g.addWindowFunc=function(S,T,M){const Q=g(S,1);Q.wudf||(Q.wudf=new Map),this._addUDF(S,T,M,Q.wudf)}),g.cleanup=function(S){S=x(S);for(const Q of[["sqlite3_busy_handler",3],["sqlite3_commit_hook",3],["sqlite3_preupdate_hook",3],["sqlite3_progress_handler",4],["sqlite3_rollback_hook",3],["sqlite3_set_authorizer",3],["sqlite3_trace_v2",4],["sqlite3_update_hook",3]]){const[O,R]=Q;if(!r.exports[O])continue;const p=[S];p.length=R;try{i[O](...p)}catch(b){s.config.warn("close-time call of",O+"(",p,") threw:",b)}}const T=g(S,0);if(!T)return;if(T.collation){for(const Q of T.collation)try{i.sqlite3_create_collation_v2(S,Q,i.SQLITE_UTF8,0,0,0)}catch{}delete T.collation}let M;for(M=0;M<2;++M){const Q=M?T.wudf:T.udf;if(!Q)continue;const O=M?i.sqlite3_create_window_function:i.sqlite3_create_function_v2;for(const R of Q){const p=R[0],b=R[1],q=[S,p,0,i.SQLITE_UTF8,0,0,0,0,0];M&&q.push(0);for(const j of b)try{q[2]=j,O.apply(null,q)}catch{}b.clear()}Q.clear()}delete T.udf,delete T.wudf};{const S=r.xWrap("sqlite3_close_v2","int","sqlite3*");i.sqlite3_close_v2=function(T){if(arguments.length!==1)return N(T,"sqlite3_close_v2",1);if(T)try{g.cleanup(T)}catch{}return S(T)}}if(i.sqlite3session_create){const S=r.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);i.sqlite3session_delete=function(T){if(arguments.length!==1)return N(pDb,"sqlite3session_delete",1);T&&i.sqlite3session_table_filter(T,0,0),S(T)}}{const S=(M,Q)=>"argv["+Q+"]:"+M[0]+":"+r.cstrToJs(M[1]).toLowerCase(),T=r.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new r.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:S}),new r.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:S})]);i.sqlite3_create_collation_v2=function(M,Q,O,R,p,b){if(arguments.length!==6)return N(M,"sqlite3_create_collation_v2",6);if((O&15)===0)O|=i.SQLITE_UTF8;else if(i.SQLITE_UTF8!==(O&15))return ee(M);try{const q=T(M,Q,O,R,p,b);return q===0&&p instanceof Function&&g.addCollation(M,Q),q}catch(q){return u.sqlite3__wasm_db_error(M,q)}},i.sqlite3_create_collation=(M,Q,O,R,p)=>arguments.length===5?i.sqlite3_create_collation_v2(M,Q,O,R,p,0):N(M,"sqlite3_create_collation",5)}{const S=function(O,R){return O[0]+":"+(O[2]<0?-1:O[2])+":"+R+":"+r.cstrToJs(O[1]).toLowerCase()},T=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:S,callProxy:O=>(R,p,b)=>{try{O(R,...i.sqlite3_values_to_js(p,b))}catch(q){i.sqlite3_result_error_js(R,q)}}},xFinalAndValue:{signature:"v(p)",contextKey:S,callProxy:O=>R=>{try{i.sqlite3_result_js(R,O(R))}catch(p){i.sqlite3_result_error_js(R,p)}}},xFunc:{signature:"v(pip)",contextKey:S,callProxy:O=>(R,p,b)=>{try{i.sqlite3_result_js(R,O(R,...i.sqlite3_values_to_js(p,b)))}catch(q){i.sqlite3_result_error_js(R,q)}}},xDestroy:{signature:"v(p)",contextKey:S,callProxy:O=>R=>{try{O(R)}catch(p){console.error("UDF xDestroy method threw:",p)}}}}),M=r.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new r.xWrap.FuncPtrAdapter({name:"xFunc",...T.xFunc}),new r.xWrap.FuncPtrAdapter({name:"xStep",...T.xInverseAndStep}),new r.xWrap.FuncPtrAdapter({name:"xFinal",...T.xFinalAndValue}),new r.xWrap.FuncPtrAdapter({name:"xDestroy",...T.xDestroy})]),Q=r.exports.sqlite3_create_window_function?r.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new r.xWrap.FuncPtrAdapter({name:"xStep",...T.xInverseAndStep}),new r.xWrap.FuncPtrAdapter({name:"xFinal",...T.xFinalAndValue}),new r.xWrap.FuncPtrAdapter({name:"xValue",...T.xFinalAndValue}),new r.xWrap.FuncPtrAdapter({name:"xInverse",...T.xInverseAndStep}),new r.xWrap.FuncPtrAdapter({name:"xDestroy",...T.xDestroy})]):void 0;i.sqlite3_create_function_v2=function O(R,p,b,q,j,ne,fe,Ie,we){if(O.length!==arguments.length)return N(R,"sqlite3_create_function_v2",O.length);if((q&15)===0)q|=i.SQLITE_UTF8;else if(i.SQLITE_UTF8!==(q&15))return ee(R);try{const Te=M(R,p,b,q,j,ne,fe,Ie,we);return Te===0&&(ne instanceof Function||fe instanceof Function||Ie instanceof Function||we instanceof Function)&&g.addFunction(R,p,b),Te}catch(Te){return console.error("sqlite3_create_function_v2() setup threw:",Te),u.sqlite3__wasm_db_error(R,Te,"Creation of UDF threw: "+Te)}},i.sqlite3_create_function=function O(R,p,b,q,j,ne,fe,Ie){return O.length===arguments.length?i.sqlite3_create_function_v2(R,p,b,q,j,ne,fe,Ie,0):N(R,"sqlite3_create_function",O.length)},Q?i.sqlite3_create_window_function=function O(R,p,b,q,j,ne,fe,Ie,we,Te){if(O.length!==arguments.length)return N(R,"sqlite3_create_window_function",O.length);if((q&15)===0)q|=i.SQLITE_UTF8;else if(i.SQLITE_UTF8!==(q&15))return ee(R);try{const J=Q(R,p,b,q,j,ne,fe,Ie,we,Te);return J===0&&(ne instanceof Function||fe instanceof Function||Ie instanceof Function||we instanceof Function||Te instanceof Function)&&g.addWindowFunc(R,p,b),J}catch(J){return console.error("sqlite3_create_window_function() setup threw:",J),u.sqlite3__wasm_db_error(R,J,"Creation of UDF threw: "+J)}}:delete i.sqlite3_create_window_function,i.sqlite3_create_function_v2.udfSetResult=i.sqlite3_create_function.udfSetResult=i.sqlite3_result_js,i.sqlite3_create_window_function&&(i.sqlite3_create_window_function.udfSetResult=i.sqlite3_result_js),i.sqlite3_create_function_v2.udfConvertArgs=i.sqlite3_create_function.udfConvertArgs=i.sqlite3_values_to_js,i.sqlite3_create_window_function&&(i.sqlite3_create_window_function.udfConvertArgs=i.sqlite3_values_to_js),i.sqlite3_create_function_v2.udfSetError=i.sqlite3_create_function.udfSetError=i.sqlite3_result_error_js,i.sqlite3_create_window_function&&(i.sqlite3_create_window_function.udfSetError=i.sqlite3_result_error_js)}{const S=(M,Q)=>(typeof M=="string"?Q=-1:u.isSQLableTypedArray(M)?(Q=M.byteLength,M=r.typedArrayToString(M instanceof ArrayBuffer?new Uint8Array(M):M)):Array.isArray(M)&&(M=M.join(""),Q=-1),[M,Q]),T={basic:r.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:r.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};i.sqlite3_prepare_v3=function M(Q,O,R,p,b,q){if(M.length!==arguments.length)return N(Q,"sqlite3_prepare_v3",M.length);const[j,ne]=S(O,Number(R));switch(typeof j){case"string":return T.basic(Q,j,ne,p,b,null);case typeof r.ptr.null:return T.full(Q,r.ptr.coerce(j),ne,p,b,q);default:return u.sqlite3__wasm_db_error(Q,i.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3(). typeof="+typeof j)}},i.sqlite3_prepare_v2=function M(Q,O,R,p,b){return M.length===arguments.length?i.sqlite3_prepare_v3(Q,O,R,0,p,b):N(Q,"sqlite3_prepare_v2",M.length)}}{const S=r.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),T=r.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);i.sqlite3_bind_text=function M(Q,O,R,p,b){if(M.length!==arguments.length)return N(i.sqlite3_db_handle(Q),"sqlite3_bind_text",M.length);if(r.isPtr(R)||R===null)return S(Q,O,R,p,b);R instanceof ArrayBuffer?R=new Uint8Array(R):Array.isArray(pMem)&&(R=pMem.join(""));let q,j;try{if(u.isSQLableTypedArray(R))q=r.allocFromTypedArray(R),j=R.byteLength;else if(typeof R=="string")[q,j]=r.allocCString(R);else return u.sqlite3__wasm_db_error(i.sqlite3_db_handle(Q),i.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return S(Q,O,q,j,i.SQLITE_WASM_DEALLOC)}catch(ne){return r.dealloc(q),u.sqlite3__wasm_db_error(i.sqlite3_db_handle(Q),ne)}},i.sqlite3_bind_blob=function M(Q,O,R,p,b){if(M.length!==arguments.length)return N(i.sqlite3_db_handle(Q),"sqlite3_bind_blob",M.length);if(r.isPtr(R)||R===null)return T(Q,O,R,p,b);R instanceof ArrayBuffer?R=new Uint8Array(R):Array.isArray(R)&&(R=R.join(""));let q,j;try{if(u.isBindableTypedArray(R))q=r.allocFromTypedArray(R),j=p>=0?p:R.byteLength;else if(typeof R=="string")[q,j]=r.allocCString(R);else return u.sqlite3__wasm_db_error(i.sqlite3_db_handle(Q),i.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return T(Q,O,q,j,i.SQLITE_WASM_DEALLOC)}catch(ne){return r.dealloc(q),u.sqlite3__wasm_db_error(i.sqlite3_db_handle(Q),ne)}}}if(!i.sqlite3_column_text){const S=r.xWrap.argAdapter("sqlite3_stmt*"),T=r.xWrap.argAdapter("int"),M=r.xWrap.argAdapter("sqlite3_value*"),Q=(O,R)=>r.typedArrayToString(r.heap8u(),Number(O),Number(O)+R);i.sqlite3_column_text=function(O,R){const p=S(O),b=T(R),q=r.exports.sqlite3_column_text(p,b);return q?Q(q,r.exports.sqlite3_column_bytes(p,b)):null},i.sqlite3_value_text=function(O){const R=M(O),p=r.exports.sqlite3_value_text(R);return p?Q(p,r.exports.sqlite3_value_bytes(R)):null}}i.sqlite3_config=function(S,...T){if(arguments.length<2)return i.SQLITE_MISUSE;switch(S){case i.SQLITE_CONFIG_COVERING_INDEX_SCAN:case i.SQLITE_CONFIG_MEMSTATUS:case i.SQLITE_CONFIG_SMALL_MALLOC:case i.SQLITE_CONFIG_SORTERREF_SIZE:case i.SQLITE_CONFIG_STMTJRNL_SPILL:case i.SQLITE_CONFIG_URI:return r.exports.sqlite3__wasm_config_i(S,T[0]);case i.SQLITE_CONFIG_LOOKASIDE:return r.exports.sqlite3__wasm_config_ii(S,T[0],T[1]);case i.SQLITE_CONFIG_MEMDB_MAXSIZE:return r.exports.sqlite3__wasm_config_j(S,T[0]);case i.SQLITE_CONFIG_GETMALLOC:case i.SQLITE_CONFIG_GETMUTEX:case i.SQLITE_CONFIG_GETPCACHE2:case i.SQLITE_CONFIG_GETPCACHE:case i.SQLITE_CONFIG_HEAP:case i.SQLITE_CONFIG_LOG:case i.SQLITE_CONFIG_MALLOC:case i.SQLITE_CONFIG_MMAP_SIZE:case i.SQLITE_CONFIG_MULTITHREAD:case i.SQLITE_CONFIG_MUTEX:case i.SQLITE_CONFIG_PAGECACHE:case i.SQLITE_CONFIG_PCACHE2:case i.SQLITE_CONFIG_PCACHE:case i.SQLITE_CONFIG_PCACHE_HDRSZ:case i.SQLITE_CONFIG_PMASZ:case i.SQLITE_CONFIG_SERIALIZED:case i.SQLITE_CONFIG_SINGLETHREAD:case i.SQLITE_CONFIG_SQLLOG:case i.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return i.SQLITE_NOTFOUND}};{const S=new Set;i.sqlite3_auto_extension=function(T){if(T instanceof Function)T=r.installFunction("i(ppp)",T);else if(arguments.length!==1||!r.isPtr(T))return i.SQLITE_MISUSE;const M=r.exports.sqlite3_auto_extension(T);return T!==arguments[0]&&(M===0?S.add(T):r.uninstallFunction(T)),M},i.sqlite3_cancel_auto_extension=function(T){return!T||arguments.length!==1||!r.isPtr(T)?0:r.exports.sqlite3_cancel_auto_extension(T)},i.sqlite3_reset_auto_extension=function(){r.exports.sqlite3_reset_auto_extension();for(const T of S)r.uninstallFunction(T);S.clear()}}r.xWrap.FuncPtrAdapter.warnOnUse=!0;const H=s.StructBinder,U=function S(T,M,Q,O=S.installMethodArgcCheck){if(T instanceof H.StructType?!(Q instanceof Function)&&!r.isPtr(Q)&&n("Usage error: expecting a Function or WASM pointer to one."):n("Usage error: target object is-not-a StructType."),arguments.length===1)return(q,j)=>S(T,q,j,O);S.argcProxy||(S.argcProxy=function(q,j,ne,fe){return function(...Ie){return ne.length!==arguments.length&&n("Argument mismatch for",q.structInfo.name+"::"+j+": Native signature is:",fe),ne.apply(this,Ie)}},S.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((q,j)=>{if(r.isPtr(q))try{r.uninstallFunction(q)}catch{}}),delete this.ondispose.__removeFuncList)});const R=T.memberSignature(M);R.length<2&&n("Member",M,"does not have a function pointer signature:",R);const p=T.memberKey(M),b=O&&!r.isPtr(Q)?S.argcProxy(T,p,Q,R):Q;if(r.isPtr(b))b&&!r.functionEntry(b)&&n("Pointer",b,"is not a WASM function table entry."),T[p]=b;else{const q=r.installFunction(b,R);T[p]=q,(!T.ondispose||!T.ondispose.__removeFuncList)&&(T.addOnDispose("ondispose.__removeFuncList handler",S.removeFuncList),T.ondispose.__removeFuncList=[]),T.ondispose.__removeFuncList.push(p,q)}return(q,j)=>S(T,q,j,O)};U.installMethodArgcCheck=!1;const oe=function(S,T,M=U.installMethodArgcCheck){const Q=new Map;for(const O of Object.keys(T)){const R=T[O],p=Q.get(R);if(p){const b=S.memberKey(O);S[b]=S[S.memberKey(p)]}else U(S,O,R,M),Q.set(R,O)}return S};H.StructType.prototype.installMethod=function(T,M,Q=U.installMethodArgcCheck){return arguments.length<3&&T&&typeof T=="object"?oe(this,...arguments):U(this,...arguments)},H.StructType.prototype.installMethods=function(S,T=U.installMethodArgcCheck){return oe(this,S,T)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const n=(...w)=>{throw new s.SQLite3Error(...w)},i=s.capi,r=s.wasm,u=s.util,D=function(w){return(...a)=>w("sqlite3.oo1:",...a)};s.__isUnderTest?D(console.debug.bind(console)):D(s.config.debug),s.__isUnderTest?D(console.warn.bind(console)):D(s.config.warn),s.__isUnderTest?D(console.error.bind(console)):D(s.config.error);const N=new WeakMap,ee=new Set,x=new WeakMap,K=(w,a,d)=>{const h=Object.getOwnPropertyDescriptor(w,a);return h?h.value:d},g=function(w,a){return a&&(w instanceof S&&(w=w.pointer),n(a,"sqlite3 result code",a+":",w?i.sqlite3_errmsg(w):i.sqlite3_errstr(a))),arguments[0]},H=r.installFunction("i(ippp)",(function(w,a,d,h){i.SQLITE_TRACE_STMT===w&&console.log("SQL TRACE #"+ ++this.counter,"via sqlite3@"+a+"["+i.sqlite3_db_filename(a,null)+"]",r.cstrToJs(h))}).bind({counter:0})),U=Object.create(null),oe=function w(...a){const d=w.normalizeArgs(...a);let h;if(h=d["sqlite3*"])d["sqlite3*:takeOwnership"]||ee.add(this),this.filename=i.sqlite3_db_filename(h,"main");else{let A=d.filename,V=d.vfs,Z=d.flags;(typeof A!="string"&&!r.isPtr(A)||typeof Z!="string"||V&&typeof V!="string"&&!r.isPtr(V))&&(s.config.error("Invalid DB ctor args",d,arguments),n("Invalid arguments for DB constructor:",arguments,"opts:",d));let B=0;Z.indexOf("c")>=0&&(B|=i.SQLITE_OPEN_CREATE|i.SQLITE_OPEN_READWRITE),Z.indexOf("w")>=0&&(B|=i.SQLITE_OPEN_READWRITE),B===0&&(B|=i.SQLITE_OPEN_READONLY),B|=i.SQLITE_OPEN_EXRESCODE;const E=r.pstack.pointer;try{const F=r.pstack.allocPtr();let G=i.sqlite3_open_v2(A,F,B,V||r.ptr.null);h=r.peekPtr(F),g(h,G),i.sqlite3_extended_result_codes(h,1),Z.indexOf("t")>=0&&i.sqlite3_trace_v2(h,i.SQLITE_TRACE_STMT,H,h)}catch(F){throw h&&i.sqlite3_close_v2(h),F}finally{r.pstack.restore(E)}this.filename=r.isPtr(A)?r.cstrToJs(A):A}if(N.set(this,h),x.set(this,Object.create(null)),!d["sqlite3*"])try{const A=U[i.sqlite3_js_db_vfs(h)||n("Internal error: cannot get VFS for new db handle.")];A&&(A instanceof Function?A(this,s):g(h,i.sqlite3_exec(h,A,0,0,0)))}catch(A){throw this.close(),A}};oe.setVfsPostOpenCallback=function(w,a){a instanceof Function||n("dbCtorHelper.setVfsPostOpenCallback() should not be used with a non-function argument.",arguments),U[w]=a},oe.normalizeArgs=function(w=":memory:",a="c",d=null){const h={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(h,arguments[0]),h.flags===void 0&&(h.flags="c"),h.vfs===void 0&&(h.vfs=null),h.filename===void 0&&(h.filename=":memory:")):(h.filename=w,h.flags=a,h.vfs=d),h};const S=function(...w){oe.apply(this,w)};S.dbCtorHelper=oe;const T={null:1,number:2,string:3,boolean:4,blob:5};r.bigIntEnabled&&(T.bigint=T.number);const M=function(){T!==arguments[2]&&n(i.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],N.set(this,arguments[1]),arguments.length>3&&!arguments[3]&&ee.add(this)},Q=function(w){return w.pointer||n("DB has been closed."),w},O=function(w,a){return(a!==(a|0)||a<0||a>=w.columnCount)&&n("Column index",a,"is out of range."),w},R=function(w,a){const d=Object.create(null);switch(d.opt=Object.create(null),a.length){case 1:typeof a[0]=="string"||u.isSQLableTypedArray(a[0])||Array.isArray(a[0])?d.sql=a[0]:a[0]&&typeof a[0]=="object"&&(d.opt=a[0],d.sql=d.opt.sql);break;case 2:d.sql=a[0],d.opt=a[1];break;default:n("Invalid argument count for exec().")}d.sql=u.flexibleString(d.sql),typeof d.sql!="string"&&n("Missing SQL argument or unsupported SQL value type.");const h=d.opt;switch(h.returnValue){case"resultRows":h.resultRows||(h.resultRows=[]),d.returnVal=()=>h.resultRows;break;case"saveSql":h.saveSql||(h.saveSql=[]),d.returnVal=()=>h.saveSql;break;case void 0:case"this":d.returnVal=()=>w;break;default:n("Invalid returnValue value:",h.returnValue)}if(!h.callback&&!h.returnValue&&h.rowMode!==void 0&&(h.resultRows||(h.resultRows=[]),d.returnVal=()=>h.resultRows),h.callback||h.resultRows)switch(h.rowMode===void 0?"array":h.rowMode){case"object":d.cbArg=(A,V)=>{V.columnNames||(V.columnNames=A.getColumnNames([]));const Z=A.get([]),B=Object.create(null);for(const E in V.columnNames)B[V.columnNames[E]]=Z[E];return B};break;case"array":d.cbArg=A=>A.get([]);break;case"stmt":Array.isArray(h.resultRows)&&n("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),d.cbArg=A=>A;break;default:if(u.isInt32(h.rowMode)){d.cbArg=A=>A.get(h.rowMode);break}else if(typeof h.rowMode=="string"&&h.rowMode.length>1&&h.rowMode[0]==="$"){const A=h.rowMode.substr(1);d.cbArg=V=>{const Z=V.get(Object.create(null))[A];return Z===void 0?n(i.SQLITE_NOTFOUND,"exec(): unknown result column:",A):Z};break}n("Invalid rowMode:",h.rowMode)}return d},p=(w,a,d,...h)=>{const A=w.prepare(a);try{const V=A.bind(d).step()?A.get(...h):void 0;return A.reset(),V}finally{A.finalize()}},b=(w,a,d,h)=>w.exec({sql:a,bind:d,rowMode:h,returnValue:"resultRows"});S.checkRc=(w,a)=>g(w,a),S.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return Q(this)},close:function(){const w=this.pointer;if(w){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}if(Object.keys(x.get(this)).forEach((a,d)=>{if(d&&d.pointer)try{d.finalize()}catch{}}),N.delete(this),x.delete(this),ee.delete(this)||i.sqlite3_close_v2(w),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(w=!1,a=!1){const d=Q(this).pointer;return w?a?i.sqlite3_total_changes64(d):i.sqlite3_total_changes(d):a?i.sqlite3_changes64(d):i.sqlite3_changes(d)},dbFilename:function(w="main"){return i.sqlite3_db_filename(Q(this).pointer,w)},dbName:function(w=0){return i.sqlite3_db_name(Q(this).pointer,w)},dbVfsName:function(w=0){let a;const d=i.sqlite3_js_db_vfs(Q(this).pointer,w);if(d){const h=new i.sqlite3_vfs(d);try{a=r.cstrToJs(h.$zName)}finally{h.dispose()}}return a},prepare:function(w){Q(this);const a=r.pstack.pointer;let d,h;try{d=r.pstack.alloc(8),S.checkRc(this,i.sqlite3_prepare_v2(this.pointer,w,-1,d,null)),h=r.peekPtr(d)}finally{r.pstack.restore(a)}h||n("Cannot prepare empty SQL.");const A=new M(this,h,T);return x.get(this)[h]=A,A},exec:function(){Q(this);const w=R(this,arguments);if(!w.sql)return n("exec() requires an SQL string.");const a=w.opt,d=a.callback,h=Array.isArray(a.resultRows)?a.resultRows:void 0;let A,V=a.bind,Z=!!(w.cbArg||a.columnNames||h);const B=r.scopedAllocPush(),E=Array.isArray(a.saveSql)?a.saveSql:void 0;try{const F=u.isSQLableTypedArray(w.sql);let G=F?w.sql.byteLength:r.jstrlen(w.sql);const le=r.scopedAlloc(2*r.ptr.size+(G+1)),y=r.ptr.add(le,r.ptr.size);let P=r.ptr.add(y,r.ptr.size);const $=r.ptr.add(P,G);for(F?r.heap8().set(w.sql,P):r.jstrcpy(w.sql,r.heap8(),P,G,!1),r.poke8(r.ptr.add(P,G),0);P&&r.peek8(P);){r.pokePtr([le,y],0),S.checkRc(this,i.sqlite3_prepare_v3(this.pointer,P,G,0,le,y));const ce=r.peekPtr(le);if(P=r.peekPtr(y),G=Number(r.ptr.add($,-P)),!!ce){if(E&&E.push(i.sqlite3_sql(ce).trim()),A=new M(this,ce,T),V&&A.parameterCount&&(A.bind(V),V=null),Z&&A.columnCount){let re=Array.isArray(a.columnNames)?0:1;if(Z=!1,w.cbArg||h){const me=Object.create(null);for(;A.step();Ie.delete(A)){re++===0&&A.getColumnNames(me.columnNames=a.columnNames||[]),Ie.add(A);const Le=w.cbArg(A,me);if(h&&h.push(Le),d&&d.call(a,Le,A)===!1)break}Ie.delete(A)}re===0&&A.getColumnNames(a.columnNames)}else A.step();A.reset().finalize(),A=null}}}finally{A&&(Ie.delete(A),A.finalize()),r.scopedAllocPop(B)}return w.returnVal()},createFunction:function(a,d,h){const A=me=>me instanceof Function;switch(arguments.length){case 1:h=a,a=h.name,d=h.xFunc||0;break;case 2:A(d)||(h=d,d=h.xFunc||0);break}h||(h={}),typeof a!="string"&&n("Invalid arguments: missing function name.");let V=h.xStep||0,Z=h.xFinal||0;const B=h.xValue||0,E=h.xInverse||0;let F;A(d)?(F=!1,(A(V)||A(Z))&&n("Ambiguous arguments: scalar or aggregate?"),V=Z=null):A(V)?(A(Z)||n("Missing xFinal() callback for aggregate or window UDF."),d=null):A(Z)?n("Missing xStep() callback for aggregate or window UDF."):n("Missing function-type properties."),F===!1?(A(B)||A(E))&&n("xValue and xInverse are not permitted for non-window UDFs."):A(B)?(A(E)||n("xInverse must be provided if xValue is."),F=!0):A(E)&&n("xValue must be provided if xInverse is.");const G=h.pApp;G!=null&&!r.isPtr(G)&&n("Invalid value for pApp property. Must be a legal WASM pointer value.");const le=h.xDestroy||0;le&&!A(le)&&n("xDestroy property must be a function.");let y=0;K(h,"deterministic")&&(y|=i.SQLITE_DETERMINISTIC),K(h,"directOnly")&&(y|=i.SQLITE_DIRECTONLY),K(h,"innocuous")&&(y|=i.SQLITE_INNOCUOUS),a=a.toLowerCase();const P=d||V,$=K(h,"arity"),ce=typeof $=="number"?$:P.length?P.length-1:0;let re;return F?re=i.sqlite3_create_window_function(this.pointer,a,ce,i.SQLITE_UTF8|y,G||0,V,Z,B,E,le):re=i.sqlite3_create_function_v2(this.pointer,a,ce,i.SQLITE_UTF8|y,G||0,d,V,Z,le),S.checkRc(this,re),this},selectValue:function(w,a,d){return p(this,w,a,0,d)},selectValues:function(w,a,d){const h=this.prepare(w),A=[];try{for(h.bind(a);h.step();)A.push(h.get(0,d));h.reset()}finally{h.finalize()}return A},selectArray:function(w,a){return p(this,w,a,[])},selectObject:function(w,a){return p(this,w,a,{})},selectArrays:function(w,a){return b(this,w,a,"array")},selectObjects:function(w,a){return b(this,w,a,"object")},openStatementCount:function(){return this.pointer?Object.keys(x.get(this)).length:0},transaction:function(w){let a="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&n(i.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),a+=" "+arguments[0],w=arguments[1]),Q(this).exec(a);try{const d=w(this);return this.exec("COMMIT"),d}catch(d){throw this.exec("ROLLBACK"),d}},savepoint:function(w){Q(this).exec("SAVEPOINT oo1");try{const a=w(this);return this.exec("RELEASE oo1"),a}catch(a){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),a}},checkRc:function(w){return g(this,w)}},S.wrapHandle=function(w,a=!1){if(!w||!r.isPtr(w))throw new s.SQLite3Error(i.SQLITE_MISUSE,"Argument must be a WASM sqlite3 pointer");return new S({"sqlite3*":w,"sqlite3*:takeOwnership":!!a})};const q=function(w){return w.pointer||n("Stmt has been closed."),w},j=function(w){let a=T[w==null?"null":typeof w];switch(a){case T.boolean:case T.null:case T.number:case T.string:return a;case T.bigint:return r.bigIntEnabled?a:void 0;default:return u.isBindableTypedArray(w)?T.blob:void 0}},ne=function(w){return j(w)||n("Unsupported bind() argument type:",typeof w)},fe=function(w,a){const d=typeof a=="number"?a:i.sqlite3_bind_parameter_index(w.pointer,a);return d===0||!u.isInt32(d)?n("Invalid bind() parameter name: "+a):(d<1||d>w.parameterCount)&&n("Bind index",a,"is out of range."),d},Ie=new Set,we=new Set,Te=function(w,a){return Ie.has(w)&&n("Operation is illegal when statement is locked:",a),w},J=function w(a,d,h,A){Te(q(a),"bind()"),w._||(w._tooBigInt=Z=>n("BigInt value is too big to store without precision loss:",Z),w._={string:function(Z,B,E,F){const[G,le]=r.allocCString(E,!0);return(F?i.sqlite3_bind_blob:i.sqlite3_bind_text)(Z.pointer,B,G,le,i.SQLITE_WASM_DEALLOC)}}),ne(A),d=fe(a,d);let V=0;switch(A==null?T.null:h){case T.null:V=i.sqlite3_bind_null(a.pointer,d);break;case T.string:V=w._.string(a,d,A,!1);break;case T.number:{let Z;u.isInt32(A)?Z=i.sqlite3_bind_int:typeof A=="bigint"?u.bigIntFits64(A)?r.bigIntEnabled?Z=i.sqlite3_bind_int64:u.bigIntFitsDouble(A)?(A=Number(A),Z=i.sqlite3_bind_double):w._tooBigInt(A):w._tooBigInt(A):(A=Number(A),r.bigIntEnabled&&Number.isInteger(A)?Z=i.sqlite3_bind_int64:Z=i.sqlite3_bind_double),V=Z(a.pointer,d,A);break}case T.boolean:V=i.sqlite3_bind_int(a.pointer,d,A?1:0);break;case T.blob:{if(typeof A=="string"){V=w._.string(a,d,A,!0);break}else A instanceof ArrayBuffer?A=new Uint8Array(A):u.isBindableTypedArray(A)||n("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const Z=r.alloc(A.byteLength||1);r.heap8().set(A.byteLength?A:[0],Number(Z)),V=i.sqlite3_bind_blob(a.pointer,d,Z,A.byteLength,i.SQLITE_WASM_DEALLOC);break}default:s.config.warn("Unsupported bind() argument type:",A),n("Unsupported bind() argument type: "+typeof A)}return V&&S.checkRc(a.db.pointer,V),a};M.prototype={finalize:function(){const w=this.pointer;if(w){Te(this,"finalize()");const a=ee.delete(this)?0:i.sqlite3_finalize(w);return delete x.get(this.db)[w],N.delete(this),Ie.delete(this),we.delete(this),delete this.parameterCount,delete this.db,a}},clearBindings:function(){return Te(q(this),"clearBindings()"),i.sqlite3_clear_bindings(this.pointer),we.delete(this),this},reset:function(w){Te(this,"reset()"),w&&this.clearBindings();const a=i.sqlite3_reset(q(this).pointer);return we.delete(this),g(this.db,a),this},bind:function(){q(this);let w,a;switch(arguments.length){case 1:w=1,a=arguments[0];break;case 2:w=arguments[0],a=arguments[1];break;default:n("Invalid bind() arguments.")}return a===void 0?this:(this.parameterCount||n("This statement has no bindable parameters."),we.delete(this),a===null?J(this,w,T.null,a):Array.isArray(a)?(arguments.length!==1&&n("When binding an array, an index argument is not permitted."),a.forEach((d,h)=>J(this,h+1,ne(d),d)),this):(a instanceof ArrayBuffer&&(a=new Uint8Array(a)),typeof a=="object"&&!u.isBindableTypedArray(a)?(arguments.length!==1&&n("When binding an object, an index argument is not permitted."),Object.keys(a).forEach(d=>J(this,d,ne(a[d]),a[d])),this):J(this,w,ne(a),a)))},bindAsBlob:function(w,a){q(this),arguments.length===1&&(a=w,w=1);const d=ne(a);return T.string!==d&&T.blob!==d&&T.null!==d&&n("Invalid value type for bindAsBlob()"),J(this,w,T.blob,a)},step:function(){Te(this,"step()");const w=i.sqlite3_step(q(this).pointer);switch(w){case i.SQLITE_DONE:return we.delete(this),!1;case i.SQLITE_ROW:return we.add(this),!0;default:we.delete(this),s.config.warn("sqlite3_step() rc=",w,i.sqlite3_js_rc_str(w),"SQL =",i.sqlite3_sql(this.pointer)),S.checkRc(this.db.pointer,w)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const w=this.step();return this.reset(),w}finally{try{this.finalize()}catch{}}},get:function(w,a){if(we.has(q(this))||n("Stmt.step() has not (recently) returned true."),Array.isArray(w)){let d=0;const h=this.columnCount;for(;d<h;)w[d]=this.get(d++);return w}else if(w&&typeof w=="object"){let d=0;const h=this.columnCount;for(;d<h;)w[i.sqlite3_column_name(this.pointer,d)]=this.get(d++);return w}switch(O(this,w),a===void 0?i.sqlite3_column_type(this.pointer,w):a){case i.SQLITE_NULL:return null;case i.SQLITE_INTEGER:if(r.bigIntEnabled){const d=i.sqlite3_column_int64(this.pointer,w);return d>=Number.MIN_SAFE_INTEGER&&d<=Number.MAX_SAFE_INTEGER?Number(d).valueOf():d}else{const d=i.sqlite3_column_double(this.pointer,w);return(d>Number.MAX_SAFE_INTEGER||d<Number.MIN_SAFE_INTEGER)&&n("Integer is out of range for JS integer range: "+d),u.isInt32(d)?d|0:d}case i.SQLITE_FLOAT:return i.sqlite3_column_double(this.pointer,w);case i.SQLITE_TEXT:return i.sqlite3_column_text(this.pointer,w);case i.SQLITE_BLOB:{const d=i.sqlite3_column_bytes(this.pointer,w),h=i.sqlite3_column_blob(this.pointer,w),A=new Uint8Array(d);return d&&(A.set(r.heap8u().slice(Number(h),Number(h)+d),0),this.db._blobXfer instanceof Array&&this.db._blobXfer.push(A.buffer)),A}default:n("Don't know how to translate","type of result column #"+w+".")}n("Not reached.")},getInt:function(w){return this.get(w,i.SQLITE_INTEGER)},getFloat:function(w){return this.get(w,i.SQLITE_FLOAT)},getString:function(w){return this.get(w,i.SQLITE_TEXT)},getBlob:function(w){return this.get(w,i.SQLITE_BLOB)},getJSON:function(w){const a=this.get(w,i.SQLITE_STRING);return a===null?a:JSON.parse(a)},getColumnName:function(w){return i.sqlite3_column_name(O(q(this),w).pointer,w)},getColumnNames:function(w=[]){O(q(this),0);const a=this.columnCount;for(let d=0;d<a;++d)w.push(i.sqlite3_column_name(this.pointer,d));return w},getParamIndex:function(w){return q(this).parameterCount?i.sqlite3_bind_parameter_index(this.pointer,w):void 0},getParamName:function(w){return q(this).parameterCount?i.sqlite3_bind_parameter_name(this.pointer,w):void 0},isBusy:function(){return i.sqlite3_stmt_busy(q(this))!==0},isReadOnly:function(){return i.sqlite3_stmt_readonly(q(this))!==0}};{const w={enumerable:!0,get:function(){return N.get(this)},set:()=>n("The pointer property is read-only.")};Object.defineProperty(M.prototype,"pointer",w),Object.defineProperty(S.prototype,"pointer",w)}Object.defineProperty(M.prototype,"columnCount",{enumerable:!1,get:function(){return i.sqlite3_column_count(this.pointer)},set:()=>n("The columnCount property is read-only.")}),Object.defineProperty(M.prototype,"parameterCount",{enumerable:!1,get:function(){return i.sqlite3_bind_parameter_count(this.pointer)},set:()=>n("The parameterCount property is read-only.")}),M.wrapHandle=function(w,a,d=!1){if(!(w instanceof S)||!w.pointer)throw new s.SQLite3Error(s.SQLITE_MISUSE,"First argument must be an opened sqlite3.oo1.DB instance");if(!a||!r.isPtr(a))throw new s.SQLite3Error(s.SQLITE_MISUSE,"Second argument must be a WASM sqlite3_stmt pointer");return new M(w,a,T,!!d)},s.oo1={DB:S,Stmt:M}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const n=s.util;s.initWorker1API=(function(){const i=(...H)=>{throw new Error(H.join(" "))};globalThis.WorkerGlobalScope instanceof Function||i("initWorker1API() must be run from a Worker thread.");const r=this.sqlite3||i("Missing this.sqlite3 object."),u=r.oo1.DB,D=function(H){let U=N.idMap.get(H);return U||(U="db#"+ ++N.idSeq+":"+Math.floor(Math.random()*1e8)+":"+Math.floor(Math.random()*1e8),N.idMap.set(H,U),U)},N={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(H){const U=new u(H);return this.dbs[D(U)]=U,this.dbList.indexOf(U)<0&&this.dbList.push(U),U},close:function(H,U){if(H){delete this.dbs[D(H)];const oe=H.filename,S=n.sqlite3__wasm_db_vfs(H.pointer,0);H.close();const T=this.dbList.indexOf(H);T>=0&&this.dbList.splice(T,1),U&&oe&&S&&n.sqlite3__wasm_vfs_unlink(S,oe)}},post:function(H,U){U&&U.length?(globalThis.postMessage(H,Array.from(U)),U.length=0):globalThis.postMessage(H)},dbs:Object.create(null),getDb:function(H,U=!0){return this.dbs[H]||(U?i("Unknown (or closed) DB ID:",H):void 0)}},ee=function(H=N.dbList[0]){return H&&H.pointer?H:i("DB is not opened.")},x=function(H,U=!0){const oe=N.getDb(H.dbId,!1)||N.dbList[0];return U?ee(oe):oe},K=function(){return N.dbList[0]&&D(N.dbList[0])},g={open:function(H){const U=Object.create(null),oe=H.args||Object.create(null);oe.simulateError&&i("Throwing because of simulateError flag.");const S=Object.create(null);U.vfs=oe.vfs,U.filename=oe.filename||"";const T=N.open(U);return S.filename=T.filename,S.persistent=!!r.capi.sqlite3_js_db_uses_vfs(T.pointer,"opfs"),S.dbId=D(T),S.vfs=T.dbVfsName(),S},close:function(H){const U=x(H,!1),oe={filename:U&&U.filename};if(U){const S=H.args&&typeof H.args=="object"?!!H.args.unlink:!1;N.close(U,S)}return oe},exec:function(H){const U=typeof H.args=="string"?{sql:H.args}:H.args||Object.create(null);U.rowMode==="stmt"?i("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):U.sql||i("'exec' requires input SQL.");const oe=x(H);(U.callback||Array.isArray(U.resultRows))&&(oe._blobXfer=N.xfer);const S=U.callback;let T=0;const M=!!U.columnNames;typeof S=="string"&&(M||(U.columnNames=[]),U.callback=function(Q,O){N.post({type:S,columnNames:U.columnNames,rowNumber:++T,row:Q},N.xfer)});try{const Q=U.countChanges?oe.changes(!0,U.countChanges===64):void 0;oe.exec(U),Q!==void 0&&(U.changeCount=oe.changes(!0,U.countChanges===64)-Q);const O=U.lastInsertRowId?r.capi.sqlite3_last_insert_rowid(oe):void 0;O!==void 0&&(U.lastInsertRowId=O),U.callback instanceof Function&&(U.callback=S,N.post({type:S,columnNames:U.columnNames,rowNumber:null,row:void 0}))}finally{delete oe._blobXfer,U.callback&&(U.callback=S)}return U},"config-get":function(){const H=Object.create(null),U=r.config;return["bigIntEnabled"].forEach(function(oe){Object.getOwnPropertyDescriptor(U,oe)&&(H[oe]=U[oe])}),H.version=r.version,H.vfsList=r.capi.sqlite3_js_vfs_list(),H},export:function(H){const U=x(H),oe={byteArray:r.capi.sqlite3_js_db_export(U.pointer),filename:U.filename,mimetype:"application/x-sqlite3"};return N.xfer.push(oe.byteArray.buffer),oe},toss:function(H){i("Testing worker exception")}};globalThis.onmessage=async function(H){H=H.data;let U,oe=H.dbId,S=H.type;const T=performance.now();try{g.hasOwnProperty(S)&&g[S]instanceof Function?U=await g[S](H):i("Unknown db worker message type:",H.type)}catch(M){S="error",U={operation:H.type,message:M.message,errorClass:M.name,input:H},M.stack&&(U.stack=typeof M.stack=="string"?M.stack.split(/\n\s*/):M.stack)}oe||(oe=U.dbId||K()),N.post({type:S,dbId:oe,messageId:H.messageId,workerReceivedTime:T,workerRespondTime:performance.now(),departureTime:H.departureTime,result:U},N.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}).bind({sqlite3:s})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const n=s.wasm,i=s.capi,r=s.util.toss3,u=Object.create(null);s.vfs=u,i.sqlite3_vfs.prototype.registerVfs=function(D=!1){this instanceof s.capi.sqlite3_vfs||r("Expecting a sqlite3_vfs-type argument.");const N=i.sqlite3_vfs_register(this,D?1:0);return N&&r("sqlite3_vfs_register(",this,") failed with rc",N),this.pointer!==i.sqlite3_vfs_find(this.$zName)&&r("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},u.installVfs=function(D){let N=0;const ee=["io","vfs"];for(const x of ee){const K=D[x];K&&(++N,K.struct.installMethods(K.methods,!!K.applyArgcCheck),x==="vfs"&&(!K.struct.$zName&&typeof K.name=="string"&&K.struct.addOnDispose(K.struct.$zName=n.allocCString(K.name)),K.struct.registerVfs(!!K.asDefault)))}return N||r("Misuse: installVfs() options object requires at least","one of:",ee),this}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){if(!s.wasm.exports.sqlite3_declare_vtab)return;const n=s.wasm,i=s.capi,r=s.util.toss3,u=Object.create(null);s.vtab=u;const D=i.sqlite3_index_info;D.prototype.nthConstraint=function(x,K=!1){if(x<0||x>=this.$nConstraint)return!1;const g=n.ptr.add(this.$aConstraint,D.sqlite3_index_constraint.structInfo.sizeof*x);return K?g:new D.sqlite3_index_constraint(g)},D.prototype.nthConstraintUsage=function(x,K=!1){if(x<0||x>=this.$nConstraint)return!1;const g=n.ptr.add(this.$aConstraintUsage,D.sqlite3_index_constraint_usage.structInfo.sizeof*x);return K?g:new D.sqlite3_index_constraint_usage(g)},D.prototype.nthOrderBy=function(x,K=!1){if(x<0||x>=this.$nOrderBy)return!1;const g=n.ptr.add(this.$aOrderBy,D.sqlite3_index_orderby.structInfo.sizeof*x);return K?g:new D.sqlite3_index_orderby(g)};const N=function(x,K){return(function(g,H=!1){if(arguments.length===0&&(g=new K),g instanceof K)return this.set(g.pointer,g),g;n.isPtr(g)||s.SQLite3Error.toss("Invalid argument to",x+"()");let U=this.get(g);return H&&this.delete(g),U}).bind(new Map)},ee=function(x,K){const g=N(x,K);return Object.assign(Object.create(null),{StructType:K,create:H=>{const U=g();return n.pokePtr(H,U.pointer),U},get:H=>g(H),unget:H=>g(H,!0),dispose:H=>g(H,!0)?.dispose?.()})};u.xVtab=ee("xVtab",i.sqlite3_vtab),u.xCursor=ee("xCursor",i.sqlite3_vtab_cursor),u.xIndexInfo=x=>new i.sqlite3_index_info(x),u.xError=function x(K,g,H){if(x.errorReporter instanceof Function)try{x.errorReporter("sqlite3_module::"+K+"(): "+g.message)}catch{}let U;return g instanceof s.WasmAllocError?U=i.SQLITE_NOMEM:arguments.length>2?U=H:g instanceof s.SQLite3Error&&(U=g.resultCode),U||i.SQLITE_ERROR},u.xError.errorReporter=s.config.error.bind(s.config),u.xRowid=(x,K)=>n.poke(x,K,"i64"),u.setupModule=function(x){let K=!1;const g=this instanceof i.sqlite3_module?this:x.struct||(K=new i.sqlite3_module);try{const H=x.methods||r("Missing 'methods' object.");for(const U of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const oe=U[0],S=U[1];H[oe]===!0?H[oe]=H[S]:H[S]===!0&&(H[S]=H[oe])}if(x.catchExceptions){const U=function(T,M){return["xConnect","xCreate"].indexOf(T)>=0?function(Q,O,R,p,b,q){try{return M(...arguments)||0}catch(j){return j instanceof s.WasmAllocError||(n.dealloc(n.peekPtr(q)),n.pokePtr(q,n.allocCString(j.message))),u.xError(T,j)}}:function(...Q){try{return M(...Q)||0}catch(O){return u.xError(T,O)}}},oe=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],S=Object.create(null);for(const T of oe){const M=H[T];if(M instanceof Function)T==="xConnect"&&H.xCreate===M?S[T]=H.xCreate:T==="xCreate"&&H.xConnect===M?S[T]=H.xConnect:S[T]=U(T,M);else continue}g.installMethods(S,!1)}else g.installMethods(H,!!x.applyArgcCheck);if(g.$iVersion===0){let U;typeof x.iVersion=="number"?U=x.iVersion:g.$xIntegrity?U=4:g.$xShadowName?U=3:g.$xSavePoint||g.$xRelease||g.$xRollbackTo?U=2:U=1,g.$iVersion=U}}catch(H){throw K&&K.dispose(),H}return g},i.sqlite3_module.prototype.setupModule=function(x){return u.setupModule.call(this,x)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const n=s.capi,i=n.sqlite3_kvvfs_methods,r=n.KVVfsFile,u=s.capi.sqlite3_vfs_find("kvvfs");if(delete n.sqlite3_kvvfs_methods,delete n.KVVfsFile,!u)return;const D=s.util,N=s.wasm,ee=D.toss3,x=(I,C)=>Object.prototype.hasOwnProperty.call(I,C),K=new i(N.exports.sqlite3__wasm_kvvfs_methods());D.assert(32<=K.$nKeySize,"unexpected kvvfsMethods.$nKeySize: "+K.$nKeySize);const g=Object.assign(Object.create(null),{rxJournalSuffix:/-journal$/,zKeyJrnl:N.allocCString("jrnl"),zKeySz:N.allocCString("sz"),keySize:K.$nKeySize,buffer:Object.assign(Object.create(null),{n:K.$nBufferSize,pool:Object.create(null)})});g.memBuffer=(I=0)=>g.buffer.pool[I]??=N.alloc(g.buffer.n),g.memBufferFree=I=>{const C=g.buffer.pool[I];C&&(N.dealloc(C),delete g.buffer.pool[I])};const H=()=>{},U=s.__isUnderTest?(...I)=>s.config.debug("kvvfs:",...I):H,oe=(...I)=>s.config.warn("kvvfs:",...I),S=(...I)=>s.config.error("kvvfs:",...I);class T{#e;#r;#a(){return this.#r??=Object.keys(this.#e)}constructor(){this.clear()}key(C){const W=this.#a();return C<W.length?W[C]:null}getItem(C){return this.#e[C]??null}setItem(C,W){x(this.#e,C)||(this.#r=null),this.#e[C]=""+W}removeItem(C){delete this.#e[C]&&(this.#r=null)}clear(){this.#e=Object.create(null),this.#r=null}get length(){return this.#a().length}}const M=I=>I==="local"||I==="session",Q=I=>M(I)?"kvvfs-"+I+"-":"",O=function(I,C=!1){if(M(I))return;const W=new Blob([I]).size;W||ee(n.SQLITE_MISUSE,"Empty name is not permitted.");let z=g.keySize-1;g.rxJournalSuffix.test(I)?C||ee(n.SQLITE_MISUSE,"Storage names may not have a '-journal' suffix."):["-wal","-shm"].filter(pe=>I.endsWith(pe)).length?ee(n.SQLITE_MISUSE,"Storage names may not have a -wal or -shm suffix."):z-=8,W>z&&ee(n.SQLITE_RANGE,"Storage name is too long. Limit =",z);let se;for(se=0;se<W;++se){const pe=I.codePointAt(se);pe<32&&ee(n.SQLITE_RANGE,"Illegal character ("+pe+"d) in storage name:",I)}},R=(I,C=void 0)=>Object.assign(Object.create(null),{jzClass:I,refc:1,deleteAtRefc0:!1,storage:C||new T,keyPrefix:Q(I),files:[],listeners:void 0}),p=s.kvvfs=Object.create(null);s.__isUnderTest&&(p.log=Object.assign(Object.create(null),{xOpen:!1,xClose:!1,xWrite:!1,xRead:!1,xSync:!1,xAccess:!1,xFileControl:!1,xRcrdRead:!1,xRcrdWrite:!1,xRcrdDelete:!1}));const b=function(I){const C=g.rxJournalSuffix.test(I.jzClass)?I.jzClass.replace(g.rxJournalSuffix,""):I.jzClass+"-journal";p?.log?.xClose&&U("cleaning up storage handles [",I.jzClass,C,"]",I),delete g.storagePool[I.jzClass],delete g.storagePool[C],s.__isUnderTest||(delete I.storage,delete I.refc)},q=I=>g.storagePool[I.jzClass]=g.storagePool[I.jzClass+"-journal"]=I,j=".";g.storagePool=Object.assign(Object.create(null),{[j]:R(j)}),globalThis.Storage&&(globalThis.localStorage instanceof globalThis.Storage&&(g.storagePool.local=R("local",globalThis.localStorage)),globalThis.sessionStorage instanceof globalThis.Storage&&(g.storagePool.session=R("session",globalThis.sessionStorage))),g.builtinStorageNames=Object.keys(g.storagePool);const ne=I=>g.builtinStorageNames.indexOf(I)>-1;for(const I of Object.keys(g.storagePool)){const C=g.storagePool[I];g.storagePool[I+"-journal"]=C}g.setError=(I=void 0,C=n.SQLITE_ERROR)=>I?(g.lastError=I,I.resultCode|0||C):(delete g.lastError,0),g.popError=()=>{const I=g.lastError;return delete g.lastError,I};const fe=I=>{oe("kvvfs.listener handler threw:",I)},Ie=N.exports.sqlite3__wasm_kvvfs_decode,we=N.exports.sqlite3__wasm_kvvfs_encode,Te=async function(I,C,...W){try{C.keyPrefix&&W[0]&&(W[0]=W[0].replace(C.keyPrefix,""));let z,se,pe,ye;for(const ge of C.listeners){const ve=Object.create(null);ve.storageName=C.jzClass,ve.type=I,ge.decodePages;const Re=ge.events[I];if(Re){if(!ge.includeJournal&&W[0]==="jrnl")continue;if(I==="write"&&ge.decodePages&&+W[0]>0){if(ve.data=[W[0]],ye?.[W[0]]){ve.data[1]=ye[W[0]];continue}z??=new TextEncoder("utf-8"),se??=g.memBuffer(10),pe??=g.memBuffer(11);const Ue=z.encode(W[1]),ke=N.heap8u();ke.set(Ue,Number(se)),ke[N.ptr.addn(se,Ue.length)]=0;const Xe=Ie(se,pe,g.buffer.n);if(Xe>0)ye??=Object.create(null),ye[W[0]]=ve.data[1]=ke.slice(Number(pe),N.ptr.addn(pe,Xe));else continue}else ve.data=W.length?W.length===1?W[0]:W:void 0;try{Re(ve)?.catch?.(fe)}catch(Ue){oe("notifyListeners [",C.jzClass,"]",I,Ue)}}}}catch(z){fe(z)}},J=I=>typeof I=="string"?g.storagePool[I]:g.storagePool[N.cstrToJs(I)],w=N.exports.sqlite3__wasm_kvvfsMakeKey,a=(I,C,W)=>C&&I.keyPrefix?w(C,W):W,d=(I,C,W)=>N.cstrToJs(a(I,C,W)),h=I=>+I.storage.getItem(I.keyPrefix+"sz"),A=new Map,V={vfs:Object.create(null),ioDb:Object.create(null),ioJrnl:Object.create(null)},Z=new n.sqlite3_vfs(K.$pVfs),B=new n.sqlite3_io_methods(K.$pIoDb),E=new n.sqlite3_io_methods(K.$pIoJrnl),F=Object.create(null),G=Object.assign(Object.create(null),{pFileHandles:A,cache:g,storageForZClass:J,KVVfsStorage:T,disablePageSizeChange:!0});p.log&&(p.internal=G);const le={recordHandler:{xRcrdRead:(I,C,W,z)=>{try{const se=N.cstrToJs(I),pe=J(se);if(!pe)return-1;const ye=d(pe,I,C);p?.log?.xRcrdRead&&oe("xRcrdRead",se,ye,z,pe);const ge=pe.storage.getItem(ye);if(ge===null)return-1;const ve=ge.length;if(z<=0)return ve;if(z===1)return N.poke(W,0),ve;z+1<ve&&ee(n.SQLITE_RANGE,"xRcrdRead()",se,ye,"input buffer is too small: need",ve,"but have",z);const Re=g.memBuffer(0),Ue=N.heap8();let ke;for(ke=0;ke<ve;++ke)Ue[N.ptr.add(Re,ke)]=ge.codePointAt(ke)&255;return Ue.copyWithin(Number(W),Number(Re),N.ptr.addn(Re,ke)),Ue[N.ptr.add(W,ve)]=0,z}catch(se){return S("kvrecordRead()",se),g.setError(se),-2}},xRcrdWrite:(I,C,W)=>{try{const z=J(I),se=d(z,I,C),pe=N.cstrToJs(W);return p?.log?.xRcrdWrite&&oe("xRcrdWrite",se,z),z.storage.setItem(se,pe),z.listeners&&Te("write",z,se,pe),0}catch(z){return S("kvrecordWrite()",z),g.setError(z,n.SQLITE_IOERR)}},xRcrdDelete:(I,C)=>{try{const W=J(I),z=d(W,I,C);return p?.log?.xRcrdDelete&&oe("xRcrdDelete",z,W),W.storage.removeItem(z),W.listeners&&Te("delete",W,z),0}catch(W){return S("kvrecordDelete()",W),g.setError(W,n.SQLITE_IOERR)}}},vfs:{xOpen:function(I,C,W,z,se){g.popError();let pe;try{C||(pe=N.allocCString(""+W+"."+(Math.random()*1e5|0)),C=pe);const ye=N.cstrToJs(C);p?.log?.xOpen&&U("xOpen",ye,"flags =",z),O(ye,!0),z&(n.SQLITE_OPEN_MAIN_DB|n.SQLITE_OPEN_TEMP_DB|n.SQLITE_OPEN_TRANSIENT_DB)&&g.rxJournalSuffix.test(ye)&&ee(n.SQLITE_ERROR,"DB files may not have a '-journal' suffix.");let ge=J(ye);!ge&&!(z&n.SQLITE_OPEN_CREATE)&&ee(n.SQLITE_ERROR,"Storage not found:",ye);const ve=V.vfs.xOpen(I,C,W,z,se);if(ve)return ve;let Re=!!(n.SQLITE_OPEN_DELETEONCLOSE&z);N.isPtr(arguments[1])&&n.sqlite3_uri_boolean(C,"delete-on-close",0)&&(Re=!0);const Ue=new r(W);if(D.assert(Ue.$zClass,"Missing f.$zClass"),Ue.addOnDispose(pe),pe=void 0,ge)++ge.refc,ge.files.push(Ue),N.poke32(se,z);else{N.poke32(se,z|n.SQLITE_OPEN_CREATE),D.assert(!Ue.$isJournal,"Opening a journal before its db? "+ye);const ke=ye.replace(g.rxJournalSuffix,"");ge=R(ke),q(ge),ge.files.push(Ue),ge.deleteAtRefc0=Re,p?.log?.xOpen&&U("xOpen installed storage handle [",ke,ke+"-journal","]",ge)}return A.set(W,{store:ge,file:Ue,jzClass:ye}),ge.listeners&&Te("open",ge,ge.files.length),0}catch(ye){return oe("xOpen:",ye),g.setError(ye)}finally{pe&&N.dealloc(pe)}},xDelete:function(I,C,W){g.popError();try{const z=N.cstrToJs(C);return g.rxJournalSuffix.test(z)&&F.xRcrdDelete(C,g.zKeyJrnl),0}catch(z){return oe("xDelete",z),g.setError(z)}},xAccess:function(I,C,W,z){g.popError();try{const se=J(C),pe=se?.jzClass||N.cstrToJs(C);if(p?.log?.xAccess&&U("xAccess",pe,"flags =",W,"*pResOut =",N.peek32(z),"store =",se),!se)try{O(pe)}catch{return N.poke32(z,0),0}if(se){const ye=se.keyPrefix+(g.rxJournalSuffix.test(pe)?"jrnl":"1"),ge=se.storage.getItem(ye)?0:1;N.poke32(z,ge)}else N.poke32(z,0);return 0}catch(se){return S("xAccess",se),g.setError(se)}},xRandomness:function(I,C,W){const z=N.heap8u();let se=0;const pe=Number(W);for(;se<C;++se)z[pe+se]=Math.random()*255e3&255;return C},xGetLastError:function(I,C,W){const z=g.popError();if(U("xGetLastError",z),z){const se=N.scopedAllocPush();try{const[pe,ye]=N.scopedAllocCString(z.message,!0);return N.cstrncpy(W,pe,C),ye>C&&N.poke8(N.ptr.add(W,C,-1),0),U("set xGetLastError",z.message),z.resultCode|0||n.SQLITE_IOERR}catch{return n.SQLITE_NOMEM}finally{N.scopedAllocPop(se)}}return 0}},ioDb:{xClose:function(I){g.popError();try{const C=A.get(I);if(p?.log?.xClose&&U("xClose",I,C),C){A.delete(I);const W=C.store;W.files=W.files.filter(z=>z!==C.file),--W.refc<=0&&W.deleteAtRefc0&&b(W),V.ioDb.xClose(I),C.file.dispose(),W.listeners&&Te("close",W,W.files.length)}return 0}catch(C){return S("xClose",C),g.setError(C)}},xFileControl:function(I,C,W){g.popError();try{const z=A.get(I);if(D.assert(z,"Missing KVVfsFile handle"),p?.log?.xFileControl&&U("xFileControl",z,"op =",C),C===n.SQLITE_FCNTL_PRAGMA&&G.disablePageSizeChange){const pe=N.peekPtr(N.ptr.add(W,N.ptr.size));if(N.cstrToJs(pe)==="page_size"){p?.log?.xFileControl&&U("xFileControl pragma",N.cstrToJs(pe));const ye=N.peekPtr(N.ptr.add(W,2*N.ptr.size));if(ye)return p?.log?.xFileControl&&oe("xFileControl pragma",z,"NOT setting page size to",N.cstrToJs(ye)),z.file.$szPage=-1,0;if(z.file.$szPage>0)return p?.log?.xFileControl&&oe("xFileControl",z,"getting page size",z.file.$szPage),N.pokePtr(W,N.allocCString(""+z.file.$szPage)),0}}const se=V.ioDb.xFileControl(I,C,W);return se==0&&n.SQLITE_FCNTL_SYNC===C&&z.store.listeners&&Te("sync",z.store,!1),se}catch(z){return S("xFileControl",z),g.setError(z)}},xSync:function(I,C){g.popError();try{const W=A.get(I);p?.log?.xSync&&U("xSync",W),D.assert(W,"Missing KVVfsFile handle");const z=V.ioDb.xSync(I,C);return z==0&&W.store.listeners&&Te("sync",W.store,!0),z}catch(W){return S("xSync",W),g.setError(W)}},xRead:function(I,C,W,z){g.popError();try{if(p?.log?.xRead){const se=A.get(I);D.assert(se,"Missing KVVfsFile handle"),U("xRead",W,z,se)}return V.ioDb.xRead(I,C,W,z)}catch(se){return S("xRead",se),g.setError(se)}},xWrite:function(I,C,W,z){g.popError();try{if(p?.log?.xWrite){const se=A.get(I);D.assert(se,"Missing KVVfsFile handle"),U("xWrite",W,z,se)}return V.ioDb.xWrite(I,C,W,z)}catch(se){return S("xWrite",se),g.setError(se)}}},ioJrnl:{xClose:!0}};U("pVfs and friends",Z,B,E,K,n.sqlite3_file.structInfo,r.structInfo);try{D.assert(g.buffer.n>1024*129,"Heap buffer is not large enough");for(const I of Object.entries(le.recordHandler)){const C=I[0],W=I[1];F[C]=W,K[K.memberKey(C)]=N.installFunction(K.memberSignature(C),W)}for(const I of Object.entries(le.vfs)){const C=I[0],W=I[1],z=Z.memberKey(C),se=Z.structInfo.members[C]||D.toss("Missing pVfs.structInfo[",C,"]");V.vfs[C]=N.functionEntry(Z[z]),Z[z]=N.installFunction(se.signature,W)}for(const I of Object.entries(le.ioDb)){const C=I[0],W=I[1],z=B.memberKey(C);V.ioDb[C]=N.functionEntry(B[z])||D.toss("Missing native pIoDb[",z,"]"),B[z]=N.installFunction(B.memberSignature(C),W)}for(const I of Object.entries(le.ioJrnl)){const C=I[0],W=I[1],z=E.memberKey(C);V.ioJrnl[C]=N.functionEntry(E[z])||D.toss("Missing native pIoJrnl[",z,"]"),W===!0?E[z]=B[z]||D.toss("Missing copied pIoDb[",z,"]"):E[z]=N.installFunction(E.memberSignature(C),W)}}finally{K.dispose(),Z.dispose(),B.dispose(),E.dispose()}const y=function I(C){if(C==="")return I("local")+I("session");const W=J(C);if(!W)return 0;W.files.length&&(globalThis.localStorage===W.storage||globalThis.sessionStorage===W.storage||ee(n.SQLITE_ACCESS,"Cannot clear in-use database storage."));const z=W.storage,se=[];let pe,ye=z.length;for(pe=0;pe<ye;++pe){const ge=z.key(pe);(!W.keyPrefix||ge.startsWith(W.keyPrefix))&&se.push(ge)}return se.forEach(ge=>z.removeItem(ge)),se.length},P=function I(C){if(C==="")return I("local")+I("session");const W=J(C);if(!W)return 0;const z=W.storage;let se,pe=0;for(se=0;se<z.length;++se){const ye=z.key(se);(!W.keyPrefix||ye.startsWith(W.keyPrefix))&&(pe+=ye.length,pe+=z.getItem(ye).length)}return pe*2},$=function(...C){let W;C.length===1&&typeof C[0]=="object"?W=C[0]:C.length&&(W=Object.assign(Object.create(null),{name:C[0]}));const z=W?J(W.name):null;z||ee(n.SQLITE_NOTFOUND,"There is no kvvfs storage named",W?.name);const se=z.storage,pe=Object.assign(Object.create(null),{name:z.jzClass,timestamp:Date.now(),pages:[]}),ye=Object.create(null),ge=z.keyPrefix,ve=ge?/^kvvfs-[^-]+-(\w+)/:void 0;let Re=0,Ue=se.length;for(;Re<Ue;++Re){const ke=se.key(Re);if(!ge||ke.startsWith(ge)){let Xe=(ge?ve.exec(ke):void 0)?.[1]??ke;switch(Xe){case"jrnl":W.includeJournal&&(pe.journal=se.getItem(ke));break;case"sz":pe.size=+se.getItem(ke);break;default:if(Xe=+Xe,(!D.isInt32(Xe)||Xe<=0)&&ee(n.SQLITE_RANGE,"Malformed kvvfs key: "+ke),W.decodePages){const _t=se.getItem(ke),Dt=_t.length,it=g.memBuffer(0),Gt=g.memBuffer(1),st=N.heap8u();let At=0;for(;At<Dt;++At)st[N.ptr.add(it,At)]=_t.codePointAt(At)&255;st[N.ptr.add(it,At)]=0;const _n=Ie(it,Gt,g.buffer.n);ye[Xe]=st.slice(Number(Gt),N.ptr.addn(Gt,_n))}else ye[Xe]=se.getItem(ke);break}}}return W.decodePages&&g.memBufferFree(1),Object.keys(ye).map(ke=>+ke).sort().forEach(ke=>pe.pages.push(ye[ke])),pe},ce=function(I,C=!1){!I?.timestamp||!I.name||I.size===void 0||!Array.isArray(I.pages)?ee(n.SQLITE_MISUSE,"Malformed export object."):(!I.size||I.size!==(I.size|0)||I.size>=2147483647)&&ee(n.SQLITE_RANGE,"Invalid db size: "+I.size),O(I.name);let W=J(I.name);const z=!W;W?(C?!W.files||!W.jzClass?ee(n.SQLITE_ERROR,"Internal storage object",I.name,"seems to be malformed."):W.files.length&&ee(n.SQLITE_IOERR_ACCESS,"Cannot import db storage while it is in use."):ee(n.SQLITE_ACCESS,"Storage '"+I.name+"' already exists and","overwrite was not specified."),y(I.name)):W=R(I.name);const se=Q(I.name);let pe;try{const ye=W.storage;ye.setItem(se+"sz",I.size),I.journal&&ye.setItem(se+"jrnl",I.journal),I.pages[0]instanceof Uint8Array?I.pages.forEach((ge,ve)=>{const Re=ge.length;pe??=g.memBuffer(1);const Ue=g.memBuffer(0),ke=N.heap8u();ke.set(ge,Number(Ue)),ke[N.ptr.addn(Ue,Re)]=0;const Xe=we(Ue,Re,pe);D.assert(Xe<g.buffer.n,"Impossibly long output - possibly smashed the heap"),D.assert(N.peek8(N.ptr.add(pe,Xe))===0,"Expecting NUL-terminated encoded output");const _t=N.cstrToJs(pe);ye.setItem(se+(ve+1),_t)}):I.pages[0]&&I.pages.forEach((ge,ve)=>ye.setItem(se+(ve+1),ge)),z&&q(W)}catch{if(!z)try{y(I.name)}catch{}}finally{pe&&g.memBufferFree(1)}return this},re=function(I){let C=J(I);if(C){++C.refc;return}O(I),q(R(I))},me=function(I){const C=J(I);return!C||M(C.jzClass)||ne(C.jzClass)||g.rxJournalSuffix.test(I)?!1:C.refc>C.files.length||C.files.length===0?(--C.refc<=0&&b(C),!0):!1},Le=function(I){(!I||typeof I!="object")&&ee(n.SQLITE_MISUSE,"Expecting a listener object.");let C=J(I.storage);C||(I.storage&&I.reserve?(re(I.storage),C=J(I.storage),D.assert(C,"Unexpectedly cannot fetch reserved storage "+I.storage)):ee(n.SQLITE_NOTFOUND,"No such storage:",I.storage)),I.events&&(C.listeners??=[]).push(I)},Ee=function(I){const C=J(I?.storage);if(C?.listeners&&I.events){const W=C.listeners.length;C.listeners=C.listeners.filter(se=>se!==I);const z=W>C.listeners.length;return C.listeners.length||(C.listeners=void 0),z}return!1};if(s.kvvfs.reserve=re,s.kvvfs.import=ce,s.kvvfs.export=$,s.kvvfs.unlink=me,s.kvvfs.listen=Le,s.kvvfs.unlisten=Ee,s.kvvfs.exists=I=>!!J(I),s.kvvfs.estimateSize=P,s.kvvfs.clear=y,globalThis.Storage&&(n.sqlite3_js_kvvfs_size=(I="")=>P(I),n.sqlite3_js_kvvfs_clear=(I="")=>y(I)),s.oo1?.DB){const I=s.oo1.DB;s.oo1.JsStorageDb=function(W=s.oo1.JsStorageDb.defaultStorageName){const z=I.dbCtorHelper.normalizeArgs(...arguments);switch(z.vfs="kvvfs",z.filename){case":sessionStorage:":z.filename="session";break;case":localStorage:":z.filename="local";break}const se=/(file:(\/\/)?)([^?]+)/.exec(z.filename);O(se?se[3]:z.filename),I.dbCtorHelper.call(this,z)},s.oo1.JsStorageDb.defaultStorageName=g.storagePool.session?"session":j;const C=s.oo1.JsStorageDb;C.prototype=Object.create(I.prototype),C.clearStorage=y,C.prototype.clearStorage=function(){return C.clearStorage(this.affirmOpen().dbFilename(),!0)},C.storageSize=P,C.prototype.storageSize=function(){return C.storageSize(this.affirmOpen().dbFilename(),!0)}}if(s.__isUnderTest&&s.vtab){const I=Object.assign(Object.create(null),{rowid:{type:"INTEGER"},name:{type:"TEXT"},nRef:{type:"INTEGER"},nOpen:{type:"INTEGER"},isTransient:{type:"INTEGER"},dbSize:{type:"INTEGER"}});Object.keys(I).forEach((ye,ge)=>I[ye].colId=ge);const C=s.vtab,W=Object.assign(Object.create(null),{row:function(){return g.storagePool[this.names[this.rowid]]}});Object.assign(Object.create(W),{rowid:0,names:Object.keys(g.storagePool).filter(ye=>!g.rxJournalSuffix.test(ye))});const z=function(ye,ge){const ve=ye instanceof n.sqlite3_vtab_cursor?ye:C.xCursor.get(ye);return(ge||!ve.vTabState)&&(ve.vTabState=Object.assign(Object.create(W),{rowid:0,names:Object.keys(g.storagePool).filter(Re=>!g.rxJournalSuffix.test(Re))})),ve.vTabState},se=()=>{},pe=function ye(){return ye.mod??=new s.capi.sqlite3_module().setupModule({catchExceptions:!0,methods:{xConnect:function(ge,ve,Re,Ue,ke,Xe){try{const _t=[];Object.keys(I).forEach(it=>{_t.push(it+" "+I[it].type)});const Dt=n.sqlite3_declare_vtab(ge,"CREATE TABLE ignored("+_t.join(",")+")");if(Dt===0){const it=C.xVtab.create(ke);D.assert(it===C.xVtab.get(N.peekPtr(ke)),"output pointer check failed")}return Dt}catch(_t){return C.xErrror("xConnect",_t,n.SQLITE_ERROR)}},xCreate:N.ptr.null,xDisconnect:function(ge){return C.xVtab.dispose(ge),0},xOpen:function(ge,ve){return C.xCursor.create(ve),0},xClose:function(ge){const ve=C.xCursor.unget(ge);return delete ve.vTabState,ve.dispose(),0},xNext:function(ge){const ve=C.xCursor.get(ge);return++z(ve).rowid,0},xColumn:function(ge,ve,Re){const Ue=z(ge),ke=Ue.row();switch(D.assert(ke,"Unexpected xColumn call"),Re){case I.rowid.colId:n.sqlite3_result_int(ve,Ue.rowid);break;case I.name.colId:n.sqlite3_result_text(ve,ke.jzClass,-1,n.SQLITE_TRANSIENT);break;case I.nRef.colId:n.sqlite3_result_int(ve,ke.refc);break;case I.nOpen.colId:n.sqlite3_result_int(ve,ke.files.length);break;case I.isTransient.colId:n.sqlite3_result_int(ve,!!ke.deleteAtRefc0);break;case I.dbSize.colId:n.sqlite3_result_int(ve,h(ke));break;default:return n.sqlite3_result_error(ve,"Invalid column id: "+Re),n.SQLITE_RANGE}return 0},xRowid:function(ge,ve){const Re=z(ge);return C.xRowid(ve,Re.rowid),0},xEof:function(ge){const ve=z(ge);return se("xEof?="+!ve.row(),...arguments),!ve.row()},xFilter:function(ge,ve,Re,Ue,ke){return z(ge,!0),0},xBestIndex:function(ge,ve){const Re=new n.sqlite3_index_info(ve);return Re.$estimatedRows=g.storagePool.size,Re.$estimatedCost=1,Re.dispose(),0}}})};s.kvvfs.create_module=function(ye,ge="sqlite_kvvfs"){return n.sqlite3_create_module(ye,ge,pe(),N.ptr.null)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const n=function i(r){if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory)return Promise.reject(new Error("Missing required OPFS APIs."));(!r||typeof r!="object")&&(r=Object.create(null));const u=new URL(globalThis.location.href).searchParams;return u.has("opfs-disable")?Promise.resolve(s):(r.verbose===void 0&&(r.verbose=u.has("opfs-verbose")?+u.get("opfs-verbose")||2:1),r.sanityChecks===void 0&&(r.sanityChecks=u.has("opfs-sanity-check")),r.proxyUri===void 0&&(r.proxyUri=i.defaultProxyUri),typeof r.proxyUri=="function"&&(r.proxyUri=r.proxyUri()),new Promise(function(D,N){const ee=[s.config.error,s.config.warn,s.config.log],x=(y,...P)=>{r.verbose>y&&ee[y]("OPFS syncer:",...P)},K=(...y)=>x(2,...y),g=(...y)=>x(1,...y),H=(...y)=>x(0,...y),U=s.util.toss,oe=s.capi,S=s.util,T=s.wasm,M=oe.sqlite3_vfs,Q=oe.sqlite3_file,O=oe.sqlite3_io_methods,R=Object.create(null),p=()=>globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&navigator?.storage?.getDirectory;R.metrics={dump:function(){let y,P=0,$=0,ce=0;for(y in J.opIds){const re=w[y];P+=re.count,$+=re.time,ce+=re.wait,re.avgTime=re.count&&re.time?re.time/re.count:0,re.avgWait=re.count&&re.wait?re.wait/re.count:0}s.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",w,`
Total of`,P,"op(s) for",$,"ms (incl. "+ce+" ms of waiting on the async side)"),s.config.log("Serialization metrics:",w.s11n),Ie.postMessage({type:"opfs-async-metrics"})},reset:function(){let y;const P=ce=>ce.count=ce.time=ce.wait=0;for(y in J.opIds)P(w[y]=Object.create(null));let $=w.s11n=Object.create(null);$=$.serialize=Object.create(null),$.count=$.time=0,$=w.s11n.deserialize=Object.create(null),$.count=$.time=0}};const b=new O,q=new M().addOnDispose(()=>b.dispose());let j;const ne=y=>(j=!0,q.dispose(),N(y)),fe=()=>(j=!1,D(s)),Ie=new Worker(new URL(""+new URL("sqlite3-opfs-async-proxy--d6widYe.js",import.meta.url).href,import.meta.url));setTimeout(()=>{j===void 0&&ne(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),Ie._originalOnError=Ie.onerror,Ie.onerror=function(y){H("Error initializing OPFS asyncer:",y),ne(new Error("Loading OPFS async Worker failed for unknown reasons."))};const we=oe.sqlite3_vfs_find(null),Te=we?new M(we):null;b.$iVersion=1,q.$iVersion=2,q.$szOsFile=oe.sqlite3_file.structInfo.sizeof,q.$mxPathname=1024,q.$zName=T.allocCString("opfs"),q.$xDlOpen=q.$xDlError=q.$xDlSym=q.$xDlClose=null,q.addOnDispose("$zName",q.$zName,"cleanup default VFS wrapper",()=>Te?Te.dispose():null);const J=Object.create(null);J.verbose=r.verbose,J.littleEndian=(()=>{const y=new ArrayBuffer(2);return new DataView(y).setInt16(0,256,!0),new Int16Array(y)[0]===256})(),J.asyncIdleWaitTime=150,J.asyncS11nExceptions=1,J.fileBufferSize=65536,J.sabS11nOffset=J.fileBufferSize,J.sabS11nSize=q.$mxPathname*2,J.sabIO=new SharedArrayBuffer(J.fileBufferSize+J.sabS11nSize),J.opIds=Object.create(null);const w=Object.create(null);{let y=0;J.opIds.whichOp=y++,J.opIds.rc=y++,J.opIds.xAccess=y++,J.opIds.xClose=y++,J.opIds.xDelete=y++,J.opIds.xDeleteNoWait=y++,J.opIds.xFileSize=y++,J.opIds.xLock=y++,J.opIds.xOpen=y++,J.opIds.xRead=y++,J.opIds.xSleep=y++,J.opIds.xSync=y++,J.opIds.xTruncate=y++,J.opIds.xUnlock=y++,J.opIds.xWrite=y++,J.opIds.mkdir=y++,J.opIds["opfs-async-metrics"]=y++,J.opIds["opfs-async-shutdown"]=y++,J.opIds.retry=y++,J.sabOP=new SharedArrayBuffer(y*4),R.metrics.reset()}J.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_CANTOPEN","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(y=>{(J.sq3Codes[y]=oe[y])===void 0&&U("Maintenance required: not found:",y)}),J.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,OPFS_UNLINK_BEFORE_OPEN:2,defaultUnlockAsap:!1});const a=(y,...P)=>{const $=J.opIds[y]||U("Invalid op ID:",y);J.s11n.serialize(...P),Atomics.store(J.sabOPView,J.opIds.rc,-1),Atomics.store(J.sabOPView,J.opIds.whichOp,$),Atomics.notify(J.sabOPView,J.opIds.whichOp);const ce=performance.now();for(;Atomics.wait(J.sabOPView,J.opIds.rc,-1)!=="not-equal";);const re=Atomics.load(J.sabOPView,J.opIds.rc);if(w[y].wait+=performance.now()-ce,re&&J.asyncS11nExceptions){const me=J.s11n.deserialize();me&&H(y+"() async error:",...me)}return re};R.debug={asyncShutdown:()=>{g("Shutting down OPFS async listener. The OPFS VFS will no longer work."),a("opfs-async-shutdown")},asyncRestart:()=>{g("Attempting to restart OPFS VFS async listener. Might work, might not."),Ie.postMessage({type:"opfs-async-restart"})}};const d=()=>{if(J.s11n)return J.s11n;const y=new TextDecoder,P=new TextEncoder("utf-8"),$=new Uint8Array(J.sabIO,J.sabS11nOffset,J.sabS11nSize),ce=new DataView(J.sabIO,J.sabS11nOffset,J.sabS11nSize);J.s11n=Object.create(null);const re=Object.create(null);re.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},re.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},re.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},re.string={id:4};const me=Ee=>re[typeof Ee]||U("Maintenance required: this value type cannot be serialized.",Ee),Le=Ee=>{switch(Ee){case re.number.id:return re.number;case re.bigint.id:return re.bigint;case re.boolean.id:return re.boolean;case re.string.id:return re.string;default:U("Invalid type ID:",Ee)}};return J.s11n.deserialize=function(Ee=!1){++w.s11n.deserialize.count;const I=performance.now(),C=$[0],W=C?[]:null;if(C){const z=[];let se=1,pe,ye,ge;for(pe=0;pe<C;++pe,++se)z.push(Le($[se]));for(pe=0;pe<C;++pe){const ve=z[pe];ve.getter?(ge=ce[ve.getter](se,J.littleEndian),se+=ve.size):(ye=ce.getInt32(se,J.littleEndian),se+=4,ge=y.decode($.slice(se,se+ye)),se+=ye),W.push(ge)}}return Ee&&($[0]=0),w.s11n.deserialize.time+=performance.now()-I,W},J.s11n.serialize=function(...Ee){const I=performance.now();if(++w.s11n.serialize.count,Ee.length){const C=[];let W=0,z=1;for($[0]=Ee.length&255;W<Ee.length;++W,++z)C.push(me(Ee[W])),$[z]=C[W].id;for(W=0;W<Ee.length;++W){const se=C[W];if(se.setter)ce[se.setter](z,Ee[W],J.littleEndian),z+=se.size;else{const pe=P.encode(Ee[W]);ce.setInt32(z,pe.byteLength,J.littleEndian),z+=4,$.set(pe,z),z+=pe.byteLength}}}else $[0]=0;w.s11n.serialize.time+=performance.now()-I},J.s11n},h=function y(P=16){y._chars||(y._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",y._n=y._chars.length);const $=[];let ce=0;for(;ce<P;++ce){const re=Math.random()*(y._n*64)%y._n|0;$[ce]=y._chars[re]}return $.join("")},A=Object.create(null),V=Object.create(null);V.op=void 0,V.start=void 0;const Z=y=>{V.start=performance.now(),V.op=y,++w[y].count},B=()=>w[V.op].time+=performance.now()-V.start,E={xCheckReservedLock:function(y,P){return T.poke(P,0,"i32"),0},xClose:function(y){Z("xClose");let P=0;const $=A[y];return $&&(delete A[y],P=a("xClose",y),$.sq3File&&$.sq3File.dispose()),B(),P},xDeviceCharacteristics:function(y){return oe.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(y,P,$){return oe.SQLITE_NOTFOUND},xFileSize:function(y,P){Z("xFileSize");let $=a("xFileSize",y);if($==0)try{const ce=J.s11n.deserialize()[0];T.poke(P,ce,"i64")}catch(ce){H("Unexpected error reading xFileSize() result:",ce),$=J.sq3Codes.SQLITE_IOERR}return B(),$},xLock:function(y,P){Z("xLock");const $=A[y];let ce=0;return $.lockType?$.lockType=P:(ce=a("xLock",y,P),ce===0&&($.lockType=P)),B(),ce},xRead:function(y,P,$,ce){Z("xRead");const re=A[y];let me;try{me=a("xRead",y,$,Number(ce)),(me===0||oe.SQLITE_IOERR_SHORT_READ===me)&&T.heap8u().set(re.sabView.subarray(0,$),Number(P))}catch(Le){H("xRead(",arguments,") failed:",Le,re),me=oe.SQLITE_IOERR_READ}return B(),me},xSync:function(y,P){Z("xSync"),++w.xSync.count;const $=a("xSync",y,P);return B(),$},xTruncate:function(y,P){Z("xTruncate");const $=a("xTruncate",y,Number(P));return B(),$},xUnlock:function(y,P){Z("xUnlock");const $=A[y];let ce=0;return oe.SQLITE_LOCK_NONE===P&&$.lockType&&(ce=a("xUnlock",y,P)),ce===0&&($.lockType=P),B(),ce},xWrite:function(y,P,$,ce){Z("xWrite");const re=A[y];let me;try{re.sabView.set(T.heap8u().subarray(Number(P),Number(P)+$)),me=a("xWrite",y,$,Number(ce))}catch(Le){H("xWrite(",arguments,") failed:",Le,re),me=oe.SQLITE_IOERR_WRITE}return B(),me}},F={xAccess:function(y,P,$,ce){Z("xAccess");const re=a("xAccess",T.cstrToJs(P));return T.poke(ce,re?0:1,"i32"),B(),0},xCurrentTime:function(y,P){return T.poke(P,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(y,P){return T.poke(P,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(y,P,$){Z("xDelete");const ce=a("xDelete",T.cstrToJs(P),$,!1);return B(),ce},xFullPathname:function(y,P,$,ce){return T.cstrncpy(ce,P,$)<$?0:oe.SQLITE_CANTOPEN},xGetLastError:function(y,P,$){return g("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(P,$,ce,re,me){Z("xOpen");let Le=0;$===0?$=h():T.isPtr($)&&(oe.sqlite3_uri_boolean($,"opfs-unlock-asap",0)&&(Le|=J.opfsFlags.OPFS_UNLOCK_ASAP),oe.sqlite3_uri_boolean($,"delete-before-open",0)&&(Le|=J.opfsFlags.OPFS_UNLINK_BEFORE_OPEN),$=T.cstrToJs($));const Ee=Object.create(null);Ee.fid=ce,Ee.filename=$,Ee.sab=new SharedArrayBuffer(J.fileBufferSize),Ee.flags=re,Ee.readOnly=!(oe.SQLITE_OPEN_CREATE&re)&&!!(re&oe.SQLITE_OPEN_READONLY);const I=a("xOpen",ce,$,re,Le);return I||(Ee.readOnly&&T.poke(me,oe.SQLITE_OPEN_READONLY,"i32"),A[ce]=Ee,Ee.sabView=J.sabFileBufView,Ee.sq3File=new Q(ce),Ee.sq3File.$pMethods=b.pointer,Ee.lockType=oe.SQLITE_LOCK_NONE),B(),I}};Te&&(q.$xRandomness=Te.$xRandomness,q.$xSleep=Te.$xSleep),q.$xRandomness||(F.xRandomness=function(y,P,$){const ce=T.heap8u();let re=0;const me=Number($);for(;re<P;++re)ce[me+re]=Math.random()*255e3&255;return re}),q.$xSleep||(F.xSleep=function(y,P){return Atomics.wait(J.sabOPView,J.opIds.xSleep,0,P),0}),R.getResolvedPath=function(y,P){const $=new URL(y,"file://irrelevant").pathname;return P?$.split("/").filter(ce=>!!ce):$},R.getDirForFilename=async function(P,$=!1){const ce=R.getResolvedPath(P,!0),re=ce.pop();let me=R.rootDirectory;for(const Le of ce)Le&&(me=await me.getDirectoryHandle(Le,{create:!!$}));return[me,re]},R.mkdir=async function(y){try{return await R.getDirForFilename(y+"/filepart",!0),!0}catch{return!1}},R.entryExists=async function(y){try{const[P,$]=await R.getDirForFilename(y);return await P.getFileHandle($),!0}catch{return!1}},R.randomFilename=h,R.treeList=async function(){const y=async function $(ce,re){re.name=ce.name,re.dirs=[],re.files=[];for await(const me of ce.values())if(me.kind==="directory"){const Le=Object.create(null);re.dirs.push(Le),await $(me,Le)}else re.files.push(me.name)},P=Object.create(null);return await y(R.rootDirectory,P),P},R.rmfr=async function(){const y=R.rootDirectory,P={recurse:!0};for await(const $ of y.values())y.removeEntry($.name,P)},R.unlink=async function(y,P=!1,$=!1){try{const[ce,re]=await R.getDirForFilename(y,!1);return await ce.removeEntry(re,{recursive:P}),!0}catch(ce){if($)throw new Error("unlink(",arguments[0],") failed: "+ce.message,{cause:ce});return!1}},R.traverse=async function(y){const P={recursive:!0,directory:R.rootDirectory};typeof y=="function"&&(y={callback:y}),y=Object.assign(P,y||{}),(async function $(ce,re){for await(const me of ce.values()){if(y.callback(me,ce,re)===!1)return!1;if(y.recursive&&me.kind==="directory"&&await $(me,re+1)===!1)break}})(y.directory,0)};const G=async function(y,P){const[$,ce]=await R.getDirForFilename(y,!0);let re=await(await $.getFileHandle(ce,{create:!0})).createSyncAccessHandle(),me=0,Le,Ee=!1;try{for(re.truncate(0);(Le=await P())!==void 0;)Le instanceof ArrayBuffer&&(Le=new Uint8Array(Le)),!Ee&&me===0&&Le.byteLength>=15&&(S.affirmDbHeader(Le),Ee=!0),re.write(Le,{at:me}),me+=Le.byteLength;if((me<512||me%512!==0)&&U("Input size",me,"is not correct for an SQLite database."),!Ee){const I=new Uint8Array(20);re.read(I,{at:0}),S.affirmDbHeader(I)}return re.write(new Uint8Array([1,1]),{at:18}),me}catch(I){throw await re.close(),re=void 0,await $.removeEntry(ce).catch(()=>{}),I}finally{re&&await re.close()}};if(R.importDb=async function(y,P){if(P instanceof Function)return G(y,P);P instanceof ArrayBuffer&&(P=new Uint8Array(P)),S.affirmIsDb(P);const $=P.byteLength,[ce,re]=await R.getDirForFilename(y,!0);let me,Le=0;try{return me=await(await ce.getFileHandle(re,{create:!0})).createSyncAccessHandle(),me.truncate(0),Le=me.write(P,{at:0}),Le!=$&&U("Expected to write "+$+" bytes but wrote "+Le+"."),me.write(new Uint8Array([1,1]),{at:18}),Le}catch(Ee){throw me&&(await me.close(),me=void 0),await ce.removeEntry(re).catch(()=>{}),Ee}finally{me&&await me.close()}},s.oo1){const y=function(...P){const $=s.oo1.DB.dbCtorHelper.normalizeArgs(...P);$.vfs=q.$zName,s.oo1.DB.dbCtorHelper.call(this,$)};y.prototype=Object.create(s.oo1.DB.prototype),s.oo1.OpfsDb=y,y.importDb=R.importDb,s.oo1.DB.dbCtorHelper.setVfsPostOpenCallback(q.pointer,function(P,$){$.capi.sqlite3_busy_timeout(P,1e4)})}const le=function(){const y=T.scopedAllocPush(),P=new Q;try{const $=P.pointer,ce=oe.SQLITE_OPEN_CREATE|oe.SQLITE_OPEN_READWRITE|oe.SQLITE_OPEN_MAIN_DB,re=T.scopedAlloc(8),me="/sanity/check/file"+h(8),Le=T.scopedAllocCString(me);let Ee;if(J.s11n.serialize("This is  string."),Ee=J.s11n.deserialize(),K("deserialize() says:",Ee),Ee[0]!=="This is  string."&&U("String d13n error."),F.xAccess(q.pointer,Le,0,re),Ee=T.peek(re,"i32"),K("xAccess(",me,") exists ?=",Ee),Ee=F.xOpen(q.pointer,Le,$,ce,re),K("open rc =",Ee,"state.sabOPView[xOpen] =",J.sabOPView[J.opIds.xOpen]),Ee!==0){H("open failed with code",Ee);return}F.xAccess(q.pointer,Le,0,re),Ee=T.peek(re,"i32"),Ee||U("xAccess() failed to detect file."),Ee=E.xSync(P.pointer,0),Ee&&U("sync failed w/ rc",Ee),Ee=E.xTruncate(P.pointer,1024),Ee&&U("truncate failed w/ rc",Ee),T.poke(re,0,"i64"),Ee=E.xFileSize(P.pointer,re),Ee&&U("xFileSize failed w/ rc",Ee),K("xFileSize says:",T.peek(re,"i64")),Ee=E.xWrite(P.pointer,Le,10,1),Ee&&U("xWrite() failed!");const I=T.scopedAlloc(16);Ee=E.xRead(P.pointer,I,6,2),T.poke(I+6,0);let C=T.cstrToJs(I);K("xRead() got:",C),C!=="sanity"&&U("Unexpected xRead() value."),F.xSleep&&(K("xSleep()ing before close()ing..."),F.xSleep(q.pointer,2e3),K("waking up from xSleep()")),Ee=E.xClose($),K("xClose rc =",Ee,"sabOPView =",J.sabOPView),K("Deleting file:",me),F.xDelete(q.pointer,Le,4660),F.xAccess(q.pointer,Le,0,re),Ee=T.peek(re,"i32"),Ee&&U("Expecting 0 from xAccess(",me,") after xDelete()."),g("End of OPFS sanity checks.")}finally{P.dispose(),T.scopedAllocPop(y)}};Ie.onmessage=function({data:y}){switch(y.type){case"opfs-unavailable":ne(new Error(y.payload.join(" ")));break;case"opfs-async-loaded":Ie.postMessage({type:"opfs-async-init",args:J});break;case"opfs-async-inited":if(j===!0)break;try{s.vfs.installVfs({io:{struct:b,methods:E},vfs:{struct:q,methods:F}}),J.sabOPView=new Int32Array(J.sabOP),J.sabFileBufView=new Uint8Array(J.sabIO,0,J.fileBufferSize),J.sabS11nView=new Uint8Array(J.sabIO,J.sabS11nOffset,J.sabS11nSize),d(),r.sanityChecks&&(g("Running sanity checks because of opfs-sanity-check URL arg..."),le()),p()?navigator.storage.getDirectory().then(P=>{Ie.onerror=Ie._originalOnError,delete Ie._originalOnError,s.opfs=R,R.rootDirectory=P,K("End of OPFS sqlite3_vfs setup.",q),fe()}).catch(ne):fe()}catch(P){H(P),ne(P)}break;default:{const P="Unexpected message from the OPFS async worker: "+JSON.stringify(y);H(P),ne(new Error(P));break}}}}))};n.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async i=>{try{let r=n.defaultProxyUri;return i?.scriptInfo?.sqlite3Dir&&(n.defaultProxyUri=i.scriptInfo.sqlite3Dir+r),n().catch(u=>{i.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",u.message)})}catch(r){return i.config.error("installOpfsVfs() exception:",r),Promise.reject(r)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(s){const n=s.util.toss,i=s.util.toss3,r=Object.create(null),u=s.capi,D=s.util,N=s.wasm,ee=4096,x=512,K=4,g=8,H=x+K,U=x,oe=H,S=ee,T=u.SQLITE_OPEN_MAIN_DB|u.SQLITE_OPEN_MAIN_JOURNAL|u.SQLITE_OPEN_SUPER_JOURNAL|u.SQLITE_OPEN_WAL,M=u.SQLITE_OPEN_MEMORY,Q=".opaque",O=()=>Math.random().toString(36).slice(2),R=new TextDecoder,p=new TextEncoder,b=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2,forceReinitIfPreviouslyFailed:!1}),q=[s.config.error,s.config.warn,s.config.log];s.config.log;const j=s.config.warn;s.config.error;const ne=new Map,fe=B=>ne.get(B),Ie=(B,E)=>{E?ne.set(B,E):ne.delete(B)},we=new Map,Te=B=>we.get(B),J=(B,E)=>{E?we.set(B,E):we.delete(B)},w={xCheckReservedLock:function(B,E){const F=Te(B);return F.log("xCheckReservedLock"),F.storeErr(),N.poke32(E,1),0},xClose:function(B){const E=Te(B);E.storeErr();const F=E.getOFileForS3File(B);if(F)try{E.log(`xClose ${F.path}`),E.mapS3FileToOFile(B,!1),F.sah.flush(),F.flags&u.SQLITE_OPEN_DELETEONCLOSE&&E.deletePath(F.path)}catch(G){return E.storeErr(G,u.SQLITE_IOERR)}return 0},xDeviceCharacteristics:function(B){return u.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(B,E,F){return u.SQLITE_NOTFOUND},xFileSize:function(B,E){const F=Te(B);F.log("xFileSize");const G=F.getOFileForS3File(B).sah.getSize()-S;return N.poke64(E,BigInt(G)),0},xLock:function(B,E){const F=Te(B);F.log(`xLock ${E}`),F.storeErr();const G=F.getOFileForS3File(B);return G.lockType=E,0},xRead:function(B,E,F,G){const le=Te(B);le.storeErr();const y=le.getOFileForS3File(B);le.log(`xRead ${y.path} ${F} @ ${G}`);try{const P=y.sah.read(N.heap8u().subarray(Number(E),Number(E)+F),{at:S+Number(G)});return P<F?(N.heap8u().fill(0,Number(E)+P,Number(E)+F),u.SQLITE_IOERR_SHORT_READ):0}catch(P){return le.storeErr(P,u.SQLITE_IOERR)}},xSectorSize:function(B){return ee},xSync:function(B,E){const F=Te(B);F.log(`xSync ${E}`),F.storeErr();const G=F.getOFileForS3File(B);try{return G.sah.flush(),0}catch(le){return F.storeErr(le,u.SQLITE_IOERR)}},xTruncate:function(B,E){const F=Te(B);F.log(`xTruncate ${E}`),F.storeErr();const G=F.getOFileForS3File(B);try{return G.sah.truncate(S+Number(E)),0}catch(le){return F.storeErr(le,u.SQLITE_IOERR)}},xUnlock:function(B,E){const F=Te(B);F.log("xUnlock");const G=F.getOFileForS3File(B);return G.lockType=E,0},xWrite:function(B,E,F,G){const le=Te(B);le.storeErr();const y=le.getOFileForS3File(B);le.log(`xWrite ${y.path} ${F} ${G}`);try{return F===y.sah.write(N.heap8u().subarray(Number(E),Number(E)+F),{at:S+Number(G)})?0:n("Unknown write() failure.")}catch(P){return le.storeErr(P,u.SQLITE_IOERR)}}},a=new u.sqlite3_io_methods;a.$iVersion=1,s.vfs.installVfs({io:{struct:a,methods:w}});const d={xAccess:function(B,E,F,G){const le=fe(B);le.storeErr();try{const y=le.getPath(E);N.poke32(G,le.hasFilename(y)?1:0)}catch{N.poke32(G,0)}return 0},xCurrentTime:function(B,E){return N.poke(E,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(B,E){return N.poke(E,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(B,E,F){const G=fe(B);G.log(`xDelete ${N.cstrToJs(E)}`),G.storeErr();try{return G.deletePath(G.getPath(E)),0}catch(le){return G.storeErr(le),u.SQLITE_IOERR_DELETE}},xFullPathname:function(B,E,F,G){return N.cstrncpy(G,E,F)<F?0:u.SQLITE_CANTOPEN},xGetLastError:function(B,E,F){const G=fe(B),le=G.popErr();if(G.log(`xGetLastError ${E} e =`,le),le){const y=N.scopedAllocPush();try{const[P,$]=N.scopedAllocCString(le.message,!0);N.cstrncpy(F,P,E),$>E&&N.poke8(N.ptr.add(F,E,-1),0)}catch{return u.SQLITE_NOMEM}finally{N.scopedAllocPop(y)}}return le?le.sqlite3Rc||u.SQLITE_IOERR:0},xOpen:function(E,F,G,le,y){const P=fe(E);try{le&=~M,P.log(`xOpen ${N.cstrToJs(F)} ${le}`);const $=F&&N.peek8(F)?P.getPath(F):O();let ce=P.getSAHForPath($);!ce&&le&u.SQLITE_OPEN_CREATE&&(P.getFileCount()<P.getCapacity()?(ce=P.nextAvailableSAH(),P.setAssociatedPath(ce,$,le)):n("SAH pool is full. Cannot create file",$)),ce||n("file not found:",$);const re={path:$,flags:le,sah:ce};P.mapS3FileToOFile(G,re),re.lockType=u.SQLITE_LOCK_NONE;const me=new u.sqlite3_file(G);return me.$pMethods=a.pointer,me.dispose(),N.poke32(y,le),0}catch($){return P.storeErr($),u.SQLITE_CANTOPEN}}},h=function(B){s.capi.sqlite3_vfs_find(B)&&i("VFS name is already registered:",B);const E=new u.sqlite3_vfs,F=u.sqlite3_vfs_find(null),G=F?new u.sqlite3_vfs(F):null;return E.$iVersion=2,E.$szOsFile=u.sqlite3_file.structInfo.sizeof,E.$mxPathname=x,E.addOnDispose(E.$zName=N.allocCString(B),()=>Ie(E.pointer,0)),G&&(E.$xRandomness=G.$xRandomness,E.$xSleep=G.$xSleep,G.dispose()),!E.$xRandomness&&!d.xRandomness&&(d.xRandomness=function(le,y,P){const $=N.heap8u();let ce=0;const re=Number(P);for(;ce<y;++ce)$[re+ce]=Math.random()*255e3&255;return ce}),!E.$xSleep&&!d.xSleep&&(d.xSleep=(le,y)=>0),s.vfs.installVfs({vfs:{struct:E,methods:d}}),E};class A{vfsDir;#e;#r;#a;#i=new Map;#t=new Map;#s=new Set;#l=new Map;#n=new Uint8Array(H);#c;#o;#u;constructor(E=Object.create(null)){this.#u=E.verbosity??b.verbosity,this.vfsName=E.name||b.name,this.#o=h(this.vfsName),Ie(this.#o.pointer,this),this.vfsDir=E.directory||"."+this.vfsName,this.#c=new DataView(this.#n.buffer,this.#n.byteOffset),this.isReady=this.reset(!!(E.clearOnInit??b.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(E.initialCapacity||b.initialCapacity)})}#_(E,...F){this.#u>E&&q[E](this.vfsName+":",...F)}log(...E){this.#_(2,...E)}warn(...E){this.#_(1,...E)}error(...E){this.#_(0,...E)}getVfs(){return this.#o}getCapacity(){return this.#i.size}getFileCount(){return this.#t.size}getFileNames(){const E=[];for(const F of this.#t.keys())E.push(F);return E}async addCapacity(E){for(let F=0;F<E;++F){const G=O(),le=await(await this.#r.getFileHandle(G,{create:!0})).createSyncAccessHandle();this.#i.set(le,G),this.setAssociatedPath(le,"",0)}return this.getCapacity()}async reduceCapacity(E){let F=0;for(const G of Array.from(this.#s)){if(F===E||this.getFileCount()===this.getCapacity())break;const le=this.#i.get(G);G.close(),await this.#r.removeEntry(le),this.#i.delete(G),this.#s.delete(G),++F}return F}releaseAccessHandles(){for(const E of this.#i.keys())E.close();this.#i.clear(),this.#t.clear(),this.#s.clear()}async acquireAccessHandles(E=!1){const F=[];for await(const[G,le]of this.#r)le.kind==="file"&&F.push([G,le]);return Promise.all(F.map(async([G,le])=>{try{const y=await le.createSyncAccessHandle();if(this.#i.set(y,G),E)y.truncate(S),this.setAssociatedPath(y,"",0);else{const P=this.getAssociatedPath(y);P?this.#t.set(P,y):this.#s.add(y)}}catch(y){throw this.storeErr(y),this.releaseAccessHandles(),y}}))}getAssociatedPath(E){E.read(this.#n,{at:0});const F=this.#c.getUint32(U);if(this.#n[0]&&(F&u.SQLITE_OPEN_DELETEONCLOSE||(F&T)===0))return j(`Removing file with unexpected flags ${F.toString(16)}`,this.#n),this.setAssociatedPath(E,"",0),"";const G=new Uint32Array(g/4);E.read(G,{at:oe});const le=this.computeDigest(this.#n,F);if(G.every((y,P)=>y===le[P])){const y=this.#n.findIndex(P=>P===0);return y===0&&E.truncate(S),y?R.decode(this.#n.subarray(0,y)):""}else return j("Disassociating file with bad digest."),this.setAssociatedPath(E,"",0),""}setAssociatedPath(E,F,G){const le=p.encodeInto(F,this.#n);x<=le.written+1&&n("Path too long:",F),F&&G&&(G|=M),this.#n.fill(0,le.written,x),this.#c.setUint32(U,G);const y=this.computeDigest(this.#n,G);E.write(this.#n,{at:0}),E.write(y,{at:oe}),E.flush(),F?(this.#t.set(F,E),this.#s.delete(E)):(E.truncate(S),this.#s.add(E))}computeDigest(E,F){if(F&M){let G=3735928559,le=1103547991;for(const y of E)G=Math.imul(G^y,2654435761),le=Math.imul(le^y,104729);return new Uint32Array([G>>>0,le>>>0])}else return new Uint32Array([0,0])}async reset(E){await this.isReady;let F=await navigator.storage.getDirectory(),G;for(const le of this.vfsDir.split("/"))le&&(G=F,F=await F.getDirectoryHandle(le,{create:!0}));return this.#e=F,this.#a=G,this.#r=await this.#e.getDirectoryHandle(Q,{create:!0}),this.releaseAccessHandles(),this.acquireAccessHandles(E)}getPath(E){return N.isPtr(E)&&(E=N.cstrToJs(E)),(E instanceof URL?E:new URL(E,"file://localhost/")).pathname}deletePath(E){const F=this.#t.get(E);return F&&(this.#t.delete(E),this.setAssociatedPath(F,"",0)),!!F}storeErr(E,F){return E&&(E.sqlite3Rc=F||u.SQLITE_IOERR,this.error(E)),this.$error=E,F}popErr(){const E=this.$error;return this.$error=void 0,E}nextAvailableSAH(){const[E]=this.#s.keys();return E}getOFileForS3File(E){return this.#l.get(E)}mapS3FileToOFile(E,F){F?(this.#l.set(E,F),J(E,this)):(this.#l.delete(E),J(E,!1))}hasFilename(E){return this.#t.has(E)}getSAHForPath(E){return this.#t.get(E)}async removeVfs(){if(!this.#o.pointer||!this.#r)return!1;u.sqlite3_vfs_unregister(this.#o.pointer),this.#o.dispose(),delete r[this.vfsName];try{this.releaseAccessHandles(),await this.#e.removeEntry(Q,{recursive:!0}),this.#r=void 0,await this.#a.removeEntry(this.#e.name,{recursive:!0}),this.#e=this.#a=void 0}catch(E){s.config.error(this.vfsName,"removeVfs() failed with no recovery strategy:",E)}return!0}pauseVfs(){return this.#l.size>0&&s.SQLite3Error.toss(u.SQLITE_MISUSE,"Cannot pause VFS",this.vfsName,"because it has opened files."),this.#i.size>0&&(u.sqlite3_vfs_unregister(this.vfsName),this.releaseAccessHandles()),this}isPaused(){return this.#i.size===0}async unpauseVfs(){return this.#i.size===0?this.acquireAccessHandles(!1).then(()=>u.sqlite3_vfs_register(this.#o,0),this):this}exportFile(E){const F=this.#t.get(E)||n("File not found:",E),G=F.getSize()-S,le=new Uint8Array(G>0?G:0);if(G>0){const y=F.read(le,{at:S});y!=G&&n("Expected to read "+G+" bytes but read "+y+".")}return le}async importDbChunked(E,F){const G=this.#t.get(E)||this.nextAvailableSAH()||n("No available handles to import to.");G.truncate(0);let le=0,y,P=!1;try{for(;(y=await F())!==void 0;)y instanceof ArrayBuffer&&(y=new Uint8Array(y)),!P&&le===0&&y.byteLength>=15&&(D.affirmDbHeader(y),P=!0),G.write(y,{at:S+le}),le+=y.byteLength;if((le<512||le%512!==0)&&n("Input size",le,"is not correct for an SQLite database."),!P){const $=new Uint8Array(20);G.read($,{at:0}),D.affirmDbHeader($)}G.write(new Uint8Array([1,1]),{at:S+18})}catch($){throw this.setAssociatedPath(G,"",0),$}return this.setAssociatedPath(G,E,u.SQLITE_OPEN_MAIN_DB),le}importDb(E,F){if(F instanceof ArrayBuffer)F=new Uint8Array(F);else if(F instanceof Function)return this.importDbChunked(E,F);const G=this.#t.get(E)||this.nextAvailableSAH()||n("No available handles to import to."),le=F.byteLength;(le<512||le%512!=0)&&n("Byte array size is invalid for an SQLite db.");const y="SQLite format 3";for(let $=0;$<15;++$)y.charCodeAt($)!==F[$]&&n("Input does not contain an SQLite database header.");const P=G.write(F,{at:S});return P!=le?(this.setAssociatedPath(G,"",0),n("Expected to write "+le+" bytes but wrote "+P+".")):(G.write(new Uint8Array([1,1]),{at:S+18}),this.setAssociatedPath(G,E,u.SQLITE_OPEN_MAIN_DB)),P}}class V{#e;constructor(E){this.#e=E,this.vfsName=E.vfsName}async addCapacity(E){return this.#e.addCapacity(E)}async reduceCapacity(E){return this.#e.reduceCapacity(E)}getCapacity(){return this.#e.getCapacity(this.#e)}getFileCount(){return this.#e.getFileCount()}getFileNames(){return this.#e.getFileNames()}async reserveMinimumCapacity(E){const F=this.#e.getCapacity();return F<E?this.#e.addCapacity(E-F):F}exportFile(E){return this.#e.exportFile(E)}importDb(E,F){return this.#e.importDb(E,F)}async wipeFiles(){return this.#e.reset(!0)}unlink(E){return this.#e.deletePath(E)}async removeVfs(){return this.#e.removeVfs()}pauseVfs(){return this.#e.pauseVfs(),this}async unpauseVfs(){return this.#e.unpauseVfs().then(()=>this)}isPaused(){return this.#e.isPaused()}}const Z=async()=>{const B=await navigator.storage.getDirectory(),E=".opfs-sahpool-sync-check-"+O(),F=(await(await B.getFileHandle(E,{create:!0})).createSyncAccessHandle()).close();return await F,await B.removeEntry(E),F?.then&&n("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};s.installOpfsSAHPoolVfs=async function(B=Object.create(null)){B=Object.assign(Object.create(null),b,B||{});const E=B.name;if(B.$testThrowPhase1)throw B.$testThrowPhase1;if(r[E])try{return await r[E]}catch(F){if(B.forceReinitIfPreviouslyFailed)delete r[E];else throw F}return!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory?r[E]=Promise.reject(new Error("Missing required OPFS APIs.")):r[E]=Z().then(async function(){if(B.$testThrowPhase2)throw B.$testThrowPhase2;const F=new A(B);return F.isReady.then(async()=>{const G=new V(F);if(s.oo1){const le=s.oo1,y=F.getVfs(),P=function(...$){const ce=le.DB.dbCtorHelper.normalizeArgs(...$);ce.vfs=y.$zName,le.DB.dbCtorHelper.call(this,ce)};P.prototype=Object.create(le.DB.prototype),G.OpfsSAHPoolDb=P}return F.log("VFS initialized."),G}).catch(async G=>{throw await F.removeVfs().catch(()=>{}),G})}).catch(F=>r[E]=Promise.reject(F))}});try{const s=Object.assign(Object.create(null),{memory:typeof ot<"u"?ot:t.wasmMemory,exports:typeof Mt<"u"?Mt:Object.prototype.hasOwnProperty.call(t,"wasmExports")?t.wasmExports:t.asm},globalThis.sqlite3ApiBootstrap.defaultConfig,globalThis.sqlite3ApiConfig||{});e.debugModule("Bootstrapping lib config",s);const n=globalThis.sqlite3ApiBootstrap(s);return delete globalThis.sqlite3ApiBootstrap,n}catch(s){throw console.error("sqlite3ApiBootstrap() error:",s),s}},Xt?Ae=f:Ae=new Promise((e,t)=>{ut=e,Tt=t}),Ae}cr=(function(){const Je=cr;if(!Je)throw new Error("Expecting sqlite3InitModule to be defined by the Emscripten build.");const Ae=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:globalThis?.document?.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:globalThis?.location?.href?new URL(globalThis.location.href).searchParams:new URLSearchParams,wasmFilename:"sqlite3.wasm"});if(Ae.debugModule=Ae.urlParams.has("sqlite3.debugModule")?(...Me)=>console.warn("sqlite3.debugModule:",...Me):()=>{},Ae.urlParams.has("sqlite3.dir"))Ae.sqlite3Dir=Ae.urlParams.get("sqlite3.dir")+"/";else if(Ae.moduleScript){const Me=Ae.moduleScript.src.split("/");Me.pop(),Ae.sqlite3Dir=Me.join("/")+"/"}const f=globalThis.sqlite3InitModule=function Me(...Qe){return Ae.emscriptenLocateFile=Qe[0]?.locateFile,Ae.emscriptenInstantiateWasm=Qe[0]?.instantiateWasm,Je(...Qe).then(Be=>{Ae.debugModule("sqlite3InitModule() sIMS =",Ae),Ae.debugModule("sqlite3InitModule() EmscriptenModule =",Be);const Ye=Be.runSQLite3PostLoadInit(Ae,Be,!!Me.__isUnderTest);return Ae.debugModule("sqlite3InitModule() sqlite3 =",Ye),Ye}).catch(Be=>{throw console.error("Exception loading sqlite3 module:",Be),Be})};if(f.ready=Je.ready,Ae.moduleScript){let Me=Ae.moduleScript.src.split("/");Me.pop(),Ae.scriptDir=Me.join("/")+"/"}return Ae.debugModule("extern-post-js.c-pp.js sqlite3InitModuleState =",Ae),f})();var gr=cr;globalThis.sqlite3Worker1Promiser=function Je(Ae=Je.defaultConfig){if(arguments.length===1&&typeof arguments[0]=="function"){const he=Ae;Ae=Object.assign(Object.create(null),Je.defaultConfig),Ae.onready=he}else Ae=Object.assign(Object.create(null),Je.defaultConfig,Ae);const f=Object.create(null),Me=function(){},Qe=Ae.onerror||Me,Be=Ae.debug||Me,Ye=Ae.generateMessageId?void 0:Object.create(null),It=Ae.generateMessageId||function(he){return he.type+"#"+(Ye[he.type]=(Ye[he.type]||0)+1)},Pt=(...he)=>{throw new Error(he.join(" "))};Ae.worker||(Ae.worker=Je.defaultConfig.worker),typeof Ae.worker=="function"&&(Ae.worker=Ae.worker());let nt,ft;return Ae.worker.onmessage=function(he){he=he.data,Be("worker1.onmessage",he);let ie=f[he.messageId];if(!ie){if(he&&he.type==="sqlite3-api"&&he.result==="worker1-ready"){Ae.onready&&Ae.onready(ft);return}if(ie=f[he.type],ie&&ie.onrow){ie.onrow(he);return}Ae.onunhandled?Ae.onunhandled(arguments[0]):Qe("sqlite3Worker1Promiser() unhandled worker message:",he);return}switch(delete f[he.messageId],he.type){case"error":ie.reject(he);return;case"open":nt||(nt=he.dbId);break;case"close":he.dbId===nt&&(nt=void 0);break}try{ie.resolve(he)}catch(ae){ie.reject(ae)}},ft=function(){let he;arguments.length===1?he=arguments[0]:arguments.length===2?(he=Object.create(null),he.type=arguments[0],he.args=arguments[1],he.dbId=he.args.dbId):Pt("Invalid arguments for sqlite3Worker1Promiser()-created factory."),!he.dbId&&he.type!=="open"&&(he.dbId=nt),he.messageId=It(he),he.departureTime=performance.now();const ie=Object.create(null);ie.message=he;let ae;he.type==="exec"&&he.args&&(typeof he.args.callback=="function"?(ae=he.messageId+":row",ie.onrow=he.args.callback,he.args.callback=ae,f[ae]=ie):typeof he.args.callback=="string"&&Pt("exec callback may not be a string when using the Promise interface."));let pt=new Promise(function(ut,Tt){ie.resolve=ut,ie.reject=Tt,f[he.messageId]=ie,Be("Posting",he.type,"message to Worker dbId="+(nt||"default")+":",he),Ae.worker.postMessage(he)});return ae&&(pt=pt.finally(()=>delete f[ae])),pt}};globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL(""+new URL("sqlite3-worker1-slji4pXB.js",import.meta.url).href,import.meta.url),{type:"module"})},onerror:(...Je)=>console.error("sqlite3Worker1Promiser():",...Je)};globalThis.sqlite3Worker1Promiser.v2=(function Je(Ae=Je.defaultConfig){let f;typeof Ae=="function"?(f=Ae,Ae={}):typeof Ae?.onready=="function"&&(f=Ae.onready,delete Ae.onready);const Me=Object.create(null);Ae=Object.assign(Ae||Object.create(null),{onready:async function(Be){try{f&&await f(Be),Me.resolve(Be)}catch(Ye){Me.reject(Ye)}}});const Qe=new Promise(function(Be,Ye){Me.resolve=Be,Me.reject=Ye});try{this.original(Ae)}catch(Be){Me.reject(Be)}return Qe}).bind({original:sqlite3Worker1Promiser});globalThis.sqlite3Worker1Promiser.v2.defaultConfig=globalThis.sqlite3Worker1Promiser.defaultConfig;sqlite3Worker1Promiser.v2;delete globalThis.sqlite3Worker1Promiser;var mr=gr;await(async()=>{async function Je(){for(let f=0;f<3;f++)if(f>0&&await new Promise(Qe=>setTimeout(Qe,1e3)),await new Promise(Qe=>{navigator.locks.request("habitat-db",{ifAvailable:!0},Be=>Be?(Qe(!0),new Promise(()=>{})):(Qe(!1),Promise.resolve()))}))return!0;return!1}if(!await Je()){self.postMessage({type:"LOCK_UNAVAILABLE"});return}try{let f=function(){const c=[];lt.exec({sql:"PRAGMA user_version",rowMode:"object",callback:X=>c.push({...X})});let _=c[0]?.user_version??0;const m={11:[`CREATE TABLE IF NOT EXISTS bored_categories (
        id TEXT PRIMARY KEY, name TEXT NOT NULL,
        icon TEXT NOT NULL DEFAULT 'i-heroicons-sparkles',
        color TEXT NOT NULL DEFAULT '#6366f1',
        is_system INTEGER NOT NULL DEFAULT 0,
        sort_order INTEGER NOT NULL DEFAULT 0,
        created_at TEXT NOT NULL
      )`,`CREATE TABLE IF NOT EXISTS bored_activities (
        id TEXT PRIMARY KEY, title TEXT NOT NULL,
        description TEXT NOT NULL DEFAULT '',
        category_id TEXT NOT NULL REFERENCES bored_categories(id) ON DELETE CASCADE,
        estimated_minutes INTEGER, tags TEXT NOT NULL DEFAULT '[]',
        annotations TEXT NOT NULL DEFAULT '{}',
        is_recurring INTEGER NOT NULL DEFAULT 0, recurrence_rule TEXT,
        is_done INTEGER NOT NULL DEFAULT 0, done_at TEXT,
        done_count INTEGER NOT NULL DEFAULT 0, last_done_at TEXT,
        archived_at TEXT, created_at TEXT NOT NULL
      )`,"CREATE INDEX IF NOT EXISTS idx_bored_activities_category ON bored_activities(category_id)",`CREATE TABLE IF NOT EXISTS todos (
        id TEXT PRIMARY KEY, title TEXT NOT NULL,
        description TEXT NOT NULL DEFAULT '', due_date TEXT,
        priority TEXT NOT NULL DEFAULT 'medium', estimated_minutes INTEGER,
        is_done INTEGER NOT NULL DEFAULT 0, done_at TEXT,
        done_count INTEGER NOT NULL DEFAULT 0, last_done_at TEXT,
        tags TEXT NOT NULL DEFAULT '[]', annotations TEXT NOT NULL DEFAULT '{}',
        is_recurring INTEGER NOT NULL DEFAULT 0, recurrence_rule TEXT,
        show_in_bored INTEGER NOT NULL DEFAULT 0,
        bored_category_id TEXT REFERENCES bored_categories(id) ON DELETE SET NULL,
        archived_at TEXT, created_at TEXT NOT NULL, updated_at TEXT NOT NULL
      )`,"CREATE INDEX IF NOT EXISTS idx_todos_due_date ON todos(due_date)","CREATE INDEX IF NOT EXISTS idx_todos_is_done ON todos(is_done)"]};for(let X=_+1;X in m;X++){for(const ue of m[X])lt.exec(ue);lt.exec(`PRAGMA user_version = ${X}`),_=X}_===0&&lt.exec("PRAGMA user_version = 11")},Me=function(){const c=[{key:"checkin_template:morning_checkin",apply:()=>{const m=Lt({title:"Morning Check-in",schedule_type:"DAILY",days_active:null}),X=[{template_id:m.id,prompt:"How did you sleep?",response_type:"SCALE",display_order:0},{template_id:m.id,prompt:"How is your energy level right now?",response_type:"SCALE",display_order:1},{template_id:m.id,prompt:"What's your main intention for today?",response_type:"TEXT",display_order:2},{template_id:m.id,prompt:"Are you feeling anxious or stressed?",response_type:"BOOLEAN",display_order:3}];for(const ue of X)Ut(ue)}},{key:"checkin_template:evening_reflection",apply:()=>{const m=Lt({title:"Evening Reflection",schedule_type:"DAILY",days_active:null}),X=[{template_id:m.id,prompt:"Overall mood today (110)?",response_type:"SCALE",display_order:0},{template_id:m.id,prompt:"What went well today?",response_type:"TEXT",display_order:1},{template_id:m.id,prompt:"What could have gone better?",response_type:"TEXT",display_order:2},{template_id:m.id,prompt:"Did you complete your main intention?",response_type:"BOOLEAN",display_order:3}];for(const ue of X)Ut(ue)}},{key:"checkin_template:weekly_review",apply:()=>{const m=Lt({title:"Weekly Review",schedule_type:"WEEKLY",days_active:[0]}),X=[{template_id:m.id,prompt:"How would you rate this week overall (110)?",response_type:"SCALE",display_order:0},{template_id:m.id,prompt:"What were your biggest wins?",response_type:"TEXT",display_order:1},{template_id:m.id,prompt:"Which habit are you most proud of?",response_type:"TEXT",display_order:2},{template_id:m.id,prompt:"What will you focus on next week?",response_type:"TEXT",display_order:3}];for(const ue of X)Ut(ue)}},{key:"bored:cat:reading",apply:()=>{const m="bored-cat-reading",X=new Date().toISOString();ae("INSERT OR IGNORE INTO bored_categories (id,name,icon,color,is_system,sort_order,created_at) VALUES (?,?,?,?,?,?,?)",[m,"Things to Read","i-heroicons-book-open","#3b82f6",1,0,X]);const ue=[["Read 10 pages of current book","Pick up wherever you left off.",20],["Catch up on saved articles","Clear your reading list a bit.",15],["Wikipedia rabbit hole","Start on any topic and follow curiosity.",30]];for(const[de,be,je]of ue)ae("INSERT OR IGNORE INTO bored_activities (id,title,description,category_id,estimated_minutes,tags,annotations,is_recurring,is_done,done_count,created_at) VALUES (?,?,?,?,?,?,?,?,?,?,?)",[crypto.randomUUID(),de,be,m,je,"[]","{}",0,0,0,new Date().toISOString()])}},{key:"bored:cat:chores",apply:()=>{const m="bored-cat-chores",X=new Date().toISOString();ae("INSERT OR IGNORE INTO bored_categories (id,name,icon,color,is_system,sort_order,created_at) VALUES (?,?,?,?,?,?,?)",[m,"Chores","i-heroicons-home","#f59e0b",1,1,X]);const ue=[["Clean one small area","A drawer, a shelf, a corner  pick one.",15],["Do laundry","Throw in a load or fold what's waiting.",45],["Organize one drawer","Just one. It always feels satisfying.",20]];for(const[de,be,je]of ue)ae("INSERT OR IGNORE INTO bored_activities (id,title,description,category_id,estimated_minutes,tags,annotations,is_recurring,is_done,done_count,created_at) VALUES (?,?,?,?,?,?,?,?,?,?,?)",[crypto.randomUUID(),de,be,m,je,"[]","{}",0,0,0,new Date().toISOString()])}},{key:"bored:cat:contacts",apply:()=>{const m="bored-cat-contacts",X=new Date().toISOString();ae("INSERT OR IGNORE INTO bored_categories (id,name,icon,color,is_system,sort_order,created_at) VALUES (?,?,?,?,?,?,?)",[m,"People to Contact","i-heroicons-chat-bubble-left","#10b981",1,2,X]);const ue=[["Text a friend you haven't spoken to lately",'A simple "hey, how are you?" goes a long way.',5],["Send an appreciation message","Tell someone you appreciate them.",5],["Catch up with family","Call or message a family member.",15]];for(const[de,be,je]of ue)ae("INSERT OR IGNORE INTO bored_activities (id,title,description,category_id,estimated_minutes,tags,annotations,is_recurring,is_done,done_count,created_at) VALUES (?,?,?,?,?,?,?,?,?,?,?)",[crypto.randomUUID(),de,be,m,je,"[]","{}",0,0,0,new Date().toISOString()])}},{key:"bored:cat:learning",apply:()=>{const m="bored-cat-learning",X=new Date().toISOString();ae("INSERT OR IGNORE INTO bored_categories (id,name,icon,color,is_system,sort_order,created_at) VALUES (?,?,?,?,?,?,?)",[m,"Things to Learn","i-heroicons-academic-cap","#8b5cf6",1,3,X]);const ue=[["Watch a YouTube tutorial","Pick a skill you've been curious about.",20],["Practice a skill for 15 min","Music, language, coding  whatever you're building.",15],["Read documentation or a how-to","Level up something you already use.",20]];for(const[de,be,je]of ue)ae("INSERT OR IGNORE INTO bored_activities (id,title,description,category_id,estimated_minutes,tags,annotations,is_recurring,is_done,done_count,created_at) VALUES (?,?,?,?,?,?,?,?,?,?,?)",[crypto.randomUUID(),de,be,m,je,"[]","{}",0,0,0,new Date().toISOString()])}},{key:"bored:cat:idle",apply:()=>{const m="bored-cat-idle",X=new Date().toISOString();ae("INSERT OR IGNORE INTO bored_categories (id,name,icon,color,is_system,sort_order,created_at) VALUES (?,?,?,?,?,?,?)",[m,"Idle Quests","i-heroicons-sparkles","#f97316",1,4,X]);const ue=[["Take a 10-min walk","No destination needed. Just move.",10],["Stretch or light yoga","Even 5 minutes resets the body.",10],["Doodle without overthinking","Pen and paper, no expectations.",15],["Listen to a new album","Pick something outside your usual taste.",30]];for(const[de,be,je]of ue)ae("INSERT OR IGNORE INTO bored_activities (id,title,description,category_id,estimated_minutes,tags,annotations,is_recurring,is_done,done_count,created_at) VALUES (?,?,?,?,?,?,?,?,?,?,?)",[crypto.randomUUID(),de,be,m,je,"[]","{}",0,0,0,new Date().toISOString()])}}],_=new Date().toISOString();for(const{key:m,apply:X}of c)ie("SELECT key FROM applied_defaults WHERE key = ?",[m]).length===0&&(X(),ae("INSERT INTO applied_defaults (key, applied_at) VALUES (?,?)",[m,_]))},Qe=function(){const c=Vt.wasm,_=Vt.capi,m=c.pstack.pointer;try{const X=c.pstack.alloc(8),ue=_.sqlite3_serialize(lt.pointer,"main",X,0);if(!ue)throw new Error("sqlite3_serialize returned null");const de=Number(c.peek(X,"i64")),be=new Uint8Array(de);return be.set(c.heap8u().subarray(ue,ue+de)),_.sqlite3_free(ue),be}finally{c.pstack.restore(m)}},Be=function(c){const _=c.habits?ie("SELECT * FROM habits ORDER BY created_at ASC").map(pt):[],m=c.completions?et():[],X=c.habit_logs?ie("SELECT * FROM habit_logs ORDER BY logged_at ASC").map(Ve):[],ue=c.habit_schedules?ie("SELECT * FROM habit_schedules").map(Tt):[],de=c.reminders?Ne():[],be=c.checkin_templates?Wt():[],je=c.checkin_questions?ie("SELECT * FROM checkin_questions ORDER BY template_id, display_order").map(ht):[],bt=c.checkin_responses?ie("SELECT * FROM checkin_responses ORDER BY logged_date ASC").map(wt):[],ct=c.checkin_reminders?Rt():[],ir=c.scribbles?tn():[],sr=c.checkin_entries?ie("SELECT * FROM checkin_entries ORDER BY entry_date ASC").map(at):[],or=c.bored_categories?ie("SELECT * FROM bored_categories ORDER BY sort_order ASC").map(rt):[],ar=c.bored_activities?ie("SELECT * FROM bored_activities ORDER BY created_at ASC").map(dt):[],cn=c.todos?ie("SELECT * FROM todos ORDER BY created_at ASC").map(Et):[];return{version:1,exported_at:new Date().toISOString(),habits:_,completions:m,habit_logs:X,habit_schedules:ue,reminders:de,checkin_templates:be,checkin_questions:je,checkin_responses:bt,checkin_reminders:ct,scribbles:ir,checkin_entries:sr,bored_categories:or,bored_activities:ar,todos:cn}},Ye=function(c){for(const _ of c.habits??[])ae(`INSERT OR IGNORE INTO habits
         (id, name, description, color, icon, frequency, created_at, archived_at, tags, annotations, type, target_value, paused_until)
       VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?)`,[_.id,_.name,_.description,_.color,_.icon,_.frequency,_.created_at,_.archived_at??null,JSON.stringify(_.tags??[]),JSON.stringify(_.annotations??{}),_.type??"BOOLEAN",_.target_value??1,_.paused_until??null]);for(const _ of c.completions??[])ae(`INSERT OR IGNORE INTO completions (id, habit_id, date, completed_at, notes, tags, annotations)
       VALUES (?,?,?,?,?,?,?)`,[_.id,_.habit_id,_.date,_.completed_at,_.notes??"",JSON.stringify(_.tags??[]),JSON.stringify(_.annotations??{})]);for(const _ of c.habit_logs??[])ae(`INSERT OR IGNORE INTO habit_logs (id, habit_id, date, logged_at, value, notes)
       VALUES (?,?,?,?,?,?)`,[_.id,_.habit_id,_.date,_.logged_at,_.value,_.notes??""]);for(const _ of c.habit_schedules??[])ae(`INSERT OR IGNORE INTO habit_schedules
         (id, habit_id, schedule_type, frequency_count, days_of_week, due_time, start_date, end_date)
       VALUES (?,?,?,?,?,?,?,?)`,[_.id,_.habit_id,_.schedule_type??"DAILY",_.frequency_count??null,_.days_of_week!=null?JSON.stringify(_.days_of_week):null,_.due_time??null,_.start_date??null,_.end_date??null]);for(const _ of c.reminders??[])ae("INSERT OR IGNORE INTO reminders (id, habit_id, trigger_time, days_active) VALUES (?,?,?,?)",[_.id,_.habit_id,_.trigger_time,_.days_active!=null?JSON.stringify(_.days_active):null])},It=function(c){for(const _ of c.checkin_templates??[])ae("INSERT OR IGNORE INTO checkin_templates (id, title, schedule_type, days_active) VALUES (?,?,?,?)",[_.id,_.title,_.schedule_type??"DAILY",_.days_active!=null?JSON.stringify(_.days_active):null]);for(const _ of c.checkin_questions??[])ae(`INSERT OR IGNORE INTO checkin_questions (id, template_id, prompt, response_type, display_order)
       VALUES (?,?,?,?,?)`,[_.id,_.template_id,_.prompt,_.response_type??"TEXT",_.display_order??0]);for(const _ of c.checkin_responses??[])ae(`INSERT OR IGNORE INTO checkin_responses (id, question_id, logged_date, value_numeric, value_text)
       VALUES (?,?,?,?,?)`,[_.id,_.question_id,_.logged_date,_.value_numeric??null,_.value_text??null]);for(const _ of c.checkin_reminders??[])ae("INSERT OR IGNORE INTO checkin_reminders (id, template_id, trigger_time, days_active) VALUES (?,?,?,?)",[_.id,_.template_id,_.trigger_time,_.days_active!=null?JSON.stringify(_.days_active):null])},Pt=function(c){for(const _ of c.scribbles??[])ae(`INSERT OR IGNORE INTO scribbles (id, title, content, tags, annotations, created_at, updated_at)
       VALUES (?,?,?,?,?,?,?)`,[_.id,_.title??"",_.content??"",JSON.stringify(_.tags??[]),JSON.stringify(_.annotations??{}),_.created_at,_.updated_at]);for(const _ of c.checkin_entries??[])ae(`INSERT OR IGNORE INTO checkin_entries (id, entry_date, content, created_at, updated_at)
       VALUES (?,?,?,?,?)`,[_.id,_.entry_date,_.content??"",_.created_at,_.updated_at]);for(const _ of c.bored_categories??[])ae(`INSERT OR IGNORE INTO bored_categories (id,name,icon,color,is_system,sort_order,created_at)
       VALUES (?,?,?,?,?,?,?)`,[_.id,_.name,_.icon,_.color,_.is_system?1:0,_.sort_order,_.created_at]);for(const _ of c.bored_activities??[])ae(`INSERT OR IGNORE INTO bored_activities
         (id,title,description,category_id,estimated_minutes,tags,annotations,
          is_recurring,recurrence_rule,is_done,done_at,done_count,last_done_at,archived_at,created_at)
       VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)`,[_.id,_.title,_.description,_.category_id,_.estimated_minutes??null,JSON.stringify(_.tags??[]),JSON.stringify(_.annotations??{}),_.is_recurring?1:0,_.recurrence_rule??null,_.is_done?1:0,_.done_at??null,_.done_count??0,_.last_done_at??null,_.archived_at??null,_.created_at]);for(const _ of c.todos??[])ae(`INSERT OR IGNORE INTO todos
         (id,title,description,due_date,priority,estimated_minutes,is_done,done_at,
          done_count,last_done_at,tags,annotations,is_recurring,recurrence_rule,
          show_in_bored,bored_category_id,archived_at,created_at,updated_at)
       VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)`,[_.id,_.title,_.description,_.due_date??null,_.priority??"medium",_.estimated_minutes??null,_.is_done?1:0,_.done_at??null,_.done_count??0,_.last_done_at??null,JSON.stringify(_.tags??[]),JSON.stringify(_.annotations??{}),_.is_recurring?1:0,_.recurrence_rule??null,_.show_in_bored?1:0,_.bored_category_id??null,_.archived_at??null,_.created_at,_.updated_at])},nt=function(c){ae("BEGIN");try{return Ye(c),It(c),Pt(c),ae("COMMIT"),null}catch(_){throw ae("ROLLBACK"),_}},ft=function(c){if(c.version===1)return nt(c);throw new Error(`Unsupported export version: ${String(c.version)}`)},he=function(c,_){if(c==null)return _;try{return JSON.parse(c)}catch{return console.warn("[db] JSON.parse failed for column value:",c),_}},ie=function(c,_){const m=[];return lt.exec({sql:c,..._!==void 0&&{bind:_},rowMode:"object",callback:X=>m.push({...X})}),m},ae=function(c,_){lt.exec({sql:c,..._!==void 0&&{bind:_}})},pt=function(c){return{id:c.id,name:c.name,description:c.description,color:c.color,icon:c.icon,frequency:c.frequency,created_at:c.created_at,archived_at:c.archived_at??null,tags:he(c.tags,[]),annotations:he(c.annotations,{}),type:c.type??"BOOLEAN",target_value:c.target_value??1,paused_until:c.paused_until??null}},ut=function(c){const _=pt(c),m=c.sched_id;return m?{..._,schedule:{id:m,habit_id:_.id,schedule_type:c.schedule_type??"DAILY",frequency_count:c.frequency_count!=null?c.frequency_count:null,days_of_week:he(c.days_of_week,null),due_time:c.due_time??null,start_date:c.start_date??null,end_date:c.end_date??null}}:{..._,schedule:null}},Tt=function(c){return{id:c.id,habit_id:c.habit_id,schedule_type:c.schedule_type??"DAILY",frequency_count:c.frequency_count!=null?c.frequency_count:null,days_of_week:c.days_of_week!=null?JSON.parse(c.days_of_week):null,due_time:c.due_time??null,start_date:c.start_date??null,end_date:c.end_date??null}},Ve=function(c){return{id:c.id,habit_id:c.habit_id,date:c.date,logged_at:c.logged_at,value:c.value,notes:c.notes??""}},Ze=function(c){return{id:c.id,habit_id:c.habit_id,date:c.date,completed_at:c.completed_at,notes:c.notes,tags:he(c.tags,[]),annotations:he(c.annotations,{})}},Ot=function(){return ie(`${Ct} WHERE h.archived_at IS NULL ORDER BY h.created_at ASC`).map(ut)},Fe=function(c){const _=crypto.randomUUID(),m=crypto.randomUUID(),X=new Date().toISOString();return ae(`INSERT INTO habits
       (id, name, description, color, icon, frequency, created_at, tags, annotations,
        type, target_value, paused_until)
     VALUES (?,?,?,?,?,?,?,?,?,?,?,?)`,[_,c.name,c.description,c.color,c.icon,c.frequency,X,JSON.stringify(c.tags??[]),JSON.stringify(c.annotations??{}),c.type??"BOOLEAN",c.target_value??1,c.paused_until??null]),ae(`INSERT INTO habit_schedules
       (id, habit_id, schedule_type, frequency_count, days_of_week, due_time, start_date, end_date)
     VALUES (?,?,?,?,?,?,?,?)`,[m,_,"DAILY",null,null,null,X.slice(0,10),null]),ut(ie(`${Ct} WHERE h.id = ?`,[_])[0])},Pe=function(c){const{id:_,...m}=c,X=[],ue=["name","description","color","icon","frequency","type","target_value"];for(const de of ue)de in m&&X.push([de,m[de]]);if("paused_until"in m&&X.push(["paused_until",m.paused_until??null]),"tags"in m&&X.push(["tags",JSON.stringify(m.tags??[])]),"annotations"in m&&X.push(["annotations",JSON.stringify(m.annotations??{})]),X.length>0){const de=X.map(([be])=>`${be} = ?`).join(", ");ae(`UPDATE habits SET ${de} WHERE id = ?`,[...X.map(([,be])=>be),_])}return ut(ie(`${Ct} WHERE h.id = ?`,[_])[0])},Ge=function(c){return ae("UPDATE habits SET archived_at = ? WHERE id = ?",[new Date().toISOString(),c]),null},Xt=function(c){return ae("DELETE FROM habits WHERE id = ?",[c]),null},Jt=function(c){return ie("SELECT * FROM completions WHERE date = ? ORDER BY completed_at ASC",[c]).map(Ze)},dn=function(c,_,m){return ie("SELECT * FROM completions WHERE habit_id = ? AND date >= ? AND date <= ? ORDER BY date ASC",[c,_,m]).map(Ze)},fn=function(c,_){return ie("SELECT * FROM completions WHERE date >= ? AND date <= ? ORDER BY date ASC",[c,_]).map(Ze)},pn=function(c,_,m=[],X={}){if(ie("SELECT * FROM completions WHERE habit_id = ? AND date = ?",[c,_]).length>0)return ae("DELETE FROM completions WHERE habit_id = ? AND date = ?",[c,_]),null;const de=crypto.randomUUID(),be=new Date().toISOString();return ae(`INSERT INTO completions (id, habit_id, date, completed_at, notes, tags, annotations)
     VALUES (?,?,?,?,?,?,?)`,[de,c,_,be,"",JSON.stringify(m),JSON.stringify(X)]),Ze(ie("SELECT * FROM completions WHERE id = ?",[de])[0])},hn=function(){return ie(`${Ct} WHERE h.archived_at IS NOT NULL ORDER BY h.archived_at DESC`).map(ut)},et=function(){return ie("SELECT * FROM completions ORDER BY date DESC").map(Ze)},Bt=function(){return ae("DELETE FROM habits"),null},gn=function(){return ae("DELETE FROM checkin_entries"),null},mn=function(){return ae("DELETE FROM checkin_templates"),null},En=function(){return ae("DELETE FROM scribbles"),null},bn=function(){return ae("DELETE FROM applied_defaults"),null},yn=function(c){return ie("SELECT 1 FROM applied_defaults WHERE key = ?",[c]).length>0},Tn=function(c){return ae("INSERT OR IGNORE INTO applied_defaults (key, applied_at) VALUES (?, ?)",[c,new Date().toISOString()]),null},Sn=function(){return ie("PRAGMA integrity_check").map(c=>String(c.integrity_check??""))},$t=function(){const _=ie("PRAGMA user_version")[0]?.user_version??0,m=ie("SELECT name, sql FROM sqlite_master WHERE type = 'table' ORDER BY name"),X=ie("SELECT name, tbl_name, sql FROM sqlite_master WHERE type = 'index' AND sql IS NOT NULL ORDER BY tbl_name, name");return{userVersion:_,tables:m.map(ue=>({name:String(ue.name),sql:String(ue.sql??"")})),indices:X.map(ue=>({name:String(ue.name),tbl_name:String(ue.tbl_name),sql:String(ue.sql??"")}))}},xt=function(c){if(c.length===0)return{current:0,longest:0};const _=new Date().toISOString().slice(0,10);let m=0,X=_;for(const bt of c)if(bt===X){m++;const ct=new Date(X);ct.setDate(ct.getDate()-1),X=ct.toISOString().slice(0,10)}else if(bt<X)break;const ue=[...c].reverse();let de=0,be=0,je=null;for(const bt of ue){if(je===null)be=1;else{const ct=new Date(je);ct.setDate(ct.getDate()+1),be=bt===ct.toISOString().slice(0,10)?be+1:1}de=Math.max(de,be),je=bt}return{current:m,longest:de}},qn=function(c){const _=ie("SELECT type, target_value FROM habits WHERE id = ?",[c])[0];if(!_)return{current:0,longest:0};const m=_.type??"BOOLEAN",X=_.target_value??1;if(m==="BOOLEAN"){const de=ie("SELECT date FROM completions WHERE habit_id = ? ORDER BY date DESC",[c]).map(be=>be.date);return xt(de)}if(m==="NUMERIC"){const de=ie("SELECT date FROM habit_logs WHERE habit_id = ? GROUP BY date HAVING SUM(value) >= ? ORDER BY date DESC",[c,X]).map(be=>be.date);return xt(de)}const ue=ie("SELECT date FROM habit_logs WHERE habit_id = ? GROUP BY date HAVING SUM(value) < ? ORDER BY date DESC",[c,X]).map(de=>de.date);return xt(ue)},Kt=function(c){return ie("SELECT * FROM habit_logs WHERE date = ? ORDER BY logged_at ASC",[c]).map(Ve)},vn=function(c,_,m){return ie("SELECT * FROM habit_logs WHERE habit_id = ? AND date >= ? AND date <= ? ORDER BY date ASC",[c,_,m]).map(Ve)},ot=function(c,_){return ie("SELECT * FROM habit_logs WHERE date >= ? AND date <= ? ORDER BY date ASC",[c,_]).map(Ve)},Ce=function(c,_,m,X=""){const ue=crypto.randomUUID(),de=new Date().toISOString();return ae("INSERT INTO habit_logs (id, habit_id, date, logged_at, value, notes) VALUES (?,?,?,?,?,?)",[ue,c,_,de,m,X]),Ve(ie("SELECT * FROM habit_logs WHERE id = ?",[ue])[0])},An=function(c){return ae("DELETE FROM habit_logs WHERE id = ?",[c]),null},Yt=function(c){const _=ie("SELECT * FROM habit_schedules WHERE habit_id = ?",[c]);return _.length>0?Tt(_[0]):null},St=function(c){const{id:_,...m}=c,X=[],ue=["schedule_type","frequency_count","due_time","start_date","end_date"];for(const de of ue)de in m&&X.push([de,m[de]??null]);if("days_of_week"in m&&X.push(["days_of_week",m.days_of_week!=null?JSON.stringify(m.days_of_week):null]),X.length>0){const de=X.map(([be])=>`${be} = ?`).join(", ");ae(`UPDATE habit_schedules SET ${de} WHERE id = ?`,[...X.map(([,be])=>be),_])}return Tt(ie("SELECT * FROM habit_schedules WHERE id = ?",[_])[0])},Zt=function(c,_){return ae("UPDATE habits SET paused_until = ? WHERE id = ?",[_,c]),ut(ie(`${Ct} WHERE h.id = ?`,[c])[0])},en=function(c){return ae("UPDATE habits SET paused_until = ? WHERE archived_at IS NULL",[c]),null},at=function(c){return{id:c.id,entry_date:c.entry_date,content:c.content??"",created_at:c.created_at,updated_at:c.updated_at}},qt=function(c){return{id:c.id,title:c.title,schedule_type:c.schedule_type??"DAILY",days_active:he(c.days_active,null)}},ht=function(c){return{id:c.id,template_id:c.template_id,prompt:c.prompt,response_type:c.response_type??"TEXT",display_order:c.display_order??0}},wt=function(c){return{id:c.id,question_id:c.question_id,logged_date:c.logged_date,value_numeric:c.value_numeric!=null?c.value_numeric:null,value_text:c.value_text!=null?c.value_text:null}},jt=function(c){const _=ie("SELECT * FROM checkin_entries WHERE entry_date = ?",[c]);return _.length>0?at(_[0]):null},In=function(c,_){const m=new Date().toISOString(),X=ie("SELECT id FROM checkin_entries WHERE entry_date = ?",[c]);if(X.length>0){const de=X[0].id;return ae("UPDATE checkin_entries SET content = ?, updated_at = ? WHERE id = ?",[_,m,de]),at(ie("SELECT * FROM checkin_entries WHERE id = ?",[de])[0])}const ue=crypto.randomUUID();return ae("INSERT INTO checkin_entries (id, entry_date, content, created_at, updated_at) VALUES (?,?,?,?,?)",[ue,c,_,m,m]),at(ie("SELECT * FROM checkin_entries WHERE id = ?",[ue])[0])},gt=function(c){return ae("DELETE FROM checkin_entries WHERE id = ?",[c]),null},On=function(c,_){return ie("SELECT * FROM checkin_entries WHERE entry_date >= ? AND entry_date <= ? ORDER BY entry_date DESC",[c,_]).map(at)},Wt=function(){return ie("SELECT * FROM checkin_templates ORDER BY title ASC").map(qt)},Lt=function(c){const _=crypto.randomUUID();return ae("INSERT INTO checkin_templates (id, title, schedule_type, days_active) VALUES (?,?,?,?)",[_,c.title,c.schedule_type??"DAILY",c.days_active!=null?JSON.stringify(c.days_active):null]),qt(ie("SELECT * FROM checkin_templates WHERE id = ?",[_])[0])},Oe=function(c){const{id:_,...m}=c,X=[];if("title"in m&&X.push(["title",m.title]),"schedule_type"in m&&X.push(["schedule_type",m.schedule_type]),"days_active"in m&&X.push(["days_active",m.days_active!=null?JSON.stringify(m.days_active):null]),X.length>0){const ue=X.map(([de])=>`${de} = ?`).join(", ");ae(`UPDATE checkin_templates SET ${ue} WHERE id = ?`,[...X.map(([,de])=>de),_])}return qt(ie("SELECT * FROM checkin_templates WHERE id = ?",[_])[0])},wn=function(c){return ae("DELETE FROM checkin_templates WHERE id = ?",[c]),null},Ht=function(c){return ie("SELECT * FROM checkin_questions WHERE template_id = ? ORDER BY display_order ASC",[c]).map(ht)},Ut=function(c){const _=crypto.randomUUID();return ae("INSERT INTO checkin_questions (id, template_id, prompt, response_type, display_order) VALUES (?,?,?,?,?)",[_,c.template_id,c.prompt,c.response_type??"TEXT",c.display_order??0]),ht(ie("SELECT * FROM checkin_questions WHERE id = ?",[_])[0])},Ln=function(c){const{id:_,...m}=c,X=[];if("prompt"in m&&X.push(["prompt",m.prompt]),"response_type"in m&&X.push(["response_type",m.response_type]),"display_order"in m&&X.push(["display_order",m.display_order]),X.length>0){const ue=X.map(([de])=>`${de} = ?`).join(", ");ae(`UPDATE checkin_questions SET ${ue} WHERE id = ?`,[...X.map(([,de])=>de),_])}return ht(ie("SELECT * FROM checkin_questions WHERE id = ?",[_])[0])},mt=function(c){return ae("DELETE FROM checkin_questions WHERE id = ?",[c]),null},kt=function(c,_){return ie(`SELECT cr.* FROM checkin_responses cr
     JOIN checkin_questions cq ON cq.id = cr.question_id
     WHERE cq.template_id = ? AND cr.logged_date = ?
     ORDER BY cq.display_order ASC`,[c,_]).map(wt)},kn=function(c,_,m,X){const ue=ie("SELECT id FROM checkin_responses WHERE question_id = ? AND logged_date = ?",[c,_]);if(ue.length>0){const be=ue[0].id;return ae("UPDATE checkin_responses SET value_numeric = ?, value_text = ? WHERE id = ?",[m,X,be]),wt(ie("SELECT * FROM checkin_responses WHERE id = ?",[be])[0])}const de=crypto.randomUUID();return ae("INSERT INTO checkin_responses (id, question_id, logged_date, value_numeric, value_text) VALUES (?,?,?,?,?)",[de,c,_,m,X]),wt(ie("SELECT * FROM checkin_responses WHERE id = ?",[de])[0])},Nn=function(c){return ae("DELETE FROM checkin_responses WHERE id = ?",[c]),null},Nt=function(c){return{id:c.id,title:c.title??"",content:c.content??"",tags:he(c.tags,[]),annotations:he(c.annotations,{}),created_at:c.created_at,updated_at:c.updated_at}},tn=function(){return ie("SELECT * FROM scribbles ORDER BY updated_at DESC").map(Nt)},nn=function(c){const _=crypto.randomUUID(),m=new Date().toISOString();return ae(`INSERT INTO scribbles (id, title, content, tags, annotations, created_at, updated_at)
     VALUES (?,?,?,?,?,?,?)`,[_,c.title??"",c.content??"",JSON.stringify(c.tags??[]),JSON.stringify(c.annotations??{}),m,m]),Nt(ie("SELECT * FROM scribbles WHERE id = ?",[_])[0])},Rn=function(c){const{id:_,...m}=c,ue=[["updated_at",new Date().toISOString()]];"title"in m&&ue.push(["title",m.title??""]),"content"in m&&ue.push(["content",m.content??""]),"tags"in m&&ue.push(["tags",JSON.stringify(m.tags??[])]),"annotations"in m&&ue.push(["annotations",JSON.stringify(m.annotations??{})]);const de=ue.map(([be])=>`${be} = ?`).join(", ");return ae(`UPDATE scribbles SET ${de} WHERE id = ?`,[...ue.map(([,be])=>be),_]),Nt(ie("SELECT * FROM scribbles WHERE id = ?",[_])[0])},l=function(c){return ae("DELETE FROM scribbles WHERE id = ?",[c]),null},zt=function(c){return{id:c.id,habit_id:c.habit_id,trigger_time:c.trigger_time,days_active:he(c.days_active,null)}},Ne=function(){return ie("SELECT * FROM reminders ORDER BY trigger_time ASC").map(zt)},Fn=function(c){return ie("SELECT * FROM reminders WHERE habit_id = ? ORDER BY trigger_time ASC",[c]).map(zt)},Cn=function(c,_,m){const X=crypto.randomUUID();return ae("INSERT INTO reminders (id, habit_id, trigger_time, days_active) VALUES (?,?,?,?)",[X,c,_,m!=null?JSON.stringify(m):null]),zt(ie("SELECT * FROM reminders WHERE id = ?",[X])[0])},Dn=function(c){return ae("DELETE FROM reminders WHERE id = ?",[c]),null},Qt=function(c){return{id:c.id,template_id:c.template_id,trigger_time:c.trigger_time,days_active:he(c.days_active,null)}},Rt=function(){return ie("SELECT * FROM checkin_reminders ORDER BY trigger_time ASC").map(Qt)},vt=function(c){return ie("SELECT * FROM checkin_reminders WHERE template_id = ? ORDER BY trigger_time ASC",[c]).map(Qt)},Pn=function(c,_,m){const X=crypto.randomUUID();return ae("INSERT INTO checkin_reminders (id, template_id, trigger_time, days_active) VALUES (?,?,?,?)",[X,c,_,m!=null?JSON.stringify(m):null]),Qt(ie("SELECT * FROM checkin_reminders WHERE id = ?",[X])[0])},xn=function(c){return ae("DELETE FROM checkin_reminders WHERE id = ?",[c]),null},Un=function(c){const _=ie("SELECT * FROM checkin_templates WHERE id = ?",[c]);return _.length>0?qt(_[0]):null},Mn=function(c){return ie(`SELECT ct.id as template_id, ct.title, COUNT(cr.id) as response_count
     FROM checkin_templates ct
     JOIN checkin_questions cq ON cq.template_id = ct.id
     JOIN checkin_responses cr ON cr.question_id = cq.id
     WHERE cr.logged_date = ?
     GROUP BY ct.id, ct.title
     ORDER BY ct.title`,[c]).map(_=>({template_id:_.template_id,title:_.title,response_count:_.response_count}))},Ft=function(c){return ie("SELECT * FROM scribbles WHERE updated_at LIKE ? ORDER BY updated_at DESC",[`${c}%`]).map(Nt)},Bn=function(){return ie("SELECT logged_date as date, COUNT(*) as count FROM checkin_responses GROUP BY logged_date ORDER BY logged_date DESC").map(c=>({date:c.date,count:c.count}))},rt=function(c){return{id:c.id,name:c.name,icon:c.icon,color:c.color,is_system:!!c.is_system,sort_order:c.sort_order??0,created_at:c.created_at}},dt=function(c){return{id:c.id,title:c.title,description:c.description??"",category_id:c.category_id,estimated_minutes:c.estimated_minutes!=null?c.estimated_minutes:null,tags:he(c.tags,[]),annotations:he(c.annotations,{}),is_recurring:!!c.is_recurring,recurrence_rule:c.recurrence_rule??null,is_done:!!c.is_done,done_at:c.done_at??null,done_count:c.done_count??0,last_done_at:c.last_done_at??null,archived_at:c.archived_at??null,created_at:c.created_at}},Et=function(c){return{id:c.id,title:c.title,description:c.description??"",due_date:c.due_date??null,priority:c.priority??"medium",estimated_minutes:c.estimated_minutes!=null?c.estimated_minutes:null,is_done:!!c.is_done,done_at:c.done_at??null,done_count:c.done_count??0,last_done_at:c.last_done_at??null,tags:he(c.tags,[]),annotations:he(c.annotations,{}),is_recurring:!!c.is_recurring,recurrence_rule:c.recurrence_rule??null,show_in_bored:!!c.show_in_bored,bored_category_id:c.bored_category_id??null,archived_at:c.archived_at??null,created_at:c.created_at,updated_at:c.updated_at}},rn=function(){return ie("SELECT * FROM bored_categories ORDER BY is_system DESC, sort_order ASC, created_at ASC").map(rt)},jn=function(c){const _=crypto.randomUUID(),m=new Date().toISOString();return ae("INSERT INTO bored_categories (id,name,icon,color,is_system,sort_order,created_at) VALUES (?,?,?,?,?,?,?)",[_,c.name,c.icon,c.color,c.is_system?1:0,c.sort_order,m]),rt(ie("SELECT * FROM bored_categories WHERE id = ?",[_])[0])},Wn=function(c){const{id:_,...m}=c,X=[];for(const ue of["name","icon","color","sort_order"])ue in m&&X.push([ue,m[ue]]);if(X.length>0){const ue=X.map(([de])=>`${de} = ?`).join(", ");ae(`UPDATE bored_categories SET ${ue} WHERE id = ?`,[...X.map(([,de])=>de),_])}return rt(ie("SELECT * FROM bored_categories WHERE id = ?",[_])[0])},Hn=function(c){return ae("DELETE FROM bored_categories WHERE id = ? AND is_system = 0",[c]),null},zn=function(){return ie("SELECT * FROM bored_activities WHERE archived_at IS NULL ORDER BY created_at ASC").map(dt)},Qn=function(c){return ie("SELECT * FROM bored_activities WHERE category_id = ? AND archived_at IS NULL ORDER BY created_at ASC",[c]).map(dt)},Vn=function(c){const _=crypto.randomUUID(),m=new Date().toISOString();return ae(`INSERT INTO bored_activities
       (id,title,description,category_id,estimated_minutes,tags,annotations,is_recurring,recurrence_rule,is_done,done_count,created_at)
     VALUES (?,?,?,?,?,?,?,?,?,0,0,?)`,[_,c.title,c.description,c.category_id,c.estimated_minutes??null,JSON.stringify(c.tags??[]),JSON.stringify(c.annotations??{}),c.is_recurring?1:0,c.recurrence_rule??null,m]),dt(ie("SELECT * FROM bored_activities WHERE id = ?",[_])[0])},Gn=function(c){const{id:_,...m}=c,X=[];for(const ue of["title","description","category_id","estimated_minutes","is_recurring","recurrence_rule"])ue in m&&(ue==="is_recurring"?X.push([ue,m[ue]?1:0]):X.push([ue,m[ue]??null]));if("tags"in m&&X.push(["tags",JSON.stringify(m.tags??[])]),"annotations"in m&&X.push(["annotations",JSON.stringify(m.annotations??{})]),X.length>0){const ue=X.map(([de])=>`${de} = ?`).join(", ");ae(`UPDATE bored_activities SET ${ue} WHERE id = ?`,[...X.map(([,de])=>de),_])}return dt(ie("SELECT * FROM bored_activities WHERE id = ?",[_])[0])},sn=function(c){return ae("DELETE FROM bored_activities WHERE id = ?",[c]),null},Xn=function(c){return ae("UPDATE bored_activities SET archived_at = ? WHERE id = ?",[new Date().toISOString(),c]),null},Jn=function(c){const _=ie("SELECT * FROM bored_activities WHERE id = ?",[c]);if(_.length===0)throw new Error(`BoredActivity not found: ${c}`);const m=dt(_[0]),X=new Date().toISOString();return m.is_recurring?ae("UPDATE bored_activities SET done_count = done_count + 1, last_done_at = ? WHERE id = ?",[X,c]):ae("UPDATE bored_activities SET is_done = 1, done_at = ?, done_count = done_count + 1, last_done_at = ? WHERE id = ?",[X,X,c]),dt(ie("SELECT * FROM bored_activities WHERE id = ?",[c])[0])},$n=function(c,_){const m=new Date(c);return _==="daily"?m.setDate(m.getDate()+1):_==="weekly"?m.setDate(m.getDate()+7):_==="monthly"&&m.setMonth(m.getMonth()+1),m.toISOString().slice(0,10)},Kn=function(c,_){const m=ie(`SELECT * FROM bored_activities
     WHERE archived_at IS NULL AND (is_done = 0 OR is_recurring = 1)`).map(dt).filter(be=>!(c.includes(be.category_id)||_!=null&&be.estimated_minutes!=null&&be.estimated_minutes>_)),X=ie("SELECT * FROM todos WHERE show_in_bored = 1 AND is_done = 0 AND archived_at IS NULL").map(Et).filter(be=>!(be.bored_category_id&&c.includes(be.bored_category_id)||_!=null&&be.estimated_minutes!=null&&be.estimated_minutes>_)),ue=[],de=new Map(rn().map(be=>[be.id,be]));for(const be of m){const je=de.get(be.category_id);je&&ue.push({source:"activity",activity:be,category:je})}for(const be of X){const je=be.bored_category_id?de.get(be.bored_category_id)??null:null;ue.push({source:"todo",todo:be,category:je})}return ue.length===0?null:ue[Math.floor(Math.random()*ue.length)]},Yn=function(){return ae("DELETE FROM bored_activities"),ae("DELETE FROM bored_categories WHERE is_system = 0"),null},Zn=function(){return ie("SELECT * FROM todos WHERE archived_at IS NULL ORDER BY created_at ASC").map(Et)},er=function(c){const _=crypto.randomUUID(),m=new Date().toISOString();return ae(`INSERT INTO todos
       (id,title,description,due_date,priority,estimated_minutes,is_done,done_count,
        tags,annotations,is_recurring,recurrence_rule,show_in_bored,bored_category_id,
        created_at,updated_at)
     VALUES (?,?,?,?,?,?,0,0,?,?,?,?,?,?,?,?)`,[_,c.title,c.description,c.due_date??null,c.priority??"medium",c.estimated_minutes??null,JSON.stringify(c.tags??[]),JSON.stringify(c.annotations??{}),c.is_recurring?1:0,c.recurrence_rule??null,c.show_in_bored?1:0,c.bored_category_id??null,m,m]),Et(ie("SELECT * FROM todos WHERE id = ?",[_])[0])},tr=function(c){const{id:_,...m}=c,X=[],ue=["title","description","due_date","priority","estimated_minutes","recurrence_rule","bored_category_id"];for(const de of ue)de in m&&X.push([de,m[de]??null]);for(const de of["is_recurring","show_in_bored"])de in m&&X.push([de,m[de]?1:0]);if("tags"in m&&X.push(["tags",JSON.stringify(m.tags??[])]),"annotations"in m&&X.push(["annotations",JSON.stringify(m.annotations??{})]),X.length>0){X.push(["updated_at",new Date().toISOString()]);const de=X.map(([be])=>`${be} = ?`).join(", ");ae(`UPDATE todos SET ${de} WHERE id = ?`,[...X.map(([,be])=>be),_])}return Et(ie("SELECT * FROM todos WHERE id = ?",[_])[0])},nr=function(c){return ae("DELETE FROM todos WHERE id = ?",[c]),null},on=function(c){return ae("UPDATE todos SET archived_at = ?, updated_at = ? WHERE id = ?",[new Date().toISOString(),new Date().toISOString(),c]),null},an=function(c){const _=ie("SELECT * FROM todos WHERE id = ?",[c]);if(_.length===0)throw new Error(`Todo not found: ${c}`);const m=Et(_[0]),X=new Date().toISOString();if(!m.is_done&&m.is_recurring&&m.due_date){const ue=$n(m.due_date,m.recurrence_rule??"daily");ae("UPDATE todos SET due_date = ?, done_count = done_count + 1, last_done_at = ?, updated_at = ? WHERE id = ?",[ue,X,X,c])}else m.is_done?ae("UPDATE todos SET is_done = 0, done_at = NULL, updated_at = ? WHERE id = ?",[X,c]):ae("UPDATE todos SET is_done = 1, done_at = ?, done_count = done_count + 1, last_done_at = ?, updated_at = ? WHERE id = ?",[X,X,X,c]);return Et(ie("SELECT * FROM todos WHERE id = ?",[c])[0])},rr=function(){return ae("DELETE FROM todos"),null};const Vt=await mr({print:()=>{},printErr:()=>{}}),ln=await Vt.installOpfsSAHPoolVfs({directory:"/habitat",clearOnInit:!1}),lt=new ln.OpfsSAHPoolDb("/habitat.db");lt.exec(`
  CREATE TABLE IF NOT EXISTS habits (
    id           TEXT PRIMARY KEY,
    name         TEXT NOT NULL,
    description  TEXT NOT NULL DEFAULT '',
    color        TEXT NOT NULL DEFAULT '#6366f1',
    icon         TEXT NOT NULL DEFAULT 'i-heroicons-star',
    frequency    TEXT NOT NULL DEFAULT 'daily',
    created_at   TEXT NOT NULL,
    archived_at  TEXT,
    tags         TEXT NOT NULL DEFAULT '[]',
    annotations  TEXT NOT NULL DEFAULT '{}',
    type         TEXT NOT NULL DEFAULT 'BOOLEAN',
    target_value REAL NOT NULL DEFAULT 1,
    paused_until TEXT
  );

  CREATE TABLE IF NOT EXISTS completions (
    id           TEXT PRIMARY KEY,
    habit_id     TEXT NOT NULL REFERENCES habits(id) ON DELETE CASCADE,
    date         TEXT NOT NULL,
    completed_at TEXT NOT NULL,
    notes        TEXT NOT NULL DEFAULT '',
    tags         TEXT NOT NULL DEFAULT '[]',
    annotations  TEXT NOT NULL DEFAULT '{}',
    UNIQUE(habit_id, date)
  );

  CREATE INDEX IF NOT EXISTS idx_completions_date     ON completions(date);
  CREATE INDEX IF NOT EXISTS idx_completions_habit_id ON completions(habit_id);

  CREATE TABLE IF NOT EXISTS habit_schedules (
    id              TEXT PRIMARY KEY,
    habit_id        TEXT NOT NULL REFERENCES habits(id) ON DELETE CASCADE,
    schedule_type   TEXT NOT NULL DEFAULT 'DAILY',
    frequency_count INTEGER,
    days_of_week    TEXT,
    due_time        TEXT,
    start_date      TEXT,
    end_date        TEXT
  );

  CREATE INDEX IF NOT EXISTS idx_schedules_habit_id ON habit_schedules(habit_id);

  CREATE TABLE IF NOT EXISTS habit_logs (
    id         TEXT PRIMARY KEY,
    habit_id   TEXT NOT NULL REFERENCES habits(id) ON DELETE CASCADE,
    date       TEXT NOT NULL,
    logged_at  TEXT NOT NULL,
    value      REAL NOT NULL DEFAULT 1,
    notes      TEXT NOT NULL DEFAULT ''
  );

  CREATE INDEX IF NOT EXISTS idx_habit_logs_date     ON habit_logs(date);
  CREATE INDEX IF NOT EXISTS idx_habit_logs_habit_id ON habit_logs(habit_id);

  CREATE TABLE IF NOT EXISTS checkin_entries (
    id         TEXT PRIMARY KEY,
    entry_date TEXT UNIQUE NOT NULL,
    content    TEXT NOT NULL DEFAULT '',
    created_at TEXT NOT NULL,
    updated_at TEXT NOT NULL
  );

  CREATE INDEX IF NOT EXISTS idx_checkin_entries_date ON checkin_entries(entry_date);

  CREATE TABLE IF NOT EXISTS checkin_templates (
    id            TEXT PRIMARY KEY,
    title         TEXT NOT NULL,
    schedule_type TEXT NOT NULL DEFAULT 'DAILY',
    days_active   TEXT
  );

  CREATE TABLE IF NOT EXISTS checkin_questions (
    id            TEXT PRIMARY KEY,
    template_id   TEXT NOT NULL REFERENCES checkin_templates(id) ON DELETE CASCADE,
    prompt        TEXT NOT NULL,
    response_type TEXT NOT NULL DEFAULT 'TEXT',
    display_order INTEGER NOT NULL DEFAULT 0
  );

  CREATE INDEX IF NOT EXISTS idx_checkin_questions_template ON checkin_questions(template_id);

  CREATE TABLE IF NOT EXISTS checkin_responses (
    id            TEXT PRIMARY KEY,
    question_id   TEXT NOT NULL REFERENCES checkin_questions(id) ON DELETE CASCADE,
    logged_date   TEXT NOT NULL,
    value_numeric REAL,
    value_text    TEXT,
    UNIQUE(question_id, logged_date)
  );

  CREATE INDEX IF NOT EXISTS idx_checkin_responses_date     ON checkin_responses(logged_date);
  CREATE INDEX IF NOT EXISTS idx_checkin_responses_question ON checkin_responses(question_id);

  CREATE TABLE IF NOT EXISTS applied_defaults (
    key        TEXT PRIMARY KEY,
    applied_at TEXT NOT NULL
  );

  CREATE TABLE IF NOT EXISTS scribbles (
    id          TEXT PRIMARY KEY,
    title       TEXT NOT NULL DEFAULT '',
    content     TEXT NOT NULL DEFAULT '',
    tags        TEXT NOT NULL DEFAULT '[]',
    annotations TEXT NOT NULL DEFAULT '{}',
    created_at  TEXT NOT NULL,
    updated_at  TEXT NOT NULL
  );

  CREATE INDEX IF NOT EXISTS idx_scribbles_updated ON scribbles(updated_at);

  CREATE TABLE IF NOT EXISTS reminders (
    id           TEXT PRIMARY KEY,
    habit_id     TEXT NOT NULL REFERENCES habits(id) ON DELETE CASCADE,
    trigger_time TEXT NOT NULL,
    days_active  TEXT
  );

  CREATE INDEX IF NOT EXISTS idx_reminders_habit_id ON reminders(habit_id);

  CREATE TABLE IF NOT EXISTS checkin_reminders (
    id           TEXT PRIMARY KEY,
    template_id  TEXT NOT NULL REFERENCES checkin_templates(id) ON DELETE CASCADE,
    trigger_time TEXT NOT NULL,
    days_active  TEXT
  );

  CREATE INDEX IF NOT EXISTS idx_checkin_reminders_template ON checkin_reminders(template_id);

  CREATE TABLE IF NOT EXISTS bored_categories (
    id         TEXT PRIMARY KEY,
    name       TEXT NOT NULL,
    icon       TEXT NOT NULL DEFAULT 'i-heroicons-sparkles',
    color      TEXT NOT NULL DEFAULT '#6366f1',
    is_system  INTEGER NOT NULL DEFAULT 0,
    sort_order INTEGER NOT NULL DEFAULT 0,
    created_at TEXT NOT NULL
  );

  CREATE TABLE IF NOT EXISTS bored_activities (
    id                TEXT PRIMARY KEY,
    title             TEXT NOT NULL,
    description       TEXT NOT NULL DEFAULT '',
    category_id       TEXT NOT NULL REFERENCES bored_categories(id) ON DELETE CASCADE,
    estimated_minutes INTEGER,
    tags              TEXT NOT NULL DEFAULT '[]',
    annotations       TEXT NOT NULL DEFAULT '{}',
    is_recurring      INTEGER NOT NULL DEFAULT 0,
    recurrence_rule   TEXT,
    is_done           INTEGER NOT NULL DEFAULT 0,
    done_at           TEXT,
    done_count        INTEGER NOT NULL DEFAULT 0,
    last_done_at      TEXT,
    archived_at       TEXT,
    created_at        TEXT NOT NULL
  );

  CREATE INDEX IF NOT EXISTS idx_bored_activities_category ON bored_activities(category_id);

  CREATE TABLE IF NOT EXISTS todos (
    id                TEXT PRIMARY KEY,
    title             TEXT NOT NULL,
    description       TEXT NOT NULL DEFAULT '',
    due_date          TEXT,
    priority          TEXT NOT NULL DEFAULT 'medium',
    estimated_minutes INTEGER,
    is_done           INTEGER NOT NULL DEFAULT 0,
    done_at           TEXT,
    done_count        INTEGER NOT NULL DEFAULT 0,
    last_done_at      TEXT,
    tags              TEXT NOT NULL DEFAULT '[]',
    annotations       TEXT NOT NULL DEFAULT '{}',
    is_recurring      INTEGER NOT NULL DEFAULT 0,
    recurrence_rule   TEXT,
    show_in_bored     INTEGER NOT NULL DEFAULT 0,
    bored_category_id TEXT REFERENCES bored_categories(id) ON DELETE SET NULL,
    archived_at       TEXT,
    created_at        TEXT NOT NULL,
    updated_at        TEXT NOT NULL
  );

  CREATE INDEX IF NOT EXISTS idx_todos_due_date ON todos(due_date);
  CREATE INDEX IF NOT EXISTS idx_todos_is_done  ON todos(is_done);
`),f(),Me();const Ct=`
  SELECT h.*, hs.id as sched_id, hs.schedule_type, hs.frequency_count,
         hs.days_of_week, hs.due_time, hs.start_date, hs.end_date
  FROM habits h
  LEFT JOIN habit_schedules hs ON hs.habit_id = h.id`;self.addEventListener("message",async c=>{const _=c.data;let m;try{switch(_.type){case"GET_HABITS":m=Ot();break;case"CREATE_HABIT":m=Fe(_.payload);break;case"UPDATE_HABIT":m=Pe(_.payload);break;case"ARCHIVE_HABIT":m=Ge(_.payload.id);break;case"DELETE_HABIT":m=Xt(_.payload.id);break;case"GET_COMPLETIONS_FOR_DATE":m=Jt(_.payload.date);break;case"GET_COMPLETIONS_FOR_HABIT":m=dn(_.payload.habit_id,_.payload.from,_.payload.to);break;case"GET_COMPLETIONS_FOR_DATE_RANGE":m=fn(_.payload.from,_.payload.to);break;case"TOGGLE_COMPLETION":m=pn(_.payload.habit_id,_.payload.date,_.payload.tags,_.payload.annotations);break;case"GET_STREAK":m=qn(_.payload.habit_id);break;case"GET_ARCHIVED_HABITS":m=hn();break;case"GET_ALL_COMPLETIONS":m=et();break;case"DELETE_ALL_HABITS":m=Bt();break;case"DELETE_ALL_CHECKIN_ENTRIES":m=gn();break;case"DELETE_ALL_CHECKIN_DATA":m=mn();break;case"DELETE_ALL_SCRIBBLES":m=En();break;case"CLEAR_APPLIED_DEFAULTS":m=bn();break;case"GET_DB_INFO":m=$t();break;case"INTEGRITY_CHECK":m=Sn();break;case"IS_DEFAULT_APPLIED":m=yn(_.payload.key);break;case"MARK_DEFAULT_APPLIED":m=Tn(_.payload.key);break;case"EXPORT_DB":m=Qe();break;case"EXPORT_JSON_DATA":m=Be(_.payload);break;case"IMPORT_JSON":m=ft(_.payload);break;case"GET_HABIT_LOGS_FOR_DATE":m=Kt(_.payload.date);break;case"GET_HABIT_LOGS_FOR_HABIT":m=vn(_.payload.habit_id,_.payload.from,_.payload.to);break;case"GET_HABIT_LOGS_FOR_DATE_RANGE":m=ot(_.payload.from,_.payload.to);break;case"LOG_HABIT_VALUE":m=Ce(_.payload.habit_id,_.payload.date,_.payload.value,_.payload.notes);break;case"DELETE_HABIT_LOG":m=An(_.payload.id);break;case"GET_SCHEDULE_FOR_HABIT":m=Yt(_.payload.habit_id);break;case"UPDATE_HABIT_SCHEDULE":m=St(_.payload);break;case"PAUSE_HABIT":m=Zt(_.payload.id,_.payload.until);break;case"PAUSE_ALL_HABITS":m=en(_.payload.until);break;case"GET_CHECKIN_ENTRY":m=jt(_.payload.date);break;case"UPSERT_CHECKIN_ENTRY":m=In(_.payload.date,_.payload.content);break;case"DELETE_CHECKIN_ENTRY":m=gt(_.payload.id);break;case"GET_CHECKIN_ENTRIES":m=On(_.payload.from,_.payload.to);break;case"GET_CHECKIN_TEMPLATES":m=Wt();break;case"CREATE_CHECKIN_TEMPLATE":m=Lt(_.payload);break;case"UPDATE_CHECKIN_TEMPLATE":m=Oe(_.payload);break;case"DELETE_CHECKIN_TEMPLATE":m=wn(_.payload.id);break;case"GET_CHECKIN_QUESTIONS":m=Ht(_.payload.template_id);break;case"CREATE_CHECKIN_QUESTION":m=Ut(_.payload);break;case"UPDATE_CHECKIN_QUESTION":m=Ln(_.payload);break;case"DELETE_CHECKIN_QUESTION":m=mt(_.payload.id);break;case"GET_CHECKIN_RESPONSES":m=kt(_.payload.template_id,_.payload.date);break;case"UPSERT_CHECKIN_RESPONSE":m=kn(_.payload.question_id,_.payload.logged_date,_.payload.value_numeric,_.payload.value_text);break;case"DELETE_CHECKIN_RESPONSE":m=Nn(_.payload.id);break;case"GET_SCRIBBLES":m=tn();break;case"CREATE_SCRIBBLE":m=nn(_.payload);break;case"UPDATE_SCRIBBLE":m=Rn(_.payload);break;case"DELETE_SCRIBBLE":m=l(_.payload.id);break;case"GET_ALL_REMINDERS":m=Ne();break;case"GET_REMINDERS_FOR_HABIT":m=Fn(_.payload.habit_id);break;case"CREATE_REMINDER":m=Cn(_.payload.habit_id,_.payload.trigger_time,_.payload.days_active);break;case"DELETE_REMINDER":m=Dn(_.payload.id);break;case"GET_ALL_CHECKIN_REMINDERS":m=Rt();break;case"GET_CHECKIN_REMINDERS_FOR_TEMPLATE":m=vt(_.payload.template_id);break;case"CREATE_CHECKIN_REMINDER":m=Pn(_.payload.template_id,_.payload.trigger_time,_.payload.days_active);break;case"DELETE_CHECKIN_REMINDER":m=xn(_.payload.id);break;case"GET_CHECKIN_TEMPLATE":m=Un(_.payload.id);break;case"GET_CHECKIN_RESPONSE_DATES":m=Bn();break;case"GET_CHECKIN_SUMMARY_FOR_DATE":m=Mn(_.payload.date);break;case"GET_SCRIBBLES_FOR_DATE":m=Ft(_.payload.date);break;case"GET_BORED_CATEGORIES":m=rn();break;case"CREATE_BORED_CATEGORY":m=jn(_.payload);break;case"UPDATE_BORED_CATEGORY":m=Wn(_.payload);break;case"DELETE_BORED_CATEGORY":m=Hn(_.payload.id);break;case"GET_BORED_ACTIVITIES":m=zn();break;case"GET_BORED_ACTIVITIES_FOR_CATEGORY":m=Qn(_.payload.category_id);break;case"CREATE_BORED_ACTIVITY":m=Vn(_.payload);break;case"UPDATE_BORED_ACTIVITY":m=Gn(_.payload);break;case"DELETE_BORED_ACTIVITY":m=sn(_.payload.id);break;case"ARCHIVE_BORED_ACTIVITY":m=Xn(_.payload.id);break;case"MARK_BORED_ACTIVITY_DONE":m=Jn(_.payload.id);break;case"GET_BORED_ORACLE":m=Kn(_.payload.excluded_category_ids,_.payload.max_minutes);break;case"DELETE_ALL_BORED_DATA":m=Yn();break;case"GET_TODOS":m=Zn();break;case"CREATE_TODO":m=er(_.payload);break;case"UPDATE_TODO":m=tr(_.payload);break;case"DELETE_TODO":m=nr(_.payload.id);break;case"ARCHIVE_TODO":m=on(_.payload.id);break;case"TOGGLE_TODO":m=an(_.payload.id);break;case"DELETE_ALL_TODOS":m=rr();break;case"NUKE_OPFS":{lt.close();const X=await navigator.storage.getDirectory();for await(const[ue]of X.entries())await X.removeEntry(ue,{recursive:!0}).catch(()=>{});m=null;break}default:throw new Error(`Unknown request type: ${_.type}`)}self.postMessage({id:_.id,ok:!0,data:m})}catch(X){self.postMessage({id:_.id,ok:!1,error:X instanceof Error?X.message:String(X)})}}),self.postMessage({type:"READY"})}catch(f){self.postMessage({type:"INIT_ERROR",message:f instanceof Error?f.message:String(f)})}})();
