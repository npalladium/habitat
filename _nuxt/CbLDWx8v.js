import{_ as X}from"./CY-zuv6_.js";import{e as Z,f as tt,h as et,o,c as l,a,b as g,w as v,t as u,j as i,F as y,r as m,l as k,n as M,T as st,q as at,m as nt,z as w,y as _}from"./B4ebfuTa.js";import{_ as ot}from"./DlAUqK2U.js";const lt={class:"space-y-5"},rt={class:"grid grid-cols-3 gap-2"},it={class:"text-2xl font-bold text-slate-100"},dt={class:"text-2xl font-bold text-slate-100"},ct={class:"text-2xl font-bold text-slate-100"},ut={key:0,class:"flex items-center justify-center py-6"},xt={key:1,class:"flex items-center justify-center py-6"},ft={key:2,class:"overflow-x-auto -mx-1 px-1"},pt={class:"inline-flex flex-col gap-1"},gt={class:"flex gap-0.5 ml-5"},yt={class:"flex gap-1"},mt={class:"flex flex-col gap-0.5 w-4 flex-shrink-0"},_t={class:"flex gap-0.5"},ht=["onClick"],vt={class:"h-6 flex items-center ml-5"},bt={key:0,class:"text-xs"},kt={class:"text-slate-300 font-medium"},wt={key:0,class:"text-slate-600"},Dt={key:1,class:"text-slate-400"},St={key:2,class:"text-cyan-400 ml-1"},Ct={key:1,class:"text-[10px] text-slate-700"},Mt={class:"flex items-center gap-1 ml-5"},Ot={key:0,class:"flex items-center justify-center py-6"},It={key:1,class:"flex items-end gap-1.5 h-28"},Lt={class:"w-full flex-1 flex items-end"},Ft={class:"text-[10px] text-slate-600"},$t={class:"flex items-center justify-between"},At={class:"flex gap-0.5"},Ht=["onClick"],jt={key:0,class:"flex items-center justify-center py-6"},Et={key:1,class:"space-y-3"},Nt={class:"w-20 text-xs text-slate-400 truncate flex-shrink-0"},Tt={class:"flex-1 h-1.5 bg-slate-800 rounded-full overflow-hidden"},Bt={class:"w-7 text-[11px] text-slate-500 text-right flex-shrink-0"},N=17,Rt=Z({__name:"stats",setup(Ut){const C=tt(),x=w([]),$=w([]),A=w([]),O=w(!0),h=new Date().toISOString().slice(0,10),H=(()=>{const e=new Date;return e.setMonth(e.getMonth()-6),e.toISOString().slice(0,10)})();async function T(){if(!C.isAvailable){O.value=!1;return}const[e,t,n]=await Promise.all([C.getHabits(),C.getCompletionsForDateRange(H,h),C.getHabitLogsForDateRange(H,h)]);x.value=e,$.value=t,A.value=n,O.value=!1}const B=_(()=>{const e=new Map;for(const t of $.value)e.has(t.date)||e.set(t.date,new Set),e.get(t.date).add(t.habit_id);return e}),R=_(()=>{const e=new Map;for(const t of A.value){e.has(t.date)||e.set(t.date,new Map);const n=e.get(t.date);n.set(t.habit_id,(n.get(t.habit_id)??0)+t.value)}return e});function D(e,t){if(e.type==="BOOLEAN")return B.value.get(t)?.has(e.id)??!1;const n=R.value.get(t),r=n?.has(e.id)??!1,s=n?.get(e.id)??0;return e.type==="NUMERIC"?s>=e.target_value:r&&s<e.target_value}const I=_(()=>x.value.length);function U(e){let t=0;const n=new Date(h);for(;D(e,n.toISOString().slice(0,10));)t++,n.setDate(n.getDate()-1);return t}const W=_(()=>Math.max(0,...x.value.map(U))),z=_(()=>{if(!x.value.length)return 0;let e=0;for(const t of x.value){const n=new Date(h);for(let r=0;r<30;r++)D(t,n.toISOString().slice(0,10))&&e++,n.setDate(n.getDate()-1)}return Math.round(e/(x.value.length*30)*100)});function P(e,t){let n=0;for(const r of x.value)for(let s=1;s<=t;s++)D(r,`${e}-${String(s).padStart(2,"0")}`)&&n++;return n}const V=_(()=>{const e=new Date;return Array.from({length:6},(t,n)=>{const r=new Date(e.getFullYear(),e.getMonth()-(5-n),1),s=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,d=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),c=n===5?e.getDate():d,p=P(s,c),S=x.value.length&&c?Math.min(100,Math.round(p/(x.value.length*c)*100)):0;return{label:r.toLocaleDateString("en-US",{month:"short"}),rate:S}})}),L=w(30),j=_(()=>{const e=L.value,t=new Date(h);t.setDate(t.getDate()-(e-1));const n=t.toISOString().slice(0,10);return x.value.map(r=>{let s=0;const d=new Date(h);for(let c=0;c<e;c++){const p=d.toISOString().slice(0,10);p>=n&&D(r,p)&&s++,d.setDate(d.getDate()-1)}return{habit:r,rate:Math.round(s/e*100)}}).sort((r,s)=>s.rate-r.rate).slice(0,6)});function Y(e,t,n){const r=new Date().toISOString().slice(0,10),s=[];for(let d=0;d<7;d++){const c=new Date(e);c.setDate(e.getDate()+t*7+d);const p=c.toISOString().slice(0,10),S=p>r;let F=0;if(!S&&n>0)for(const Q of x.value)D(Q,p)&&F++;s.push({date:p,doneCount:F,total:n,rate:n&&!S?Math.round(F/n*100):0,isToday:p===r,isFuture:S})}return s}const E=_(()=>{const e=x.value.length,t=new Date(h);return t.setDate(t.getDate()-(N*7-1)-t.getDay()),Array.from({length:N},(n,r)=>Y(t,r,e))});function q(e){const t=e.find(n=>n.date.slice(8)==="01");return t?new Date(`${t.date}T12:00:00`).toLocaleDateString("en-US",{month:"short"}):""}const b=["#1e293b","#083344","#0e4d6c","#0e7490","#22d3ee"];function K(e){return e.isFuture||e.total===0||e.rate===0?b[0]:e.rate<=33?b[1]:e.rate<=66?b[2]:e.rate<100?b[3]:b[4]}const f=w(null);function G(e){f.value=f.value?.date===e.date?null:e}const J=["","Mo","","We","","Fr",""];return et(T),(e,t)=>{const n=X,r=nt;return o(),l("div",lt,[t[16]||(t[16]=a("header",null,[a("p",{class:"text-sm text-slate-500"},"Overview"),a("h2",{class:"text-2xl font-bold"},"Analytics")],-1)),a("div",rt,[g(n,{ui:{root:"rounded-2xl",body:"p-3 sm:p-3 space-y-1 text-center"}},{default:v(()=>[t[0]||(t[0]=a("p",{class:"text-[10px] text-slate-500 uppercase tracking-wide"},"Habits",-1)),a("p",it,u(i(I)),1),t[1]||(t[1]=a("p",{class:"text-[10px] text-slate-600"},"active",-1))]),_:1}),g(n,{ui:{root:"rounded-2xl",body:"p-3 sm:p-3 space-y-1 text-center"}},{default:v(()=>[t[2]||(t[2]=a("p",{class:"text-[10px] text-slate-500 uppercase tracking-wide"},"Streak",-1)),a("p",dt,u(i(W)),1),t[3]||(t[3]=a("p",{class:"text-[10px] text-slate-600"},"days best",-1))]),_:1}),g(n,{ui:{root:"rounded-2xl",body:"p-3 sm:p-3 space-y-1 text-center"}},{default:v(()=>[t[4]||(t[4]=a("p",{class:"text-[10px] text-slate-500 uppercase tracking-wide"},"Avg",-1)),a("p",ct,u(i(z))+"%",1),t[5]||(t[5]=a("p",{class:"text-[10px] text-slate-600"},"30 days",-1))]),_:1})]),g(n,{ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-3"}},{default:v(()=>[t[11]||(t[11]=a("p",{class:"text-xs font-semibold text-slate-400"},"Daily Completion",-1)),i(O)?(o(),l("div",ut,[...t[6]||(t[6]=[a("p",{class:"text-xs text-slate-600"},"Loading…",-1)])])):i(I)?(o(),l("div",ft,[a("div",pt,[a("div",gt,[(o(!0),l(y,null,m(i(E),(s,d)=>(o(),l("div",{key:d,class:"w-3.5 flex-shrink-0 h-3 text-[9px] text-slate-500 leading-none"},u(q(s)),1))),128))]),a("div",yt,[a("div",mt,[(o(),l(y,null,m(J,(s,d)=>a("div",{key:d,class:"h-3.5 text-[9px] text-slate-600 flex items-center justify-end"},u(s),1)),64))]),a("div",_t,[(o(!0),l(y,null,m(i(E),(s,d)=>(o(),l("div",{key:d,class:"flex flex-col gap-0.5"},[(o(!0),l(y,null,m(s,c=>(o(),l("button",{key:c.date,class:M(["w-3.5 h-3.5 rounded-[3px] flex-shrink-0 transition-transform active:scale-110",i(f)?.date===c.date?"ring-1 ring-white/60 ring-offset-[1.5px] ring-offset-slate-900":c.isToday?"ring-1 ring-cyan-400/80 ring-offset-[1.5px] ring-offset-slate-900":""]),style:k({backgroundColor:K(c)}),onClick:p=>G(c)},null,14,ht))),128))]))),128))])]),a("div",vt,[g(st,{name:"fade"},{default:v(()=>[i(f)?(o(),l("p",bt,[a("span",kt,u(i(f).date),1),t[8]||(t[8]=a("span",{class:"text-slate-500 mx-1"},"—",-1)),i(f).isFuture?(o(),l("span",wt,"future")):(o(),l("span",Dt,u(i(f).doneCount)+"/"+u(i(f).total)+" habits",1)),!i(f).isFuture&&i(f).doneCount===i(f).total&&i(f).total>0?(o(),l("span",St,"✓ Perfect day")):at("",!0)])):(o(),l("p",Ct,"Tap any cell"))]),_:1})]),a("div",Mt,[t[9]||(t[9]=a("span",{class:"text-[10px] text-slate-600 mr-0.5"},"Less",-1)),(o(),l(y,null,m(b,s=>a("div",{key:s,class:"w-3.5 h-3.5 rounded-[3px]",style:k({backgroundColor:s})},null,4)),64)),t[10]||(t[10]=a("span",{class:"text-[10px] text-slate-600 ml-0.5"},"More",-1))])])])):(o(),l("div",xt,[...t[7]||(t[7]=[a("p",{class:"text-xs text-slate-600"},"No habits yet",-1)])]))]),_:1}),g(n,{ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-3"}},{default:v(()=>[t[13]||(t[13]=a("p",{class:"text-xs font-semibold text-slate-400"},"Monthly Completion Rate",-1)),i(I)?(o(),l("div",It,[(o(!0),l(y,null,m(i(V),s=>(o(),l("div",{key:s.label,class:"flex-1 flex flex-col items-center gap-1"},[a("span",{class:M(["text-[10px] font-medium tabular-nums",s.rate>=70?"text-emerald-400":s.rate>=40?"text-amber-400":s.rate>0?"text-rose-400":"text-slate-700"])},u(s.rate>0?`${s.rate}%`:"—"),3),a("div",Lt,[a("div",{class:M(["w-full rounded-t transition-all duration-700",s.rate>=70?"bg-emerald-500":s.rate>=40?"bg-amber-400":s.rate>0?"bg-rose-500":"bg-slate-800"]),style:k({height:`${Math.max(s.rate>0?4:0,s.rate)}%`})},null,6)]),a("span",Ft,u(s.label),1)]))),128))])):(o(),l("div",Ot,[...t[12]||(t[12]=[a("p",{class:"text-xs text-slate-600"},"No data yet",-1)])]))]),_:1}),g(n,{ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-3"}},{default:v(()=>[a("div",$t,[t[14]||(t[14]=a("p",{class:"text-xs font-semibold text-slate-400"},"Habit Completion",-1)),a("div",At,[(o(),l(y,null,m([7,14,30,90],s=>a("button",{key:s,class:M(["px-2 py-0.5 rounded text-[10px] font-medium transition-colors",i(L)===s?"bg-slate-700 text-slate-100":"text-slate-500 hover:text-slate-400"]),onClick:d=>L.value=s},u(s)+"d",11,Ht)),64))])]),i(j).length?(o(),l("div",Et,[(o(!0),l(y,null,m(i(j),s=>(o(),l("div",{key:s.habit.id,class:"flex items-center gap-2"},[a("div",{class:"w-5 h-5 rounded-full flex-shrink-0 flex items-center justify-center",style:k({backgroundColor:s.habit.color+"33"})},[g(r,{name:s.habit.icon,class:"w-3 h-3",style:k({color:s.habit.color})},null,8,["name","style"])],4),a("p",Nt,u(s.habit.name),1),a("div",Tt,[a("div",{class:"h-full rounded-full transition-all duration-700",style:k({width:`${s.rate}%`,backgroundColor:s.habit.color})},null,4)]),a("span",Bt,u(s.rate)+"%",1)]))),128))])):(o(),l("div",jt,[...t[15]||(t[15]=[a("p",{class:"text-xs text-slate-600"},"No data yet",-1)])]))]),_:1})])}}}),Vt=ot(Rt,[["__scopeId","data-v-a7c60dc3"]]);export{Vt as default};
