import{_ as A}from"./BuWmrV8K.js";import{e as F,h as V,E as q,o as d,c as v,a as l,j as s,p as C,q as T,n as $,b as w,m as Y,t as U,F as G,r as H,w as J,k as K,z as y}from"./B4ebfuTa.js";import{_ as Q}from"./CY-zuv6_.js";const W=globalThis.setInterval,X={class:"space-y-5"},Z={class:"flex flex-col items-center gap-3 py-8"},ee=["aria-label"],te={key:0,class:"text-red-400 text-sm font-mono tabular-nums animate-pulse"},oe={key:1,class:"text-xs text-slate-500"},ae={key:1,class:"flex flex-col items-center gap-2 py-6 text-center"},ne={key:2,class:"space-y-2"},se={class:"flex items-center gap-3"},re={class:"flex-1 min-w-0"},ie={class:"text-sm text-slate-300 truncate"},le={class:"text-xs text-slate-500 tabular-nums"},ce="habitat",p="voice_notes",fe=F({__name:"voice",setup(ue){let k=null;function D(){return k?Promise.resolve(k):new Promise((t,e)=>{const o=indexedDB.open(ce,1);o.onupgradeneeded=()=>{o.result.createObjectStore(p,{keyPath:"id"})},o.onsuccess=()=>{k=o.result,t(o.result)},o.onerror=()=>e(o.error)})}async function L(){const t=await D();return new Promise((e,o)=>{const a=t.transaction(p,"readonly").objectStore(p).getAll();a.onsuccess=()=>e(a.result),a.onerror=()=>o(a.error)})}async function j(t){const e=await D();return new Promise((o,a)=>{const n=e.transaction(p,"readwrite");n.objectStore(p).put(t),n.oncomplete=()=>o(),n.onerror=()=>a(n.error)})}async function B(t){const e=await D();return new Promise((o,a)=>{const n=e.transaction(p,"readwrite");n.objectStore(p).delete(t),n.oncomplete=()=>o(),n.onerror=()=>a(n.error)})}const u=y([]),c=y(!1),b=y(0),g=y(null),r=y(null);let m=null,S=[],x=null;const f=new Map;V(async()=>{const t=await L();t.sort((e,o)=>o.created_at.localeCompare(e.created_at)),u.value=t.map(e=>({...e,url:URL.createObjectURL(e.blob)}))}),q(()=>{M(),u.value.forEach(t=>{t.url&&URL.revokeObjectURL(t.url)}),f.forEach(t=>t.pause())});function P(){const t=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/mp4"];for(const e of t)if(MediaRecorder.isTypeSupported(e))return e;return""}function R(t){const e=Math.floor(t/60),o=t%60;return`${e}:${String(o).padStart(2,"0")}`}function I(t){const e=new Date(t),o=new Date,a=new Date(o);a.setDate(o.getDate()-1);const n=(i,_)=>i.getFullYear()===_.getFullYear()&&i.getMonth()===_.getMonth()&&i.getDate()===_.getDate(),h=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return n(e,o)?`Today, ${h}`:n(e,a)?`Yesterday, ${h}`:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})+`, ${h}`}async function E(){g.value=null;let t;try{t=await navigator.mediaDevices.getUserMedia({audio:!0})}catch{g.value="Microphone access denied. Please allow access in your browser settings.";return}S=[];const e=P();m=new MediaRecorder(t,e?{mimeType:e}:void 0),m.ondataavailable=o=>{o.data.size>0&&S.push(o.data)},m.onstop=async()=>{t.getTracks().forEach(n=>n.stop());const o=new Blob(S,{type:e||"audio/webm"}),a={id:crypto.randomUUID(),blob:o,mimeType:e||"audio/webm",duration:b.value,created_at:new Date().toISOString()};await j(a),u.value.unshift({...a,url:URL.createObjectURL(o)}),b.value=0},m.start(100),c.value=!0,x=W(()=>{b.value++},1e3)}function M(){m&&m.state!=="inactive"&&m.stop(),c.value=!1,x&&(clearInterval(x),x=null)}function N(){c.value?M():E()}function O(t){if(!t.url)return;r.value&&r.value!==t.id&&(f.get(r.value)?.pause(),r.value=null);let e=f.get(t.id);e||(e=new Audio(t.url),e.onended=()=>{r.value=null},f.set(t.id,e)),r.value===t.id?(e.pause(),r.value=null):(e.play(),r.value=t.id)}async function z(t){const e=f.get(t.id);e&&(e.pause(),f.delete(t.id)),r.value===t.id&&(r.value=null),t.url&&URL.revokeObjectURL(t.url),await B(t.id),u.value=u.value.filter(o=>o.id!==t.id)}return(t,e)=>{const o=A,a=Y,n=K,h=Q;return d(),v("div",X,[e[2]||(e[2]=l("header",null,[l("p",{class:"text-sm text-slate-500"},"Voice Notes"),l("h2",{class:"text-2xl font-bold"},"Record")],-1)),s(g)?(d(),C(o,{key:0,title:s(g),color:"error",variant:"soft",icon:"i-heroicons-exclamation-circle","close-button":{icon:"i-heroicons-x-mark",color:"error",variant:"ghost",size:"sm"},onClose:e[0]||(e[0]=i=>g.value=null)},null,8,["title"])):T("",!0),l("div",Z,[l("button",{class:$(["w-24 h-24 rounded-full flex items-center justify-center transition-all duration-200 active:scale-95 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500",s(c)?"bg-red-500 shadow-xl shadow-red-500/30 scale-105":"bg-slate-800 hover:bg-slate-700"]),"aria-label":s(c)?"Stop recording":"Start recording",onClick:N},[w(a,{name:s(c)?"i-heroicons-stop":"i-heroicons-microphone",class:$(["w-10 h-10",s(c)?"text-white":"text-slate-300"])},null,8,["name","class"])],10,ee),s(c)?(d(),v("p",te," â— "+U(R(s(b))),1)):(d(),v("p",oe,"Tap to record"))]),s(u).length===0&&!s(c)?(d(),v("section",ae,[w(a,{name:"i-heroicons-microphone",class:"w-8 h-8 text-slate-700"}),e[1]||(e[1]=l("p",{class:"text-sm text-slate-500"},"No recordings yet. Tap the button above to start.",-1))])):s(u).length>0?(d(),v("div",ne,[(d(!0),v(G,null,H(s(u),i=>(d(),C(h,{key:i.id,ui:{root:"rounded-2xl",body:"px-4 py-3 sm:px-4 sm:py-3"}},{default:J(()=>[l("div",se,[w(n,{icon:s(r)===i.id?"i-heroicons-pause":"i-heroicons-play",color:s(r)===i.id?"primary":"neutral",variant:s(r)===i.id?"soft":"outline",size:"sm",ui:{base:"rounded-full"},onClick:_=>O(i)},null,8,["icon","color","variant","onClick"]),l("div",re,[l("p",ie,U(I(i.created_at)),1),l("p",le,U(R(i.duration)),1)]),w(n,{icon:"i-heroicons-trash",color:"neutral",variant:"ghost",size:"sm",class:"text-slate-600 hover:text-red-400",onClick:_=>z(i)},null,8,["onClick"])])]),_:2},1024))),128))])):T("",!0)])}}});export{fe as default};
