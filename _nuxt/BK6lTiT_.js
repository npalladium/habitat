import{e as ze,L as Le,f as Re,H as Se,g as Ne,o as i,c as d,a as s,b as o,j as je,i as a,l as Ve,w as m,d as p,F as k,t as f,p as w,r as A,m as re,n as E,s as de,I as J,y as u,x as X,z as Z,N as ue,E as Ye,A as Ue}from"./IgzNwamV.js";import{_ as Me}from"./CIme5z_8.js";import{_ as Ke}from"./DeFhM5eI.js";import{_ as Qe}from"./BcOqzIgr.js";const We={class:"space-y-5"},Be={class:"flex items-center gap-2 -mb-1"},Ie={key:0,class:"flex items-center justify-center py-12"},Oe={key:1,class:"flex flex-col items-center gap-3 py-12 text-center"},Fe={class:"flex items-start justify-between"},Xe={class:"text-xs text-slate-500"},He={class:"text-2xl font-bold leading-tight"},Pe={class:"flex items-center gap-0.5 mt-1"},Ge={class:"text-sm text-slate-400 -mt-2"},Je={class:"space-y-4"},Ze={key:0,class:"flex flex-col items-center gap-3 py-8 text-center"},qe={class:"flex items-start justify-between gap-2"},et={class:"text-sm font-medium text-slate-100 leading-snug"},tt=["disabled","onClick"],st={key:0,class:"flex gap-1 flex-wrap"},lt=["onClick"],at={key:2,class:"flex gap-2"},nt=["onClick"],ot=["onClick"],it={class:"px-4 pt-3.5 pb-3 flex items-center justify-between"},rt={key:0,class:"px-4 py-3 space-y-3"},dt={class:"space-y-1"},ut={class:"flex gap-1.5"},ct=["onClick"],vt={class:"flex justify-end gap-2"},mt={class:"px-4 pt-3.5 pb-3 flex items-center justify-between"},pt={class:"text-sm font-medium text-slate-200"},ft={class:"text-[11px] text-slate-500"},xt=["disabled","onClick"],yt={key:0,class:"px-4 py-3 text-xs text-slate-600"},bt={key:1,class:"px-4 py-3 space-y-3"},ht={class:"flex items-center gap-3"},gt={class:"space-y-1"},_t={class:"flex gap-1.5"},kt=["onClick"],wt={class:"flex justify-end gap-2"},Ct={class:"space-y-2 pb-4"},Tt={key:3,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center"},Dt={class:"relative w-full sm:max-w-md bg-slate-900 border border-slate-800 rounded-t-3xl sm:rounded-2xl p-5 space-y-4"},At={class:"flex items-center justify-between"},Et={class:"space-y-1.5"},$t={class:"flex gap-1.5"},zt=["onClick"],Lt={key:0,class:"space-y-1.5"},Rt={class:"flex gap-1.5"},St=["onClick"],Nt={class:"flex justify-end gap-2 pt-1"},jt={key:4,class:"fixed inset-0 z-50 flex items-end sm:items-center justify-center"},Vt={class:"relative w-full sm:max-w-sm bg-slate-900 border border-slate-800 rounded-t-3xl sm:rounded-2xl p-5 space-y-4"},Yt={class:"text-sm text-slate-400"},Ut={class:"text-slate-200 font-medium"},Mt={class:"flex justify-end gap-2"},Ot=ze({__name:"[id]",setup(Kt){const r=Ue(),ce=Le(),$=X(()=>ce.params.id),v=u(null),b=u([]),H=u(!0);async function ve(){if(!r.isAvailable){H.value=!1;return}const[t,e]=await Promise.all([r.getCheckinTemplate($.value),r.getCheckinQuestions($.value)]);v.value=t,b.value=e,H.value=!1}function q(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}const me=q(new Date),z=u(new Date),W=X(()=>q(z.value)),ee=X(()=>W.value===me),pe=X(()=>z.value.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}));function fe(){const t=new Date(z.value);t.setDate(t.getDate()-1),z.value=t}function xe(){if(ee.value)return;const t=new Date(z.value);t.setDate(t.getDate()+1),z.value=t}const y=u(new Map),j=Z({});let h=null;async function te(){if(!r.isAvailable)return;const t=await r.getCheckinResponses($.value,W.value);y.value=new Map(t.map(e=>[e.question_id,e]));for(const e of b.value){const n=y.value.get(e.id);n?.value_text!=null?j[e.id]=n.value_text:delete j[e.id]}}Re(W,async()=>{h&&(clearTimeout(h),h=null),await te()});async function V(t,e,n){if(!r.isAvailable)return;const x=await r.upsertCheckinResponse(t,W.value,e,n);y.value.set(t,x)}function ye(t,e){j[t]=e,h&&clearTimeout(h),h=setTimeout(()=>{V(t,null,e.trim()||null)},600)}async function be(t,e){y.value.get(t)?.value_numeric===e?await V(t,null,null):await V(t,e,null)}async function se(t,e){y.value.get(t)?.value_numeric===e?await V(t,null,null):await V(t,e,null)}Se(()=>{h&&clearTimeout(h)});const L=u(!1),C=u(""),B=u("TEXT"),Y=u(!1),I=Z(new Set);async function le(){if(!(!r.isAvailable||!C.value.trim()||Y.value)){Y.value=!0;try{const t=await r.createCheckinQuestion({template_id:$.value,prompt:C.value.trim(),response_type:B.value,display_order:b.value.length});b.value.push(t),C.value="",B.value="TEXT",L.value=!1}finally{Y.value=!1}}}async function he(t){if(!(!r.isAvailable||I.has(t))){I.add(t);try{await r.deleteCheckinQuestion(t),b.value=b.value.filter(e=>e.id!==t),y.value.delete(t),delete j[t]}finally{I.delete(t)}}}const ae=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ne=["Su","Mo","Tu","We","Th","Fr","Sa"],R=u([]),T=u(!1),D=u(""),g=u([]),U=u(!1),O=Z(new Set);async function ge(){r.isAvailable&&(R.value=await r.getCheckinRemindersForTemplate($.value))}function _e(t){return!t.days_active||t.days_active.length===0?"Every day":t.days_active.map(e=>ae[e]).join(", ")}function ke(t){const e=g.value.indexOf(t);e>=0?g.value.splice(e,1):(g.value.push(t),g.value.sort((n,x)=>n-x))}async function we(){if(!(!r.isAvailable||!D.value||U.value)){U.value=!0;try{const t=await r.createCheckinReminder($.value,D.value,g.value.length?[...g.value]:null);R.value.push(t),D.value="",g.value=[],T.value=!1,ue().scheduleAll().catch(console.error)}finally{U.value=!1}}}async function Ce(t){if(!(!r.isAvailable||O.has(t))){O.add(t);try{await r.deleteCheckinReminder(t),R.value=R.value.filter(e=>e.id!==t),ue().scheduleAll().catch(console.error)}finally{O.delete(t)}}}const S=u(!1),M=u(""),N=u("DAILY"),_=u([]),K=u(!1);function Te(){v.value&&(M.value=v.value.title,N.value=v.value.schedule_type,_.value=v.value.days_active?[...v.value.days_active]:[],S.value=!0)}function De(t){const e=_.value.indexOf(t);e>=0?_.value.splice(e,1):(_.value.push(t),_.value.sort((n,x)=>n-x))}async function oe(){if(!(!r.isAvailable||!v.value||K.value)){K.value=!0;try{const t=await r.updateCheckinTemplate({id:v.value.id,title:M.value.trim()||v.value.title,schedule_type:N.value,days_active:N.value==="WEEKLY"&&_.value.length?[..._.value]:null});v.value=t,S.value=!1}finally{K.value=!1}}}const F=u(!1),Q=u(!1);async function Ae(){if(!(!r.isAvailable||!v.value||Q.value)){Q.value=!0;try{await r.deleteCheckinTemplate(v.value.id),await Ye("/checkin")}finally{Q.value=!1}}}function Ee(t){return t.schedule_type==="DAILY"?"Daily":t.schedule_type==="MONTHLY"?"Monthly":!t.days_active||t.days_active.length===0?"Weekly":`Weekly · ${t.days_active.map(e=>ae[e]).join(", ")}`}return Ne(async()=>{await ve(),await Promise.all([te(),ge()])}),(t,e)=>{const n=je,x=Ve,$e=Me,P=Ke,G=Qe;return i(),d("div",We,[s("div",Be,[o(n,{icon:"i-heroicons-arrow-left",variant:"ghost",color:"neutral",size:"sm",to:"/checkin"}),e[13]||(e[13]=s("span",{class:"text-sm text-slate-500"},"Check-in",-1))]),a(H)?(i(),d("div",Ie,[o(x,{name:"i-heroicons-arrow-path",class:"w-5 h-5 animate-spin text-slate-600"})])):a(v)?(i(),d(k,{key:2},[s("header",Fe,[s("div",null,[s("p",Xe,f(Ee(a(v))),1),s("h2",He,f(a(v).title),1)]),s("div",Pe,[o(n,{icon:"i-heroicons-pencil-square",variant:"ghost",color:"neutral",size:"sm",onClick:Te}),o(n,{icon:"i-heroicons-chevron-left",variant:"ghost",color:"neutral",size:"sm",onClick:fe}),o(n,{icon:"i-heroicons-chevron-right",variant:"ghost",color:"neutral",size:"sm",disabled:a(ee),onClick:xe},null,8,["disabled"])])]),s("p",Ge,f(a(pe)),1),s("div",Je,[a(b).length===0?(i(),d("div",Ze,[o(x,{name:"i-heroicons-plus-circle",class:"w-7 h-7 text-slate-700"}),e[16]||(e[16]=s("p",{class:"text-sm text-slate-500"},"No questions yet. Add one below.",-1))])):w("",!0),(i(!0),d(k,null,A(a(b),l=>(i(),re(P,{key:l.id,ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-3"}},{default:m(()=>[s("div",qe,[s("p",et,f(l.prompt),1),s("button",{class:"flex-shrink-0 text-slate-700 hover:text-red-400 transition-colors mt-0.5",disabled:a(I).has(l.id),onClick:c=>he(l.id)},[o(x,{name:"i-heroicons-trash",class:"w-3.5 h-3.5"})],8,tt)]),l.response_type==="SCALE"?(i(),d("div",st,[(i(),d(k,null,A(10,c=>s("button",{key:c,class:E(["w-8 h-8 rounded-full text-xs font-semibold border transition-colors",a(y).get(l.id)?.value_numeric===c?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600 hover:text-slate-400"]),onClick:ie=>be(l.id,c)},f(c),11,lt)),64))])):l.response_type==="TEXT"?(i(),re($e,{key:1,"model-value":a(j)[l.id]??"",placeholder:"Write something…",rows:3,autoresize:"",variant:"outline",class:"w-full text-sm","onUpdate:modelValue":c=>ye(l.id,c)},null,8,["model-value","onUpdate:modelValue"])):l.response_type==="BOOLEAN"?(i(),d("div",at,[s("button",{class:E(["flex-1 py-1.5 text-sm font-medium rounded-xl border transition-colors",a(y).get(l.id)?.value_numeric===1?"bg-emerald-500/20 border-emerald-500 text-emerald-300":"border-slate-700 text-slate-500 hover:border-slate-600 hover:text-slate-400"]),onClick:c=>se(l.id,1)}," Yes ",10,nt),s("button",{class:E(["flex-1 py-1.5 text-sm font-medium rounded-xl border transition-colors",a(y).get(l.id)?.value_numeric===0?"bg-red-500/20 border-red-500 text-red-300":"border-slate-700 text-slate-500 hover:border-slate-600 hover:text-slate-400"]),onClick:c=>se(l.id,0)}," No ",10,ot)])):w("",!0)]),_:2},1024))),128))]),o(P,{ui:{root:"rounded-2xl",body:"p-0 sm:p-0 divide-y divide-slate-800"}},{default:m(()=>[s("div",it,[e[17]||(e[17]=s("p",{class:"text-xs font-semibold text-slate-400"},"Questions",-1)),o(n,{size:"xs",variant:"ghost",color:"neutral",icon:a(L)?"i-heroicons-chevron-up":"i-heroicons-plus",onClick:e[0]||(e[0]=l=>L.value=!a(L))},null,8,["icon"])]),a(L)?(i(),d("div",rt,[o(G,{modelValue:a(C),"onUpdate:modelValue":e[1]||(e[1]=l=>J(C)?C.value=l:null),placeholder:"Question prompt…",autofocus:"",onKeydown:de(le,["enter"])},null,8,["modelValue"]),s("div",dt,[e[18]||(e[18]=s("p",{class:"text-[11px] text-slate-500"},"Response type",-1)),s("div",ut,[(i(),d(k,null,A(["TEXT","SCALE","BOOLEAN"],l=>s("button",{key:l,class:E(["flex-1 py-1 text-xs font-medium rounded-lg border transition-colors",a(B)===l?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600"]),onClick:c=>B.value=l},f(l==="TEXT"?"Text":l==="SCALE"?"1–10":"Yes/No"),11,ct)),64))])]),s("div",vt,[o(n,{size:"xs",variant:"ghost",color:"neutral",onClick:e[2]||(e[2]=l=>L.value=!1)},{default:m(()=>[...e[19]||(e[19]=[p("Cancel",-1)])]),_:1}),o(n,{size:"xs",disabled:!a(C).trim()||a(Y),loading:a(Y),onClick:le},{default:m(()=>[...e[20]||(e[20]=[p(" Add ",-1)])]),_:1},8,["disabled","loading"])])])):w("",!0)]),_:1}),o(P,{ui:{root:"rounded-2xl",body:"p-0 sm:p-0 divide-y divide-slate-800"}},{default:m(()=>[s("div",mt,[e[21]||(e[21]=s("p",{class:"text-xs font-semibold text-slate-400"},"Reminders",-1)),o(n,{size:"xs",variant:"ghost",color:"neutral",icon:a(T)?"i-heroicons-chevron-up":"i-heroicons-plus",onClick:e[3]||(e[3]=l=>T.value=!a(T))},null,8,["icon"])]),(i(!0),d(k,null,A(a(R),l=>(i(),d("div",{key:l.id,class:"flex items-center justify-between px-4 py-2.5"},[s("div",null,[s("p",pt,f(l.trigger_time),1),s("p",ft,f(_e(l)),1)]),s("button",{class:"text-slate-700 hover:text-red-400 transition-colors",disabled:a(O).has(l.id),onClick:c=>Ce(l.id)},[o(x,{name:"i-heroicons-trash",class:"w-4 h-4"})],8,xt)]))),128)),a(R).length===0&&!a(T)?(i(),d("div",yt," No reminders set. ")):w("",!0),a(T)?(i(),d("div",bt,[s("div",ht,[o(G,{modelValue:a(D),"onUpdate:modelValue":e[4]||(e[4]=l=>J(D)?D.value=l:null),type:"time",class:"w-32"},null,8,["modelValue"]),e[22]||(e[22]=s("span",{class:"text-xs text-slate-500"},"Remind me at this time",-1))]),s("div",gt,[e[23]||(e[23]=s("p",{class:"text-[11px] text-slate-500"},"Days (leave blank for every day)",-1)),s("div",_t,[(i(),d(k,null,A(ne,(l,c)=>s("button",{key:c,class:E(["w-8 h-8 rounded-full text-xs font-medium border transition-colors",a(g).includes(c)?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600"]),onClick:ie=>ke(c)},f(l),11,kt)),64))])]),s("div",wt,[o(n,{size:"xs",variant:"ghost",color:"neutral",onClick:e[5]||(e[5]=l=>T.value=!1)},{default:m(()=>[...e[24]||(e[24]=[p("Cancel",-1)])]),_:1}),o(n,{size:"xs",disabled:!a(D)||a(U),loading:a(U),onClick:we},{default:m(()=>[...e[25]||(e[25]=[p(" Add ",-1)])]),_:1},8,["disabled","loading"])])])):w("",!0)]),_:1}),s("div",Ct,[e[27]||(e[27]=s("p",{class:"text-xs font-semibold text-slate-600"},"Danger zone",-1)),o(n,{variant:"soft",color:"error",size:"sm",icon:"i-heroicons-trash",onClick:e[6]||(e[6]=l=>F.value=!0)},{default:m(()=>[...e[26]||(e[26]=[p(" Delete check-in ",-1)])]),_:1})])],64)):(i(),d("div",Oe,[o(x,{name:"i-heroicons-exclamation-circle",class:"w-8 h-8 text-slate-700"}),e[15]||(e[15]=s("p",{class:"text-sm text-slate-500"},"Check-in not found.",-1)),o(n,{variant:"ghost",color:"neutral",size:"sm",to:"/checkin"},{default:m(()=>[...e[14]||(e[14]=[p("Go back",-1)])]),_:1})])),a(S)?(i(),d("div",Tt,[s("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:e[7]||(e[7]=l=>S.value=!1)}),s("div",Dt,[s("div",At,[e[28]||(e[28]=s("h3",{class:"font-semibold text-slate-100"},"Edit Check-in",-1)),o(n,{icon:"i-heroicons-x-mark",variant:"ghost",color:"neutral",size:"sm",onClick:e[8]||(e[8]=l=>S.value=!1)})]),o(G,{modelValue:a(M),"onUpdate:modelValue":e[9]||(e[9]=l=>J(M)?M.value=l:null),placeholder:"Name",onKeydown:de(oe,["enter"])},null,8,["modelValue"]),s("div",Et,[e[29]||(e[29]=s("p",{class:"text-xs text-slate-500"},"Schedule",-1)),s("div",$t,[(i(),d(k,null,A(["DAILY","WEEKLY","MONTHLY"],l=>s("button",{key:l,class:E(["flex-1 py-1.5 text-xs font-medium rounded-lg border transition-colors",a(N)===l?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600 hover:text-slate-400"]),onClick:c=>N.value=l},f(l==="DAILY"?"Daily":l==="WEEKLY"?"Weekly":"Monthly"),11,zt)),64))])]),a(N)==="WEEKLY"?(i(),d("div",Lt,[e[30]||(e[30]=s("p",{class:"text-xs text-slate-500"},"Days (leave blank for every day)",-1)),s("div",Rt,[(i(),d(k,null,A(ne,(l,c)=>s("button",{key:c,class:E(["w-8 h-8 rounded-full text-xs font-medium border transition-colors",a(_).includes(c)?"bg-primary-500/20 border-primary-500 text-primary-300":"border-slate-700 text-slate-500 hover:border-slate-600"]),onClick:ie=>De(c)},f(l),11,St)),64))])])):w("",!0),s("div",Nt,[o(n,{variant:"ghost",color:"neutral",size:"sm",onClick:e[10]||(e[10]=l=>S.value=!1)},{default:m(()=>[...e[31]||(e[31]=[p("Cancel",-1)])]),_:1}),o(n,{size:"sm",disabled:a(K),loading:a(K),onClick:oe},{default:m(()=>[...e[32]||(e[32]=[p("Save",-1)])]),_:1},8,["disabled","loading"])])])])):w("",!0),a(F)?(i(),d("div",jt,[s("div",{class:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:e[11]||(e[11]=l=>F.value=!1)}),s("div",Vt,[e[37]||(e[37]=s("h3",{class:"font-semibold text-slate-100"},"Delete check-in?",-1)),s("p",Yt,[e[33]||(e[33]=p(" This will delete ",-1)),s("span",Ut,f(a(v)?.title),1),e[34]||(e[34]=p(" along with all its questions and responses. This cannot be undone. ",-1))]),s("div",Mt,[o(n,{variant:"ghost",color:"neutral",size:"sm",onClick:e[12]||(e[12]=l=>F.value=!1)},{default:m(()=>[...e[35]||(e[35]=[p("Cancel",-1)])]),_:1}),o(n,{color:"error",size:"sm",disabled:a(Q),loading:a(Q),onClick:Ae},{default:m(()=>[...e[36]||(e[36]=[p(" Delete ",-1)])]),_:1},8,["disabled","loading"])])])])):w("",!0)])}}});export{Ot as default};
