import{_ as X}from"./Cwm85ug8.js";import{e as Z,g as tt,o,c as l,a,b as g,w as _,t as c,i,F as y,r as m,k,n as S,T as et,p as st,l as at,y as w,x as f,A as nt}from"./5yv4BkwC.js";import{_ as ot}from"./DlAUqK2U.js";const lt={class:"space-y-5"},rt={class:"grid grid-cols-3 gap-2"},it={class:"text-2xl font-bold text-slate-100"},dt={class:"text-2xl font-bold text-slate-100"},ct={class:"text-2xl font-bold text-slate-100"},ut={key:0,class:"flex items-center justify-center py-6"},xt={key:1,class:"flex items-center justify-center py-6"},pt={key:2,class:"overflow-x-auto -mx-1 px-1"},ft={class:"inline-flex flex-col gap-1"},gt={class:"flex gap-0.5 ml-5"},yt={class:"flex gap-1"},mt={class:"flex flex-col gap-0.5 w-4 flex-shrink-0"},_t={class:"flex gap-0.5"},vt=["onClick"],ht={class:"h-6 flex items-center ml-5"},bt={key:0,class:"text-xs"},kt={class:"text-slate-300 font-medium"},wt={key:0,class:"text-slate-600"},Dt={key:1,class:"text-slate-400"},Ct={key:2,class:"text-cyan-400 ml-1"},Mt={key:1,class:"text-[10px] text-slate-700"},St={class:"flex items-center gap-1 ml-5"},Lt={key:0,class:"flex items-center justify-center py-6"},At={key:1,class:"flex items-end gap-1.5 h-28"},Ft={class:"w-full flex-1 flex items-end"},$t={class:"text-[10px] text-slate-600"},Ot={class:"flex items-center justify-between"},Ht={class:"flex gap-0.5"},It=["onClick"],Bt={key:0,class:"flex items-center justify-center py-6"},Et={key:1,class:"space-y-3"},Nt={class:"w-20 text-xs text-slate-400 truncate flex-shrink-0"},Tt={class:"flex-1 h-1.5 bg-slate-800 rounded-full overflow-hidden"},jt={class:"w-7 text-[11px] text-slate-500 text-right flex-shrink-0"},T=17,Rt=Z({__name:"stats",setup(Ut){const D=nt(),p=w([]),I=w([]),B=w([]),L=w(!0),v=new Date().toISOString().slice(0,10),A=(()=>{const e=new Date;return e.setMonth(e.getMonth()-6),e.toISOString().slice(0,10)})();async function j(){if(!D.isAvailable){L.value=!1;return}const[e,t,n]=await Promise.all([D.getHabits(),D.getCompletionsForDateRange(A,v),D.getHabitLogsForDateRange(A,v)]);p.value=e,I.value=t,B.value=n,L.value=!1}const R=f(()=>{const e=new Map;for(const t of I.value)e.has(t.date)||e.set(t.date,new Set),e.get(t.date).add(t.habit_id);return e}),U=f(()=>{const e=new Map;for(const t of B.value){e.has(t.date)||e.set(t.date,new Map);const n=e.get(t.date);n.set(t.habit_id,(n.get(t.habit_id)??0)+t.value)}return e});function F(e,t){if(e.type==="BOOLEAN")return R.value.get(t)?.has(e.id)??!1;const n=U.value.get(t),r=n?.has(e.id)??!1,s=n?.get(e.id)??0;return e.type==="NUMERIC"?s>=e.target_value:r&&s<e.target_value}const C=(()=>{const e=[],t=new Date(v),n=new Date(A);for(;t>=n;)e.push(t.toISOString().slice(0,10)),t.setDate(t.getDate()-1);return e})(),$=f(()=>{const e=new Map;for(const t of C){let n=0;for(const r of p.value)F(r,t)&&n++;n>0&&e.set(t,n)}return e}),O=f(()=>p.value.length);function W(e){let t=0;for(const n of C){if(!F(e,n))break;t++}return t}const P=f(()=>Math.max(0,...p.value.map(W))),V=f(()=>{if(!p.value.length)return 0;let e=0;for(let t=0;t<30;t++)e+=$.value.get(C[t])??0;return Math.round(e/(p.value.length*30)*100)});function Y(e,t){let n=0;for(let r=1;r<=t;r++)n+=$.value.get(`${e}-${String(r).padStart(2,"0")}`)??0;return n}const z=f(()=>{const e=new Date;return Array.from({length:6},(t,n)=>{const r=new Date(e.getFullYear(),e.getMonth()-(5-n),1),s=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,x=new Date(r.getFullYear(),r.getMonth()+1,0).getDate(),d=n===5?e.getDate():x,b=Y(s,d),M=p.value.length&&d?Math.min(100,Math.round(b/(p.value.length*d)*100)):0;return{label:r.toLocaleDateString("en-US",{month:"short"}),rate:M}})}),H=w(30),E=f(()=>{const e=H.value,t=C.slice(0,e);return p.value.map(n=>{let r=0;for(const s of t)F(n,s)&&r++;return{habit:n,rate:Math.round(r/e*100)}}).sort((n,r)=>r.rate-n.rate).slice(0,6)});function K(e,t,n){const r=[];for(let s=0;s<7;s++){const x=new Date(e);x.setDate(e.getDate()+t*7+s);const d=x.toISOString().slice(0,10),b=d>v,M=!b&&n>0?$.value.get(d)??0:0;r.push({date:d,doneCount:M,total:n,rate:n&&!b?Math.round(M/n*100):0,isToday:d===v,isFuture:b})}return r}const N=f(()=>{const e=p.value.length,t=new Date(v);return t.setDate(t.getDate()-(T*7-1)-t.getDay()),Array.from({length:T},(n,r)=>K(t,r,e))});function q(e){const t=e.find(n=>n.date.slice(8)==="01");return t?new Date(`${t.date}T12:00:00`).toLocaleDateString("en-US",{month:"short"}):""}const h=["#1e293b","#083344","#0e4d6c","#0e7490","#22d3ee"];function G(e){return e.isFuture||e.total===0||e.rate===0?h[0]:e.rate<=33?h[1]:e.rate<=66?h[2]:e.rate<100?h[3]:h[4]}const u=w(null);function J(e){u.value=u.value?.date===e.date?null:e}const Q=["","Mo","","We","","Fr",""];return tt(j),(e,t)=>{const n=X,r=at;return o(),l("div",lt,[t[16]||(t[16]=a("header",null,[a("p",{class:"text-sm text-slate-500"},"Overview"),a("h2",{class:"text-2xl font-bold"},"Analytics")],-1)),a("div",rt,[g(n,{ui:{root:"rounded-2xl",body:"p-3 sm:p-3 space-y-1 text-center"}},{default:_(()=>[t[0]||(t[0]=a("p",{class:"text-[10px] text-slate-500 uppercase tracking-wide"},"Habits",-1)),a("p",it,c(i(O)),1),t[1]||(t[1]=a("p",{class:"text-[10px] text-slate-600"},"active",-1))]),_:1}),g(n,{ui:{root:"rounded-2xl",body:"p-3 sm:p-3 space-y-1 text-center"}},{default:_(()=>[t[2]||(t[2]=a("p",{class:"text-[10px] text-slate-500 uppercase tracking-wide"},"Streak",-1)),a("p",dt,c(i(P)),1),t[3]||(t[3]=a("p",{class:"text-[10px] text-slate-600"},"days best",-1))]),_:1}),g(n,{ui:{root:"rounded-2xl",body:"p-3 sm:p-3 space-y-1 text-center"}},{default:_(()=>[t[4]||(t[4]=a("p",{class:"text-[10px] text-slate-500 uppercase tracking-wide"},"Avg",-1)),a("p",ct,c(i(V))+"%",1),t[5]||(t[5]=a("p",{class:"text-[10px] text-slate-600"},"30 days",-1))]),_:1})]),g(n,{ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-3"}},{default:_(()=>[t[11]||(t[11]=a("p",{class:"text-xs font-semibold text-slate-400"},"Daily Completion",-1)),i(L)?(o(),l("div",ut,[...t[6]||(t[6]=[a("p",{class:"text-xs text-slate-600"},"Loading…",-1)])])):i(O)?(o(),l("div",pt,[a("div",ft,[a("div",gt,[(o(!0),l(y,null,m(i(N),(s,x)=>(o(),l("div",{key:x,class:"w-3.5 flex-shrink-0 h-3 text-[9px] text-slate-500 leading-none"},c(q(s)),1))),128))]),a("div",yt,[a("div",mt,[(o(),l(y,null,m(Q,(s,x)=>a("div",{key:x,class:"h-3.5 text-[9px] text-slate-600 flex items-center justify-end"},c(s),1)),64))]),a("div",_t,[(o(!0),l(y,null,m(i(N),(s,x)=>(o(),l("div",{key:x,class:"flex flex-col gap-0.5"},[(o(!0),l(y,null,m(s,d=>(o(),l("button",{key:d.date,class:S(["w-3.5 h-3.5 rounded-[3px] flex-shrink-0 transition-transform active:scale-110",i(u)?.date===d.date?"ring-1 ring-white/60 ring-offset-[1.5px] ring-offset-slate-900":d.isToday?"ring-1 ring-cyan-400/80 ring-offset-[1.5px] ring-offset-slate-900":""]),style:k({backgroundColor:G(d)}),onClick:b=>J(d)},null,14,vt))),128))]))),128))])]),a("div",ht,[g(et,{name:"fade"},{default:_(()=>[i(u)?(o(),l("p",bt,[a("span",kt,c(i(u).date),1),t[8]||(t[8]=a("span",{class:"text-slate-500 mx-1"},"—",-1)),i(u).isFuture?(o(),l("span",wt,"future")):(o(),l("span",Dt,c(i(u).doneCount)+"/"+c(i(u).total)+" habits",1)),!i(u).isFuture&&i(u).doneCount===i(u).total&&i(u).total>0?(o(),l("span",Ct,"✓ Perfect day")):st("",!0)])):(o(),l("p",Mt,"Tap any cell"))]),_:1})]),a("div",St,[t[9]||(t[9]=a("span",{class:"text-[10px] text-slate-600 mr-0.5"},"Less",-1)),(o(),l(y,null,m(h,s=>a("div",{key:s,class:"w-3.5 h-3.5 rounded-[3px]",style:k({backgroundColor:s})},null,4)),64)),t[10]||(t[10]=a("span",{class:"text-[10px] text-slate-600 ml-0.5"},"More",-1))])])])):(o(),l("div",xt,[...t[7]||(t[7]=[a("p",{class:"text-xs text-slate-600"},"No habits yet",-1)])]))]),_:1}),g(n,{ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-3"}},{default:_(()=>[t[13]||(t[13]=a("p",{class:"text-xs font-semibold text-slate-400"},"Monthly Completion Rate",-1)),i(O)?(o(),l("div",At,[(o(!0),l(y,null,m(i(z),s=>(o(),l("div",{key:s.label,class:"flex-1 flex flex-col items-center gap-1"},[a("span",{class:S(["text-[10px] font-medium tabular-nums",s.rate>=70?"text-emerald-400":s.rate>=40?"text-amber-400":s.rate>0?"text-rose-400":"text-slate-700"])},c(s.rate>0?`${s.rate}%`:"—"),3),a("div",Ft,[a("div",{class:S(["w-full rounded-t transition-all duration-700",s.rate>=70?"bg-emerald-500":s.rate>=40?"bg-amber-400":s.rate>0?"bg-rose-500":"bg-slate-800"]),style:k({height:`${Math.max(s.rate>0?4:0,s.rate)}%`})},null,6)]),a("span",$t,c(s.label),1)]))),128))])):(o(),l("div",Lt,[...t[12]||(t[12]=[a("p",{class:"text-xs text-slate-600"},"No data yet",-1)])]))]),_:1}),g(n,{ui:{root:"rounded-2xl",body:"p-4 sm:p-4 space-y-3"}},{default:_(()=>[a("div",Ot,[t[14]||(t[14]=a("p",{class:"text-xs font-semibold text-slate-400"},"Habit Completion",-1)),a("div",Ht,[(o(),l(y,null,m([7,14,30,90],s=>a("button",{key:s,class:S(["px-2 py-0.5 rounded text-[10px] font-medium transition-colors",i(H)===s?"bg-slate-700 text-slate-100":"text-slate-500 hover:text-slate-400"]),onClick:x=>H.value=s},c(s)+"d",11,It)),64))])]),i(E).length?(o(),l("div",Et,[(o(!0),l(y,null,m(i(E),s=>(o(),l("div",{key:s.habit.id,class:"flex items-center gap-2"},[a("div",{class:"w-5 h-5 rounded-full flex-shrink-0 flex items-center justify-center",style:k({backgroundColor:s.habit.color+"33"})},[g(r,{name:s.habit.icon,class:"w-3 h-3",style:k({color:s.habit.color})},null,8,["name","style"])],4),a("p",Nt,c(s.habit.name),1),a("div",Tt,[a("div",{class:"h-full rounded-full transition-all duration-700",style:k({width:`${s.rate}%`,backgroundColor:s.habit.color})},null,4)]),a("span",jt,c(s.rate)+"%",1)]))),128))])):(o(),l("div",Bt,[...t[15]||(t[15]=[a("p",{class:"text-xs text-slate-600"},"No data yet",-1)])]))]),_:1})])}}}),Yt=ot(Rt,[["__scopeId","data-v-67e791a9"]]);export{Yt as default};
