import{e as H,f as K,g as P,o as i,c as d,h as q,i as s,a as o,b as x,w as E,d as N,j as Q,F as C,r as j,n as D,t as f,k as S,l as W,m as G,p as b,q as J,s as T,v as X,T as Y,x as Z,y as p,z as ee,A as te,B as se}from"./xAnKZML8.js";import{u as ae}from"./Bd4hLxuj.js";import{_ as ne}from"./DlAUqK2U.js";const le={class:"space-y-5"},oe={key:0,class:"flex flex-col items-center justify-center gap-4 py-8 text-center"},re={key:1,class:"overflow-x-auto -mx-4 px-4"},ie={class:"min-w-max"},de={class:"flex items-end pb-2 border-b border-slate-800"},ce={class:"text-[9px] text-slate-600"},ue={class:"w-32 shrink-0 pr-2 flex items-center gap-2 min-w-0"},fe={class:"text-xs font-medium text-slate-200 truncate"},pe=["disabled","onClick"],me=["onClick"],ve={key:0,class:"fixed inset-x-0 bottom-0 z-50 bg-slate-900 border-t border-slate-700"},xe={class:"px-4 pb-2 flex items-center gap-2.5"},ge={class:"flex-1 min-w-0"},ye={class:"text-sm font-semibold text-slate-100 truncate"},be={class:"text-xs text-slate-400"},ke={class:"px-4 pb-5 flex items-center gap-3"},we={class:"text-sm text-slate-500 shrink-0 w-10"},he=["disabled"],_e=H({__name:"week",setup(Ce){const u=te(),{settings:g}=ae(),m=new Date().toISOString().slice(0,10),k=(()=>{const t=new Date;return t.setDate(t.getDate()-6),t.toISOString().slice(0,10)})(),L=Z(()=>{const t=[];for(let e=g.value.weekDays-1;e>=0;e--){const l=new Date;l.setDate(l.getDate()-e),t.push(l.toISOString().slice(0,10))}return t}),I=p([]),$=p([]),w=p([]),h=p(!0);async function V(){if(!u.isAvailable){h.value=!1;return}const[t,e,l]=await Promise.all([u.getHabits(),u.getCompletionsForDateRange(k,m),u.getHabitLogsForDateRange(k,m)]);I.value=t,$.value=e,w.value=l,h.value=!1}function v(t,e){return w.value.filter(l=>l.habit_id===t&&l.date===e).reduce((l,c)=>l+c.value,0)}function M(t,e){if(t.type==="BOOLEAN")return $.value.some(c=>c.habit_id===t.id&&c.date===e);const l=v(t.id,e);return t.type==="NUMERIC"?l>=t.target_value:l>0&&l<t.target_value}const _=ee(new Set);async function O(t,e){const l=`${t.id}:${e}`;if(!(_.has(l)||!u.isAvailable)){_.add(l);try{await u.toggleCompletion(t.id,e),$.value=await u.getCompletionsForDateRange(k,m)}finally{_.delete(l)}}}const n=p(null),A=p(null),y=p(!1);K(n,t=>{t&&se(()=>A.value?.focus())});function z(t,e){const l=g.value.logInputMode==="absolute"?v(t.id,e):0;n.value={habit:t,date:e,value:l}}async function R(){if(!n.value||y.value||!u.isAvailable)return;const{habit:t,date:e,value:l}=n.value,c=g.value.logInputMode==="absolute";if(!c&&l<=0){n.value=null;return}y.value=!0;try{if(c){const a=w.value.filter(r=>r.habit_id===t.id&&r.date===e);await Promise.all(a.map(r=>u.deleteHabitLog(r.id))),l>0&&await u.logHabitValue(t.id,e,l)}else await u.logHabitValue(t.id,e,l);w.value=await u.getHabitLogsForDateRange(k,m),n.value=null}finally{y.value=!1}}function B(t){return t===m?"Today":new Date(`${t}T12:00:00`).toLocaleDateString("en-US",{weekday:"short"})}function U(t){return new Date(`${t}T12:00:00`).toLocaleDateString("en-US",{month:"short",day:"numeric"})}return P(V),(t,e)=>{const l=Q,c=W;return i(),d("div",le,[e[9]||(e[9]=q('<header class="flex flex-col items-center gap-3 pt-2" data-v-df9d1ac4><div class="relative flex items-center justify-center" data-v-df9d1ac4><div class="absolute w-44 h-44 rounded-full bg-primary-500/10 blur-3xl" data-v-df9d1ac4></div><svg class="plant-logo relative w-24 h-28" viewBox="0 0 40 44" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-v-df9d1ac4><path d="M 8,40 C 12,37 28,37 32,40" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" data-v-df9d1ac4></path><line x1="20" y1="40" x2="20" y2="24" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" data-v-df9d1ac4></line><path d="M 20,24 C 11,23 4,29 8,34 C 11,37 19,30 20,24" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round" data-v-df9d1ac4></path><path d="M 20,24 C 26,20 32,14 30,8 C 28,5 20,13 20,24" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round" data-v-df9d1ac4></path></svg></div><div class="text-center" data-v-df9d1ac4><p class="text-sm text-slate-500" data-v-df9d1ac4>Quick fill</p><h2 class="text-2xl font-bold" data-v-df9d1ac4>Week</h2></div></header>',1)),!s(h)&&s(I).length===0?(i(),d("div",oe,[e[5]||(e[5]=o("p",{class:"font-semibold text-slate-200"},"No habits yet",-1)),x(l,{to:"/habits",size:"sm",variant:"soft",color:"neutral"},{default:E(()=>[...e[4]||(e[4]=[N("Add habits",-1)])]),_:1})])):s(h)?b("",!0):(i(),d("div",re,[o("div",ie,[o("div",de,[e[6]||(e[6]=o("div",{class:"w-32 shrink-0 pr-2"},null,-1)),(i(!0),d(C,null,j(s(L),a=>(i(),d("div",{key:a,class:"w-12 shrink-0 text-center"},[o("p",{class:D(["text-[10px] font-semibold",a===s(m)?"text-primary-400":"text-slate-500"])},f(B(a)),3),o("p",ce,f(U(a)),1)]))),128))]),(i(!0),d(C,null,j(s(I),a=>(i(),d("div",{key:a.id,class:"flex items-center border-b border-slate-800/40 py-1.5"},[o("div",ue,[o("div",{class:"w-6 h-6 rounded-full shrink-0 flex items-center justify-center",style:S({backgroundColor:a.color+"33"})},[x(c,{name:a.icon,class:"w-3.5 h-3.5",style:S({color:a.color})},null,8,["name","style"])],4),o("span",fe,f(a.name),1)]),(i(!0),d(C,null,j(s(L),r=>(i(),d("div",{key:r,class:"w-12 shrink-0 flex items-center justify-center"},[a.type==="BOOLEAN"?(i(),d("button",{key:0,class:D(["w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all duration-150",M(a,r)?"bg-primary-500 border-primary-500":"border-slate-700 hover:border-slate-500 bg-transparent"]),disabled:s(_).has(`${a.id}:${r}`),onClick:F=>O(a,r)},[M(a,r)?(i(),G(c,{key:0,name:"i-heroicons-check",class:"w-3.5 h-3.5 text-white"})):b("",!0)],10,pe)):(i(),d("button",{key:1,class:D(["w-8 h-8 rounded-lg flex items-center justify-center text-xs font-medium transition-all border",[M(a,r)?a.type==="NUMERIC"?"bg-primary-500/20 border-primary-500/40 text-primary-300":"bg-amber-500/20 border-amber-500/40 text-amber-300":v(a.id,r)>0?"border-slate-600 text-slate-300 bg-slate-800/60":"border-slate-800 text-slate-700",s(n)?.habit.id===a.id&&s(n)?.date===r?"ring-2 ring-primary-500 ring-offset-1 ring-offset-slate-950":""]]),onClick:F=>z(a,r)},f(v(a.id,r)>0?v(a.id,r):"·"),11,me))]))),128))]))),128))])])),s(n)?(i(),d("div",{key:2,class:"fixed inset-0 z-40 bg-black/40",onClick:e[0]||(e[0]=a=>n.value=null)})):b("",!0),x(Y,{name:"slide-up"},{default:E(()=>[s(n)?(i(),d("div",ve,[e[7]||(e[7]=o("div",{class:"flex justify-center pt-2.5 pb-1"},[o("div",{class:"w-10 h-1 rounded-full bg-slate-700"})],-1)),o("div",xe,[o("div",{class:"w-7 h-7 rounded-full shrink-0 flex items-center justify-center",style:S({backgroundColor:s(n).habit.color+"33"})},[x(c,{name:s(n).habit.icon,class:"w-4 h-4",style:S({color:s(n).habit.color})},null,8,["name","style"])],4),o("div",ge,[o("p",ye,f(s(n).habit.name),1),o("p",be,[N(f(B(s(n).date))+", "+f(U(s(n).date))+" · "+f(s(n).habit.type==="NUMERIC"?`target ${s(n).habit.target_value}`:`limit ${s(n).habit.target_value}`)+" ",1),s(g).logInputMode==="increment"?(i(),d(C,{key:0},[N(" · now: "+f(v(s(n).habit.id,s(n).date)),1)],64)):b("",!0)])]),o("button",{class:"p-1.5 text-slate-500 hover:text-slate-300 transition-colors",onClick:e[1]||(e[1]=a=>n.value=null)},[x(c,{name:"i-heroicons-x-mark",class:"w-5 h-5"})])]),o("div",ke,[J(o("input",{ref_key:"cellInputRef",ref:A,"onUpdate:modelValue":e[2]||(e[2]=a=>s(n).value=a),type:"number",min:"0",step:"any",class:"flex-1 bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-xl font-semibold text-slate-100 text-center focus:outline-none focus:border-primary-500 transition-colors",onKeydown:[T(R,["enter"]),e[3]||(e[3]=T(a=>n.value=null,["escape"]))]},null,544),[[X,s(n).value,void 0,{number:!0}]]),o("span",we,f(s(g).logInputMode==="increment"?"add":(s(n).habit.type==="NUMERIC","total")),1),o("button",{class:D(["w-12 h-12 rounded-xl bg-primary-500 flex items-center justify-center shrink-0 transition-opacity",s(y)?"opacity-50":""]),disabled:s(y),onClick:R},[x(c,{name:"i-heroicons-check",class:"w-5 h-5 text-white"})],10,he)]),e[8]||(e[8]=o("div",{class:"safe-area-bottom"},null,-1))])):b("",!0)]),_:1})])}}}),$e=ne(_e,[["__scopeId","data-v-df9d1ac4"]]);export{$e as default};
